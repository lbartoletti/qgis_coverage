<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">

<html lang="en">

<head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <title>LCOV - coverage.info.cleaned - analysis/interpolation/qgsdualedgetriangulation.cpp</title>
  <link rel="stylesheet" type="text/css" href="../../gcov.css">
</head>

<body>

  <table width="100%" border=0 cellspacing=0 cellpadding=0>
    <tr><td class="title">LCOV - code coverage report</td></tr>
    <tr><td class="ruler"><img src="../../glass.png" width=3 height=3 alt=""></td></tr>

    <tr>
      <td width="100%">
        <table cellpadding=1 border=0 width="100%">
          <tr>
            <td width="10%" class="headerItem">Current view:</td>
            <td width="35%" class="headerValue"><a href="../../index.html">top level</a> - <a href="index.html">analysis/interpolation</a> - qgsdualedgetriangulation.cpp<span style="font-size: 80%;"> (source / <a href="qgsdualedgetriangulation.cpp.func-sort-c.html">functions</a>)</span></td>
            <td width="5%"></td>
            <td width="15%"></td>
            <td width="10%" class="headerCovTableHead">Hit</td>
            <td width="10%" class="headerCovTableHead">Total</td>
            <td width="15%" class="headerCovTableHead">Coverage</td>
          </tr>
          <tr>
            <td class="headerItem">Test:</td>
            <td class="headerValue">coverage.info.cleaned</td>
            <td></td>
            <td class="headerItem">Lines:</td>
            <td class="headerCovTableEntry">0</td>
            <td class="headerCovTableEntry">1743</td>
            <td class="headerCovTableEntryLo">0.0 %</td>
          </tr>
          <tr>
            <td class="headerItem">Date:</td>
            <td class="headerValue">2021-04-10 08:29:14</td>
            <td></td>
            <td class="headerItem">Functions:</td>
            <td class="headerCovTableEntry">0</td>
            <td class="headerCovTableEntry">0</td>
            <td class="headerCovTableEntryHi">-</td>
          </tr>
          <tr>
            <td></td>
            <td></td>
            <td></td>
            <td class="headerItem">Branches:</td>
            <td class="headerCovTableEntry">0</td>
            <td class="headerCovTableEntry">0</td>
            <td class="headerCovTableEntryHi">-</td>
          </tr>
          <tr><td><img src="../../glass.png" width=3 height=3 alt=""></td></tr>
        </table>
      </td>
    </tr>

    <tr><td class="ruler"><img src="../../glass.png" width=3 height=3 alt=""></td></tr>
  </table>

  <table cellpadding=0 cellspacing=0 border=0>
    <tr>
      <td><br></td>
    </tr>
    <tr>
      <td>
<pre class="sourceHeading">           Branch data     Line data    Source code</pre>
<pre class="source">
<a name="1"><span class="lineNum">       1 </span>                :            : /***************************************************************************</a>
<a name="2"><span class="lineNum">       2 </span>                :            :                           QgsDualEdgeTriangulation.cpp</a>
<a name="3"><span class="lineNum">       3 </span>                :            :                           -------------------------</a>
<a name="4"><span class="lineNum">       4 </span>                :            :     copyright            : (C) 2004 by Marco Hugentobler</a>
<a name="5"><span class="lineNum">       5 </span>                :            :     email                : mhugent@geo.unizh.ch</a>
<a name="6"><span class="lineNum">       6 </span>                :            :  ***************************************************************************/</a>
<a name="7"><span class="lineNum">       7 </span>                :            : </a>
<a name="8"><span class="lineNum">       8 </span>                :            : /***************************************************************************</a>
<a name="9"><span class="lineNum">       9 </span>                :            :  *                                                                         *</a>
<a name="10"><span class="lineNum">      10 </span>                :            :  *   This program is free software; you can redistribute it and/or modify  *</a>
<a name="11"><span class="lineNum">      11 </span>                :            :  *   it under the terms of the GNU General Public License as published by  *</a>
<a name="12"><span class="lineNum">      12 </span>                :            :  *   the Free Software Foundation; either version 2 of the License, or     *</a>
<a name="13"><span class="lineNum">      13 </span>                :            :  *   (at your option) any later version.                                   *</a>
<a name="14"><span class="lineNum">      14 </span>                :            :  *                                                                         *</a>
<a name="15"><span class="lineNum">      15 </span>                :            :  ***************************************************************************/</a>
<a name="16"><span class="lineNum">      16 </span>                :            : </a>
<a name="17"><span class="lineNum">      17 </span>                :            : #include &lt;QStack&gt;</a>
<a name="18"><span class="lineNum">      18 </span>                :            : #include &quot;qgsdualedgetriangulation.h&quot;</a>
<a name="19"><span class="lineNum">      19 </span>                :            : #include &lt;map&gt;</a>
<a name="20"><span class="lineNum">      20 </span>                :            : #include &quot;MathUtils.h&quot;</a>
<a name="21"><span class="lineNum">      21 </span>                :            : #include &quot;qgsgeometry.h&quot;</a>
<a name="22"><span class="lineNum">      22 </span>                :            : #include &quot;qgslogger.h&quot;</a>
<a name="23"><span class="lineNum">      23 </span>                :            : #include &quot;qgsvectorfilewriter.h&quot;</a>
<a name="24"><span class="lineNum">      24 </span>                :            : #include &quot;qgsinterpolator.h&quot;</a>
<a name="25"><span class="lineNum">      25 </span>                :            : </a>
<a name="26"><span class="lineNum">      26 </span>                :            : double leftOfTresh = 0;</a>
<a name="27"><span class="lineNum">      27 </span>                :            : </a>
<a name="28"><span class="lineNum">      28 </span>                :<span class="lineNoCov">          0 : static bool inCircle( const QgsPoint &amp;testedPoint, const QgsPoint &amp;point1, const QgsPoint &amp;point2, const QgsPoint &amp;point3 )</span></a>
<a name="29"><span class="lineNum">      29 </span>                :            : {</a>
<a name="30"><span class="lineNum">      30 </span>                :<span class="lineNoCov">          0 :   double x2 = point2.x() - point1.x();</span></a>
<a name="31"><span class="lineNum">      31 </span>                :<span class="lineNoCov">          0 :   double y2 = point2.y() - point1.y();</span></a>
<a name="32"><span class="lineNum">      32 </span>                :<span class="lineNoCov">          0 :   double x3 = point3.x() - point1.x();</span></a>
<a name="33"><span class="lineNum">      33 </span>                :<span class="lineNoCov">          0 :   double y3 = point3.y() - point1.y();</span></a>
<a name="34"><span class="lineNum">      34 </span>                :            : </a>
<a name="35"><span class="lineNum">      35 </span>                :<span class="lineNoCov">          0 :   double denom = x2 * y3 - y2 * x3;</span></a>
<a name="36"><span class="lineNum">      36 </span>                :            :   double frac;</a>
<a name="37"><span class="lineNum">      37 </span>                :            : </a>
<a name="38"><span class="lineNum">      38 </span>                :<span class="lineNoCov">          0 :   if ( denom == 0 )</span></a>
<a name="39"><span class="lineNum">      39 </span>                :<span class="lineNoCov">          0 :     return false;</span></a>
<a name="40"><span class="lineNum">      40 </span>                :            : </a>
<a name="41"><span class="lineNum">      41 </span>                :<span class="lineNoCov">          0 :   frac = ( x2 * ( x2 - x3 ) + y2 * ( y2 - y3 ) ) / denom;</span></a>
<a name="42"><span class="lineNum">      42 </span>                :<span class="lineNoCov">          0 :   double cx = ( x3 + frac * y3 ) / 2;</span></a>
<a name="43"><span class="lineNum">      43 </span>                :<span class="lineNoCov">          0 :   double cy = ( y3 - frac * x3 ) / 2;</span></a>
<a name="44"><span class="lineNum">      44 </span>                :<span class="lineNoCov">          0 :   double squaredRadius = ( cx * cx + cy * cy );</span></a>
<a name="45"><span class="lineNum">      45 </span>                :<span class="lineNoCov">          0 :   QgsPoint center( cx + point1.x(), cy + point1.y() );</span></a>
<a name="46"><span class="lineNum">      46 </span>                :            : </a>
<a name="47"><span class="lineNum">      47 </span>                :<span class="lineNoCov">          0 :   return  center.distanceSquared( testedPoint ) &lt; squaredRadius ;</span></a>
<a name="48"><span class="lineNum">      48 </span>                :<span class="lineNoCov">          0 : }</span></a>
<a name="49"><span class="lineNum">      49 </span>                :            : </a>
<a name="50"><span class="lineNum">      50 </span>                :<span class="lineNoCov">          0 : QgsDualEdgeTriangulation::~QgsDualEdgeTriangulation()</span></a>
<a name="51"><span class="lineNum">      51 </span>                :<span class="lineNoCov">          0 : {</span></a>
<a name="52"><span class="lineNum">      52 </span>                :            :   //remove all the points</a>
<a name="53"><span class="lineNum">      53 </span>                :<span class="lineNoCov">          0 :   if ( !mPointVector.isEmpty() )</span></a>
<a name="54"><span class="lineNum">      54 </span>                :            :   {</a>
<a name="55"><span class="lineNum">      55 </span>                :<span class="lineNoCov">          0 :     for ( int i = 0; i &lt; mPointVector.count(); i++ )</span></a>
<a name="56"><span class="lineNum">      56 </span>                :            :     {</a>
<a name="57"><span class="lineNum">      57 </span>                :<span class="lineNoCov">          0 :       delete mPointVector[i];</span></a>
<a name="58"><span class="lineNum">      58 </span>                :<span class="lineNoCov">          0 :     }</span></a>
<a name="59"><span class="lineNum">      59 </span>                :<span class="lineNoCov">          0 :   }</span></a>
<a name="60"><span class="lineNum">      60 </span>                :            : </a>
<a name="61"><span class="lineNum">      61 </span>                :            :   //remove all the HalfEdge</a>
<a name="62"><span class="lineNum">      62 </span>                :<span class="lineNoCov">          0 :   if ( !mHalfEdge.isEmpty() )</span></a>
<a name="63"><span class="lineNum">      63 </span>                :            :   {</a>
<a name="64"><span class="lineNum">      64 </span>                :<span class="lineNoCov">          0 :     for ( int i = 0; i &lt; mHalfEdge.count(); i++ )</span></a>
<a name="65"><span class="lineNum">      65 </span>                :            :     {</a>
<a name="66"><span class="lineNum">      66 </span>                :<span class="lineNoCov">          0 :       delete mHalfEdge[i];</span></a>
<a name="67"><span class="lineNum">      67 </span>                :<span class="lineNoCov">          0 :     }</span></a>
<a name="68"><span class="lineNum">      68 </span>                :<span class="lineNoCov">          0 :   }</span></a>
<a name="69"><span class="lineNum">      69 </span>                :<span class="lineNoCov">          0 : }</span></a>
<a name="70"><span class="lineNum">      70 </span>                :            : </a>
<a name="71"><span class="lineNum">      71 </span>                :<span class="lineNoCov">          0 : void QgsDualEdgeTriangulation::performConsistencyTest()</span></a>
<a name="72"><span class="lineNum">      72 </span>                :            : {</a>
<a name="73"><span class="lineNum">      73 </span>                :<span class="lineNoCov">          0 :   QgsDebugMsg( QStringLiteral( &quot;performing consistency test&quot; ) );</span></a>
<a name="74"><span class="lineNum">      74 </span>                :            : </a>
<a name="75"><span class="lineNum">      75 </span>                :<span class="lineNoCov">          0 :   for ( int i = 0; i &lt; mHalfEdge.count(); i++ )</span></a>
<a name="76"><span class="lineNum">      76 </span>                :            :   {</a>
<a name="77"><span class="lineNum">      77 </span>                :<span class="lineNoCov">          0 :     int a = mHalfEdge[mHalfEdge[i]-&gt;getDual()]-&gt;getDual();</span></a>
<a name="78"><span class="lineNum">      78 </span>                :<span class="lineNoCov">          0 :     int b = mHalfEdge[mHalfEdge[mHalfEdge[i]-&gt;getNext()]-&gt;getNext()]-&gt;getNext();</span></a>
<a name="79"><span class="lineNum">      79 </span>                :<span class="lineNoCov">          0 :     if ( i != a )</span></a>
<a name="80"><span class="lineNum">      80 </span>                :            :     {</a>
<a name="81"><span class="lineNum">      81 </span>                :<span class="lineNoCov">          0 :       QgsDebugMsg( QStringLiteral( &quot;warning, first test failed&quot; ) );</span></a>
<a name="82"><span class="lineNum">      82 </span>                :<span class="lineNoCov">          0 :     }</span></a>
<a name="83"><span class="lineNum">      83 </span>                :<span class="lineNoCov">          0 :     if ( i != b )</span></a>
<a name="84"><span class="lineNum">      84 </span>                :            :     {</a>
<a name="85"><span class="lineNum">      85 </span>                :<span class="lineNoCov">          0 :       QgsDebugMsg( QStringLiteral( &quot;warning, second test failed&quot; ) );</span></a>
<a name="86"><span class="lineNum">      86 </span>                :<span class="lineNoCov">          0 :     }</span></a>
<a name="87"><span class="lineNum">      87 </span>                :<span class="lineNoCov">          0 :   }</span></a>
<a name="88"><span class="lineNum">      88 </span>                :<span class="lineNoCov">          0 :   QgsDebugMsg( QStringLiteral( &quot;consistency test finished&quot; ) );</span></a>
<a name="89"><span class="lineNum">      89 </span>                :<span class="lineNoCov">          0 : }</span></a>
<a name="90"><span class="lineNum">      90 </span>                :            : </a>
<a name="91"><span class="lineNum">      91 </span>                :<span class="lineNoCov">          0 : void QgsDualEdgeTriangulation::addLine( const QVector&lt;QgsPoint&gt; &amp;points, QgsInterpolator::SourceType lineType )</span></a>
<a name="92"><span class="lineNum">      92 </span>                :            : {</a>
<a name="93"><span class="lineNum">      93 </span>                :<span class="lineNoCov">          0 :   int actpoint = -10;//number of the last point, which has been inserted from the line</span></a>
<a name="94"><span class="lineNum">      94 </span>                :<span class="lineNoCov">          0 :   int currentpoint = -10;//number of the point, which is currently inserted from the line</span></a>
<a name="95"><span class="lineNum">      95 </span>                :            : </a>
<a name="96"><span class="lineNum">      96 </span>                :<span class="lineNoCov">          0 :   int i = 0;</span></a>
<a name="97"><span class="lineNum">      97 </span>                :<span class="lineNoCov">          0 :   for ( const QgsPoint &amp;point : points )</span></a>
<a name="98"><span class="lineNum">      98 </span>                :            :   {</a>
<a name="99"><span class="lineNum">      99 </span>                :<span class="lineNoCov">          0 :     actpoint = addPoint( point );</span></a>
<a name="100"><span class="lineNum">     100 </span>                :<span class="lineNoCov">          0 :     i++;</span></a>
<a name="101"><span class="lineNum">     101 </span>                :<span class="lineNoCov">          0 :     if ( actpoint != -100 )</span></a>
<a name="102"><span class="lineNum">     102 </span>                :            :     {</a>
<a name="103"><span class="lineNum">     103 </span>                :<span class="lineNoCov">          0 :       break;</span></a>
<a name="104"><span class="lineNum">     104 </span>                :            :     }</a>
<a name="105"><span class="lineNum">     105 </span>                :            :   }</a>
<a name="106"><span class="lineNum">     106 </span>                :            : </a>
<a name="107"><span class="lineNum">     107 </span>                :<span class="lineNoCov">          0 :   if ( actpoint == -100 )//no point of the line could be inserted</span></a>
<a name="108"><span class="lineNum">     108 </span>                :            :   {</a>
<a name="109"><span class="lineNum">     109 </span>                :<span class="lineNoCov">          0 :     return;</span></a>
<a name="110"><span class="lineNum">     110 </span>                :            :   }</a>
<a name="111"><span class="lineNum">     111 </span>                :            : </a>
<a name="112"><span class="lineNum">     112 </span>                :<span class="lineNoCov">          0 :   for ( ; i &lt; points.size(); ++i )</span></a>
<a name="113"><span class="lineNum">     113 </span>                :            :   {</a>
<a name="114"><span class="lineNum">     114 </span>                :<span class="lineNoCov">          0 :     currentpoint = addPoint( points.at( i ) );</span></a>
<a name="115"><span class="lineNum">     115 </span>                :<span class="lineNoCov">          0 :     if ( currentpoint != -100 &amp;&amp; actpoint != -100 &amp;&amp; currentpoint != actpoint )//-100 is the return value if the point could not be not inserted</span></a>
<a name="116"><span class="lineNum">     116 </span>                :            :     {</a>
<a name="117"><span class="lineNum">     117 </span>                :<span class="lineNoCov">          0 :       insertForcedSegment( actpoint, currentpoint, lineType );</span></a>
<a name="118"><span class="lineNum">     118 </span>                :<span class="lineNoCov">          0 :     }</span></a>
<a name="119"><span class="lineNum">     119 </span>                :<span class="lineNoCov">          0 :     actpoint = currentpoint;</span></a>
<a name="120"><span class="lineNum">     120 </span>                :<span class="lineNoCov">          0 :   }</span></a>
<a name="121"><span class="lineNum">     121 </span>                :<span class="lineNoCov">          0 : }</span></a>
<a name="122"><span class="lineNum">     122 </span>                :            : </a>
<a name="123"><span class="lineNum">     123 </span>                :<span class="lineNoCov">          0 : int QgsDualEdgeTriangulation::addPoint( const QgsPoint &amp;p )</span></a>
<a name="124"><span class="lineNum">     124 </span>                :            : {</a>
<a name="125"><span class="lineNum">     125 </span>                :            :   //first update the bounding box</a>
<a name="126"><span class="lineNum">     126 </span>                :<span class="lineNoCov">          0 :   if ( mPointVector.isEmpty() )//update bounding box when the first point is inserted</span></a>
<a name="127"><span class="lineNum">     127 </span>                :            :   {</a>
<a name="128"><span class="lineNum">     128 </span>                :<span class="lineNoCov">          0 :     mXMin = p.x();</span></a>
<a name="129"><span class="lineNum">     129 </span>                :<span class="lineNoCov">          0 :     mYMin = p.y();</span></a>
<a name="130"><span class="lineNum">     130 </span>                :<span class="lineNoCov">          0 :     mXMax = p.x();</span></a>
<a name="131"><span class="lineNum">     131 </span>                :<span class="lineNoCov">          0 :     mYMax = p.y();</span></a>
<a name="132"><span class="lineNum">     132 </span>                :<span class="lineNoCov">          0 :   }</span></a>
<a name="133"><span class="lineNum">     133 </span>                :            :   else //update bounding box else</a>
<a name="134"><span class="lineNum">     134 </span>                :            :   {</a>
<a name="135"><span class="lineNum">     135 </span>                :<span class="lineNoCov">          0 :     mXMin = std::min( p.x(), mXMin );</span></a>
<a name="136"><span class="lineNum">     136 </span>                :<span class="lineNoCov">          0 :     mXMax = std::max( p.x(), mXMax );</span></a>
<a name="137"><span class="lineNum">     137 </span>                :<span class="lineNoCov">          0 :     mYMin = std::min( p.y(), mYMin );</span></a>
<a name="138"><span class="lineNum">     138 </span>                :<span class="lineNoCov">          0 :     mYMax = std::max( p.y(), mYMax );</span></a>
<a name="139"><span class="lineNum">     139 </span>                :            :   }</a>
<a name="140"><span class="lineNum">     140 </span>                :            : </a>
<a name="141"><span class="lineNum">     141 </span>                :            :   //then update mPointVector</a>
<a name="142"><span class="lineNum">     142 </span>                :<span class="lineNoCov">          0 :   mPointVector.append( new QgsPoint( p ) );</span></a>
<a name="143"><span class="lineNum">     143 </span>                :            : </a>
<a name="144"><span class="lineNum">     144 </span>                :            :   //then update the HalfEdgeStructure</a>
<a name="145"><span class="lineNum">     145 </span>                :<span class="lineNoCov">          0 :   if ( mDimension == -1 )//insert the first point into the triangulation</span></a>
<a name="146"><span class="lineNum">     146 </span>                :            :   {</a>
<a name="147"><span class="lineNum">     147 </span>                :<span class="lineNoCov">          0 :     unsigned int zedge /* 0 */ = insertEdge( -10, -10, -1, false, false ); //edge pointing from p to the virtual point</span></a>
<a name="148"><span class="lineNum">     148 </span>                :<span class="lineNoCov">          0 :     unsigned int fedge /* 1 */ = insertEdge( static_cast&lt;int&gt;( zedge ), static_cast&lt;int&gt;( zedge ), 0, false, false ); //edge pointing from the virtual point to p</span></a>
<a name="149"><span class="lineNum">     149 </span>                :<span class="lineNoCov">          0 :     ( mHalfEdge.at( zedge ) )-&gt;setDual( static_cast&lt;int&gt;( fedge ) );</span></a>
<a name="150"><span class="lineNum">     150 </span>                :<span class="lineNoCov">          0 :     ( mHalfEdge.at( zedge ) )-&gt;setNext( static_cast&lt;int&gt;( fedge ) );</span></a>
<a name="151"><span class="lineNum">     151 </span>                :<span class="lineNoCov">          0 :     mDimension = 0;</span></a>
<a name="152"><span class="lineNum">     152 </span>                :<span class="lineNoCov">          0 :   }</span></a>
<a name="153"><span class="lineNum">     153 </span>                :<span class="lineNoCov">          0 :   else if ( mDimension == 0 )//insert the second point into the triangulation</span></a>
<a name="154"><span class="lineNum">     154 </span>                :            :   {</a>
<a name="155"><span class="lineNum">     155 </span>                :            :     //test, if it is the same point as the first point</a>
<a name="156"><span class="lineNum">     156 </span>                :<span class="lineNoCov">          0 :     if ( p.x() == mPointVector[0]-&gt;x() &amp;&amp; p.y() == mPointVector[0]-&gt;y() )</span></a>
<a name="157"><span class="lineNum">     157 </span>                :            :     {</a>
<a name="158"><span class="lineNum">     158 </span>                :            :       //second point is the same as the first point</a>
<a name="159"><span class="lineNum">     159 </span>                :<span class="lineNoCov">          0 :       removeLastPoint();</span></a>
<a name="160"><span class="lineNum">     160 </span>                :<span class="lineNoCov">          0 :       return 0;</span></a>
<a name="161"><span class="lineNum">     161 </span>                :            :     }</a>
<a name="162"><span class="lineNum">     162 </span>                :            : </a>
<a name="163"><span class="lineNum">     163 </span>                :<span class="lineNoCov">          0 :     unsigned int edgeFromPoint0ToPoint1 /* 2 */ = insertEdge( -10, -10, 1, false, false );//edge pointing from point 0 to point 1</span></a>
<a name="164"><span class="lineNum">     164 </span>                :<span class="lineNoCov">          0 :     unsigned int edgeFromPoint1ToPoint0 /* 3 */ = insertEdge( edgeFromPoint0ToPoint1, -10, 0, false, false ); //edge pointing from point 1 to point 0</span></a>
<a name="165"><span class="lineNum">     165 </span>                :<span class="lineNoCov">          0 :     unsigned int edgeFromVirtualToPoint1Side1 /* 4 */ = insertEdge( -10, -10, 1, false, false ); //edge pointing from the virtual point to point 1</span></a>
<a name="166"><span class="lineNum">     166 </span>                :<span class="lineNoCov">          0 :     unsigned int edgeFromPoint1ToVirtualSide1 /* 5 */ = insertEdge( edgeFromVirtualToPoint1Side1, 1, -1, false, false ); //edge pointing from point 1 to the virtual point</span></a>
<a name="167"><span class="lineNum">     167 </span>                :<span class="lineNoCov">          0 :     unsigned int edgeFromVirtualToPoint1Side2 /* 6 */ = insertEdge( -10, edgeFromPoint1ToPoint0, 1, false, false );</span></a>
<a name="168"><span class="lineNum">     168 </span>                :<span class="lineNoCov">          0 :     unsigned int edgeFromPoint1ToVirtualSide2 /* 7 */ = insertEdge( edgeFromVirtualToPoint1Side2, edgeFromVirtualToPoint1Side1, -1, false, false );</span></a>
<a name="169"><span class="lineNum">     169 </span>                :<span class="lineNoCov">          0 :     unsigned int edgeFromVirtualToPoint0Side2 /* 8 */ = insertEdge( -10, -10, 0, false, false );</span></a>
<a name="170"><span class="lineNum">     170 </span>                :<span class="lineNoCov">          0 :     unsigned int edgeFromPoint0ToVirtualSide2 /* 9 */ = insertEdge( edgeFromVirtualToPoint0Side2, edgeFromVirtualToPoint1Side2, -1, false, false );</span></a>
<a name="171"><span class="lineNum">     171 </span>                :<span class="lineNoCov">          0 :     mHalfEdge.at( edgeFromPoint1ToPoint0 )-&gt;setNext( edgeFromPoint0ToVirtualSide2 );</span></a>
<a name="172"><span class="lineNum">     172 </span>                :<span class="lineNoCov">          0 :     mHalfEdge.at( edgeFromPoint0ToPoint1 )-&gt;setDual( edgeFromPoint1ToPoint0 );</span></a>
<a name="173"><span class="lineNum">     173 </span>                :<span class="lineNoCov">          0 :     mHalfEdge.at( edgeFromPoint0ToPoint1 )-&gt;setNext( edgeFromPoint1ToVirtualSide1 );</span></a>
<a name="174"><span class="lineNum">     174 </span>                :<span class="lineNoCov">          0 :     mHalfEdge.at( edgeFromVirtualToPoint1Side1 )-&gt;setDual( edgeFromPoint1ToVirtualSide1 );</span></a>
<a name="175"><span class="lineNum">     175 </span>                :<span class="lineNoCov">          0 :     mHalfEdge.at( edgeFromVirtualToPoint1Side1 )-&gt;setNext( edgeFromPoint1ToVirtualSide2 );</span></a>
<a name="176"><span class="lineNum">     176 </span>                :<span class="lineNoCov">          0 :     mHalfEdge.at( 0 )-&gt;setNext( static_cast&lt;int&gt;( edgeFromVirtualToPoint0Side2 ) );</span></a>
<a name="177"><span class="lineNum">     177 </span>                :<span class="lineNoCov">          0 :     mHalfEdge.at( 1 )-&gt;setNext( static_cast&lt;int&gt;( edgeFromPoint0ToPoint1 ) );</span></a>
<a name="178"><span class="lineNum">     178 </span>                :<span class="lineNoCov">          0 :     mHalfEdge.at( edgeFromVirtualToPoint1Side2 )-&gt;setDual( edgeFromPoint1ToVirtualSide2 );</span></a>
<a name="179"><span class="lineNum">     179 </span>                :<span class="lineNoCov">          0 :     mHalfEdge.at( edgeFromVirtualToPoint0Side2 )-&gt;setDual( edgeFromPoint0ToVirtualSide2 );</span></a>
<a name="180"><span class="lineNum">     180 </span>                :<span class="lineNoCov">          0 :     mHalfEdge.at( edgeFromVirtualToPoint0Side2 )-&gt;setNext( 0 );</span></a>
<a name="181"><span class="lineNum">     181 </span>                :<span class="lineNoCov">          0 :     mEdgeInside = 3;</span></a>
<a name="182"><span class="lineNum">     182 </span>                :<span class="lineNoCov">          0 :     mEdgeOutside = edgeFromPoint0ToPoint1;</span></a>
<a name="183"><span class="lineNum">     183 </span>                :<span class="lineNoCov">          0 :     mDimension = 1;</span></a>
<a name="184"><span class="lineNum">     184 </span>                :<span class="lineNoCov">          0 :   }</span></a>
<a name="185"><span class="lineNum">     185 </span>                :<span class="lineNoCov">          0 :   else if ( mDimension == 1 )</span></a>
<a name="186"><span class="lineNum">     186 </span>                :            :   {</a>
<a name="187"><span class="lineNum">     187 </span>                :<span class="lineNoCov">          0 :     if ( mEdgeOutside &lt; 0 || mHalfEdge[mEdgeOutside]-&gt;getPoint() &lt; 0 || mHalfEdge[mHalfEdge[mEdgeOutside]-&gt;getDual()]-&gt;getPoint() &lt; 0 )</span></a>
<a name="188"><span class="lineNum">     188 </span>                :<span class="lineNoCov">          0 :       mEdgeOutside = firstEdgeOutSide();</span></a>
<a name="189"><span class="lineNum">     189 </span>                :<span class="lineNoCov">          0 :     if ( mEdgeOutside &lt; 0 || mHalfEdge[mEdgeOutside]-&gt;getPoint() &lt; 0 || mHalfEdge[mHalfEdge[mEdgeOutside]-&gt;getDual()]-&gt;getPoint() &lt; 0 )</span></a>
<a name="190"><span class="lineNum">     190 </span>                :<span class="lineNoCov">          0 :       return -100;</span></a>
<a name="191"><span class="lineNum">     191 </span>                :            : </a>
<a name="192"><span class="lineNum">     192 </span>                :<span class="lineNoCov">          0 :     double leftOfNumber = MathUtils::leftOf( p,  mPointVector[mHalfEdge[mHalfEdge[mEdgeOutside]-&gt;getDual()]-&gt;getPoint()], mPointVector[mHalfEdge[mEdgeOutside]-&gt;getPoint()] );</span></a>
<a name="193"><span class="lineNum">     193 </span>                :<span class="lineNoCov">          0 :     if ( fabs( leftOfNumber ) &lt;= leftOfTresh )</span></a>
<a name="194"><span class="lineNum">     194 </span>                :            :     {</a>
<a name="195"><span class="lineNum">     195 </span>                :            :       // new point colinear with existing points</a>
<a name="196"><span class="lineNum">     196 </span>                :<span class="lineNoCov">          0 :       mDimension = 1;</span></a>
<a name="197"><span class="lineNum">     197 </span>                :            :       // First find the edge which has the point in or the closest edge if the new point is outside</a>
<a name="198"><span class="lineNum">     198 </span>                :<span class="lineNoCov">          0 :       int closestEdge = -1;</span></a>
<a name="199"><span class="lineNum">     199 </span>                :<span class="lineNoCov">          0 :       double distance = std::numeric_limits&lt;double&gt;::max();</span></a>
<a name="200"><span class="lineNum">     200 </span>                :<span class="lineNoCov">          0 :       int firstEdge = mEdgeOutside;</span></a>
<a name="201"><span class="lineNum">     201 </span>                :<span class="lineNoCov">          0 :       do</span></a>
<a name="202"><span class="lineNum">     202 </span>                :            :       {</a>
<a name="203"><span class="lineNum">     203 </span>                :<span class="lineNoCov">          0 :         int point1 = mHalfEdge[mEdgeOutside]-&gt;getPoint();</span></a>
<a name="204"><span class="lineNum">     204 </span>                :<span class="lineNoCov">          0 :         int point2 = mHalfEdge[mHalfEdge[mEdgeOutside]-&gt;getDual()]-&gt;getPoint();</span></a>
<a name="205"><span class="lineNum">     205 </span>                :<span class="lineNoCov">          0 :         double distance1 = p.distance( *mPointVector[point1] );</span></a>
<a name="206"><span class="lineNum">     206 </span>                :<span class="lineNoCov">          0 :         if ( distance1 &lt;= leftOfTresh ) // point1 == new point</span></a>
<a name="207"><span class="lineNum">     207 </span>                :            :         {</a>
<a name="208"><span class="lineNum">     208 </span>                :<span class="lineNoCov">          0 :           removeLastPoint();</span></a>
<a name="209"><span class="lineNum">     209 </span>                :<span class="lineNoCov">          0 :           return point1;</span></a>
<a name="210"><span class="lineNum">     210 </span>                :            :         }</a>
<a name="211"><span class="lineNum">     211 </span>                :<span class="lineNoCov">          0 :         double distance2 = p.distance( *mPointVector[point2] );</span></a>
<a name="212"><span class="lineNum">     212 </span>                :<span class="lineNoCov">          0 :         if ( distance2 &lt;= leftOfTresh ) // point2 == new point</span></a>
<a name="213"><span class="lineNum">     213 </span>                :            :         {</a>
<a name="214"><span class="lineNum">     214 </span>                :<span class="lineNoCov">          0 :           removeLastPoint();</span></a>
<a name="215"><span class="lineNum">     215 </span>                :<span class="lineNoCov">          0 :           return point2;</span></a>
<a name="216"><span class="lineNum">     216 </span>                :            :         }</a>
<a name="217"><span class="lineNum">     217 </span>                :            : </a>
<a name="218"><span class="lineNum">     218 </span>                :<span class="lineNoCov">          0 :         double edgeLength = mPointVector[point1]-&gt;distance( *mPointVector[point2] );</span></a>
<a name="219"><span class="lineNum">     219 </span>                :            : </a>
<a name="220"><span class="lineNum">     220 </span>                :<span class="lineNoCov">          0 :         if ( distance1 &lt; edgeLength &amp;&amp; distance2 &lt; edgeLength )</span></a>
<a name="221"><span class="lineNum">     221 </span>                :            :         {</a>
<a name="222"><span class="lineNum">     222 </span>                :            :           //new point include in mEdgeOutside</a>
<a name="223"><span class="lineNum">     223 </span>                :<span class="lineNoCov">          0 :           int newPoint = mPointVector.count() - 1;</span></a>
<a name="224"><span class="lineNum">     224 </span>                :            : </a>
<a name="225"><span class="lineNum">     225 </span>                :            :           //edges that do not change</a>
<a name="226"><span class="lineNum">     226 </span>                :<span class="lineNoCov">          0 :           int edgeFromNewPointToPoint1 = mEdgeOutside;</span></a>
<a name="227"><span class="lineNum">     227 </span>                :<span class="lineNoCov">          0 :           int edgeFromNewPointToPoint2 = mHalfEdge[mEdgeOutside]-&gt;getDual();</span></a>
<a name="228"><span class="lineNum">     228 </span>                :            :           //edges to modify</a>
<a name="229"><span class="lineNum">     229 </span>                :<span class="lineNoCov">          0 :           int edgeFromPoint1ToVirtualSide2 = mHalfEdge[edgeFromNewPointToPoint1]-&gt;getNext();</span></a>
<a name="230"><span class="lineNum">     230 </span>                :<span class="lineNoCov">          0 :           int edgeFromVirtualToPoint1Side1 = mHalfEdge[mHalfEdge[edgeFromNewPointToPoint2]-&gt;getNext()]-&gt;getNext();</span></a>
<a name="231"><span class="lineNum">     231 </span>                :<span class="lineNoCov">          0 :           int edgeFromPoint2ToVirtualSide1 = mHalfEdge[edgeFromNewPointToPoint2]-&gt;getNext();</span></a>
<a name="232"><span class="lineNum">     232 </span>                :<span class="lineNoCov">          0 :           int edgeFromVirtualToPoint2Side2 = mHalfEdge[mHalfEdge[edgeFromNewPointToPoint1]-&gt;getNext()]-&gt;getNext();</span></a>
<a name="233"><span class="lineNum">     233 </span>                :            :           //insert new edges</a>
<a name="234"><span class="lineNum">     234 </span>                :<span class="lineNoCov">          0 :           int edgeFromVirtualToNewPointSide1 = insertEdge( -10, edgeFromNewPointToPoint2, newPoint, false, false );</span></a>
<a name="235"><span class="lineNum">     235 </span>                :<span class="lineNoCov">          0 :           int edgeFromNewPointToVirtualSide1 = insertEdge( edgeFromVirtualToNewPointSide1, edgeFromVirtualToPoint1Side1, -1, false, false );</span></a>
<a name="236"><span class="lineNum">     236 </span>                :<span class="lineNoCov">          0 :           int edgeFromVirtualToNewPointSide2 = insertEdge( -10, edgeFromNewPointToPoint1, newPoint, false, false );</span></a>
<a name="237"><span class="lineNum">     237 </span>                :<span class="lineNoCov">          0 :           int edgeFromNewPointToVirtualSide2 = insertEdge( edgeFromVirtualToNewPointSide2, edgeFromVirtualToPoint2Side2, -1, false, false );</span></a>
<a name="238"><span class="lineNum">     238 </span>                :<span class="lineNoCov">          0 :           int edgeFromPoint1ToNewPoint = insertEdge( edgeFromNewPointToPoint1, edgeFromNewPointToVirtualSide1, newPoint, false, false );</span></a>
<a name="239"><span class="lineNum">     239 </span>                :<span class="lineNoCov">          0 :           int edgeFromPoint2ToNewPoint = insertEdge( edgeFromNewPointToPoint2, edgeFromNewPointToVirtualSide2, newPoint, false, false );</span></a>
<a name="240"><span class="lineNum">     240 </span>                :<span class="lineNoCov">          0 :           mHalfEdge.at( edgeFromVirtualToNewPointSide1 )-&gt;setDual( edgeFromNewPointToVirtualSide1 );</span></a>
<a name="241"><span class="lineNum">     241 </span>                :<span class="lineNoCov">          0 :           mHalfEdge.at( edgeFromVirtualToNewPointSide2 )-&gt;setDual( edgeFromNewPointToVirtualSide2 );</span></a>
<a name="242"><span class="lineNum">     242 </span>                :            :           //modify existing edges</a>
<a name="243"><span class="lineNum">     243 </span>                :<span class="lineNoCov">          0 :           mHalfEdge.at( edgeFromPoint1ToVirtualSide2 )-&gt;setNext( edgeFromVirtualToNewPointSide2 );</span></a>
<a name="244"><span class="lineNum">     244 </span>                :<span class="lineNoCov">          0 :           mHalfEdge.at( edgeFromVirtualToPoint1Side1 )-&gt;setNext( edgeFromPoint1ToNewPoint );</span></a>
<a name="245"><span class="lineNum">     245 </span>                :<span class="lineNoCov">          0 :           mHalfEdge.at( edgeFromPoint2ToVirtualSide1 )-&gt;setNext( edgeFromVirtualToNewPointSide1 );</span></a>
<a name="246"><span class="lineNum">     246 </span>                :<span class="lineNoCov">          0 :           mHalfEdge.at( edgeFromVirtualToPoint2Side2 )-&gt;setNext( edgeFromPoint2ToNewPoint );</span></a>
<a name="247"><span class="lineNum">     247 </span>                :<span class="lineNoCov">          0 :           mHalfEdge.at( edgeFromNewPointToPoint1 )-&gt;setDual( edgeFromPoint1ToNewPoint );</span></a>
<a name="248"><span class="lineNum">     248 </span>                :<span class="lineNoCov">          0 :           mHalfEdge.at( edgeFromNewPointToPoint2 )-&gt;setDual( edgeFromPoint2ToNewPoint );</span></a>
<a name="249"><span class="lineNum">     249 </span>                :<span class="lineNoCov">          0 :           return newPoint;</span></a>
<a name="250"><span class="lineNum">     250 </span>                :            :         }</a>
<a name="251"><span class="lineNum">     251 </span>                :            :         else</a>
<a name="252"><span class="lineNum">     252 </span>                :            :         {</a>
<a name="253"><span class="lineNum">     253 </span>                :<span class="lineNoCov">          0 :           if ( distance1 &lt; distance )</span></a>
<a name="254"><span class="lineNum">     254 </span>                :            :           {</a>
<a name="255"><span class="lineNum">     255 </span>                :<span class="lineNoCov">          0 :             closestEdge = mEdgeOutside;</span></a>
<a name="256"><span class="lineNum">     256 </span>                :<span class="lineNoCov">          0 :             distance = distance1;</span></a>
<a name="257"><span class="lineNum">     257 </span>                :<span class="lineNoCov">          0 :           }</span></a>
<a name="258"><span class="lineNum">     258 </span>                :<span class="lineNoCov">          0 :           else if ( distance2 &lt; distance )</span></a>
<a name="259"><span class="lineNum">     259 </span>                :            :           {</a>
<a name="260"><span class="lineNum">     260 </span>                :<span class="lineNoCov">          0 :             closestEdge = mHalfEdge[mEdgeOutside]-&gt;getDual();</span></a>
<a name="261"><span class="lineNum">     261 </span>                :<span class="lineNoCov">          0 :             distance = distance2;</span></a>
<a name="262"><span class="lineNum">     262 </span>                :<span class="lineNoCov">          0 :           }</span></a>
<a name="263"><span class="lineNum">     263 </span>                :            :         }</a>
<a name="264"><span class="lineNum">     264 </span>                :<span class="lineNoCov">          0 :         mEdgeOutside = mHalfEdge[mHalfEdge[mHalfEdge[mEdgeOutside]-&gt;getNext()]-&gt;getDual()]-&gt;getNext();</span></a>
<a name="265"><span class="lineNum">     265 </span>                :<span class="lineNoCov">          0 :       }</span></a>
<a name="266"><span class="lineNum">     266 </span>                :<span class="lineNoCov">          0 :       while ( mEdgeOutside != firstEdge &amp;&amp; mHalfEdge[mEdgeOutside]-&gt;getPoint() != -1 &amp;&amp; mHalfEdge[mHalfEdge[mEdgeOutside]-&gt;getDual()]-&gt;getPoint() != -1 );</span></a>
<a name="267"><span class="lineNum">     267 </span>                :            : </a>
<a name="268"><span class="lineNum">     268 </span>                :<span class="lineNoCov">          0 :       if ( closestEdge &lt; 0 )</span></a>
<a name="269"><span class="lineNum">     269 </span>                :<span class="lineNoCov">          0 :         return -100; //something gets wrong</span></a>
<a name="270"><span class="lineNum">     270 </span>                :            : </a>
<a name="271"><span class="lineNum">     271 </span>                :            :       //add the new colinear point linking it to the extremity of closest edge</a>
<a name="272"><span class="lineNum">     272 </span>                :<span class="lineNoCov">          0 :       int extremPoint = mHalfEdge[closestEdge]-&gt;getPoint();</span></a>
<a name="273"><span class="lineNum">     273 </span>                :<span class="lineNoCov">          0 :       int newPoint = mPointVector.count() - 1;</span></a>
<a name="274"><span class="lineNum">     274 </span>                :            :       //edges that do not change</a>
<a name="275"><span class="lineNum">     275 </span>                :<span class="lineNoCov">          0 :       int edgeFromExtremeToOpposite = mHalfEdge[closestEdge]-&gt;getDual();</span></a>
<a name="276"><span class="lineNum">     276 </span>                :            :       //edges to modify</a>
<a name="277"><span class="lineNum">     277 </span>                :<span class="lineNoCov">          0 :       int edgeFromVirtualToExtremeSide1 = mHalfEdge[mHalfEdge[closestEdge]-&gt;getNext()]-&gt;getDual();</span></a>
<a name="278"><span class="lineNum">     278 </span>                :<span class="lineNoCov">          0 :       int edgeFromVirtualToExtremeSide2 = mHalfEdge[mHalfEdge[mHalfEdge[closestEdge]-&gt;getDual()]-&gt;getNext()]-&gt;getNext();</span></a>
<a name="279"><span class="lineNum">     279 </span>                :<span class="lineNoCov">          0 :       int edgeFromExtremeToVirtualSide2 = mHalfEdge[edgeFromVirtualToExtremeSide2]-&gt;getDual();</span></a>
<a name="280"><span class="lineNum">     280 </span>                :            :       //insert new edge</a>
<a name="281"><span class="lineNum">     281 </span>                :<span class="lineNoCov">          0 :       int edgeFromExtremeToNewPoint = insertEdge( -10, -10, newPoint, false, false );</span></a>
<a name="282"><span class="lineNum">     282 </span>                :<span class="lineNoCov">          0 :       int edgeFromNewPointToExtrem = insertEdge( edgeFromExtremeToNewPoint, edgeFromExtremeToVirtualSide2, extremPoint, false, false );</span></a>
<a name="283"><span class="lineNum">     283 </span>                :<span class="lineNoCov">          0 :       int edgeFromNewPointToVirtualSide1 = insertEdge( -10, edgeFromVirtualToExtremeSide1, -1, false, false );</span></a>
<a name="284"><span class="lineNum">     284 </span>                :<span class="lineNoCov">          0 :       int edgeFromVirtualToNewPointSide1 = insertEdge( edgeFromNewPointToVirtualSide1, -10, newPoint, false, false );</span></a>
<a name="285"><span class="lineNum">     285 </span>                :<span class="lineNoCov">          0 :       int edgeFromNewPointToVirtualSide2 = insertEdge( -10, edgeFromVirtualToNewPointSide1, -1, false, false );</span></a>
<a name="286"><span class="lineNum">     286 </span>                :<span class="lineNoCov">          0 :       int edgeFromVirtualToNewPointSide2 = insertEdge( edgeFromNewPointToVirtualSide2, edgeFromNewPointToExtrem, newPoint, false, false );</span></a>
<a name="287"><span class="lineNum">     287 </span>                :<span class="lineNoCov">          0 :       mHalfEdge.at( edgeFromExtremeToNewPoint )-&gt;setDual( edgeFromNewPointToExtrem );</span></a>
<a name="288"><span class="lineNum">     288 </span>                :<span class="lineNoCov">          0 :       mHalfEdge.at( edgeFromExtremeToNewPoint )-&gt;setNext( edgeFromNewPointToVirtualSide1 );</span></a>
<a name="289"><span class="lineNum">     289 </span>                :<span class="lineNoCov">          0 :       mHalfEdge.at( edgeFromNewPointToVirtualSide1 )-&gt;setDual( edgeFromVirtualToNewPointSide1 );</span></a>
<a name="290"><span class="lineNum">     290 </span>                :<span class="lineNoCov">          0 :       mHalfEdge.at( edgeFromNewPointToVirtualSide2 )-&gt;setDual( edgeFromVirtualToNewPointSide2 );</span></a>
<a name="291"><span class="lineNum">     291 </span>                :<span class="lineNoCov">          0 :       mHalfEdge.at( edgeFromVirtualToNewPointSide1 )-&gt;setNext( edgeFromNewPointToVirtualSide2 );</span></a>
<a name="292"><span class="lineNum">     292 </span>                :            :       //modify existing edges</a>
<a name="293"><span class="lineNum">     293 </span>                :<span class="lineNoCov">          0 :       mHalfEdge.at( edgeFromVirtualToExtremeSide1 )-&gt;setNext( edgeFromExtremeToNewPoint );</span></a>
<a name="294"><span class="lineNum">     294 </span>                :<span class="lineNoCov">          0 :       mHalfEdge.at( edgeFromVirtualToExtremeSide2 )-&gt;setNext( edgeFromExtremeToOpposite );</span></a>
<a name="295"><span class="lineNum">     295 </span>                :<span class="lineNoCov">          0 :       mHalfEdge.at( edgeFromExtremeToVirtualSide2 )-&gt;setNext( edgeFromVirtualToNewPointSide2 );</span></a>
<a name="296"><span class="lineNum">     296 </span>                :            : </a>
<a name="297"><span class="lineNum">     297 </span>                :<span class="lineNoCov">          0 :       return newPoint;</span></a>
<a name="298"><span class="lineNum">     298 </span>                :            :     }</a>
<a name="299"><span class="lineNum">     299 </span>                :<span class="lineNoCov">          0 :     else if ( leftOfNumber &gt;= leftOfTresh )</span></a>
<a name="300"><span class="lineNum">     300 </span>                :            :     {</a>
<a name="301"><span class="lineNum">     301 </span>                :            :       // new point on the right of mEdgeOutside</a>
<a name="302"><span class="lineNum">     302 </span>                :<span class="lineNoCov">          0 :       mEdgeOutside = mHalfEdge[mEdgeOutside]-&gt;getDual();</span></a>
<a name="303"><span class="lineNum">     303 </span>                :<span class="lineNoCov">          0 :     }</span></a>
<a name="304"><span class="lineNum">     304 </span>                :<span class="lineNoCov">          0 :     mDimension = 2;</span></a>
<a name="305"><span class="lineNum">     305 </span>                :<span class="lineNoCov">          0 :     int newPoint = mPointVector.count() - 1;</span></a>
<a name="306"><span class="lineNum">     306 </span>                :            :     //buil the 2D dimension triangulation</a>
<a name="307"><span class="lineNum">     307 </span>                :            :     //First clock wise</a>
<a name="308"><span class="lineNum">     308 </span>                :<span class="lineNoCov">          0 :     int cwEdge = mEdgeOutside;</span></a>
<a name="309"><span class="lineNum">     309 </span>                :<span class="lineNoCov">          0 :     while ( mHalfEdge[mHalfEdge[mHalfEdge[mHalfEdge[cwEdge]-&gt;getNext()]-&gt;getDual()]-&gt;getNext()]-&gt;getPoint() != -1 )</span></a>
<a name="310"><span class="lineNum">     310 </span>                :            :     {</a>
<a name="311"><span class="lineNum">     311 </span>                :<span class="lineNoCov">          0 :       mHalfEdge[mHalfEdge[ cwEdge ]-&gt;getNext()]-&gt;setPoint( newPoint );</span></a>
<a name="312"><span class="lineNum">     312 </span>                :<span class="lineNoCov">          0 :       cwEdge = mHalfEdge[mHalfEdge[mHalfEdge[cwEdge]-&gt;getNext()]-&gt;getDual()]-&gt;getNext();</span></a>
<a name="313"><span class="lineNum">     313 </span>                :            :     }</a>
<a name="314"><span class="lineNum">     314 </span>                :            : </a>
<a name="315"><span class="lineNum">     315 </span>                :<span class="lineNoCov">          0 :     int edgeFromLastCwPointToVirtualPoint = mHalfEdge[mHalfEdge[mHalfEdge[cwEdge]-&gt;getNext()]-&gt;getDual()]-&gt;getNext();</span></a>
<a name="316"><span class="lineNum">     316 </span>                :<span class="lineNoCov">          0 :     int edgeFromLastCwPointToNewPointPoint = mHalfEdge[ cwEdge ]-&gt;getNext();</span></a>
<a name="317"><span class="lineNum">     317 </span>                :<span class="lineNoCov">          0 :     int edgeFromNewPointPointToLastCwPoint = mHalfEdge[ edgeFromLastCwPointToNewPointPoint ]-&gt;getDual();</span></a>
<a name="318"><span class="lineNum">     318 </span>                :            :     //connect the new point</a>
<a name="319"><span class="lineNum">     319 </span>                :<span class="lineNoCov">          0 :     int edgeFromNewPointtoVirtualPoint = insertEdge( -10, -10, -1, false, false );</span></a>
<a name="320"><span class="lineNum">     320 </span>                :<span class="lineNoCov">          0 :     int edgeFromVirtualPointToNewPoint = insertEdge( edgeFromNewPointtoVirtualPoint, edgeFromNewPointPointToLastCwPoint, newPoint, false, false );</span></a>
<a name="321"><span class="lineNum">     321 </span>                :<span class="lineNoCov">          0 :     mHalfEdge.at( edgeFromLastCwPointToNewPointPoint )-&gt;setPoint( newPoint );</span></a>
<a name="322"><span class="lineNum">     322 </span>                :<span class="lineNoCov">          0 :     mHalfEdge.at( edgeFromNewPointtoVirtualPoint )-&gt;setDual( edgeFromVirtualPointToNewPoint );</span></a>
<a name="323"><span class="lineNum">     323 </span>                :<span class="lineNoCov">          0 :     mHalfEdge.at( edgeFromLastCwPointToVirtualPoint )-&gt;setNext( edgeFromVirtualPointToNewPoint );</span></a>
<a name="324"><span class="lineNum">     324 </span>                :            : </a>
<a name="325"><span class="lineNum">     325 </span>                :            :     //First counter clock wise</a>
<a name="326"><span class="lineNum">     326 </span>                :<span class="lineNoCov">          0 :     int ccwEdge = mEdgeOutside;</span></a>
<a name="327"><span class="lineNum">     327 </span>                :<span class="lineNoCov">          0 :     while ( mHalfEdge[mHalfEdge[mHalfEdge[mHalfEdge[mHalfEdge[ccwEdge]-&gt;getDual()]-&gt;getNext()]-&gt;getDual()]-&gt;getNext()]-&gt;getPoint() != -1 )</span></a>
<a name="328"><span class="lineNum">     328 </span>                :            :     {</a>
<a name="329"><span class="lineNum">     329 </span>                :<span class="lineNoCov">          0 :       mHalfEdge[mHalfEdge[mHalfEdge[mHalfEdge[ ccwEdge ]-&gt;getNext()]-&gt;getNext()]-&gt;getDual()]-&gt;setPoint( newPoint );</span></a>
<a name="330"><span class="lineNum">     330 </span>                :<span class="lineNoCov">          0 :       ccwEdge = mHalfEdge[mHalfEdge[mHalfEdge[mHalfEdge[mHalfEdge[ccwEdge]-&gt;getDual()]-&gt;getNext()]-&gt;getDual()]-&gt;getNext()]-&gt;getDual();</span></a>
<a name="331"><span class="lineNum">     331 </span>                :            :     }</a>
<a name="332"><span class="lineNum">     332 </span>                :            : </a>
<a name="333"><span class="lineNum">     333 </span>                :<span class="lineNoCov">          0 :     int edgeToLastCcwPoint = mHalfEdge[mHalfEdge[mHalfEdge[ccwEdge]-&gt;getDual()]-&gt;getNext()]-&gt;getDual();</span></a>
<a name="334"><span class="lineNum">     334 </span>                :<span class="lineNoCov">          0 :     int edgeFromLastCcwPointToNewPoint = mHalfEdge[edgeToLastCcwPoint]-&gt;getNext();</span></a>
<a name="335"><span class="lineNum">     335 </span>                :<span class="lineNoCov">          0 :     mHalfEdge.at( edgeFromNewPointtoVirtualPoint )-&gt;setNext( edgeToLastCcwPoint );</span></a>
<a name="336"><span class="lineNum">     336 </span>                :<span class="lineNoCov">          0 :     mHalfEdge.at( edgeFromLastCcwPointToNewPoint )-&gt;setNext( edgeFromNewPointtoVirtualPoint );</span></a>
<a name="337"><span class="lineNum">     337 </span>                :<span class="lineNoCov">          0 :     mHalfEdge.at( edgeFromLastCcwPointToNewPoint )-&gt;setPoint( newPoint );</span></a>
<a name="338"><span class="lineNum">     338 </span>                :<span class="lineNoCov">          0 :   }</span></a>
<a name="339"><span class="lineNum">     339 </span>                :            :   else</a>
<a name="340"><span class="lineNum">     340 </span>                :            :   {</a>
<a name="341"><span class="lineNum">     341 </span>                :<span class="lineNoCov">          0 :     int number = baseEdgeOfTriangle( p );</span></a>
<a name="342"><span class="lineNum">     342 </span>                :            : </a>
<a name="343"><span class="lineNum">     343 </span>                :            :     //point is outside the convex hull----------------------------------------------------</a>
<a name="344"><span class="lineNum">     344 </span>                :<span class="lineNoCov">          0 :     if ( number == -10 )</span></a>
<a name="345"><span class="lineNum">     345 </span>                :            :     {</a>
<a name="346"><span class="lineNum">     346 </span>                :<span class="lineNoCov">          0 :       unsigned int cwEdge = mEdgeOutside;//the last visible edge clockwise from mEdgeOutside</span></a>
<a name="347"><span class="lineNum">     347 </span>                :<span class="lineNoCov">          0 :       unsigned int ccwEdge = mEdgeOutside;//the last visible edge counterclockwise from mEdgeOutside</span></a>
<a name="348"><span class="lineNum">     348 </span>                :            : </a>
<a name="349"><span class="lineNum">     349 </span>                :            :       //mEdgeOutside is in each case visible</a>
<a name="350"><span class="lineNum">     350 </span>                :<span class="lineNoCov">          0 :       mHalfEdge[mHalfEdge[mEdgeOutside]-&gt;getNext()]-&gt;setPoint( mPointVector.count() - 1 );</span></a>
<a name="351"><span class="lineNum">     351 </span>                :            : </a>
<a name="352"><span class="lineNum">     352 </span>                :            :       //find cwEdge and replace the virtual point with the new point when necessary (equivalent to while the hull is not convex going clock wise)</a>
<a name="353"><span class="lineNum">     353 </span>                :<span class="lineNoCov">          0 :       while ( MathUtils::leftOf( *mPointVector[ mHalfEdge[mHalfEdge[mHalfEdge[mHalfEdge[cwEdge]-&gt;getNext()]-&gt;getDual()]-&gt;getNext()]-&gt;getPoint()],</span></a>
<a name="354"><span class="lineNum">     354 </span>                :<span class="lineNoCov">          0 :                                  &amp;p, mPointVector[ mHalfEdge[cwEdge]-&gt;getPoint()] ) &lt; ( -leftOfTresh ) )</span></a>
<a name="355"><span class="lineNum">     355 </span>                :            :       {</a>
<a name="356"><span class="lineNum">     356 </span>                :            :         //set the point number of the necessary edge to the actual point instead of the virtual point</a>
<a name="357"><span class="lineNum">     357 </span>                :<span class="lineNoCov">          0 :         mHalfEdge[mHalfEdge[mHalfEdge[mHalfEdge[mHalfEdge[cwEdge]-&gt;getNext()]-&gt;getDual()]-&gt;getNext()]-&gt;getNext()]-&gt;setPoint( mPointVector.count() - 1 );</span></a>
<a name="358"><span class="lineNum">     358 </span>                :            :         //advance cwedge one edge further clockwise</a>
<a name="359"><span class="lineNum">     359 </span>                :<span class="lineNoCov">          0 :         cwEdge = ( unsigned int )mHalfEdge[mHalfEdge[mHalfEdge[cwEdge]-&gt;getNext()]-&gt;getDual()]-&gt;getNext();</span></a>
<a name="360"><span class="lineNum">     360 </span>                :            :       }</a>
<a name="361"><span class="lineNum">     361 </span>                :            : </a>
<a name="362"><span class="lineNum">     362 </span>                :            :       //build the necessary connections with the virtual point</a>
<a name="363"><span class="lineNum">     363 </span>                :<span class="lineNoCov">          0 :       unsigned int edge1 = insertEdge( mHalfEdge[cwEdge]-&gt;getNext(), -10, mHalfEdge[cwEdge]-&gt;getPoint(), false, false );//edge pointing from the new point to the last visible point clockwise</span></a>
<a name="364"><span class="lineNum">     364 </span>                :<span class="lineNoCov">          0 :       unsigned int edge2 = insertEdge( mHalfEdge[mHalfEdge[cwEdge]-&gt;getNext()]-&gt;getDual(), -10, -1, false, false );//edge pointing from the last visible point to the virtual point</span></a>
<a name="365"><span class="lineNum">     365 </span>                :<span class="lineNoCov">          0 :       unsigned int edge3 = insertEdge( -10, edge1, mPointVector.count() - 1, false, false );//edge pointing from the virtual point to new point</span></a>
<a name="366"><span class="lineNum">     366 </span>                :            : </a>
<a name="367"><span class="lineNum">     367 </span>                :            :       //adjust the other pointers</a>
<a name="368"><span class="lineNum">     368 </span>                :<span class="lineNoCov">          0 :       mHalfEdge[mHalfEdge[mHalfEdge[cwEdge]-&gt;getNext()]-&gt;getDual()]-&gt;setDual( edge2 );</span></a>
<a name="369"><span class="lineNum">     369 </span>                :<span class="lineNoCov">          0 :       mHalfEdge[mHalfEdge[cwEdge]-&gt;getNext()]-&gt;setDual( edge1 );</span></a>
<a name="370"><span class="lineNum">     370 </span>                :<span class="lineNoCov">          0 :       mHalfEdge[edge1]-&gt;setNext( edge2 );</span></a>
<a name="371"><span class="lineNum">     371 </span>                :<span class="lineNoCov">          0 :       mHalfEdge[edge2]-&gt;setNext( edge3 );</span></a>
<a name="372"><span class="lineNum">     372 </span>                :            : </a>
<a name="373"><span class="lineNum">     373 </span>                :            :       //find ccwedge and replace the virtual point with the new point when necessary</a>
<a name="374"><span class="lineNum">     374 </span>                :<span class="lineNoCov">          0 :       while ( MathUtils::leftOf( *mPointVector[mHalfEdge[mHalfEdge[mHalfEdge[ccwEdge]-&gt;getNext()]-&gt;getNext()]-&gt;getPoint()], mPointVector[mPointVector.count() - 1], mPointVector[mHalfEdge[mHalfEdge[mHalfEdge[mHalfEdge[mHalfEdge[ccwEdge]-&gt;getNext()]-&gt;getNext()]-&gt;getDual()]-&gt;getNext()]-&gt;getPoint()] ) &lt; ( -leftOfTresh ) )</span></a>
<a name="375"><span class="lineNum">     375 </span>                :            :       {</a>
<a name="376"><span class="lineNum">     376 </span>                :            :         //set the point number of the necessary edge to the actual point instead of the virtual point</a>
<a name="377"><span class="lineNum">     377 </span>                :<span class="lineNoCov">          0 :         mHalfEdge[mHalfEdge[mHalfEdge[mHalfEdge[ccwEdge]-&gt;getNext()]-&gt;getNext()]-&gt;getDual()]-&gt;setPoint( mPointVector.count() - 1 );</span></a>
<a name="378"><span class="lineNum">     378 </span>                :            :         //advance ccwedge one edge further counterclockwise</a>
<a name="379"><span class="lineNum">     379 </span>                :<span class="lineNoCov">          0 :         ccwEdge = mHalfEdge[mHalfEdge[mHalfEdge[mHalfEdge[mHalfEdge[ccwEdge]-&gt;getNext()]-&gt;getNext()]-&gt;getDual()]-&gt;getNext()]-&gt;getNext();</span></a>
<a name="380"><span class="lineNum">     380 </span>                :            :       }</a>
<a name="381"><span class="lineNum">     381 </span>                :            : </a>
<a name="382"><span class="lineNum">     382 </span>                :            :       //build the necessary connections with the virtual point</a>
<a name="383"><span class="lineNum">     383 </span>                :<span class="lineNoCov">          0 :       unsigned int edge4 = insertEdge( mHalfEdge[mHalfEdge[ccwEdge]-&gt;getNext()]-&gt;getNext(), -10, mPointVector.count() - 1, false, false );//points from the last visible point counterclockwise to the new point</span></a>
<a name="384"><span class="lineNum">     384 </span>                :<span class="lineNoCov">          0 :       unsigned int edge5 = insertEdge( edge3, -10, -1, false, false );//points from the new point to the virtual point</span></a>
<a name="385"><span class="lineNum">     385 </span>                :<span class="lineNoCov">          0 :       unsigned int edge6 = insertEdge( mHalfEdge[mHalfEdge[mHalfEdge[ccwEdge]-&gt;getNext()]-&gt;getNext()]-&gt;getDual(), edge4, mHalfEdge[mHalfEdge[ccwEdge]-&gt;getDual()]-&gt;getPoint(), false, false );//points from the virtual point to the last visible point counterclockwise</span></a>
<a name="386"><span class="lineNum">     386 </span>                :            : </a>
<a name="387"><span class="lineNum">     387 </span>                :            : </a>
<a name="388"><span class="lineNum">     388 </span>                :            : </a>
<a name="389"><span class="lineNum">     389 </span>                :            :       //adjust the other pointers</a>
<a name="390"><span class="lineNum">     390 </span>                :<span class="lineNoCov">          0 :       mHalfEdge[mHalfEdge[mHalfEdge[mHalfEdge[ccwEdge]-&gt;getNext()]-&gt;getNext()]-&gt;getDual()]-&gt;setDual( edge6 );</span></a>
<a name="391"><span class="lineNum">     391 </span>                :<span class="lineNoCov">          0 :       mHalfEdge[mHalfEdge[mHalfEdge[ccwEdge]-&gt;getNext()]-&gt;getNext()]-&gt;setDual( edge4 );</span></a>
<a name="392"><span class="lineNum">     392 </span>                :<span class="lineNoCov">          0 :       mHalfEdge[edge4]-&gt;setNext( edge5 );</span></a>
<a name="393"><span class="lineNum">     393 </span>                :<span class="lineNoCov">          0 :       mHalfEdge[edge5]-&gt;setNext( edge6 );</span></a>
<a name="394"><span class="lineNum">     394 </span>                :<span class="lineNoCov">          0 :       mHalfEdge[edge3]-&gt;setDual( edge5 );</span></a>
<a name="395"><span class="lineNum">     395 </span>                :            : </a>
<a name="396"><span class="lineNum">     396 </span>                :            :       //now test the HalfEdge at the former convex hull for swappint</a>
<a name="397"><span class="lineNum">     397 </span>                :<span class="lineNoCov">          0 :       unsigned int index = ccwEdge;</span></a>
<a name="398"><span class="lineNum">     398 </span>                :            :       unsigned int toswap;</a>
<a name="399"><span class="lineNum">     399 </span>                :<span class="lineNoCov">          0 :       while ( true )</span></a>
<a name="400"><span class="lineNum">     400 </span>                :            :       {</a>
<a name="401"><span class="lineNum">     401 </span>                :<span class="lineNoCov">          0 :         toswap = index;</span></a>
<a name="402"><span class="lineNum">     402 </span>                :<span class="lineNoCov">          0 :         index = mHalfEdge[mHalfEdge[mHalfEdge[index]-&gt;getNext()]-&gt;getDual()]-&gt;getNext();</span></a>
<a name="403"><span class="lineNum">     403 </span>                :<span class="lineNoCov">          0 :         checkSwapRecursively( toswap, 0 );</span></a>
<a name="404"><span class="lineNum">     404 </span>                :<span class="lineNoCov">          0 :         if ( toswap == cwEdge )</span></a>
<a name="405"><span class="lineNum">     405 </span>                :            :         {</a>
<a name="406"><span class="lineNum">     406 </span>                :<span class="lineNoCov">          0 :           break;</span></a>
<a name="407"><span class="lineNum">     407 </span>                :            :         }</a>
<a name="408"><span class="lineNum">     408 </span>                :            :       }</a>
<a name="409"><span class="lineNum">     409 </span>                :<span class="lineNoCov">          0 :     }</span></a>
<a name="410"><span class="lineNum">     410 </span>                :<span class="lineNoCov">          0 :     else if ( number &gt;= 0 ) //point is inside the convex hull------------------------------------------------------</span></a>
<a name="411"><span class="lineNum">     411 </span>                :            :     {</a>
<a name="412"><span class="lineNum">     412 </span>                :<span class="lineNoCov">          0 :       int nextnumber = mHalfEdge[number]-&gt;getNext();</span></a>
<a name="413"><span class="lineNum">     413 </span>                :<span class="lineNoCov">          0 :       int nextnextnumber = mHalfEdge[mHalfEdge[number]-&gt;getNext()]-&gt;getNext();</span></a>
<a name="414"><span class="lineNum">     414 </span>                :            : </a>
<a name="415"><span class="lineNum">     415 </span>                :            :       //insert 6 new HalfEdges for the connections to the vertices of the triangle</a>
<a name="416"><span class="lineNum">     416 </span>                :<span class="lineNoCov">          0 :       unsigned int edge1 = insertEdge( -10, nextnumber, mHalfEdge[number]-&gt;getPoint(), false, false );</span></a>
<a name="417"><span class="lineNum">     417 </span>                :<span class="lineNoCov">          0 :       unsigned int edge2 = insertEdge( static_cast&lt;int&gt;( edge1 ), -10, mPointVector.count() - 1, false, false );</span></a>
<a name="418"><span class="lineNum">     418 </span>                :<span class="lineNoCov">          0 :       unsigned int edge3 = insertEdge( -10, nextnextnumber, mHalfEdge[nextnumber]-&gt;getPoint(), false, false );</span></a>
<a name="419"><span class="lineNum">     419 </span>                :<span class="lineNoCov">          0 :       unsigned int edge4 = insertEdge( static_cast&lt;int&gt;( edge3 ), static_cast&lt;int&gt;( edge1 ), mPointVector.count() - 1, false, false );</span></a>
<a name="420"><span class="lineNum">     420 </span>                :<span class="lineNoCov">          0 :       unsigned int edge5 = insertEdge( -10, number, mHalfEdge[nextnextnumber]-&gt;getPoint(), false, false );</span></a>
<a name="421"><span class="lineNum">     421 </span>                :<span class="lineNoCov">          0 :       unsigned int edge6 = insertEdge( static_cast&lt;int&gt;( edge5 ), static_cast&lt;int&gt;( edge3 ), mPointVector.count() - 1, false, false );</span></a>
<a name="422"><span class="lineNum">     422 </span>                :            : </a>
<a name="423"><span class="lineNum">     423 </span>                :            : </a>
<a name="424"><span class="lineNum">     424 </span>                :<span class="lineNoCov">          0 :       mHalfEdge.at( edge1 )-&gt;setDual( static_cast&lt;int&gt;( edge2 ) );</span></a>
<a name="425"><span class="lineNum">     425 </span>                :<span class="lineNoCov">          0 :       mHalfEdge.at( edge2 )-&gt;setNext( static_cast&lt;int&gt;( edge5 ) );</span></a>
<a name="426"><span class="lineNum">     426 </span>                :<span class="lineNoCov">          0 :       mHalfEdge.at( edge3 )-&gt;setDual( static_cast&lt;int&gt;( edge4 ) );</span></a>
<a name="427"><span class="lineNum">     427 </span>                :<span class="lineNoCov">          0 :       mHalfEdge.at( edge5 )-&gt;setDual( static_cast&lt;int&gt;( edge6 ) );</span></a>
<a name="428"><span class="lineNum">     428 </span>                :<span class="lineNoCov">          0 :       mHalfEdge.at( number )-&gt;setNext( static_cast&lt;int&gt;( edge2 ) );</span></a>
<a name="429"><span class="lineNum">     429 </span>                :<span class="lineNoCov">          0 :       mHalfEdge.at( nextnumber )-&gt;setNext( static_cast&lt;int&gt;( edge4 ) );</span></a>
<a name="430"><span class="lineNum">     430 </span>                :<span class="lineNoCov">          0 :       mHalfEdge.at( nextnextnumber )-&gt;setNext( static_cast&lt;int&gt;( edge6 ) );</span></a>
<a name="431"><span class="lineNum">     431 </span>                :            : </a>
<a name="432"><span class="lineNum">     432 </span>                :            :       //check, if there are swaps necessary</a>
<a name="433"><span class="lineNum">     433 </span>                :<span class="lineNoCov">          0 :       checkSwapRecursively( number, 0 );</span></a>
<a name="434"><span class="lineNum">     434 </span>                :<span class="lineNoCov">          0 :       checkSwapRecursively( nextnumber, 0 );</span></a>
<a name="435"><span class="lineNum">     435 </span>                :<span class="lineNoCov">          0 :       checkSwapRecursively( nextnextnumber, 0 );</span></a>
<a name="436"><span class="lineNum">     436 </span>                :<span class="lineNoCov">          0 :     }</span></a>
<a name="437"><span class="lineNum">     437 </span>                :            :     //the point is exactly on an existing edge (the number of the edge is stored in the variable 'mEdgeWithPoint'---------------</a>
<a name="438"><span class="lineNum">     438 </span>                :<span class="lineNoCov">          0 :     else if ( number == -20 )</span></a>
<a name="439"><span class="lineNum">     439 </span>                :            :     {</a>
<a name="440"><span class="lineNum">     440 </span>                :            :       //point exactly on edge;</a>
<a name="441"><span class="lineNum">     441 </span>                :            : </a>
<a name="442"><span class="lineNum">     442 </span>                :            :       //check if new point is the same than one extremity</a>
<a name="443"><span class="lineNum">     443 </span>                :<span class="lineNoCov">          0 :       int point1 = mHalfEdge[mEdgeWithPoint]-&gt;getPoint();</span></a>
<a name="444"><span class="lineNum">     444 </span>                :<span class="lineNoCov">          0 :       int point2 = mHalfEdge[mHalfEdge[mEdgeWithPoint]-&gt;getDual()]-&gt;getPoint();</span></a>
<a name="445"><span class="lineNum">     445 </span>                :<span class="lineNoCov">          0 :       double distance1 = p.distance( *mPointVector[point1] );</span></a>
<a name="446"><span class="lineNum">     446 </span>                :<span class="lineNoCov">          0 :       if ( distance1 &lt;= leftOfTresh ) // point1 == new point</span></a>
<a name="447"><span class="lineNum">     447 </span>                :            :       {</a>
<a name="448"><span class="lineNum">     448 </span>                :<span class="lineNoCov">          0 :         removeLastPoint();</span></a>
<a name="449"><span class="lineNum">     449 </span>                :<span class="lineNoCov">          0 :         return point1;</span></a>
<a name="450"><span class="lineNum">     450 </span>                :            :       }</a>
<a name="451"><span class="lineNum">     451 </span>                :<span class="lineNoCov">          0 :       double distance2 = p.distance( *mPointVector[point2] );</span></a>
<a name="452"><span class="lineNum">     452 </span>                :<span class="lineNoCov">          0 :       if ( distance2 &lt;= leftOfTresh ) // point2 == new point</span></a>
<a name="453"><span class="lineNum">     453 </span>                :            :       {</a>
<a name="454"><span class="lineNum">     454 </span>                :<span class="lineNoCov">          0 :         removeLastPoint();</span></a>
<a name="455"><span class="lineNum">     455 </span>                :<span class="lineNoCov">          0 :         return point2;</span></a>
<a name="456"><span class="lineNum">     456 </span>                :            :       }</a>
<a name="457"><span class="lineNum">     457 </span>                :            : </a>
<a name="458"><span class="lineNum">     458 </span>                :<span class="lineNoCov">          0 :       int edgea = mEdgeWithPoint;</span></a>
<a name="459"><span class="lineNum">     459 </span>                :<span class="lineNoCov">          0 :       int edgeb = mHalfEdge[mEdgeWithPoint]-&gt;getDual();</span></a>
<a name="460"><span class="lineNum">     460 </span>                :<span class="lineNoCov">          0 :       int edgec = mHalfEdge[edgea]-&gt;getNext();</span></a>
<a name="461"><span class="lineNum">     461 </span>                :<span class="lineNoCov">          0 :       int edged = mHalfEdge[edgec]-&gt;getNext();</span></a>
<a name="462"><span class="lineNum">     462 </span>                :<span class="lineNoCov">          0 :       int edgee = mHalfEdge[edgeb]-&gt;getNext();</span></a>
<a name="463"><span class="lineNum">     463 </span>                :<span class="lineNoCov">          0 :       int edgef = mHalfEdge[edgee]-&gt;getNext();</span></a>
<a name="464"><span class="lineNum">     464 </span>                :            : </a>
<a name="465"><span class="lineNum">     465 </span>                :            :       //insert the six new edges</a>
<a name="466"><span class="lineNum">     466 </span>                :<span class="lineNoCov">          0 :       int nedge1 = insertEdge( -10, mHalfEdge[edgea]-&gt;getNext(), mHalfEdge[edgea]-&gt;getPoint(), false, false );</span></a>
<a name="467"><span class="lineNum">     467 </span>                :<span class="lineNoCov">          0 :       int nedge2 = insertEdge( nedge1, -10, mPointVector.count() - 1, false, false );</span></a>
<a name="468"><span class="lineNum">     468 </span>                :<span class="lineNoCov">          0 :       int nedge3 = insertEdge( -10, edged, mHalfEdge[edgec]-&gt;getPoint(), false, false );</span></a>
<a name="469"><span class="lineNum">     469 </span>                :<span class="lineNoCov">          0 :       int nedge4 = insertEdge( nedge3, nedge1, mPointVector.count() - 1, false, false );</span></a>
<a name="470"><span class="lineNum">     470 </span>                :<span class="lineNoCov">          0 :       int nedge5 = insertEdge( -10, edgef, mHalfEdge[edgee]-&gt;getPoint(), false, false );</span></a>
<a name="471"><span class="lineNum">     471 </span>                :<span class="lineNoCov">          0 :       int nedge6 = insertEdge( nedge5, edgeb, mPointVector.count() - 1, false, false );</span></a>
<a name="472"><span class="lineNum">     472 </span>                :            : </a>
<a name="473"><span class="lineNum">     473 </span>                :            :       //adjust the triangular structure</a>
<a name="474"><span class="lineNum">     474 </span>                :<span class="lineNoCov">          0 :       mHalfEdge[nedge1]-&gt;setDual( nedge2 );</span></a>
<a name="475"><span class="lineNum">     475 </span>                :<span class="lineNoCov">          0 :       mHalfEdge[nedge2]-&gt;setNext( nedge5 );</span></a>
<a name="476"><span class="lineNum">     476 </span>                :<span class="lineNoCov">          0 :       mHalfEdge[nedge3]-&gt;setDual( nedge4 );</span></a>
<a name="477"><span class="lineNum">     477 </span>                :<span class="lineNoCov">          0 :       mHalfEdge[nedge5]-&gt;setDual( nedge6 );</span></a>
<a name="478"><span class="lineNum">     478 </span>                :<span class="lineNoCov">          0 :       mHalfEdge[edgea]-&gt;setPoint( mPointVector.count() - 1 );</span></a>
<a name="479"><span class="lineNum">     479 </span>                :<span class="lineNoCov">          0 :       mHalfEdge[edgea]-&gt;setNext( nedge3 );</span></a>
<a name="480"><span class="lineNum">     480 </span>                :<span class="lineNoCov">          0 :       mHalfEdge[edgec]-&gt;setNext( nedge4 );</span></a>
<a name="481"><span class="lineNum">     481 </span>                :<span class="lineNoCov">          0 :       mHalfEdge[edgee]-&gt;setNext( nedge6 );</span></a>
<a name="482"><span class="lineNum">     482 </span>                :<span class="lineNoCov">          0 :       mHalfEdge[edgef]-&gt;setNext( nedge2 );</span></a>
<a name="483"><span class="lineNum">     483 </span>                :            : </a>
<a name="484"><span class="lineNum">     484 </span>                :            :       //swap edges if necessary</a>
<a name="485"><span class="lineNum">     485 </span>                :<span class="lineNoCov">          0 :       checkSwapRecursively( edgec, 0 );</span></a>
<a name="486"><span class="lineNum">     486 </span>                :<span class="lineNoCov">          0 :       checkSwapRecursively( edged, 0 );</span></a>
<a name="487"><span class="lineNum">     487 </span>                :<span class="lineNoCov">          0 :       checkSwapRecursively( edgee, 0 );</span></a>
<a name="488"><span class="lineNum">     488 </span>                :<span class="lineNoCov">          0 :       checkSwapRecursively( edgef, 0 );</span></a>
<a name="489"><span class="lineNum">     489 </span>                :<span class="lineNoCov">          0 :     }</span></a>
<a name="490"><span class="lineNum">     490 </span>                :            : </a>
<a name="491"><span class="lineNum">     491 </span>                :<span class="lineNoCov">          0 :     else if ( number == -100 || number == -5 )//this means unknown problems or a numerical error occurred in 'baseEdgeOfTriangle'</span></a>
<a name="492"><span class="lineNum">     492 </span>                :            :     {</a>
<a name="493"><span class="lineNum">     493 </span>                :            :       //QgsDebugMsg( &quot;point has not been inserted because of unknown problems&quot; );</a>
<a name="494"><span class="lineNum">     494 </span>                :<span class="lineNoCov">          0 :       removeLastPoint();</span></a>
<a name="495"><span class="lineNum">     495 </span>                :<span class="lineNoCov">          0 :       return -100;</span></a>
<a name="496"><span class="lineNum">     496 </span>                :            :     }</a>
<a name="497"><span class="lineNum">     497 </span>                :<span class="lineNoCov">          0 :     else if ( number == -25 )//this means that the point has already been inserted in the triangulation</span></a>
<a name="498"><span class="lineNum">     498 </span>                :            :     {</a>
<a name="499"><span class="lineNum">     499 </span>                :            :       //Take the higher z-Value in case of two equal points</a>
<a name="500"><span class="lineNum">     500 </span>                :<span class="lineNoCov">          0 :       QgsPoint *newPoint = mPointVector[mPointVector.count() - 1];</span></a>
<a name="501"><span class="lineNum">     501 </span>                :<span class="lineNoCov">          0 :       QgsPoint *existingPoint = mPointVector[mTwiceInsPoint];</span></a>
<a name="502"><span class="lineNum">     502 </span>                :<span class="lineNoCov">          0 :       existingPoint-&gt;setZ( std::max( newPoint-&gt;z(), existingPoint-&gt;z() ) );</span></a>
<a name="503"><span class="lineNum">     503 </span>                :            : </a>
<a name="504"><span class="lineNum">     504 </span>                :<span class="lineNoCov">          0 :       removeLastPoint();</span></a>
<a name="505"><span class="lineNum">     505 </span>                :<span class="lineNoCov">          0 :       return mTwiceInsPoint;</span></a>
<a name="506"><span class="lineNum">     506 </span>                :            :     }</a>
<a name="507"><span class="lineNum">     507 </span>                :            :   }</a>
<a name="508"><span class="lineNum">     508 </span>                :            : </a>
<a name="509"><span class="lineNum">     509 </span>                :<span class="lineNoCov">          0 :   return ( mPointVector.count() - 1 );</span></a>
<a name="510"><span class="lineNum">     510 </span>                :<span class="lineNoCov">          0 : }</span></a>
<a name="511"><span class="lineNum">     511 </span>                :            : </a>
<a name="512"><span class="lineNum">     512 </span>                :<span class="lineNoCov">          0 : int QgsDualEdgeTriangulation::baseEdgeOfPoint( int point )</span></a>
<a name="513"><span class="lineNum">     513 </span>                :            : {</a>
<a name="514"><span class="lineNum">     514 </span>                :<span class="lineNoCov">          0 :   unsigned int actedge = mEdgeInside;//starting edge</span></a>
<a name="515"><span class="lineNum">     515 </span>                :            : </a>
<a name="516"><span class="lineNum">     516 </span>                :<span class="lineNoCov">          0 :   if ( mPointVector.count() &lt; 4 || point == -1 || mDimension == 1 ) //at the beginning, mEdgeInside is not defined yet</span></a>
<a name="517"><span class="lineNum">     517 </span>                :            :   {</a>
<a name="518"><span class="lineNum">     518 </span>                :<span class="lineNoCov">          0 :     int fromVirtualPoint = -1;</span></a>
<a name="519"><span class="lineNum">     519 </span>                :            :     //first find pointingedge(an edge pointing to p1, priority to edge that no come from virtual point)</a>
<a name="520"><span class="lineNum">     520 </span>                :<span class="lineNoCov">          0 :     for ( int i = 0; i &lt; mHalfEdge.count(); i++ )</span></a>
<a name="521"><span class="lineNum">     521 </span>                :            :     {</a>
<a name="522"><span class="lineNum">     522 </span>                :<span class="lineNoCov">          0 :       if ( mHalfEdge[i]-&gt;getPoint() == point )//we found one</span></a>
<a name="523"><span class="lineNum">     523 </span>                :            :       {</a>
<a name="524"><span class="lineNum">     524 </span>                :<span class="lineNoCov">          0 :         if ( mHalfEdge[mHalfEdge[i]-&gt;getDual()]-&gt;getPoint() != -1 )</span></a>
<a name="525"><span class="lineNum">     525 </span>                :<span class="lineNoCov">          0 :           return i;</span></a>
<a name="526"><span class="lineNum">     526 </span>                :            :         else</a>
<a name="527"><span class="lineNum">     527 </span>                :<span class="lineNoCov">          0 :           fromVirtualPoint = i;</span></a>
<a name="528"><span class="lineNum">     528 </span>                :<span class="lineNoCov">          0 :       }</span></a>
<a name="529"><span class="lineNum">     529 </span>                :<span class="lineNoCov">          0 :     }</span></a>
<a name="530"><span class="lineNum">     530 </span>                :<span class="lineNoCov">          0 :     return fromVirtualPoint;</span></a>
<a name="531"><span class="lineNum">     531 </span>                :            :   }</a>
<a name="532"><span class="lineNum">     532 </span>                :            : </a>
<a name="533"><span class="lineNum">     533 </span>                :<span class="lineNoCov">          0 :   int control = 0;</span></a>
<a name="534"><span class="lineNum">     534 </span>                :            : </a>
<a name="535"><span class="lineNum">     535 </span>                :<span class="lineNoCov">          0 :   while ( true )//otherwise, start the search</span></a>
<a name="536"><span class="lineNum">     536 </span>                :            :   {</a>
<a name="537"><span class="lineNum">     537 </span>                :<span class="lineNoCov">          0 :     control += 1;</span></a>
<a name="538"><span class="lineNum">     538 </span>                :<span class="lineNoCov">          0 :     if ( control &gt; 1000000 )</span></a>
<a name="539"><span class="lineNum">     539 </span>                :            :     {</a>
<a name="540"><span class="lineNum">     540 </span>                :            :       //QgsDebugMsg( QStringLiteral( &quot;warning, endless loop&quot; ) );</a>
<a name="541"><span class="lineNum">     541 </span>                :            : </a>
<a name="542"><span class="lineNum">     542 </span>                :            :       //use the secure and slow method</a>
<a name="543"><span class="lineNum">     543 </span>                :            :       //qWarning( &quot;******************warning, using the slow method in baseEdgeOfPoint****************************************&quot; );</a>
<a name="544"><span class="lineNum">     544 </span>                :<span class="lineNoCov">          0 :       for ( int i = 0; i &lt; mHalfEdge.count(); i++ )</span></a>
<a name="545"><span class="lineNum">     545 </span>                :            :       {</a>
<a name="546"><span class="lineNum">     546 </span>                :<span class="lineNoCov">          0 :         if ( mHalfEdge[i]-&gt;getPoint() == point &amp;&amp; mHalfEdge[mHalfEdge[i]-&gt;getNext()]-&gt;getPoint() != -1 )//we found it</span></a>
<a name="547"><span class="lineNum">     547 </span>                :            :         {</a>
<a name="548"><span class="lineNum">     548 </span>                :<span class="lineNoCov">          0 :           return i;</span></a>
<a name="549"><span class="lineNum">     549 </span>                :            :         }</a>
<a name="550"><span class="lineNum">     550 </span>                :<span class="lineNoCov">          0 :       }</span></a>
<a name="551"><span class="lineNum">     551 </span>                :<span class="lineNoCov">          0 :     }</span></a>
<a name="552"><span class="lineNum">     552 </span>                :            : </a>
<a name="553"><span class="lineNum">     553 </span>                :<span class="lineNoCov">          0 :     int fromPoint = mHalfEdge[mHalfEdge[actedge]-&gt;getDual()]-&gt;getPoint();</span></a>
<a name="554"><span class="lineNum">     554 </span>                :<span class="lineNoCov">          0 :     int toPoint = mHalfEdge[actedge]-&gt;getPoint();</span></a>
<a name="555"><span class="lineNum">     555 </span>                :            : </a>
<a name="556"><span class="lineNum">     556 </span>                :<span class="lineNoCov">          0 :     if ( fromPoint == -1 || toPoint == -1 )//this would cause a crash. Therefore we use the slow method in this case</span></a>
<a name="557"><span class="lineNum">     557 </span>                :            :     {</a>
<a name="558"><span class="lineNum">     558 </span>                :<span class="lineNoCov">          0 :       for ( int i = 0; i &lt; mHalfEdge.count(); i++ )</span></a>
<a name="559"><span class="lineNum">     559 </span>                :            :       {</a>
<a name="560"><span class="lineNum">     560 </span>                :<span class="lineNoCov">          0 :         if ( mHalfEdge[i]-&gt;getPoint() == point &amp;&amp; mHalfEdge[mHalfEdge[i]-&gt;getNext()]-&gt;getPoint() != -1 )//we found it</span></a>
<a name="561"><span class="lineNum">     561 </span>                :            :         {</a>
<a name="562"><span class="lineNum">     562 </span>                :<span class="lineNoCov">          0 :           mEdgeInside = i;</span></a>
<a name="563"><span class="lineNum">     563 </span>                :<span class="lineNoCov">          0 :           return i;</span></a>
<a name="564"><span class="lineNum">     564 </span>                :            :         }</a>
<a name="565"><span class="lineNum">     565 </span>                :<span class="lineNoCov">          0 :       }</span></a>
<a name="566"><span class="lineNum">     566 </span>                :<span class="lineNoCov">          0 :     }</span></a>
<a name="567"><span class="lineNum">     567 </span>                :            : </a>
<a name="568"><span class="lineNum">     568 </span>                :<span class="lineNoCov">          0 :     double leftOfNumber = MathUtils::leftOf( *mPointVector[point], mPointVector[mHalfEdge[mHalfEdge[actedge]-&gt;getDual()]-&gt;getPoint()], mPointVector[mHalfEdge[actedge]-&gt;getPoint()] );</span></a>
<a name="569"><span class="lineNum">     569 </span>                :            : </a>
<a name="570"><span class="lineNum">     570 </span>                :            : </a>
<a name="571"><span class="lineNum">     571 </span>                :<span class="lineNoCov">          0 :     if ( mHalfEdge[actedge]-&gt;getPoint() == point &amp;&amp; mHalfEdge[mHalfEdge[actedge]-&gt;getNext()]-&gt;getPoint() != -1 )//we found the edge</span></a>
<a name="572"><span class="lineNum">     572 </span>                :            :     {</a>
<a name="573"><span class="lineNum">     573 </span>                :<span class="lineNoCov">          0 :       mEdgeInside = actedge;</span></a>
<a name="574"><span class="lineNum">     574 </span>                :<span class="lineNoCov">          0 :       return actedge;</span></a>
<a name="575"><span class="lineNum">     575 </span>                :            :     }</a>
<a name="576"><span class="lineNum">     576 </span>                :<span class="lineNoCov">          0 :     else if ( leftOfNumber &lt;= 0.0 )</span></a>
<a name="577"><span class="lineNum">     577 </span>                :            :     {</a>
<a name="578"><span class="lineNum">     578 </span>                :<span class="lineNoCov">          0 :       actedge = mHalfEdge[actedge]-&gt;getNext();</span></a>
<a name="579"><span class="lineNum">     579 </span>                :<span class="lineNoCov">          0 :     }</span></a>
<a name="580"><span class="lineNum">     580 </span>                :            :     else</a>
<a name="581"><span class="lineNum">     581 </span>                :            :     {</a>
<a name="582"><span class="lineNum">     582 </span>                :<span class="lineNoCov">          0 :       actedge = mHalfEdge[mHalfEdge[mHalfEdge[mHalfEdge[actedge]-&gt;getDual()]-&gt;getNext()]-&gt;getNext()]-&gt;getDual();</span></a>
<a name="583"><span class="lineNum">     583 </span>                :            :     }</a>
<a name="584"><span class="lineNum">     584 </span>                :            :   }</a>
<a name="585"><span class="lineNum">     585 </span>                :<span class="lineNoCov">          0 : }</span></a>
<a name="586"><span class="lineNum">     586 </span>                :            : </a>
<a name="587"><span class="lineNum">     587 </span>                :<span class="lineNoCov">          0 : int QgsDualEdgeTriangulation::baseEdgeOfTriangle( const QgsPoint &amp;point )</span></a>
<a name="588"><span class="lineNum">     588 </span>                :            : {</a>
<a name="589"><span class="lineNum">     589 </span>                :<span class="lineNoCov">          0 :   unsigned int actEdge = mEdgeInside;//start with an edge which does not point to the virtual point</span></a>
<a name="590"><span class="lineNum">     590 </span>                :<span class="lineNoCov">          0 :   if ( mHalfEdge.at( actEdge )-&gt;getPoint() &lt; 0 )</span></a>
<a name="591"><span class="lineNum">     591 </span>                :<span class="lineNoCov">          0 :     actEdge = mHalfEdge.at( mHalfEdge.at( mHalfEdge.at( actEdge )-&gt;getDual() )-&gt;getNext() )-&gt;getDual(); //get an real inside edge</span></a>
<a name="592"><span class="lineNum">     592 </span>                :<span class="lineNoCov">          0 :   if ( mHalfEdge.at( mHalfEdge.at( actEdge )-&gt;getDual() )-&gt;getPoint() &lt; 0 )</span></a>
<a name="593"><span class="lineNum">     593 </span>                :<span class="lineNoCov">          0 :     actEdge = mHalfEdge.at( mHalfEdge.at( actEdge )-&gt;getNext() )-&gt;getDual();</span></a>
<a name="594"><span class="lineNum">     594 </span>                :            : </a>
<a name="595"><span class="lineNum">     595 </span>                :<span class="lineNoCov">          0 :   int counter = 0;//number of consecutive successful left-of-tests</span></a>
<a name="596"><span class="lineNum">     596 </span>                :<span class="lineNoCov">          0 :   int nulls = 0;//number of left-of-tests, which returned 0. 1 means, that the point is on a line, 2 means that it is on an existing point</span></a>
<a name="597"><span class="lineNum">     597 </span>                :<span class="lineNoCov">          0 :   int numInstabs = 0;//number of suspect left-of-tests due to 'leftOfTresh'</span></a>
<a name="598"><span class="lineNum">     598 </span>                :<span class="lineNoCov">          0 :   int runs = 0;//counter for the number of iterations in the loop to prevent an endless loop</span></a>
<a name="599"><span class="lineNum">     599 </span>                :<span class="lineNoCov">          0 :   int firstEndPoint = 0, secEndPoint = 0, thEndPoint = 0, fouEndPoint = 0; //four numbers of endpoints in cases when two left-of-test are 0</span></a>
<a name="600"><span class="lineNum">     600 </span>                :            : </a>
<a name="601"><span class="lineNum">     601 </span>                :<span class="lineNoCov">          0 :   while ( true )</span></a>
<a name="602"><span class="lineNum">     602 </span>                :            :   {</a>
<a name="603"><span class="lineNum">     603 </span>                :<span class="lineNoCov">          0 :     if ( runs &gt; MAX_BASE_ITERATIONS )//prevents endless loops</span></a>
<a name="604"><span class="lineNum">     604 </span>                :            :     {</a>
<a name="605"><span class="lineNum">     605 </span>                :            :       //QgsDebugMsg( &quot;warning, probable endless loop detected&quot; );</a>
<a name="606"><span class="lineNum">     606 </span>                :<span class="lineNoCov">          0 :       return -100;</span></a>
<a name="607"><span class="lineNum">     607 </span>                :            :     }</a>
<a name="608"><span class="lineNum">     608 </span>                :            : </a>
<a name="609"><span class="lineNum">     609 </span>                :<span class="lineNoCov">          0 :     double leftOfValue = MathUtils::leftOf( point, mPointVector.at( mHalfEdge.at( mHalfEdge.at( actEdge )-&gt;getDual() )-&gt;getPoint() ), mPointVector.at( mHalfEdge.at( actEdge )-&gt;getPoint() ) );</span></a>
<a name="610"><span class="lineNum">     610 </span>                :            : </a>
<a name="611"><span class="lineNum">     611 </span>                :<span class="lineNoCov">          0 :     if ( leftOfValue &lt; ( -leftOfTresh ) )//point is on the left side</span></a>
<a name="612"><span class="lineNum">     612 </span>                :            :     {</a>
<a name="613"><span class="lineNum">     613 </span>                :<span class="lineNoCov">          0 :       counter += 1;</span></a>
<a name="614"><span class="lineNum">     614 </span>                :<span class="lineNoCov">          0 :       if ( counter == 3 )//three successful passes means that we have found the triangle</span></a>
<a name="615"><span class="lineNum">     615 </span>                :            :       {</a>
<a name="616"><span class="lineNum">     616 </span>                :<span class="lineNoCov">          0 :         break;</span></a>
<a name="617"><span class="lineNum">     617 </span>                :            :       }</a>
<a name="618"><span class="lineNum">     618 </span>                :<span class="lineNoCov">          0 :     }</span></a>
<a name="619"><span class="lineNum">     619 </span>                :<span class="lineNoCov">          0 :     else if ( fabs( leftOfValue ) &lt;= leftOfTresh ) //point is exactly in the line of the edge</span></a>
<a name="620"><span class="lineNum">     620 </span>                :            :     {</a>
<a name="621"><span class="lineNum">     621 </span>                :<span class="lineNoCov">          0 :       if ( nulls == 0 )</span></a>
<a name="622"><span class="lineNum">     622 </span>                :            :       {</a>
<a name="623"><span class="lineNum">     623 </span>                :            :         //store the numbers of the two endpoints of the line</a>
<a name="624"><span class="lineNum">     624 </span>                :<span class="lineNoCov">          0 :         firstEndPoint = mHalfEdge.at( mHalfEdge.at( actEdge )-&gt;getDual() )-&gt;getPoint();</span></a>
<a name="625"><span class="lineNum">     625 </span>                :<span class="lineNoCov">          0 :         secEndPoint = mHalfEdge.at( actEdge )-&gt;getPoint();</span></a>
<a name="626"><span class="lineNum">     626 </span>                :<span class="lineNoCov">          0 :       }</span></a>
<a name="627"><span class="lineNum">     627 </span>                :<span class="lineNoCov">          0 :       else if ( nulls == 1 )</span></a>
<a name="628"><span class="lineNum">     628 </span>                :            :       {</a>
<a name="629"><span class="lineNum">     629 </span>                :            :         //store the numbers of the two endpoints of the line</a>
<a name="630"><span class="lineNum">     630 </span>                :<span class="lineNoCov">          0 :         thEndPoint = mHalfEdge.at( mHalfEdge.at( actEdge )-&gt;getDual() )-&gt;getPoint();</span></a>
<a name="631"><span class="lineNum">     631 </span>                :<span class="lineNoCov">          0 :         fouEndPoint = mHalfEdge.at( actEdge )-&gt;getPoint();</span></a>
<a name="632"><span class="lineNum">     632 </span>                :<span class="lineNoCov">          0 :       }</span></a>
<a name="633"><span class="lineNum">     633 </span>                :<span class="lineNoCov">          0 :       counter += 1;</span></a>
<a name="634"><span class="lineNum">     634 </span>                :<span class="lineNoCov">          0 :       mEdgeWithPoint = actEdge;</span></a>
<a name="635"><span class="lineNum">     635 </span>                :<span class="lineNoCov">          0 :       nulls += 1;</span></a>
<a name="636"><span class="lineNum">     636 </span>                :<span class="lineNoCov">          0 :       if ( counter == 3 )//three successful passes means that we have found the triangle</span></a>
<a name="637"><span class="lineNum">     637 </span>                :            :       {</a>
<a name="638"><span class="lineNum">     638 </span>                :<span class="lineNoCov">          0 :         break;</span></a>
<a name="639"><span class="lineNum">     639 </span>                :            :       }</a>
<a name="640"><span class="lineNum">     640 </span>                :<span class="lineNoCov">          0 :     }</span></a>
<a name="641"><span class="lineNum">     641 </span>                :            :     else//point is on the right side</a>
<a name="642"><span class="lineNum">     642 </span>                :            :     {</a>
<a name="643"><span class="lineNum">     643 </span>                :<span class="lineNoCov">          0 :       actEdge = mHalfEdge.at( actEdge )-&gt;getDual();</span></a>
<a name="644"><span class="lineNum">     644 </span>                :<span class="lineNoCov">          0 :       counter = 1;</span></a>
<a name="645"><span class="lineNum">     645 </span>                :<span class="lineNoCov">          0 :       nulls = 0;</span></a>
<a name="646"><span class="lineNum">     646 </span>                :<span class="lineNoCov">          0 :       numInstabs = 0;</span></a>
<a name="647"><span class="lineNum">     647 </span>                :            :     }</a>
<a name="648"><span class="lineNum">     648 </span>                :<span class="lineNoCov">          0 :     actEdge = mHalfEdge.at( actEdge )-&gt;getNext();</span></a>
<a name="649"><span class="lineNum">     649 </span>                :<span class="lineNoCov">          0 :     if ( mHalfEdge.at( actEdge )-&gt;getPoint() == -1 )//the half edge points to the virtual point</span></a>
<a name="650"><span class="lineNum">     650 </span>                :            :     {</a>
<a name="651"><span class="lineNum">     651 </span>                :<span class="lineNoCov">          0 :       if ( nulls == 1 )//point is exactly on the convex hull</span></a>
<a name="652"><span class="lineNum">     652 </span>                :            :       {</a>
<a name="653"><span class="lineNum">     653 </span>                :<span class="lineNoCov">          0 :         return -20;</span></a>
<a name="654"><span class="lineNum">     654 </span>                :            :       }</a>
<a name="655"><span class="lineNum">     655 </span>                :<span class="lineNoCov">          0 :       mEdgeOutside = ( unsigned int )mHalfEdge.at( mHalfEdge.at( actEdge )-&gt;getNext() )-&gt;getNext();</span></a>
<a name="656"><span class="lineNum">     656 </span>                :<span class="lineNoCov">          0 :       mEdgeInside = mHalfEdge.at( mHalfEdge.at( mEdgeOutside )-&gt;getDual() )-&gt;getNext();</span></a>
<a name="657"><span class="lineNum">     657 </span>                :<span class="lineNoCov">          0 :       return -10;//the point is outside the convex hull</span></a>
<a name="658"><span class="lineNum">     658 </span>                :            :     }</a>
<a name="659"><span class="lineNum">     659 </span>                :<span class="lineNoCov">          0 :     runs++;</span></a>
<a name="660"><span class="lineNum">     660 </span>                :            :   }</a>
<a name="661"><span class="lineNum">     661 </span>                :            : </a>
<a name="662"><span class="lineNum">     662 </span>                :<span class="lineNoCov">          0 :   if ( numInstabs &gt; 0 )//we hit an existing point or a numerical instability occurred</span></a>
<a name="663"><span class="lineNum">     663 </span>                :            :   {</a>
<a name="664"><span class="lineNum">     664 </span>                :            :     // QgsDebugMsg(&quot;numerical instability occurred&quot;);</a>
<a name="665"><span class="lineNum">     665 </span>                :<span class="lineNoCov">          0 :     mUnstableEdge = actEdge;</span></a>
<a name="666"><span class="lineNum">     666 </span>                :<span class="lineNoCov">          0 :     return -5;</span></a>
<a name="667"><span class="lineNum">     667 </span>                :            :   }</a>
<a name="668"><span class="lineNum">     668 </span>                :            : </a>
<a name="669"><span class="lineNum">     669 </span>                :<span class="lineNoCov">          0 :   if ( nulls == 2 )</span></a>
<a name="670"><span class="lineNum">     670 </span>                :            :   {</a>
<a name="671"><span class="lineNum">     671 </span>                :            :     //find out the number of the point, which has already been inserted</a>
<a name="672"><span class="lineNum">     672 </span>                :<span class="lineNoCov">          0 :     if ( firstEndPoint == thEndPoint || firstEndPoint == fouEndPoint )</span></a>
<a name="673"><span class="lineNum">     673 </span>                :            :     {</a>
<a name="674"><span class="lineNum">     674 </span>                :            :       //firstendp is the number of the point which has been inserted twice</a>
<a name="675"><span class="lineNum">     675 </span>                :<span class="lineNoCov">          0 :       mTwiceInsPoint = firstEndPoint;</span></a>
<a name="676"><span class="lineNum">     676 </span>                :            :       // QgsDebugMsg(QString(&quot;point nr %1 already inserted&quot;).arg(firstendp));</a>
<a name="677"><span class="lineNum">     677 </span>                :<span class="lineNoCov">          0 :     }</span></a>
<a name="678"><span class="lineNum">     678 </span>                :<span class="lineNoCov">          0 :     else if ( secEndPoint == thEndPoint || secEndPoint == fouEndPoint )</span></a>
<a name="679"><span class="lineNum">     679 </span>                :            :     {</a>
<a name="680"><span class="lineNum">     680 </span>                :            :       //secendp is the number of the point which has been inserted twice</a>
<a name="681"><span class="lineNum">     681 </span>                :<span class="lineNoCov">          0 :       mTwiceInsPoint = secEndPoint;</span></a>
<a name="682"><span class="lineNum">     682 </span>                :            :       // QgsDebugMsg(QString(&quot;point nr %1 already inserted&quot;).arg(secendp));</a>
<a name="683"><span class="lineNum">     683 </span>                :<span class="lineNoCov">          0 :     }</span></a>
<a name="684"><span class="lineNum">     684 </span>                :            : </a>
<a name="685"><span class="lineNum">     685 </span>                :<span class="lineNoCov">          0 :     return -25;//return the code for a point that is already contained in the triangulation</span></a>
<a name="686"><span class="lineNum">     686 </span>                :            :   }</a>
<a name="687"><span class="lineNum">     687 </span>                :            : </a>
<a name="688"><span class="lineNum">     688 </span>                :<span class="lineNoCov">          0 :   if ( nulls == 1 )//point is on an existing edge</span></a>
<a name="689"><span class="lineNum">     689 </span>                :            :   {</a>
<a name="690"><span class="lineNum">     690 </span>                :<span class="lineNoCov">          0 :     return -20;</span></a>
<a name="691"><span class="lineNum">     691 </span>                :            :   }</a>
<a name="692"><span class="lineNum">     692 </span>                :            : </a>
<a name="693"><span class="lineNum">     693 </span>                :<span class="lineNoCov">          0 :   mEdgeInside = actEdge;</span></a>
<a name="694"><span class="lineNum">     694 </span>                :            : </a>
<a name="695"><span class="lineNum">     695 </span>                :            :   int nr1, nr2, nr3;</a>
<a name="696"><span class="lineNum">     696 </span>                :<span class="lineNoCov">          0 :   nr1 = mHalfEdge.at( actEdge )-&gt;getPoint();</span></a>
<a name="697"><span class="lineNum">     697 </span>                :<span class="lineNoCov">          0 :   nr2 = mHalfEdge.at( mHalfEdge.at( actEdge )-&gt;getNext() )-&gt;getPoint();</span></a>
<a name="698"><span class="lineNum">     698 </span>                :<span class="lineNoCov">          0 :   nr3 = mHalfEdge.at( mHalfEdge.at( mHalfEdge.at( actEdge )-&gt;getNext() )-&gt;getNext() )-&gt;getPoint();</span></a>
<a name="699"><span class="lineNum">     699 </span>                :<span class="lineNoCov">          0 :   double x1 = mPointVector.at( nr1 )-&gt;x();</span></a>
<a name="700"><span class="lineNum">     700 </span>                :<span class="lineNoCov">          0 :   double y1 = mPointVector.at( nr1 )-&gt;y();</span></a>
<a name="701"><span class="lineNum">     701 </span>                :<span class="lineNoCov">          0 :   double x2 = mPointVector.at( nr2 )-&gt;x();</span></a>
<a name="702"><span class="lineNum">     702 </span>                :<span class="lineNoCov">          0 :   double y2 = mPointVector.at( nr2 )-&gt;y();</span></a>
<a name="703"><span class="lineNum">     703 </span>                :<span class="lineNoCov">          0 :   double x3 = mPointVector.at( nr3 )-&gt;x();</span></a>
<a name="704"><span class="lineNum">     704 </span>                :<span class="lineNoCov">          0 :   double y3 = mPointVector.at( nr3 )-&gt;y();</span></a>
<a name="705"><span class="lineNum">     705 </span>                :            : </a>
<a name="706"><span class="lineNum">     706 </span>                :            :   //now make sure that always the same edge is returned</a>
<a name="707"><span class="lineNum">     707 </span>                :<span class="lineNoCov">          0 :   if ( x1 &lt; x2 &amp;&amp; x1 &lt; x3 )//return the edge which points to the point with the lowest x-coordinate</span></a>
<a name="708"><span class="lineNum">     708 </span>                :            :   {</a>
<a name="709"><span class="lineNum">     709 </span>                :<span class="lineNoCov">          0 :     return actEdge;</span></a>
<a name="710"><span class="lineNum">     710 </span>                :            :   }</a>
<a name="711"><span class="lineNum">     711 </span>                :<span class="lineNoCov">          0 :   else if ( x2 &lt; x1 &amp;&amp; x2 &lt; x3 )</span></a>
<a name="712"><span class="lineNum">     712 </span>                :            :   {</a>
<a name="713"><span class="lineNum">     713 </span>                :<span class="lineNoCov">          0 :     return mHalfEdge.at( actEdge )-&gt;getNext();</span></a>
<a name="714"><span class="lineNum">     714 </span>                :            :   }</a>
<a name="715"><span class="lineNum">     715 </span>                :<span class="lineNoCov">          0 :   else if ( x3 &lt; x1 &amp;&amp; x3 &lt; x2 )</span></a>
<a name="716"><span class="lineNum">     716 </span>                :            :   {</a>
<a name="717"><span class="lineNum">     717 </span>                :<span class="lineNoCov">          0 :     return mHalfEdge.at( mHalfEdge.at( actEdge )-&gt;getNext() )-&gt;getNext();</span></a>
<a name="718"><span class="lineNum">     718 </span>                :            :   }</a>
<a name="719"><span class="lineNum">     719 </span>                :            :   //in case two x-coordinates are the same, the edge pointing to the point with the lower y-coordinate is returned</a>
<a name="720"><span class="lineNum">     720 </span>                :<span class="lineNoCov">          0 :   else if ( x1 == x2 )</span></a>
<a name="721"><span class="lineNum">     721 </span>                :            :   {</a>
<a name="722"><span class="lineNum">     722 </span>                :<span class="lineNoCov">          0 :     if ( y1 &lt; y2 )</span></a>
<a name="723"><span class="lineNum">     723 </span>                :            :     {</a>
<a name="724"><span class="lineNum">     724 </span>                :<span class="lineNoCov">          0 :       return actEdge;</span></a>
<a name="725"><span class="lineNum">     725 </span>                :            :     }</a>
<a name="726"><span class="lineNum">     726 </span>                :<span class="lineNoCov">          0 :     else if ( y2 &lt; y1 )</span></a>
<a name="727"><span class="lineNum">     727 </span>                :            :     {</a>
<a name="728"><span class="lineNum">     728 </span>                :<span class="lineNoCov">          0 :       return mHalfEdge.at( actEdge )-&gt;getNext();</span></a>
<a name="729"><span class="lineNum">     729 </span>                :            :     }</a>
<a name="730"><span class="lineNum">     730 </span>                :<span class="lineNoCov">          0 :   }</span></a>
<a name="731"><span class="lineNum">     731 </span>                :<span class="lineNoCov">          0 :   else if ( x2 == x3 )</span></a>
<a name="732"><span class="lineNum">     732 </span>                :            :   {</a>
<a name="733"><span class="lineNum">     733 </span>                :<span class="lineNoCov">          0 :     if ( y2 &lt; y3 )</span></a>
<a name="734"><span class="lineNum">     734 </span>                :            :     {</a>
<a name="735"><span class="lineNum">     735 </span>                :<span class="lineNoCov">          0 :       return mHalfEdge.at( actEdge )-&gt;getNext();</span></a>
<a name="736"><span class="lineNum">     736 </span>                :            :     }</a>
<a name="737"><span class="lineNum">     737 </span>                :<span class="lineNoCov">          0 :     else if ( y3 &lt; y2 )</span></a>
<a name="738"><span class="lineNum">     738 </span>                :            :     {</a>
<a name="739"><span class="lineNum">     739 </span>                :<span class="lineNoCov">          0 :       return mHalfEdge.at( mHalfEdge.at( actEdge )-&gt;getNext() )-&gt;getNext();</span></a>
<a name="740"><span class="lineNum">     740 </span>                :            :     }</a>
<a name="741"><span class="lineNum">     741 </span>                :<span class="lineNoCov">          0 :   }</span></a>
<a name="742"><span class="lineNum">     742 </span>                :<span class="lineNoCov">          0 :   else if ( x1 == x3 )</span></a>
<a name="743"><span class="lineNum">     743 </span>                :            :   {</a>
<a name="744"><span class="lineNum">     744 </span>                :<span class="lineNoCov">          0 :     if ( y1 &lt; y3 )</span></a>
<a name="745"><span class="lineNum">     745 </span>                :            :     {</a>
<a name="746"><span class="lineNum">     746 </span>                :<span class="lineNoCov">          0 :       return actEdge;</span></a>
<a name="747"><span class="lineNum">     747 </span>                :            :     }</a>
<a name="748"><span class="lineNum">     748 </span>                :<span class="lineNoCov">          0 :     else if ( y3 &lt; y1 )</span></a>
<a name="749"><span class="lineNum">     749 </span>                :            :     {</a>
<a name="750"><span class="lineNum">     750 </span>                :<span class="lineNoCov">          0 :       return mHalfEdge.at( mHalfEdge.at( actEdge )-&gt;getNext() )-&gt;getNext();</span></a>
<a name="751"><span class="lineNum">     751 </span>                :            :     }</a>
<a name="752"><span class="lineNum">     752 </span>                :<span class="lineNoCov">          0 :   }</span></a>
<a name="753"><span class="lineNum">     753 </span>                :<span class="lineNoCov">          0 :   return -100;//this means a bug happened</span></a>
<a name="754"><span class="lineNum">     754 </span>                :<span class="lineNoCov">          0 : }</span></a>
<a name="755"><span class="lineNum">     755 </span>                :            : </a>
<a name="756"><span class="lineNum">     756 </span>                :<span class="lineNoCov">          0 : bool QgsDualEdgeTriangulation::calcNormal( double x, double y, QgsPoint &amp;result )</span></a>
<a name="757"><span class="lineNum">     757 </span>                :            : {</a>
<a name="758"><span class="lineNum">     758 </span>                :<span class="lineNoCov">          0 :   if ( mTriangleInterpolator )</span></a>
<a name="759"><span class="lineNum">     759 </span>                :            :   {</a>
<a name="760"><span class="lineNum">     760 </span>                :<span class="lineNoCov">          0 :     return mTriangleInterpolator-&gt;calcNormVec( x, y, result );</span></a>
<a name="761"><span class="lineNum">     761 </span>                :            :   }</a>
<a name="762"><span class="lineNum">     762 </span>                :            :   else</a>
<a name="763"><span class="lineNum">     763 </span>                :            :   {</a>
<a name="764"><span class="lineNum">     764 </span>                :<span class="lineNoCov">          0 :     QgsDebugMsg( QStringLiteral( &quot;warning, null pointer&quot; ) );</span></a>
<a name="765"><span class="lineNum">     765 </span>                :<span class="lineNoCov">          0 :     return false;</span></a>
<a name="766"><span class="lineNum">     766 </span>                :            :   }</a>
<a name="767"><span class="lineNum">     767 </span>                :<span class="lineNoCov">          0 : }</span></a>
<a name="768"><span class="lineNum">     768 </span>                :            : </a>
<a name="769"><span class="lineNum">     769 </span>                :<span class="lineNoCov">          0 : bool QgsDualEdgeTriangulation::calcPoint( double x, double y, QgsPoint &amp;result )</span></a>
<a name="770"><span class="lineNum">     770 </span>                :            : {</a>
<a name="771"><span class="lineNum">     771 </span>                :<span class="lineNoCov">          0 :   if ( mTriangleInterpolator )</span></a>
<a name="772"><span class="lineNum">     772 </span>                :            :   {</a>
<a name="773"><span class="lineNum">     773 </span>                :<span class="lineNoCov">          0 :     return mTriangleInterpolator-&gt;calcPoint( x, y, result );</span></a>
<a name="774"><span class="lineNum">     774 </span>                :            :   }</a>
<a name="775"><span class="lineNum">     775 </span>                :            :   else</a>
<a name="776"><span class="lineNum">     776 </span>                :            :   {</a>
<a name="777"><span class="lineNum">     777 </span>                :<span class="lineNoCov">          0 :     QgsDebugMsg( QStringLiteral( &quot;warning, null pointer&quot; ) );</span></a>
<a name="778"><span class="lineNum">     778 </span>                :<span class="lineNoCov">          0 :     return false;</span></a>
<a name="779"><span class="lineNum">     779 </span>                :            :   }</a>
<a name="780"><span class="lineNum">     780 </span>                :<span class="lineNoCov">          0 : }</span></a>
<a name="781"><span class="lineNum">     781 </span>                :            : </a>
<a name="782"><span class="lineNum">     782 </span>                :<span class="lineNoCov">          0 : bool QgsDualEdgeTriangulation::checkSwapRecursively( unsigned int edge, unsigned int recursiveDeep )</span></a>
<a name="783"><span class="lineNum">     783 </span>                :            : {</a>
<a name="784"><span class="lineNum">     784 </span>                :<span class="lineNoCov">          0 :   if ( swapPossible( edge ) )</span></a>
<a name="785"><span class="lineNum">     785 </span>                :            :   {</a>
<a name="786"><span class="lineNum">     786 </span>                :<span class="lineNoCov">          0 :     QgsPoint *pta = mPointVector.at( mHalfEdge.at( edge )-&gt;getPoint() );</span></a>
<a name="787"><span class="lineNum">     787 </span>                :<span class="lineNoCov">          0 :     QgsPoint *ptb = mPointVector.at( mHalfEdge.at( mHalfEdge.at( edge )-&gt;getNext() )-&gt;getPoint() );</span></a>
<a name="788"><span class="lineNum">     788 </span>                :<span class="lineNoCov">          0 :     QgsPoint *ptc = mPointVector.at( mHalfEdge.at( mHalfEdge.at( mHalfEdge.at( edge )-&gt;getNext( ) )-&gt;getNext() )-&gt;getPoint() );</span></a>
<a name="789"><span class="lineNum">     789 </span>                :<span class="lineNoCov">          0 :     QgsPoint *ptd = mPointVector.at( mHalfEdge.at( mHalfEdge.at( mHalfEdge.at( edge )-&gt;getDual() )-&gt;getNext() )-&gt;getPoint() );</span></a>
<a name="790"><span class="lineNum">     790 </span>                :<span class="lineNoCov">          0 :     if ( inCircle( *ptd, *pta, *ptb, *ptc ) /*&amp;&amp; recursiveDeep &lt; 100*/ ) //empty circle criterion violated</span></a>
<a name="791"><span class="lineNum">     791 </span>                :            :     {</a>
<a name="792"><span class="lineNum">     792 </span>                :<span class="lineNoCov">          0 :       doSwapRecursively( edge, recursiveDeep );//swap the edge (recursive)</span></a>
<a name="793"><span class="lineNum">     793 </span>                :<span class="lineNoCov">          0 :       return true;</span></a>
<a name="794"><span class="lineNum">     794 </span>                :            :     }</a>
<a name="795"><span class="lineNum">     795 </span>                :<span class="lineNoCov">          0 :   }</span></a>
<a name="796"><span class="lineNum">     796 </span>                :<span class="lineNoCov">          0 :   return false;</span></a>
<a name="797"><span class="lineNum">     797 </span>                :<span class="lineNoCov">          0 : }</span></a>
<a name="798"><span class="lineNum">     798 </span>                :            : </a>
<a name="799"><span class="lineNum">     799 </span>                :<span class="lineNoCov">          0 : bool QgsDualEdgeTriangulation::isEdgeNeedSwap( unsigned int edge ) const</span></a>
<a name="800"><span class="lineNum">     800 </span>                :            : {</a>
<a name="801"><span class="lineNum">     801 </span>                :<span class="lineNoCov">          0 :   if ( swapPossible( edge ) )</span></a>
<a name="802"><span class="lineNum">     802 </span>                :            :   {</a>
<a name="803"><span class="lineNum">     803 </span>                :<span class="lineNoCov">          0 :     QgsPoint *pta = mPointVector[mHalfEdge[edge]-&gt;getPoint()];</span></a>
<a name="804"><span class="lineNum">     804 </span>                :<span class="lineNoCov">          0 :     QgsPoint *ptb = mPointVector[mHalfEdge[mHalfEdge[edge]-&gt;getNext()]-&gt;getPoint()];</span></a>
<a name="805"><span class="lineNum">     805 </span>                :<span class="lineNoCov">          0 :     QgsPoint *ptc = mPointVector[mHalfEdge[mHalfEdge[mHalfEdge[edge]-&gt;getNext()]-&gt;getNext()]-&gt;getPoint()];</span></a>
<a name="806"><span class="lineNum">     806 </span>                :<span class="lineNoCov">          0 :     QgsPoint *ptd = mPointVector[mHalfEdge[mHalfEdge[mHalfEdge[edge]-&gt;getDual()]-&gt;getNext()]-&gt;getPoint()];</span></a>
<a name="807"><span class="lineNum">     807 </span>                :<span class="lineNoCov">          0 :     return inCircle( *ptd, *pta, *ptb, *ptc );</span></a>
<a name="808"><span class="lineNum">     808 </span>                :            :   }</a>
<a name="809"><span class="lineNum">     809 </span>                :            : </a>
<a name="810"><span class="lineNum">     810 </span>                :<span class="lineNoCov">          0 :   return false;</span></a>
<a name="811"><span class="lineNum">     811 </span>                :            : </a>
<a name="812"><span class="lineNum">     812 </span>                :<span class="lineNoCov">          0 : }</span></a>
<a name="813"><span class="lineNum">     813 </span>                :            : </a>
<a name="814"><span class="lineNum">     814 </span>                :<span class="lineNoCov">          0 : void QgsDualEdgeTriangulation::doOnlySwap( unsigned int edge )</span></a>
<a name="815"><span class="lineNum">     815 </span>                :            : {</a>
<a name="816"><span class="lineNum">     816 </span>                :<span class="lineNoCov">          0 :   unsigned int edge1 = edge;</span></a>
<a name="817"><span class="lineNum">     817 </span>                :<span class="lineNoCov">          0 :   unsigned int edge2 = mHalfEdge[edge]-&gt;getDual();</span></a>
<a name="818"><span class="lineNum">     818 </span>                :<span class="lineNoCov">          0 :   unsigned int edge3 = mHalfEdge[edge]-&gt;getNext();</span></a>
<a name="819"><span class="lineNum">     819 </span>                :<span class="lineNoCov">          0 :   unsigned int edge4 = mHalfEdge[mHalfEdge[edge]-&gt;getNext()]-&gt;getNext();</span></a>
<a name="820"><span class="lineNum">     820 </span>                :<span class="lineNoCov">          0 :   unsigned int edge5 = mHalfEdge[mHalfEdge[edge]-&gt;getDual()]-&gt;getNext();</span></a>
<a name="821"><span class="lineNum">     821 </span>                :<span class="lineNoCov">          0 :   unsigned int edge6 = mHalfEdge[mHalfEdge[mHalfEdge[edge]-&gt;getDual()]-&gt;getNext()]-&gt;getNext();</span></a>
<a name="822"><span class="lineNum">     822 </span>                :<span class="lineNoCov">          0 :   mHalfEdge[edge1]-&gt;setNext( edge4 );//set the necessary nexts</span></a>
<a name="823"><span class="lineNum">     823 </span>                :<span class="lineNoCov">          0 :   mHalfEdge[edge2]-&gt;setNext( edge6 );</span></a>
<a name="824"><span class="lineNum">     824 </span>                :<span class="lineNoCov">          0 :   mHalfEdge[edge3]-&gt;setNext( edge2 );</span></a>
<a name="825"><span class="lineNum">     825 </span>                :<span class="lineNoCov">          0 :   mHalfEdge[edge4]-&gt;setNext( edge5 );</span></a>
<a name="826"><span class="lineNum">     826 </span>                :<span class="lineNoCov">          0 :   mHalfEdge[edge5]-&gt;setNext( edge1 );</span></a>
<a name="827"><span class="lineNum">     827 </span>                :<span class="lineNoCov">          0 :   mHalfEdge[edge6]-&gt;setNext( edge3 );</span></a>
<a name="828"><span class="lineNum">     828 </span>                :<span class="lineNoCov">          0 :   mHalfEdge[edge1]-&gt;setPoint( mHalfEdge[edge3]-&gt;getPoint() );//change the points to which edge1 and edge2 point</span></a>
<a name="829"><span class="lineNum">     829 </span>                :<span class="lineNoCov">          0 :   mHalfEdge[edge2]-&gt;setPoint( mHalfEdge[edge5]-&gt;getPoint() );</span></a>
<a name="830"><span class="lineNum">     830 </span>                :<span class="lineNoCov">          0 : }</span></a>
<a name="831"><span class="lineNum">     831 </span>                :            : </a>
<a name="832"><span class="lineNum">     832 </span>                :<span class="lineNoCov">          0 : void QgsDualEdgeTriangulation::doSwapRecursively( unsigned int edge, unsigned int recursiveDeep )</span></a>
<a name="833"><span class="lineNum">     833 </span>                :            : {</a>
<a name="834"><span class="lineNum">     834 </span>                :<span class="lineNoCov">          0 :   unsigned int edge1 = edge;</span></a>
<a name="835"><span class="lineNum">     835 </span>                :<span class="lineNoCov">          0 :   unsigned int edge2 = mHalfEdge.at( edge )-&gt;getDual();</span></a>
<a name="836"><span class="lineNum">     836 </span>                :<span class="lineNoCov">          0 :   unsigned int edge3 = mHalfEdge.at( edge )-&gt;getNext();</span></a>
<a name="837"><span class="lineNum">     837 </span>                :<span class="lineNoCov">          0 :   unsigned int edge4 = mHalfEdge.at( mHalfEdge.at( edge )-&gt;getNext() )-&gt;getNext();</span></a>
<a name="838"><span class="lineNum">     838 </span>                :<span class="lineNoCov">          0 :   unsigned int edge5 = mHalfEdge.at( mHalfEdge.at( edge )-&gt;getDual() )-&gt;getNext();</span></a>
<a name="839"><span class="lineNum">     839 </span>                :<span class="lineNoCov">          0 :   unsigned int edge6 = mHalfEdge.at( mHalfEdge.at( mHalfEdge.at( edge )-&gt;getDual() )-&gt;getNext() )-&gt;getNext();</span></a>
<a name="840"><span class="lineNum">     840 </span>                :<span class="lineNoCov">          0 :   mHalfEdge.at( edge1 )-&gt;setNext( edge4 );//set the necessary nexts</span></a>
<a name="841"><span class="lineNum">     841 </span>                :<span class="lineNoCov">          0 :   mHalfEdge.at( edge2 )-&gt;setNext( edge6 );</span></a>
<a name="842"><span class="lineNum">     842 </span>                :<span class="lineNoCov">          0 :   mHalfEdge.at( edge3 )-&gt;setNext( edge2 );</span></a>
<a name="843"><span class="lineNum">     843 </span>                :<span class="lineNoCov">          0 :   mHalfEdge.at( edge4 )-&gt;setNext( edge5 );</span></a>
<a name="844"><span class="lineNum">     844 </span>                :<span class="lineNoCov">          0 :   mHalfEdge.at( edge5 )-&gt;setNext( edge1 );</span></a>
<a name="845"><span class="lineNum">     845 </span>                :<span class="lineNoCov">          0 :   mHalfEdge.at( edge6 )-&gt;setNext( edge3 );</span></a>
<a name="846"><span class="lineNum">     846 </span>                :<span class="lineNoCov">          0 :   mHalfEdge.at( edge1 )-&gt;setPoint( mHalfEdge.at( edge3 )-&gt;getPoint() );//change the points to which edge1 and edge2 point</span></a>
<a name="847"><span class="lineNum">     847 </span>                :<span class="lineNoCov">          0 :   mHalfEdge.at( edge2 )-&gt;setPoint( mHalfEdge.at( edge5 )-&gt;getPoint() );</span></a>
<a name="848"><span class="lineNum">     848 </span>                :<span class="lineNoCov">          0 :   recursiveDeep++;</span></a>
<a name="849"><span class="lineNum">     849 </span>                :            : </a>
<a name="850"><span class="lineNum">     850 </span>                :<span class="lineNoCov">          0 :   if ( recursiveDeep &lt; 100 )</span></a>
<a name="851"><span class="lineNum">     851 </span>                :            :   {</a>
<a name="852"><span class="lineNum">     852 </span>                :<span class="lineNoCov">          0 :     checkSwapRecursively( edge3, recursiveDeep );</span></a>
<a name="853"><span class="lineNum">     853 </span>                :<span class="lineNoCov">          0 :     checkSwapRecursively( edge6, recursiveDeep );</span></a>
<a name="854"><span class="lineNum">     854 </span>                :<span class="lineNoCov">          0 :     checkSwapRecursively( edge4, recursiveDeep );</span></a>
<a name="855"><span class="lineNum">     855 </span>                :<span class="lineNoCov">          0 :     checkSwapRecursively( edge5, recursiveDeep );</span></a>
<a name="856"><span class="lineNum">     856 </span>                :<span class="lineNoCov">          0 :   }</span></a>
<a name="857"><span class="lineNum">     857 </span>                :            :   else</a>
<a name="858"><span class="lineNum">     858 </span>                :            :   {</a>
<a name="859"><span class="lineNum">     859 </span>                :<span class="lineNoCov">          0 :     QStack&lt;int&gt; edgesToSwap;</span></a>
<a name="860"><span class="lineNum">     860 </span>                :<span class="lineNoCov">          0 :     edgesToSwap.push( edge3 );</span></a>
<a name="861"><span class="lineNum">     861 </span>                :<span class="lineNoCov">          0 :     edgesToSwap.push( edge6 );</span></a>
<a name="862"><span class="lineNum">     862 </span>                :<span class="lineNoCov">          0 :     edgesToSwap.push( edge4 );</span></a>
<a name="863"><span class="lineNum">     863 </span>                :<span class="lineNoCov">          0 :     edgesToSwap.push( edge5 );</span></a>
<a name="864"><span class="lineNum">     864 </span>                :<span class="lineNoCov">          0 :     int loopCount = 0;</span></a>
<a name="865"><span class="lineNum">     865 </span>                :<span class="lineNoCov">          0 :     while ( !edgesToSwap.isEmpty() &amp;&amp; loopCount &lt; 10000 )</span></a>
<a name="866"><span class="lineNum">     866 </span>                :            :     {</a>
<a name="867"><span class="lineNum">     867 </span>                :<span class="lineNoCov">          0 :       loopCount++;</span></a>
<a name="868"><span class="lineNum">     868 </span>                :<span class="lineNoCov">          0 :       unsigned int e1 = edgesToSwap.pop();</span></a>
<a name="869"><span class="lineNum">     869 </span>                :<span class="lineNoCov">          0 :       if ( isEdgeNeedSwap( e1 ) )</span></a>
<a name="870"><span class="lineNum">     870 </span>                :            :       {</a>
<a name="871"><span class="lineNum">     871 </span>                :<span class="lineNoCov">          0 :         unsigned int e2 = mHalfEdge.at( e1 )-&gt;getDual();</span></a>
<a name="872"><span class="lineNum">     872 </span>                :<span class="lineNoCov">          0 :         unsigned int e3 = mHalfEdge.at( e1 )-&gt;getNext();</span></a>
<a name="873"><span class="lineNum">     873 </span>                :<span class="lineNoCov">          0 :         unsigned int e4 = mHalfEdge.at( mHalfEdge.at( e1 )-&gt;getNext() )-&gt;getNext();</span></a>
<a name="874"><span class="lineNum">     874 </span>                :<span class="lineNoCov">          0 :         unsigned int e5 = mHalfEdge.at( mHalfEdge.at( e1 )-&gt;getDual() )-&gt;getNext();</span></a>
<a name="875"><span class="lineNum">     875 </span>                :<span class="lineNoCov">          0 :         unsigned int e6 = mHalfEdge.at( mHalfEdge.at( mHalfEdge.at( e1 )-&gt;getDual() )-&gt;getNext() )-&gt;getNext();</span></a>
<a name="876"><span class="lineNum">     876 </span>                :<span class="lineNoCov">          0 :         mHalfEdge.at( e1 )-&gt;setNext( e4 );//set the necessary nexts</span></a>
<a name="877"><span class="lineNum">     877 </span>                :<span class="lineNoCov">          0 :         mHalfEdge.at( e2 )-&gt;setNext( e6 );</span></a>
<a name="878"><span class="lineNum">     878 </span>                :<span class="lineNoCov">          0 :         mHalfEdge.at( e3 )-&gt;setNext( e2 );</span></a>
<a name="879"><span class="lineNum">     879 </span>                :<span class="lineNoCov">          0 :         mHalfEdge.at( e4 )-&gt;setNext( e5 );</span></a>
<a name="880"><span class="lineNum">     880 </span>                :<span class="lineNoCov">          0 :         mHalfEdge.at( e5 )-&gt;setNext( e1 );</span></a>
<a name="881"><span class="lineNum">     881 </span>                :<span class="lineNoCov">          0 :         mHalfEdge.at( e6 )-&gt;setNext( e3 );</span></a>
<a name="882"><span class="lineNum">     882 </span>                :<span class="lineNoCov">          0 :         mHalfEdge.at( e1 )-&gt;setPoint( mHalfEdge.at( e3 )-&gt;getPoint() );//change the points to which edge1 and edge2 point</span></a>
<a name="883"><span class="lineNum">     883 </span>                :<span class="lineNoCov">          0 :         mHalfEdge.at( e2 )-&gt;setPoint( mHalfEdge.at( e5 )-&gt;getPoint() );</span></a>
<a name="884"><span class="lineNum">     884 </span>                :            : </a>
<a name="885"><span class="lineNum">     885 </span>                :<span class="lineNoCov">          0 :         edgesToSwap.push( e3 );</span></a>
<a name="886"><span class="lineNum">     886 </span>                :<span class="lineNoCov">          0 :         edgesToSwap.push( e6 );</span></a>
<a name="887"><span class="lineNum">     887 </span>                :<span class="lineNoCov">          0 :         edgesToSwap.push( e4 );</span></a>
<a name="888"><span class="lineNum">     888 </span>                :<span class="lineNoCov">          0 :         edgesToSwap.push( e5 );</span></a>
<a name="889"><span class="lineNum">     889 </span>                :<span class="lineNoCov">          0 :       }</span></a>
<a name="890"><span class="lineNum">     890 </span>                :            :     }</a>
<a name="891"><span class="lineNum">     891 </span>                :<span class="lineNoCov">          0 :   }</span></a>
<a name="892"><span class="lineNum">     892 </span>                :            : </a>
<a name="893"><span class="lineNum">     893 </span>                :<span class="lineNoCov">          0 : }</span></a>
<a name="894"><span class="lineNum">     894 </span>                :            : </a>
<a name="895"><span class="lineNum">     895 </span>                :            : #if 0</a>
<a name="896"><span class="lineNum">     896 </span>                :            : void DualEdgeTriangulation::draw( QPainter *p, double xlowleft, double ylowleft, double xupright, double yupright, double width, double height ) const</a>
<a name="897"><span class="lineNum">     897 </span>                :            : {</a>
<a name="898"><span class="lineNum">     898 </span>                :            :   //if mPointVector is empty, there is nothing to do</a>
<a name="899"><span class="lineNum">     899 </span>                :            :   if ( mPointVector.isEmpty() )</a>
<a name="900"><span class="lineNum">     900 </span>                :            :   {</a>
<a name="901"><span class="lineNum">     901 </span>                :            :     return;</a>
<a name="902"><span class="lineNum">     902 </span>                :            :   }</a>
<a name="903"><span class="lineNum">     903 </span>                :            : </a>
<a name="904"><span class="lineNum">     904 </span>                :            :   p-&gt;setPen( mEdgeColor );</a>
<a name="905"><span class="lineNum">     905 </span>                :            : </a>
<a name="906"><span class="lineNum">     906 </span>                :            :   bool *control = new bool[mHalfEdge.count()];//controllarray that no edge is painted twice</a>
<a name="907"><span class="lineNum">     907 </span>                :            :   bool *control2 = new bool[mHalfEdge.count()];//controllarray for the flat triangles</a>
<a name="908"><span class="lineNum">     908 </span>                :            : </a>
<a name="909"><span class="lineNum">     909 </span>                :            :   for ( unsigned int i = 0; i &lt;= mHalfEdge.count() - 1; i++ )</a>
<a name="910"><span class="lineNum">     910 </span>                :            :   {</a>
<a name="911"><span class="lineNum">     911 </span>                :            :     control[i] = false;</a>
<a name="912"><span class="lineNum">     912 </span>                :            :     control2[i] = false;</a>
<a name="913"><span class="lineNum">     913 </span>                :            :   }</a>
<a name="914"><span class="lineNum">     914 </span>                :            : </a>
<a name="915"><span class="lineNum">     915 </span>                :            :   if ( ( ( xupright - xlowleft ) / width ) &gt; ( ( yupright - ylowleft ) / height ) )</a>
<a name="916"><span class="lineNum">     916 </span>                :            :   {</a>
<a name="917"><span class="lineNum">     917 </span>                :            :     double lowerborder = -( height * ( xupright - xlowleft ) / width - yupright );//real world coordinates of the lower widget border. This is useful to know because of the HalfEdge bounding box test</a>
<a name="918"><span class="lineNum">     918 </span>                :            :     for ( unsigned int i = 0; i &lt; mHalfEdge.count() - 1; i++ )</a>
<a name="919"><span class="lineNum">     919 </span>                :            :     {</a>
<a name="920"><span class="lineNum">     920 </span>                :            :       if ( mHalfEdge[i]-&gt;getPoint() == -1 || mHalfEdge[mHalfEdge[i]-&gt;getDual()]-&gt;getPoint() == -1 )</a>
<a name="921"><span class="lineNum">     921 </span>                :            :       {continue;}</a>
<a name="922"><span class="lineNum">     922 </span>                :            : </a>
<a name="923"><span class="lineNum">     923 </span>                :            :       //check, if the edge belongs to a flat triangle, remove this later</a>
<a name="924"><span class="lineNum">     924 </span>                :            :       if ( !control2[i] )</a>
<a name="925"><span class="lineNum">     925 </span>                :            :       {</a>
<a name="926"><span class="lineNum">     926 </span>                :            :         double p1, p2, p3;</a>
<a name="927"><span class="lineNum">     927 </span>                :            :         if ( mHalfEdge[i]-&gt;getPoint() != -1 &amp;&amp; mHalfEdge[mHalfEdge[i]-&gt;getNext()]-&gt;getPoint() != -1 &amp;&amp; mHalfEdge[mHalfEdge[mHalfEdge[i]-&gt;getNext()]-&gt;getNext()]-&gt;getPoint() != -1 )</a>
<a name="928"><span class="lineNum">     928 </span>                :            :         {</a>
<a name="929"><span class="lineNum">     929 </span>                :            :           p1 = mPointVector[mHalfEdge[i]-&gt;getPoint()]-&gt;getZ();</a>
<a name="930"><span class="lineNum">     930 </span>                :            :           p2 = mPointVector[mHalfEdge[mHalfEdge[i]-&gt;getNext()]-&gt;getPoint()]-&gt;getZ();</a>
<a name="931"><span class="lineNum">     931 </span>                :            :           p3 = mPointVector[mHalfEdge[mHalfEdge[mHalfEdge[i]-&gt;getNext()]-&gt;getNext()]-&gt;getPoint()]-&gt;getZ();</a>
<a name="932"><span class="lineNum">     932 </span>                :            :           if ( p1 == p2 &amp;&amp; p2 == p3 &amp;&amp; halfEdgeBBoxTest( i, xlowleft, lowerborder, xupright, yupright ) &amp;&amp; halfEdgeBBoxTest( mHalfEdge[i]-&gt;getNext(), xlowleft, lowerborder, xupright, yupright ) &amp;&amp; halfEdgeBBoxTest( mHalfEdge[mHalfEdge[i]-&gt;getNext()]-&gt;getNext(), xlowleft, lowerborder, xupright, yupright ) )//draw the triangle</a>
<a name="933"><span class="lineNum">     933 </span>                :            :           {</a>
<a name="934"><span class="lineNum">     934 </span>                :            :             QPointArray pa( 3 );</a>
<a name="935"><span class="lineNum">     935 </span>                :            :             pa.setPoint( 0, ( mPointVector[mHalfEdge[i]-&gt;getPoint()]-&gt;getX() - xlowleft ) / ( xupright - xlowleft )*width, ( yupright - mPointVector[mHalfEdge[i]-&gt;getPoint()]-&gt;getY() ) / ( xupright - xlowleft )*width );</a>
<a name="936"><span class="lineNum">     936 </span>                :            :             pa.setPoint( 1, ( mPointVector[mHalfEdge[mHalfEdge[i]-&gt;getNext()]-&gt;getPoint()]-&gt;getX() - xlowleft ) / ( xupright - xlowleft )*width, ( yupright - mPointVector[mHalfEdge[mHalfEdge[i]-&gt;getNext()]-&gt;getPoint()]-&gt;getY() ) / ( xupright - xlowleft )*width );</a>
<a name="937"><span class="lineNum">     937 </span>                :            :             pa.setPoint( 2, ( mPointVector[mHalfEdge[mHalfEdge[mHalfEdge[i]-&gt;getNext()]-&gt;getNext()]-&gt;getPoint()]-&gt;getX() - xlowleft ) / ( xupright - xlowleft )*width, ( yupright - mPointVector[mHalfEdge[mHalfEdge[mHalfEdge[i]-&gt;getNext()]-&gt;getNext()]-&gt;getPoint()]-&gt;getY() ) / ( xupright - xlowleft )*width );</a>
<a name="938"><span class="lineNum">     938 </span>                :            :             QColor c( 255, 0, 0 );</a>
<a name="939"><span class="lineNum">     939 </span>                :            :             p-&gt;setBrush( c );</a>
<a name="940"><span class="lineNum">     940 </span>                :            :             p-&gt;drawPolygon( pa );</a>
<a name="941"><span class="lineNum">     941 </span>                :            :           }</a>
<a name="942"><span class="lineNum">     942 </span>                :            :         }</a>
<a name="943"><span class="lineNum">     943 </span>                :            : </a>
<a name="944"><span class="lineNum">     944 </span>                :            :         control2[i] = true;</a>
<a name="945"><span class="lineNum">     945 </span>                :            :         control2[mHalfEdge[i]-&gt;getNext()] = true;</a>
<a name="946"><span class="lineNum">     946 </span>                :            :         control2[mHalfEdge[mHalfEdge[i]-&gt;getNext()]-&gt;getNext()] = true;</a>
<a name="947"><span class="lineNum">     947 </span>                :            :       }//end of the section, which has to be removed later</a>
<a name="948"><span class="lineNum">     948 </span>                :            : </a>
<a name="949"><span class="lineNum">     949 </span>                :            :       if ( control[i] )//check, if edge has already been drawn</a>
<a name="950"><span class="lineNum">     950 </span>                :            :       {continue;}</a>
<a name="951"><span class="lineNum">     951 </span>                :            : </a>
<a name="952"><span class="lineNum">     952 </span>                :            :       //draw the edge;</a>
<a name="953"><span class="lineNum">     953 </span>                :            :       if ( halfEdgeBBoxTest( i, xlowleft, lowerborder, xupright, yupright ) )//only draw the halfedge if its bounding box intersects the painted area</a>
<a name="954"><span class="lineNum">     954 </span>                :            :       {</a>
<a name="955"><span class="lineNum">     955 </span>                :            :         if ( mHalfEdge[i]-&gt;getBreak() )//change the color it the edge is a breakline</a>
<a name="956"><span class="lineNum">     956 </span>                :            :         {</a>
<a name="957"><span class="lineNum">     957 </span>                :            :           p-&gt;setPen( mBreakEdgeColor );</a>
<a name="958"><span class="lineNum">     958 </span>                :            :         }</a>
<a name="959"><span class="lineNum">     959 </span>                :            :         else if ( mHalfEdge[i]-&gt;getForced() )//change the color if the edge is forced</a>
<a name="960"><span class="lineNum">     960 </span>                :            :         {</a>
<a name="961"><span class="lineNum">     961 </span>                :            :           p-&gt;setPen( mForcedEdgeColor );</a>
<a name="962"><span class="lineNum">     962 </span>                :            :         }</a>
<a name="963"><span class="lineNum">     963 </span>                :            : </a>
<a name="964"><span class="lineNum">     964 </span>                :            : </a>
<a name="965"><span class="lineNum">     965 </span>                :            :         p-&gt;drawLine( ( mPointVector[mHalfEdge[i]-&gt;getPoint()]-&gt;getX() - xlowleft ) / ( xupright - xlowleft )*width, ( yupright - mPointVector[mHalfEdge[i]-&gt;getPoint()]-&gt;getY() ) / ( xupright - xlowleft )*width, ( mPointVector[mHalfEdge[mHalfEdge[i]-&gt;getDual()]-&gt;getPoint()]-&gt;getX() - xlowleft ) / ( xupright - xlowleft )*width, ( yupright - mPointVector[mHalfEdge[mHalfEdge[i]-&gt;getDual()]-&gt;getPoint()]-&gt;getY() ) / ( xupright - xlowleft )*width );</a>
<a name="966"><span class="lineNum">     966 </span>                :            : </a>
<a name="967"><span class="lineNum">     967 </span>                :            :         if ( mHalfEdge[i]-&gt;getForced() )</a>
<a name="968"><span class="lineNum">     968 </span>                :            :         {</a>
<a name="969"><span class="lineNum">     969 </span>                :            :           p-&gt;setPen( mEdgeColor );</a>
<a name="970"><span class="lineNum">     970 </span>                :            :         }</a>
<a name="971"><span class="lineNum">     971 </span>                :            : </a>
<a name="972"><span class="lineNum">     972 </span>                :            : </a>
<a name="973"><span class="lineNum">     973 </span>                :            :       }</a>
<a name="974"><span class="lineNum">     974 </span>                :            :       control[i] = true;</a>
<a name="975"><span class="lineNum">     975 </span>                :            :       control[mHalfEdge[i]-&gt;getDual()] = true;</a>
<a name="976"><span class="lineNum">     976 </span>                :            :     }</a>
<a name="977"><span class="lineNum">     977 </span>                :            :   }</a>
<a name="978"><span class="lineNum">     978 </span>                :            :   else</a>
<a name="979"><span class="lineNum">     979 </span>                :            :   {</a>
<a name="980"><span class="lineNum">     980 </span>                :            :     double rightborder = width * ( yupright - ylowleft ) / height + xlowleft;//real world coordinates of the right widget border. This is useful to know because of the HalfEdge bounding box test</a>
<a name="981"><span class="lineNum">     981 </span>                :            :     for ( unsigned int i = 0; i &lt; mHalfEdge.count() - 1; i++ )</a>
<a name="982"><span class="lineNum">     982 </span>                :            :     {</a>
<a name="983"><span class="lineNum">     983 </span>                :            :       if ( mHalfEdge[i]-&gt;getPoint() == -1 || mHalfEdge[mHalfEdge[i]-&gt;getDual()]-&gt;getPoint() == -1 )</a>
<a name="984"><span class="lineNum">     984 </span>                :            :       {continue;}</a>
<a name="985"><span class="lineNum">     985 </span>                :            : </a>
<a name="986"><span class="lineNum">     986 </span>                :            :       //check, if the edge belongs to a flat triangle, remove this section later</a>
<a name="987"><span class="lineNum">     987 </span>                :            :       if ( !control2[i] )</a>
<a name="988"><span class="lineNum">     988 </span>                :            :       {</a>
<a name="989"><span class="lineNum">     989 </span>                :            :         double p1, p2, p3;</a>
<a name="990"><span class="lineNum">     990 </span>                :            :         if ( mHalfEdge[i]-&gt;getPoint() != -1 &amp;&amp; mHalfEdge[mHalfEdge[i]-&gt;getNext()]-&gt;getPoint() != -1 &amp;&amp; mHalfEdge[mHalfEdge[mHalfEdge[i]-&gt;getNext()]-&gt;getNext()]-&gt;getPoint() != -1 )</a>
<a name="991"><span class="lineNum">     991 </span>                :            :         {</a>
<a name="992"><span class="lineNum">     992 </span>                :            :           p1 = mPointVector[mHalfEdge[i]-&gt;getPoint()]-&gt;getZ();</a>
<a name="993"><span class="lineNum">     993 </span>                :            :           p2 = mPointVector[mHalfEdge[mHalfEdge[i]-&gt;getNext()]-&gt;getPoint()]-&gt;getZ();</a>
<a name="994"><span class="lineNum">     994 </span>                :            :           p3 = mPointVector[mHalfEdge[mHalfEdge[mHalfEdge[i]-&gt;getNext()]-&gt;getNext()]-&gt;getPoint()]-&gt;getZ();</a>
<a name="995"><span class="lineNum">     995 </span>                :            :           if ( p1 == p2 &amp;&amp; p2 == p3 &amp;&amp; halfEdgeBBoxTest( i, xlowleft, ylowleft, rightborder, yupright ) &amp;&amp; halfEdgeBBoxTest( mHalfEdge[i]-&gt;getNext(), xlowleft, ylowleft, rightborder, yupright ) &amp;&amp; halfEdgeBBoxTest( mHalfEdge[mHalfEdge[i]-&gt;getNext()]-&gt;getNext(), xlowleft, ylowleft, rightborder, yupright ) )//draw the triangle</a>
<a name="996"><span class="lineNum">     996 </span>                :            :           {</a>
<a name="997"><span class="lineNum">     997 </span>                :            :             QPointArray pa( 3 );</a>
<a name="998"><span class="lineNum">     998 </span>                :            :             pa.setPoint( 0, ( mPointVector[mHalfEdge[i]-&gt;getPoint()]-&gt;getX() - xlowleft ) / ( yupright - ylowleft )*height, ( yupright - mPointVector[mHalfEdge[i]-&gt;getPoint()]-&gt;getY() ) / ( yupright - ylowleft )*height );</a>
<a name="999"><span class="lineNum">     999 </span>                :            :             pa.setPoint( 1, ( mPointVector[mHalfEdge[mHalfEdge[i]-&gt;getNext()]-&gt;getPoint()]-&gt;getX() - xlowleft ) / ( yupright - ylowleft )*height, ( yupright - mPointVector[mHalfEdge[mHalfEdge[i]-&gt;getNext()]-&gt;getPoint()]-&gt;getY() ) / ( yupright - ylowleft )*height );</a>
<a name="1000"><span class="lineNum">    1000 </span>                :            :             pa.setPoint( 2, ( mPointVector[mHalfEdge[mHalfEdge[mHalfEdge[i]-&gt;getNext()]-&gt;getNext()]-&gt;getPoint()]-&gt;getX() - xlowleft ) / ( yupright - ylowleft )*height, ( yupright - mPointVector[mHalfEdge[mHalfEdge[mHalfEdge[i]-&gt;getNext()]-&gt;getNext()]-&gt;getPoint()]-&gt;getY() ) / ( yupright - ylowleft )*height );</a>
<a name="1001"><span class="lineNum">    1001 </span>                :            :             QColor c( 255, 0, 0 );</a>
<a name="1002"><span class="lineNum">    1002 </span>                :            :             p-&gt;setBrush( c );</a>
<a name="1003"><span class="lineNum">    1003 </span>                :            :             p-&gt;drawPolygon( pa );</a>
<a name="1004"><span class="lineNum">    1004 </span>                :            :           }</a>
<a name="1005"><span class="lineNum">    1005 </span>                :            :         }</a>
<a name="1006"><span class="lineNum">    1006 </span>                :            : </a>
<a name="1007"><span class="lineNum">    1007 </span>                :            :         control2[i] = true;</a>
<a name="1008"><span class="lineNum">    1008 </span>                :            :         control2[mHalfEdge[i]-&gt;getNext()] = true;</a>
<a name="1009"><span class="lineNum">    1009 </span>                :            :         control2[mHalfEdge[mHalfEdge[i]-&gt;getNext()]-&gt;getNext()] = true;</a>
<a name="1010"><span class="lineNum">    1010 </span>                :            :       }//end of the section, which has to be removed later</a>
<a name="1011"><span class="lineNum">    1011 </span>                :            : </a>
<a name="1012"><span class="lineNum">    1012 </span>                :            : </a>
<a name="1013"><span class="lineNum">    1013 </span>                :            :       if ( control[i] )//check, if edge has already been drawn</a>
<a name="1014"><span class="lineNum">    1014 </span>                :            :       {continue;}</a>
<a name="1015"><span class="lineNum">    1015 </span>                :            : </a>
<a name="1016"><span class="lineNum">    1016 </span>                :            :       //draw the edge</a>
<a name="1017"><span class="lineNum">    1017 </span>                :            :       if ( halfEdgeBBoxTest( i, xlowleft, ylowleft, rightborder, yupright ) )//only draw the edge if its bounding box intersects with the painted area</a>
<a name="1018"><span class="lineNum">    1018 </span>                :            :       {</a>
<a name="1019"><span class="lineNum">    1019 </span>                :            :         if ( mHalfEdge[i]-&gt;getBreak() )//change the color if the edge is a breakline</a>
<a name="1020"><span class="lineNum">    1020 </span>                :            :         {</a>
<a name="1021"><span class="lineNum">    1021 </span>                :            :           p-&gt;setPen( mBreakEdgeColor );</a>
<a name="1022"><span class="lineNum">    1022 </span>                :            :         }</a>
<a name="1023"><span class="lineNum">    1023 </span>                :            :         else if ( mHalfEdge[i]-&gt;getForced() )//change the color if the edge is forced</a>
<a name="1024"><span class="lineNum">    1024 </span>                :            :         {</a>
<a name="1025"><span class="lineNum">    1025 </span>                :            :           p-&gt;setPen( mForcedEdgeColor );</a>
<a name="1026"><span class="lineNum">    1026 </span>                :            :         }</a>
<a name="1027"><span class="lineNum">    1027 </span>                :            : </a>
<a name="1028"><span class="lineNum">    1028 </span>                :            :         p-&gt;drawLine( ( mPointVector[mHalfEdge[i]-&gt;getPoint()]-&gt;getX() - xlowleft ) / ( yupright - ylowleft )*height, ( yupright - mPointVector[mHalfEdge[i]-&gt;getPoint()]-&gt;getY() ) / ( yupright - ylowleft )*height, ( mPointVector[mHalfEdge[mHalfEdge[i]-&gt;getDual()]-&gt;getPoint()]-&gt;getX() - xlowleft ) / ( yupright - ylowleft )*height, ( yupright - mPointVector[mHalfEdge[mHalfEdge[i]-&gt;getDual()]-&gt;getPoint()]-&gt;getY() ) / ( yupright - ylowleft )*height );</a>
<a name="1029"><span class="lineNum">    1029 </span>                :            : </a>
<a name="1030"><span class="lineNum">    1030 </span>                :            :         if ( mHalfEdge[i]-&gt;getForced() )</a>
<a name="1031"><span class="lineNum">    1031 </span>                :            :         {</a>
<a name="1032"><span class="lineNum">    1032 </span>                :            :           p-&gt;setPen( mEdgeColor );</a>
<a name="1033"><span class="lineNum">    1033 </span>                :            :         }</a>
<a name="1034"><span class="lineNum">    1034 </span>                :            : </a>
<a name="1035"><span class="lineNum">    1035 </span>                :            :       }</a>
<a name="1036"><span class="lineNum">    1036 </span>                :            :       control[i] = true;</a>
<a name="1037"><span class="lineNum">    1037 </span>                :            :       control[mHalfEdge[i]-&gt;getDual()] = true;</a>
<a name="1038"><span class="lineNum">    1038 </span>                :            :     }</a>
<a name="1039"><span class="lineNum">    1039 </span>                :            :   }</a>
<a name="1040"><span class="lineNum">    1040 </span>                :            : </a>
<a name="1041"><span class="lineNum">    1041 </span>                :            :   delete[] control;</a>
<a name="1042"><span class="lineNum">    1042 </span>                :            :   delete[] control2;</a>
<a name="1043"><span class="lineNum">    1043 </span>                :            : }</a>
<a name="1044"><span class="lineNum">    1044 </span>                :            : #endif</a>
<a name="1045"><span class="lineNum">    1045 </span>                :            : </a>
<a name="1046"><span class="lineNum">    1046 </span>                :<span class="lineNoCov">          0 : int QgsDualEdgeTriangulation::oppositePoint( int p1, int p2 )</span></a>
<a name="1047"><span class="lineNum">    1047 </span>                :            : {</a>
<a name="1048"><span class="lineNum">    1048 </span>                :            : </a>
<a name="1049"><span class="lineNum">    1049 </span>                :            :   //first find a half edge which points to p2</a>
<a name="1050"><span class="lineNum">    1050 </span>                :<span class="lineNoCov">          0 :   int firstedge = baseEdgeOfPoint( p2 );</span></a>
<a name="1051"><span class="lineNum">    1051 </span>                :            : </a>
<a name="1052"><span class="lineNum">    1052 </span>                :            :   //then find the edge which comes from p1 or print an error message if there isn't any</a>
<a name="1053"><span class="lineNum">    1053 </span>                :<span class="lineNoCov">          0 :   int theedge = -10;</span></a>
<a name="1054"><span class="lineNum">    1054 </span>                :<span class="lineNoCov">          0 :   int nextnextedge = firstedge;</span></a>
<a name="1055"><span class="lineNum">    1055 </span>                :            :   int edge, nextedge;</a>
<a name="1056"><span class="lineNum">    1056 </span>                :<span class="lineNoCov">          0 :   do</span></a>
<a name="1057"><span class="lineNum">    1057 </span>                :            :   {</a>
<a name="1058"><span class="lineNum">    1058 </span>                :<span class="lineNoCov">          0 :     edge = mHalfEdge[nextnextedge]-&gt;getDual();</span></a>
<a name="1059"><span class="lineNum">    1059 </span>                :<span class="lineNoCov">          0 :     if ( mHalfEdge[edge]-&gt;getPoint() == p1 )</span></a>
<a name="1060"><span class="lineNum">    1060 </span>                :            :     {</a>
<a name="1061"><span class="lineNum">    1061 </span>                :<span class="lineNoCov">          0 :       theedge = nextnextedge;</span></a>
<a name="1062"><span class="lineNum">    1062 </span>                :<span class="lineNoCov">          0 :       break;</span></a>
<a name="1063"><span class="lineNum">    1063 </span>                :            :     }//we found the edge</a>
<a name="1064"><span class="lineNum">    1064 </span>                :<span class="lineNoCov">          0 :     nextedge = mHalfEdge[edge]-&gt;getNext();</span></a>
<a name="1065"><span class="lineNum">    1065 </span>                :<span class="lineNoCov">          0 :     nextnextedge = mHalfEdge[nextedge]-&gt;getNext();</span></a>
<a name="1066"><span class="lineNum">    1066 </span>                :<span class="lineNoCov">          0 :   }</span></a>
<a name="1067"><span class="lineNum">    1067 </span>                :<span class="lineNoCov">          0 :   while ( nextnextedge != firstedge );</span></a>
<a name="1068"><span class="lineNum">    1068 </span>                :            : </a>
<a name="1069"><span class="lineNum">    1069 </span>                :<span class="lineNoCov">          0 :   if ( theedge == -10 )//there is no edge between p1 and p2</span></a>
<a name="1070"><span class="lineNum">    1070 </span>                :            :   {</a>
<a name="1071"><span class="lineNum">    1071 </span>                :            :     //QgsDebugMsg( QStringLiteral( &quot;warning, error: the points are: %1 and %2&quot; ).arg( p1 ).arg( p2 ) );</a>
<a name="1072"><span class="lineNum">    1072 </span>                :<span class="lineNoCov">          0 :     return -10;</span></a>
<a name="1073"><span class="lineNum">    1073 </span>                :            :   }</a>
<a name="1074"><span class="lineNum">    1074 </span>                :            : </a>
<a name="1075"><span class="lineNum">    1075 </span>                :            :   //finally find the opposite point</a>
<a name="1076"><span class="lineNum">    1076 </span>                :<span class="lineNoCov">          0 :   return mHalfEdge[mHalfEdge[mHalfEdge[theedge]-&gt;getDual()]-&gt;getNext()]-&gt;getPoint();</span></a>
<a name="1077"><span class="lineNum">    1077 </span>                :            : </a>
<a name="1078"><span class="lineNum">    1078 </span>                :<span class="lineNoCov">          0 : }</span></a>
<a name="1079"><span class="lineNum">    1079 </span>                :            : </a>
<a name="1080"><span class="lineNum">    1080 </span>                :<span class="lineNoCov">          0 : QList&lt;int&gt; QgsDualEdgeTriangulation::surroundingTriangles( int pointno )</span></a>
<a name="1081"><span class="lineNum">    1081 </span>                :            : {</a>
<a name="1082"><span class="lineNum">    1082 </span>                :<span class="lineNoCov">          0 :   int firstedge = baseEdgeOfPoint( pointno );</span></a>
<a name="1083"><span class="lineNum">    1083 </span>                :            : </a>
<a name="1084"><span class="lineNum">    1084 </span>                :<span class="lineNoCov">          0 :   QList&lt;int&gt; vlist;</span></a>
<a name="1085"><span class="lineNum">    1085 </span>                :<span class="lineNoCov">          0 :   if ( firstedge == -1 )//an error occurred</span></a>
<a name="1086"><span class="lineNum">    1086 </span>                :            :   {</a>
<a name="1087"><span class="lineNum">    1087 </span>                :<span class="lineNoCov">          0 :     return vlist;</span></a>
<a name="1088"><span class="lineNum">    1088 </span>                :            :   }</a>
<a name="1089"><span class="lineNum">    1089 </span>                :            : </a>
<a name="1090"><span class="lineNum">    1090 </span>                :<span class="lineNoCov">          0 :   int actedge = firstedge;</span></a>
<a name="1091"><span class="lineNum">    1091 </span>                :            :   int edge, nextedge, nextnextedge;</a>
<a name="1092"><span class="lineNum">    1092 </span>                :<span class="lineNoCov">          0 :   do</span></a>
<a name="1093"><span class="lineNum">    1093 </span>                :            :   {</a>
<a name="1094"><span class="lineNum">    1094 </span>                :<span class="lineNoCov">          0 :     edge = mHalfEdge[actedge]-&gt;getDual();</span></a>
<a name="1095"><span class="lineNum">    1095 </span>                :<span class="lineNoCov">          0 :     vlist.append( mHalfEdge[edge]-&gt;getPoint() );//add the number of the endpoint of the first edge to the value list</span></a>
<a name="1096"><span class="lineNum">    1096 </span>                :<span class="lineNoCov">          0 :     nextedge = mHalfEdge[edge]-&gt;getNext();</span></a>
<a name="1097"><span class="lineNum">    1097 </span>                :<span class="lineNoCov">          0 :     vlist.append( mHalfEdge[nextedge]-&gt;getPoint() );//add the number of the endpoint of the second edge to the value list</span></a>
<a name="1098"><span class="lineNum">    1098 </span>                :<span class="lineNoCov">          0 :     nextnextedge = mHalfEdge[nextedge]-&gt;getNext();</span></a>
<a name="1099"><span class="lineNum">    1099 </span>                :<span class="lineNoCov">          0 :     vlist.append( mHalfEdge[nextnextedge]-&gt;getPoint() );//add the number of endpoint of the third edge to the value list</span></a>
<a name="1100"><span class="lineNum">    1100 </span>                :<span class="lineNoCov">          0 :     if ( mHalfEdge[nextnextedge]-&gt;getBreak() )//add, whether the third edge is a breakline or not</span></a>
<a name="1101"><span class="lineNum">    1101 </span>                :            :     {</a>
<a name="1102"><span class="lineNum">    1102 </span>                :<span class="lineNoCov">          0 :       vlist.append( -10 );</span></a>
<a name="1103"><span class="lineNum">    1103 </span>                :<span class="lineNoCov">          0 :     }</span></a>
<a name="1104"><span class="lineNum">    1104 </span>                :            :     else</a>
<a name="1105"><span class="lineNum">    1105 </span>                :            :     {</a>
<a name="1106"><span class="lineNum">    1106 </span>                :<span class="lineNoCov">          0 :       vlist.append( -20 );</span></a>
<a name="1107"><span class="lineNum">    1107 </span>                :            :     }</a>
<a name="1108"><span class="lineNum">    1108 </span>                :<span class="lineNoCov">          0 :     actedge = nextnextedge;</span></a>
<a name="1109"><span class="lineNum">    1109 </span>                :<span class="lineNoCov">          0 :   }</span></a>
<a name="1110"><span class="lineNum">    1110 </span>                :<span class="lineNoCov">          0 :   while ( nextnextedge != firstedge );</span></a>
<a name="1111"><span class="lineNum">    1111 </span>                :            : </a>
<a name="1112"><span class="lineNum">    1112 </span>                :<span class="lineNoCov">          0 :   return vlist;</span></a>
<a name="1113"><span class="lineNum">    1113 </span>                :            : </a>
<a name="1114"><span class="lineNum">    1114 </span>                :<span class="lineNoCov">          0 : }</span></a>
<a name="1115"><span class="lineNum">    1115 </span>                :            : </a>
<a name="1116"><span class="lineNum">    1116 </span>                :<span class="lineNoCov">          0 : bool QgsDualEdgeTriangulation::triangleVertices( double x, double y, QgsPoint &amp;p1, int &amp;n1, QgsPoint &amp;p2, int &amp;n2, QgsPoint &amp;p3, int &amp;n3 )</span></a>
<a name="1117"><span class="lineNum">    1117 </span>                :            : {</a>
<a name="1118"><span class="lineNum">    1118 </span>                :<span class="lineNoCov">          0 :   if ( mPointVector.size() &lt; 3 )</span></a>
<a name="1119"><span class="lineNum">    1119 </span>                :            :   {</a>
<a name="1120"><span class="lineNum">    1120 </span>                :<span class="lineNoCov">          0 :     return false;</span></a>
<a name="1121"><span class="lineNum">    1121 </span>                :            :   }</a>
<a name="1122"><span class="lineNum">    1122 </span>                :            : </a>
<a name="1123"><span class="lineNum">    1123 </span>                :<span class="lineNoCov">          0 :   QgsPoint point( x, y, 0 );</span></a>
<a name="1124"><span class="lineNum">    1124 </span>                :<span class="lineNoCov">          0 :   int edge = baseEdgeOfTriangle( point );</span></a>
<a name="1125"><span class="lineNum">    1125 </span>                :<span class="lineNoCov">          0 :   if ( edge == -10 )//the point is outside the convex hull</span></a>
<a name="1126"><span class="lineNum">    1126 </span>                :            :   {</a>
<a name="1127"><span class="lineNum">    1127 </span>                :<span class="lineNoCov">          0 :     return false;</span></a>
<a name="1128"><span class="lineNum">    1128 </span>                :            :   }</a>
<a name="1129"><span class="lineNum">    1129 </span>                :            : </a>
<a name="1130"><span class="lineNum">    1130 </span>                :<span class="lineNoCov">          0 :   else if ( edge &gt;= 0 )//the point is inside the convex hull</span></a>
<a name="1131"><span class="lineNum">    1131 </span>                :            :   {</a>
<a name="1132"><span class="lineNum">    1132 </span>                :<span class="lineNoCov">          0 :     int ptnr1 = mHalfEdge[edge]-&gt;getPoint();</span></a>
<a name="1133"><span class="lineNum">    1133 </span>                :<span class="lineNoCov">          0 :     int ptnr2 = mHalfEdge[mHalfEdge[edge]-&gt;getNext()]-&gt;getPoint();</span></a>
<a name="1134"><span class="lineNum">    1134 </span>                :<span class="lineNoCov">          0 :     int ptnr3 = mHalfEdge[mHalfEdge[mHalfEdge[edge]-&gt;getNext()]-&gt;getNext()]-&gt;getPoint();</span></a>
<a name="1135"><span class="lineNum">    1135 </span>                :<span class="lineNoCov">          0 :     p1.setX( mPointVector[ptnr1]-&gt;x() );</span></a>
<a name="1136"><span class="lineNum">    1136 </span>                :<span class="lineNoCov">          0 :     p1.setY( mPointVector[ptnr1]-&gt;y() );</span></a>
<a name="1137"><span class="lineNum">    1137 </span>                :<span class="lineNoCov">          0 :     p1.setZ( mPointVector[ptnr1]-&gt;z() );</span></a>
<a name="1138"><span class="lineNum">    1138 </span>                :<span class="lineNoCov">          0 :     p2.setX( mPointVector[ptnr2]-&gt;x() );</span></a>
<a name="1139"><span class="lineNum">    1139 </span>                :<span class="lineNoCov">          0 :     p2.setY( mPointVector[ptnr2]-&gt;y() );</span></a>
<a name="1140"><span class="lineNum">    1140 </span>                :<span class="lineNoCov">          0 :     p2.setZ( mPointVector[ptnr2]-&gt;z() );</span></a>
<a name="1141"><span class="lineNum">    1141 </span>                :<span class="lineNoCov">          0 :     p3.setX( mPointVector[ptnr3]-&gt;x() );</span></a>
<a name="1142"><span class="lineNum">    1142 </span>                :<span class="lineNoCov">          0 :     p3.setY( mPointVector[ptnr3]-&gt;y() );</span></a>
<a name="1143"><span class="lineNum">    1143 </span>                :<span class="lineNoCov">          0 :     p3.setZ( mPointVector[ptnr3]-&gt;z() );</span></a>
<a name="1144"><span class="lineNum">    1144 </span>                :<span class="lineNoCov">          0 :     n1 = ptnr1;</span></a>
<a name="1145"><span class="lineNum">    1145 </span>                :<span class="lineNoCov">          0 :     n2 = ptnr2;</span></a>
<a name="1146"><span class="lineNum">    1146 </span>                :<span class="lineNoCov">          0 :     n3 = ptnr3;</span></a>
<a name="1147"><span class="lineNum">    1147 </span>                :<span class="lineNoCov">          0 :     return true;</span></a>
<a name="1148"><span class="lineNum">    1148 </span>                :            :   }</a>
<a name="1149"><span class="lineNum">    1149 </span>                :<span class="lineNoCov">          0 :   else if ( edge == -20 )//the point is exactly on an edge</span></a>
<a name="1150"><span class="lineNum">    1150 </span>                :            :   {</a>
<a name="1151"><span class="lineNum">    1151 </span>                :<span class="lineNoCov">          0 :     int ptnr1 = mHalfEdge[mEdgeWithPoint]-&gt;getPoint();</span></a>
<a name="1152"><span class="lineNum">    1152 </span>                :<span class="lineNoCov">          0 :     int ptnr2 = mHalfEdge[mHalfEdge[mEdgeWithPoint]-&gt;getNext()]-&gt;getPoint();</span></a>
<a name="1153"><span class="lineNum">    1153 </span>                :<span class="lineNoCov">          0 :     int ptnr3 = mHalfEdge[mHalfEdge[mHalfEdge[mEdgeWithPoint]-&gt;getNext()]-&gt;getNext()]-&gt;getPoint();</span></a>
<a name="1154"><span class="lineNum">    1154 </span>                :<span class="lineNoCov">          0 :     if ( ptnr1 == -1 || ptnr2 == -1 || ptnr3 == -1 )</span></a>
<a name="1155"><span class="lineNum">    1155 </span>                :            :     {</a>
<a name="1156"><span class="lineNum">    1156 </span>                :<span class="lineNoCov">          0 :       return false;</span></a>
<a name="1157"><span class="lineNum">    1157 </span>                :            :     }</a>
<a name="1158"><span class="lineNum">    1158 </span>                :<span class="lineNoCov">          0 :     p1.setX( mPointVector[ptnr1]-&gt;x() );</span></a>
<a name="1159"><span class="lineNum">    1159 </span>                :<span class="lineNoCov">          0 :     p1.setY( mPointVector[ptnr1]-&gt;y() );</span></a>
<a name="1160"><span class="lineNum">    1160 </span>                :<span class="lineNoCov">          0 :     p1.setZ( mPointVector[ptnr1]-&gt;z() );</span></a>
<a name="1161"><span class="lineNum">    1161 </span>                :<span class="lineNoCov">          0 :     p2.setX( mPointVector[ptnr2]-&gt;x() );</span></a>
<a name="1162"><span class="lineNum">    1162 </span>                :<span class="lineNoCov">          0 :     p2.setY( mPointVector[ptnr2]-&gt;y() );</span></a>
<a name="1163"><span class="lineNum">    1163 </span>                :<span class="lineNoCov">          0 :     p2.setZ( mPointVector[ptnr2]-&gt;z() );</span></a>
<a name="1164"><span class="lineNum">    1164 </span>                :<span class="lineNoCov">          0 :     p3.setX( mPointVector[ptnr3]-&gt;x() );</span></a>
<a name="1165"><span class="lineNum">    1165 </span>                :<span class="lineNoCov">          0 :     p3.setY( mPointVector[ptnr3]-&gt;y() );</span></a>
<a name="1166"><span class="lineNum">    1166 </span>                :<span class="lineNoCov">          0 :     p3.setZ( mPointVector[ptnr3]-&gt;z() );</span></a>
<a name="1167"><span class="lineNum">    1167 </span>                :<span class="lineNoCov">          0 :     n1 = ptnr1;</span></a>
<a name="1168"><span class="lineNum">    1168 </span>                :<span class="lineNoCov">          0 :     n2 = ptnr2;</span></a>
<a name="1169"><span class="lineNum">    1169 </span>                :<span class="lineNoCov">          0 :     n3 = ptnr3;</span></a>
<a name="1170"><span class="lineNum">    1170 </span>                :<span class="lineNoCov">          0 :     return true;</span></a>
<a name="1171"><span class="lineNum">    1171 </span>                :            :   }</a>
<a name="1172"><span class="lineNum">    1172 </span>                :<span class="lineNoCov">          0 :   else if ( edge == -25 )//x and y are the coordinates of an existing point</span></a>
<a name="1173"><span class="lineNum">    1173 </span>                :            :   {</a>
<a name="1174"><span class="lineNum">    1174 </span>                :<span class="lineNoCov">          0 :     int edge1 = baseEdgeOfPoint( mTwiceInsPoint );</span></a>
<a name="1175"><span class="lineNum">    1175 </span>                :<span class="lineNoCov">          0 :     int edge2 = mHalfEdge[edge1]-&gt;getNext();</span></a>
<a name="1176"><span class="lineNum">    1176 </span>                :<span class="lineNoCov">          0 :     int edge3 = mHalfEdge[edge2]-&gt;getNext();</span></a>
<a name="1177"><span class="lineNum">    1177 </span>                :<span class="lineNoCov">          0 :     int ptnr1 = mHalfEdge[edge1]-&gt;getPoint();</span></a>
<a name="1178"><span class="lineNum">    1178 </span>                :<span class="lineNoCov">          0 :     int ptnr2 = mHalfEdge[edge2]-&gt;getPoint();</span></a>
<a name="1179"><span class="lineNum">    1179 </span>                :<span class="lineNoCov">          0 :     int ptnr3 = mHalfEdge[edge3]-&gt;getPoint();</span></a>
<a name="1180"><span class="lineNum">    1180 </span>                :<span class="lineNoCov">          0 :     p1.setX( mPointVector[ptnr1]-&gt;x() );</span></a>
<a name="1181"><span class="lineNum">    1181 </span>                :<span class="lineNoCov">          0 :     p1.setY( mPointVector[ptnr1]-&gt;y() );</span></a>
<a name="1182"><span class="lineNum">    1182 </span>                :<span class="lineNoCov">          0 :     p1.setZ( mPointVector[ptnr1]-&gt;z() );</span></a>
<a name="1183"><span class="lineNum">    1183 </span>                :<span class="lineNoCov">          0 :     p2.setX( mPointVector[ptnr2]-&gt;x() );</span></a>
<a name="1184"><span class="lineNum">    1184 </span>                :<span class="lineNoCov">          0 :     p2.setY( mPointVector[ptnr2]-&gt;y() );</span></a>
<a name="1185"><span class="lineNum">    1185 </span>                :<span class="lineNoCov">          0 :     p2.setZ( mPointVector[ptnr2]-&gt;z() );</span></a>
<a name="1186"><span class="lineNum">    1186 </span>                :<span class="lineNoCov">          0 :     p3.setX( mPointVector[ptnr3]-&gt;x() );</span></a>
<a name="1187"><span class="lineNum">    1187 </span>                :<span class="lineNoCov">          0 :     p3.setY( mPointVector[ptnr3]-&gt;y() );</span></a>
<a name="1188"><span class="lineNum">    1188 </span>                :<span class="lineNoCov">          0 :     p3.setZ( mPointVector[ptnr3]-&gt;z() );</span></a>
<a name="1189"><span class="lineNum">    1189 </span>                :<span class="lineNoCov">          0 :     n1 = ptnr1;</span></a>
<a name="1190"><span class="lineNum">    1190 </span>                :<span class="lineNoCov">          0 :     n2 = ptnr2;</span></a>
<a name="1191"><span class="lineNum">    1191 </span>                :<span class="lineNoCov">          0 :     n3 = ptnr3;</span></a>
<a name="1192"><span class="lineNum">    1192 </span>                :<span class="lineNoCov">          0 :     return true;</span></a>
<a name="1193"><span class="lineNum">    1193 </span>                :            :   }</a>
<a name="1194"><span class="lineNum">    1194 </span>                :<span class="lineNoCov">          0 :   else if ( edge == -5 )//numerical problems in 'baseEdgeOfTriangle'</span></a>
<a name="1195"><span class="lineNum">    1195 </span>                :            :   {</a>
<a name="1196"><span class="lineNum">    1196 </span>                :<span class="lineNoCov">          0 :     int ptnr1 = mHalfEdge[mUnstableEdge]-&gt;getPoint();</span></a>
<a name="1197"><span class="lineNum">    1197 </span>                :<span class="lineNoCov">          0 :     int ptnr2 = mHalfEdge[mHalfEdge[mUnstableEdge]-&gt;getNext()]-&gt;getPoint();</span></a>
<a name="1198"><span class="lineNum">    1198 </span>                :<span class="lineNoCov">          0 :     int ptnr3 = mHalfEdge[mHalfEdge[mHalfEdge[mUnstableEdge]-&gt;getNext()]-&gt;getNext()]-&gt;getPoint();</span></a>
<a name="1199"><span class="lineNum">    1199 </span>                :<span class="lineNoCov">          0 :     if ( ptnr1 == -1 || ptnr2 == -1 || ptnr3 == -1 )</span></a>
<a name="1200"><span class="lineNum">    1200 </span>                :            :     {</a>
<a name="1201"><span class="lineNum">    1201 </span>                :<span class="lineNoCov">          0 :       return false;</span></a>
<a name="1202"><span class="lineNum">    1202 </span>                :            :     }</a>
<a name="1203"><span class="lineNum">    1203 </span>                :<span class="lineNoCov">          0 :     p1.setX( mPointVector[ptnr1]-&gt;x() );</span></a>
<a name="1204"><span class="lineNum">    1204 </span>                :<span class="lineNoCov">          0 :     p1.setY( mPointVector[ptnr1]-&gt;y() );</span></a>
<a name="1205"><span class="lineNum">    1205 </span>                :<span class="lineNoCov">          0 :     p1.setZ( mPointVector[ptnr1]-&gt;z() );</span></a>
<a name="1206"><span class="lineNum">    1206 </span>                :<span class="lineNoCov">          0 :     p2.setX( mPointVector[ptnr2]-&gt;x() );</span></a>
<a name="1207"><span class="lineNum">    1207 </span>                :<span class="lineNoCov">          0 :     p2.setY( mPointVector[ptnr2]-&gt;y() );</span></a>
<a name="1208"><span class="lineNum">    1208 </span>                :<span class="lineNoCov">          0 :     p2.setZ( mPointVector[ptnr2]-&gt;z() );</span></a>
<a name="1209"><span class="lineNum">    1209 </span>                :<span class="lineNoCov">          0 :     p3.setX( mPointVector[ptnr3]-&gt;x() );</span></a>
<a name="1210"><span class="lineNum">    1210 </span>                :<span class="lineNoCov">          0 :     p3.setY( mPointVector[ptnr3]-&gt;y() );</span></a>
<a name="1211"><span class="lineNum">    1211 </span>                :<span class="lineNoCov">          0 :     p3.setZ( mPointVector[ptnr3]-&gt;z() );</span></a>
<a name="1212"><span class="lineNum">    1212 </span>                :<span class="lineNoCov">          0 :     n1 = ptnr1;</span></a>
<a name="1213"><span class="lineNum">    1213 </span>                :<span class="lineNoCov">          0 :     n2 = ptnr2;</span></a>
<a name="1214"><span class="lineNum">    1214 </span>                :<span class="lineNoCov">          0 :     n3 = ptnr3;</span></a>
<a name="1215"><span class="lineNum">    1215 </span>                :<span class="lineNoCov">          0 :     return true;</span></a>
<a name="1216"><span class="lineNum">    1216 </span>                :            :   }</a>
<a name="1217"><span class="lineNum">    1217 </span>                :            :   else//problems</a>
<a name="1218"><span class="lineNum">    1218 </span>                :            :   {</a>
<a name="1219"><span class="lineNum">    1219 </span>                :            :     //QgsDebugMsg( QStringLiteral( &quot;problem: the edge is: %1&quot; ).arg( edge ) );</a>
<a name="1220"><span class="lineNum">    1220 </span>                :<span class="lineNoCov">          0 :     return false;</span></a>
<a name="1221"><span class="lineNum">    1221 </span>                :            :   }</a>
<a name="1222"><span class="lineNum">    1222 </span>                :<span class="lineNoCov">          0 : }</span></a>
<a name="1223"><span class="lineNum">    1223 </span>                :            : </a>
<a name="1224"><span class="lineNum">    1224 </span>                :<span class="lineNoCov">          0 : bool QgsDualEdgeTriangulation::triangleVertices( double x, double y, QgsPoint &amp;p1, QgsPoint &amp;p2, QgsPoint &amp;p3 )</span></a>
<a name="1225"><span class="lineNum">    1225 </span>                :            : {</a>
<a name="1226"><span class="lineNum">    1226 </span>                :<span class="lineNoCov">          0 :   if ( mPointVector.size() &lt; 3 )</span></a>
<a name="1227"><span class="lineNum">    1227 </span>                :            :   {</a>
<a name="1228"><span class="lineNum">    1228 </span>                :<span class="lineNoCov">          0 :     return false;</span></a>
<a name="1229"><span class="lineNum">    1229 </span>                :            :   }</a>
<a name="1230"><span class="lineNum">    1230 </span>                :            : </a>
<a name="1231"><span class="lineNum">    1231 </span>                :<span class="lineNoCov">          0 :   QgsPoint point( x, y, 0 );</span></a>
<a name="1232"><span class="lineNum">    1232 </span>                :<span class="lineNoCov">          0 :   int edge = baseEdgeOfTriangle( point );</span></a>
<a name="1233"><span class="lineNum">    1233 </span>                :<span class="lineNoCov">          0 :   if ( edge == -10 )//the point is outside the convex hull</span></a>
<a name="1234"><span class="lineNum">    1234 </span>                :            :   {</a>
<a name="1235"><span class="lineNum">    1235 </span>                :<span class="lineNoCov">          0 :     return false;</span></a>
<a name="1236"><span class="lineNum">    1236 </span>                :            :   }</a>
<a name="1237"><span class="lineNum">    1237 </span>                :<span class="lineNoCov">          0 :   else if ( edge &gt;= 0 )//the point is inside the convex hull</span></a>
<a name="1238"><span class="lineNum">    1238 </span>                :            :   {</a>
<a name="1239"><span class="lineNum">    1239 </span>                :<span class="lineNoCov">          0 :     int ptnr1 = mHalfEdge[edge]-&gt;getPoint();</span></a>
<a name="1240"><span class="lineNum">    1240 </span>                :<span class="lineNoCov">          0 :     int ptnr2 = mHalfEdge[mHalfEdge[edge]-&gt;getNext()]-&gt;getPoint();</span></a>
<a name="1241"><span class="lineNum">    1241 </span>                :<span class="lineNoCov">          0 :     int ptnr3 = mHalfEdge[mHalfEdge[mHalfEdge[edge]-&gt;getNext()]-&gt;getNext()]-&gt;getPoint();</span></a>
<a name="1242"><span class="lineNum">    1242 </span>                :<span class="lineNoCov">          0 :     p1.setX( mPointVector[ptnr1]-&gt;x() );</span></a>
<a name="1243"><span class="lineNum">    1243 </span>                :<span class="lineNoCov">          0 :     p1.setY( mPointVector[ptnr1]-&gt;y() );</span></a>
<a name="1244"><span class="lineNum">    1244 </span>                :<span class="lineNoCov">          0 :     p1.setZ( mPointVector[ptnr1]-&gt;z() );</span></a>
<a name="1245"><span class="lineNum">    1245 </span>                :<span class="lineNoCov">          0 :     p2.setX( mPointVector[ptnr2]-&gt;x() );</span></a>
<a name="1246"><span class="lineNum">    1246 </span>                :<span class="lineNoCov">          0 :     p2.setY( mPointVector[ptnr2]-&gt;y() );</span></a>
<a name="1247"><span class="lineNum">    1247 </span>                :<span class="lineNoCov">          0 :     p2.setZ( mPointVector[ptnr2]-&gt;z() );</span></a>
<a name="1248"><span class="lineNum">    1248 </span>                :<span class="lineNoCov">          0 :     p3.setX( mPointVector[ptnr3]-&gt;x() );</span></a>
<a name="1249"><span class="lineNum">    1249 </span>                :<span class="lineNoCov">          0 :     p3.setY( mPointVector[ptnr3]-&gt;y() );</span></a>
<a name="1250"><span class="lineNum">    1250 </span>                :<span class="lineNoCov">          0 :     p3.setZ( mPointVector[ptnr3]-&gt;z() );</span></a>
<a name="1251"><span class="lineNum">    1251 </span>                :<span class="lineNoCov">          0 :     return true;</span></a>
<a name="1252"><span class="lineNum">    1252 </span>                :            :   }</a>
<a name="1253"><span class="lineNum">    1253 </span>                :<span class="lineNoCov">          0 :   else if ( edge == -20 )//the point is exactly on an edge</span></a>
<a name="1254"><span class="lineNum">    1254 </span>                :            :   {</a>
<a name="1255"><span class="lineNum">    1255 </span>                :<span class="lineNoCov">          0 :     int ptnr1 = mHalfEdge[mEdgeWithPoint]-&gt;getPoint();</span></a>
<a name="1256"><span class="lineNum">    1256 </span>                :<span class="lineNoCov">          0 :     int ptnr2 = mHalfEdge[mHalfEdge[mEdgeWithPoint]-&gt;getNext()]-&gt;getPoint();</span></a>
<a name="1257"><span class="lineNum">    1257 </span>                :<span class="lineNoCov">          0 :     int ptnr3 = mHalfEdge[mHalfEdge[mHalfEdge[mEdgeWithPoint]-&gt;getNext()]-&gt;getNext()]-&gt;getPoint();</span></a>
<a name="1258"><span class="lineNum">    1258 </span>                :<span class="lineNoCov">          0 :     if ( ptnr1 == -1 || ptnr2 == -1 || ptnr3 == -1 )</span></a>
<a name="1259"><span class="lineNum">    1259 </span>                :            :     {</a>
<a name="1260"><span class="lineNum">    1260 </span>                :<span class="lineNoCov">          0 :       return false;</span></a>
<a name="1261"><span class="lineNum">    1261 </span>                :            :     }</a>
<a name="1262"><span class="lineNum">    1262 </span>                :<span class="lineNoCov">          0 :     p1.setX( mPointVector[ptnr1]-&gt;x() );</span></a>
<a name="1263"><span class="lineNum">    1263 </span>                :<span class="lineNoCov">          0 :     p1.setY( mPointVector[ptnr1]-&gt;y() );</span></a>
<a name="1264"><span class="lineNum">    1264 </span>                :<span class="lineNoCov">          0 :     p1.setZ( mPointVector[ptnr1]-&gt;z() );</span></a>
<a name="1265"><span class="lineNum">    1265 </span>                :<span class="lineNoCov">          0 :     p2.setX( mPointVector[ptnr2]-&gt;x() );</span></a>
<a name="1266"><span class="lineNum">    1266 </span>                :<span class="lineNoCov">          0 :     p2.setY( mPointVector[ptnr2]-&gt;y() );</span></a>
<a name="1267"><span class="lineNum">    1267 </span>                :<span class="lineNoCov">          0 :     p2.setZ( mPointVector[ptnr2]-&gt;z() );</span></a>
<a name="1268"><span class="lineNum">    1268 </span>                :<span class="lineNoCov">          0 :     p3.setX( mPointVector[ptnr3]-&gt;x() );</span></a>
<a name="1269"><span class="lineNum">    1269 </span>                :<span class="lineNoCov">          0 :     p3.setY( mPointVector[ptnr3]-&gt;y() );</span></a>
<a name="1270"><span class="lineNum">    1270 </span>                :<span class="lineNoCov">          0 :     p3.setZ( mPointVector[ptnr3]-&gt;z() );</span></a>
<a name="1271"><span class="lineNum">    1271 </span>                :<span class="lineNoCov">          0 :     return true;</span></a>
<a name="1272"><span class="lineNum">    1272 </span>                :            :   }</a>
<a name="1273"><span class="lineNum">    1273 </span>                :<span class="lineNoCov">          0 :   else if ( edge == -25 )//x and y are the coordinates of an existing point</span></a>
<a name="1274"><span class="lineNum">    1274 </span>                :            :   {</a>
<a name="1275"><span class="lineNum">    1275 </span>                :<span class="lineNoCov">          0 :     int edge1 = baseEdgeOfPoint( mTwiceInsPoint );</span></a>
<a name="1276"><span class="lineNum">    1276 </span>                :<span class="lineNoCov">          0 :     int edge2 = mHalfEdge[edge1]-&gt;getNext();</span></a>
<a name="1277"><span class="lineNum">    1277 </span>                :<span class="lineNoCov">          0 :     int edge3 = mHalfEdge[edge2]-&gt;getNext();</span></a>
<a name="1278"><span class="lineNum">    1278 </span>                :<span class="lineNoCov">          0 :     int ptnr1 = mHalfEdge[edge1]-&gt;getPoint();</span></a>
<a name="1279"><span class="lineNum">    1279 </span>                :<span class="lineNoCov">          0 :     int ptnr2 = mHalfEdge[edge2]-&gt;getPoint();</span></a>
<a name="1280"><span class="lineNum">    1280 </span>                :<span class="lineNoCov">          0 :     int ptnr3 = mHalfEdge[edge3]-&gt;getPoint();</span></a>
<a name="1281"><span class="lineNum">    1281 </span>                :<span class="lineNoCov">          0 :     if ( ptnr1 == -1 || ptnr2 == -1 || ptnr3 == -1 )</span></a>
<a name="1282"><span class="lineNum">    1282 </span>                :            :     {</a>
<a name="1283"><span class="lineNum">    1283 </span>                :<span class="lineNoCov">          0 :       return false;</span></a>
<a name="1284"><span class="lineNum">    1284 </span>                :            :     }</a>
<a name="1285"><span class="lineNum">    1285 </span>                :<span class="lineNoCov">          0 :     p1.setX( mPointVector[ptnr1]-&gt;x() );</span></a>
<a name="1286"><span class="lineNum">    1286 </span>                :<span class="lineNoCov">          0 :     p1.setY( mPointVector[ptnr1]-&gt;y() );</span></a>
<a name="1287"><span class="lineNum">    1287 </span>                :<span class="lineNoCov">          0 :     p1.setZ( mPointVector[ptnr1]-&gt;z() );</span></a>
<a name="1288"><span class="lineNum">    1288 </span>                :<span class="lineNoCov">          0 :     p2.setX( mPointVector[ptnr2]-&gt;x() );</span></a>
<a name="1289"><span class="lineNum">    1289 </span>                :<span class="lineNoCov">          0 :     p2.setY( mPointVector[ptnr2]-&gt;y() );</span></a>
<a name="1290"><span class="lineNum">    1290 </span>                :<span class="lineNoCov">          0 :     p2.setZ( mPointVector[ptnr2]-&gt;z() );</span></a>
<a name="1291"><span class="lineNum">    1291 </span>                :<span class="lineNoCov">          0 :     p3.setX( mPointVector[ptnr3]-&gt;x() );</span></a>
<a name="1292"><span class="lineNum">    1292 </span>                :<span class="lineNoCov">          0 :     p3.setY( mPointVector[ptnr3]-&gt;y() );</span></a>
<a name="1293"><span class="lineNum">    1293 </span>                :<span class="lineNoCov">          0 :     p3.setZ( mPointVector[ptnr3]-&gt;z() );</span></a>
<a name="1294"><span class="lineNum">    1294 </span>                :<span class="lineNoCov">          0 :     return true;</span></a>
<a name="1295"><span class="lineNum">    1295 </span>                :            :   }</a>
<a name="1296"><span class="lineNum">    1296 </span>                :<span class="lineNoCov">          0 :   else if ( edge == -5 )//numerical problems in 'baseEdgeOfTriangle'</span></a>
<a name="1297"><span class="lineNum">    1297 </span>                :            :   {</a>
<a name="1298"><span class="lineNum">    1298 </span>                :<span class="lineNoCov">          0 :     int ptnr1 = mHalfEdge[mUnstableEdge]-&gt;getPoint();</span></a>
<a name="1299"><span class="lineNum">    1299 </span>                :<span class="lineNoCov">          0 :     int ptnr2 = mHalfEdge[mHalfEdge[mUnstableEdge]-&gt;getNext()]-&gt;getPoint();</span></a>
<a name="1300"><span class="lineNum">    1300 </span>                :<span class="lineNoCov">          0 :     int ptnr3 = mHalfEdge[mHalfEdge[mHalfEdge[mUnstableEdge]-&gt;getNext()]-&gt;getNext()]-&gt;getPoint();</span></a>
<a name="1301"><span class="lineNum">    1301 </span>                :<span class="lineNoCov">          0 :     if ( ptnr1 == -1 || ptnr2 == -1 || ptnr3 == -1 )</span></a>
<a name="1302"><span class="lineNum">    1302 </span>                :            :     {</a>
<a name="1303"><span class="lineNum">    1303 </span>                :<span class="lineNoCov">          0 :       return false;</span></a>
<a name="1304"><span class="lineNum">    1304 </span>                :            :     }</a>
<a name="1305"><span class="lineNum">    1305 </span>                :<span class="lineNoCov">          0 :     p1.setX( mPointVector[ptnr1]-&gt;x() );</span></a>
<a name="1306"><span class="lineNum">    1306 </span>                :<span class="lineNoCov">          0 :     p1.setY( mPointVector[ptnr1]-&gt;y() );</span></a>
<a name="1307"><span class="lineNum">    1307 </span>                :<span class="lineNoCov">          0 :     p1.setZ( mPointVector[ptnr1]-&gt;z() );</span></a>
<a name="1308"><span class="lineNum">    1308 </span>                :<span class="lineNoCov">          0 :     p2.setX( mPointVector[ptnr2]-&gt;x() );</span></a>
<a name="1309"><span class="lineNum">    1309 </span>                :<span class="lineNoCov">          0 :     p2.setY( mPointVector[ptnr2]-&gt;y() );</span></a>
<a name="1310"><span class="lineNum">    1310 </span>                :<span class="lineNoCov">          0 :     p2.setZ( mPointVector[ptnr2]-&gt;z() );</span></a>
<a name="1311"><span class="lineNum">    1311 </span>                :<span class="lineNoCov">          0 :     p3.setX( mPointVector[ptnr3]-&gt;x() );</span></a>
<a name="1312"><span class="lineNum">    1312 </span>                :<span class="lineNoCov">          0 :     p3.setY( mPointVector[ptnr3]-&gt;y() );</span></a>
<a name="1313"><span class="lineNum">    1313 </span>                :<span class="lineNoCov">          0 :     p3.setZ( mPointVector[ptnr3]-&gt;z() );</span></a>
<a name="1314"><span class="lineNum">    1314 </span>                :<span class="lineNoCov">          0 :     return true;</span></a>
<a name="1315"><span class="lineNum">    1315 </span>                :            :   }</a>
<a name="1316"><span class="lineNum">    1316 </span>                :            :   else//problems</a>
<a name="1317"><span class="lineNum">    1317 </span>                :            :   {</a>
<a name="1318"><span class="lineNum">    1318 </span>                :<span class="lineNoCov">          0 :     return false;</span></a>
<a name="1319"><span class="lineNum">    1319 </span>                :            :   }</a>
<a name="1320"><span class="lineNum">    1320 </span>                :<span class="lineNoCov">          0 : }</span></a>
<a name="1321"><span class="lineNum">    1321 </span>                :            : </a>
<a name="1322"><span class="lineNum">    1322 </span>                :<span class="lineNoCov">          0 : unsigned int QgsDualEdgeTriangulation::insertEdge( int dual, int next, int point, bool mbreak, bool forced )</span></a>
<a name="1323"><span class="lineNum">    1323 </span>                :            : {</a>
<a name="1324"><span class="lineNum">    1324 </span>                :<span class="lineNoCov">          0 :   HalfEdge *edge = new HalfEdge( dual, next, point, mbreak, forced );</span></a>
<a name="1325"><span class="lineNum">    1325 </span>                :<span class="lineNoCov">          0 :   mHalfEdge.append( edge );</span></a>
<a name="1326"><span class="lineNum">    1326 </span>                :<span class="lineNoCov">          0 :   return mHalfEdge.count() - 1;</span></a>
<a name="1327"><span class="lineNum">    1327 </span>                :            : </a>
<a name="1328"><span class="lineNum">    1328 </span>                :<span class="lineNoCov">          0 : }</span></a>
<a name="1329"><span class="lineNum">    1329 </span>                :            : </a>
<a name="1330"><span class="lineNum">    1330 </span>                :<span class="lineNoCov">          0 : static bool altitudeTriangleIsSmall( const QgsPoint &amp;pointBase1, const QgsPoint &amp;pointBase2, const QgsPoint &amp;pt3, double tolerance )</span></a>
<a name="1331"><span class="lineNum">    1331 </span>                :            : {</a>
<a name="1332"><span class="lineNum">    1332 </span>                :            :   // Compare the altitude of the triangle defined by base points and a third point with tolerance. Return true if the altitude &lt; tolerance</a>
<a name="1333"><span class="lineNum">    1333 </span>                :<span class="lineNoCov">          0 :   double x1 = pointBase1.x();</span></a>
<a name="1334"><span class="lineNum">    1334 </span>                :<span class="lineNoCov">          0 :   double y1 = pointBase1.y();</span></a>
<a name="1335"><span class="lineNum">    1335 </span>                :<span class="lineNoCov">          0 :   double x2 = pointBase2.x();</span></a>
<a name="1336"><span class="lineNum">    1336 </span>                :<span class="lineNoCov">          0 :   double y2 = pointBase2.y();</span></a>
<a name="1337"><span class="lineNum">    1337 </span>                :<span class="lineNoCov">          0 :   double X = pt3.x();</span></a>
<a name="1338"><span class="lineNum">    1338 </span>                :<span class="lineNoCov">          0 :   double Y = pt3.y();</span></a>
<a name="1339"><span class="lineNum">    1339 </span>                :<span class="lineNoCov">          0 :   QgsPoint projectedPoint;</span></a>
<a name="1340"><span class="lineNum">    1340 </span>                :            : </a>
<a name="1341"><span class="lineNum">    1341 </span>                :            :   double nx, ny; //normal vector</a>
<a name="1342"><span class="lineNum">    1342 </span>                :            : </a>
<a name="1343"><span class="lineNum">    1343 </span>                :<span class="lineNoCov">          0 :   nx = y2 - y1;</span></a>
<a name="1344"><span class="lineNum">    1344 </span>                :<span class="lineNoCov">          0 :   ny = -( x2 - x1 );</span></a>
<a name="1345"><span class="lineNum">    1345 </span>                :            : </a>
<a name="1346"><span class="lineNum">    1346 </span>                :            :   double t;</a>
<a name="1347"><span class="lineNum">    1347 </span>                :<span class="lineNoCov">          0 :   t = ( X * ny - Y * nx - x1 * ny + y1 * nx ) / ( ( x2 - x1 ) * ny - ( y2 - y1 ) * nx );</span></a>
<a name="1348"><span class="lineNum">    1348 </span>                :<span class="lineNoCov">          0 :   projectedPoint.setX( x1 + t * ( x2 - x1 ) );</span></a>
<a name="1349"><span class="lineNum">    1349 </span>                :<span class="lineNoCov">          0 :   projectedPoint.setY( y1 + t * ( y2 - y1 ) );</span></a>
<a name="1350"><span class="lineNum">    1350 </span>                :            : </a>
<a name="1351"><span class="lineNum">    1351 </span>                :<span class="lineNoCov">          0 :   return pt3.distance( projectedPoint ) &lt; tolerance;</span></a>
<a name="1352"><span class="lineNum">    1352 </span>                :<span class="lineNoCov">          0 : }</span></a>
<a name="1353"><span class="lineNum">    1353 </span>                :            : </a>
<a name="1354"><span class="lineNum">    1354 </span>                :<span class="lineNoCov">          0 : int QgsDualEdgeTriangulation::insertForcedSegment( int p1, int p2, QgsInterpolator::SourceType segmentType )</span></a>
<a name="1355"><span class="lineNum">    1355 </span>                :            : {</a>
<a name="1356"><span class="lineNum">    1356 </span>                :<span class="lineNoCov">          0 :   if ( p1 == p2 )</span></a>
<a name="1357"><span class="lineNum">    1357 </span>                :            :   {</a>
<a name="1358"><span class="lineNum">    1358 </span>                :<span class="lineNoCov">          0 :     return 0;</span></a>
<a name="1359"><span class="lineNum">    1359 </span>                :            :   }</a>
<a name="1360"><span class="lineNum">    1360 </span>                :            : </a>
<a name="1361"><span class="lineNum">    1361 </span>                :<span class="lineNoCov">          0 :   QgsPoint *point1 = mPointVector.at( p1 );</span></a>
<a name="1362"><span class="lineNum">    1362 </span>                :<span class="lineNoCov">          0 :   QgsPoint *point2 = mPointVector.at( p2 );</span></a>
<a name="1363"><span class="lineNum">    1363 </span>                :            : </a>
<a name="1364"><span class="lineNum">    1364 </span>                :            :   //list with (half of) the crossed edges</a>
<a name="1365"><span class="lineNum">    1365 </span>                :<span class="lineNoCov">          0 :   QList&lt;int&gt; crossedEdges;</span></a>
<a name="1366"><span class="lineNum">    1366 </span>                :            : </a>
<a name="1367"><span class="lineNum">    1367 </span>                :            :   //an edge pointing to p1</a>
<a name="1368"><span class="lineNum">    1368 </span>                :<span class="lineNoCov">          0 :   int pointingEdge = 0;</span></a>
<a name="1369"><span class="lineNum">    1369 </span>                :            : </a>
<a name="1370"><span class="lineNum">    1370 </span>                :<span class="lineNoCov">          0 :   pointingEdge = baseEdgeOfPoint( p1 );</span></a>
<a name="1371"><span class="lineNum">    1371 </span>                :            : </a>
<a name="1372"><span class="lineNum">    1372 </span>                :<span class="lineNoCov">          0 :   if ( pointingEdge == -1 )</span></a>
<a name="1373"><span class="lineNum">    1373 </span>                :            :   {</a>
<a name="1374"><span class="lineNum">    1374 </span>                :<span class="lineNoCov">          0 :     return -100;//return an error code</span></a>
<a name="1375"><span class="lineNum">    1375 </span>                :            :   }</a>
<a name="1376"><span class="lineNum">    1376 </span>                :            : </a>
<a name="1377"><span class="lineNum">    1377 </span>                :            :   //go around p1 and find out, if the segment already exists and if not, which is the first cutted edge</a>
<a name="1378"><span class="lineNum">    1378 </span>                :<span class="lineNoCov">          0 :   int actEdge = mHalfEdge[pointingEdge]-&gt;getDual();</span></a>
<a name="1379"><span class="lineNum">    1379 </span>                :<span class="lineNoCov">          0 :   int firstActEdge = actEdge;</span></a>
<a name="1380"><span class="lineNum">    1380 </span>                :            :   //number to prevent endless loops</a>
<a name="1381"><span class="lineNum">    1381 </span>                :<span class="lineNoCov">          0 :   int control = 0;</span></a>
<a name="1382"><span class="lineNum">    1382 </span>                :            : </a>
<a name="1383"><span class="lineNum">    1383 </span>                :<span class="lineNoCov">          0 :   do //if it's an endless loop, something went wrong</span></a>
<a name="1384"><span class="lineNum">    1384 </span>                :            :   {</a>
<a name="1385"><span class="lineNum">    1385 </span>                :<span class="lineNoCov">          0 :     control += 1;</span></a>
<a name="1386"><span class="lineNum">    1386 </span>                :<span class="lineNoCov">          0 :     if ( control &gt; 100 )</span></a>
<a name="1387"><span class="lineNum">    1387 </span>                :            :     {</a>
<a name="1388"><span class="lineNum">    1388 </span>                :            :       //QgsDebugMsg( QStringLiteral( &quot;warning, endless loop&quot; ) );</a>
<a name="1389"><span class="lineNum">    1389 </span>                :<span class="lineNoCov">          0 :       return -100;//return an error code</span></a>
<a name="1390"><span class="lineNum">    1390 </span>                :            :     }</a>
<a name="1391"><span class="lineNum">    1391 </span>                :            : </a>
<a name="1392"><span class="lineNum">    1392 </span>                :<span class="lineNoCov">          0 :     if ( mHalfEdge[actEdge]-&gt;getPoint() == -1 )//actEdge points to the virtual point</span></a>
<a name="1393"><span class="lineNum">    1393 </span>                :            :     {</a>
<a name="1394"><span class="lineNum">    1394 </span>                :<span class="lineNoCov">          0 :       actEdge = mHalfEdge[mHalfEdge[mHalfEdge[actEdge]-&gt;getNext()]-&gt;getNext()]-&gt;getDual();</span></a>
<a name="1395"><span class="lineNum">    1395 </span>                :<span class="lineNoCov">          0 :       continue;</span></a>
<a name="1396"><span class="lineNum">    1396 </span>                :            :     }</a>
<a name="1397"><span class="lineNum">    1397 </span>                :            : </a>
<a name="1398"><span class="lineNum">    1398 </span>                :            :     //test, if actEdge is already the forced edge</a>
<a name="1399"><span class="lineNum">    1399 </span>                :<span class="lineNoCov">          0 :     if ( mHalfEdge[actEdge]-&gt;getPoint() == p2 )</span></a>
<a name="1400"><span class="lineNum">    1400 </span>                :            :     {</a>
<a name="1401"><span class="lineNum">    1401 </span>                :<span class="lineNoCov">          0 :       mHalfEdge[actEdge]-&gt;setForced( true );</span></a>
<a name="1402"><span class="lineNum">    1402 </span>                :<span class="lineNoCov">          0 :       mHalfEdge[actEdge]-&gt;setBreak( segmentType == QgsInterpolator::SourceBreakLines );</span></a>
<a name="1403"><span class="lineNum">    1403 </span>                :<span class="lineNoCov">          0 :       mHalfEdge[mHalfEdge[actEdge]-&gt;getDual()]-&gt;setForced( true );</span></a>
<a name="1404"><span class="lineNum">    1404 </span>                :<span class="lineNoCov">          0 :       mHalfEdge[mHalfEdge[actEdge]-&gt;getDual()]-&gt;setBreak( segmentType == QgsInterpolator::SourceBreakLines );</span></a>
<a name="1405"><span class="lineNum">    1405 </span>                :<span class="lineNoCov">          0 :       return actEdge;</span></a>
<a name="1406"><span class="lineNum">    1406 </span>                :            :     }</a>
<a name="1407"><span class="lineNum">    1407 </span>                :            : </a>
<a name="1408"><span class="lineNum">    1408 </span>                :            :     //test, if the forced segment is a multiple of actEdge and if the direction is the same</a>
<a name="1409"><span class="lineNum">    1409 </span>                :<span class="lineNoCov">          0 :     if ( /*lines are parallel*/( point2-&gt;y() - point1-&gt;y() ) / ( mPointVector[mHalfEdge[actEdge]-&gt;getPoint()]-&gt;y() - point1-&gt;y() ) == ( point2-&gt;x() - point1-&gt;x() ) / ( mPointVector[mHalfEdge[actEdge]-&gt;getPoint()]-&gt;x() - point1-&gt;x() )</span></a>
<a name="1410"><span class="lineNum">    1410 </span>                :<span class="lineNoCov">          0 :                                &amp;&amp; ( ( point2-&gt;y() - point1-&gt;y() ) &gt;= 0 ) == ( ( mPointVector[mHalfEdge[actEdge]-&gt;getPoint()]-&gt;y() - point1-&gt;y() ) &gt; 0 )</span></a>
<a name="1411"><span class="lineNum">    1411 </span>                :<span class="lineNoCov">          0 :                                &amp;&amp; ( ( point2-&gt;x() - point1-&gt;x() ) &gt;= 0 ) == ( ( mPointVector[mHalfEdge[actEdge]-&gt;getPoint()]-&gt;x() - point1-&gt;x() ) &gt; 0 ) )</span></a>
<a name="1412"><span class="lineNum">    1412 </span>                :            :     {</a>
<a name="1413"><span class="lineNum">    1413 </span>                :            :       //mark actedge and Dual(actedge) as forced, reset p1 and start the method from the beginning</a>
<a name="1414"><span class="lineNum">    1414 </span>                :<span class="lineNoCov">          0 :       mHalfEdge[actEdge]-&gt;setForced( true );</span></a>
<a name="1415"><span class="lineNum">    1415 </span>                :<span class="lineNoCov">          0 :       mHalfEdge[actEdge]-&gt;setBreak( segmentType == QgsInterpolator::SourceBreakLines );</span></a>
<a name="1416"><span class="lineNum">    1416 </span>                :<span class="lineNoCov">          0 :       mHalfEdge[mHalfEdge[actEdge]-&gt;getDual()]-&gt;setForced( true );</span></a>
<a name="1417"><span class="lineNum">    1417 </span>                :<span class="lineNoCov">          0 :       mHalfEdge[mHalfEdge[actEdge]-&gt;getDual()]-&gt;setBreak( segmentType == QgsInterpolator::SourceBreakLines );</span></a>
<a name="1418"><span class="lineNum">    1418 </span>                :<span class="lineNoCov">          0 :       int a = insertForcedSegment( mHalfEdge[actEdge]-&gt;getPoint(), p2, segmentType );</span></a>
<a name="1419"><span class="lineNum">    1419 </span>                :<span class="lineNoCov">          0 :       return a;</span></a>
<a name="1420"><span class="lineNum">    1420 </span>                :            :     }</a>
<a name="1421"><span class="lineNum">    1421 </span>                :            : </a>
<a name="1422"><span class="lineNum">    1422 </span>                :            :     //test, if the forced segment intersects Next(actEdge)</a>
<a name="1423"><span class="lineNum">    1423 </span>                :<span class="lineNoCov">          0 :     int oppositeEdge = mHalfEdge[actEdge]-&gt;getNext();</span></a>
<a name="1424"><span class="lineNum">    1424 </span>                :            : </a>
<a name="1425"><span class="lineNum">    1425 </span>                :<span class="lineNoCov">          0 :     if ( mHalfEdge[oppositeEdge]-&gt;getPoint() == -1 || mHalfEdge[mHalfEdge[oppositeEdge]-&gt;getDual()]-&gt;getPoint() == -1 ) //intersection with line to the virtual point makes no sense</span></a>
<a name="1426"><span class="lineNum">    1426 </span>                :            :     {</a>
<a name="1427"><span class="lineNum">    1427 </span>                :<span class="lineNoCov">          0 :       actEdge = mHalfEdge[mHalfEdge[oppositeEdge]-&gt;getNext()]-&gt;getDual(); //continue with the next edge around p1</span></a>
<a name="1428"><span class="lineNum">    1428 </span>                :<span class="lineNoCov">          0 :       continue;</span></a>
<a name="1429"><span class="lineNum">    1429 </span>                :            :     }</a>
<a name="1430"><span class="lineNum">    1430 </span>                :            : </a>
<a name="1431"><span class="lineNum">    1431 </span>                :<span class="lineNoCov">          0 :     QgsPoint *oppositePoint1 = mPointVector[mHalfEdge[oppositeEdge]-&gt;getPoint()];</span></a>
<a name="1432"><span class="lineNum">    1432 </span>                :<span class="lineNoCov">          0 :     QgsPoint *oppositePoint2 = mPointVector[mHalfEdge[mHalfEdge[oppositeEdge]-&gt;getDual()]-&gt;getPoint()];</span></a>
<a name="1433"><span class="lineNum">    1433 </span>                :            : </a>
<a name="1434"><span class="lineNum">    1434 </span>                :<span class="lineNoCov">          0 :     if ( altitudeTriangleIsSmall( *oppositePoint1, *oppositePoint2, *point1, oppositePoint1-&gt;distance( *oppositePoint2 ) / 500 ) )</span></a>
<a name="1435"><span class="lineNum">    1435 </span>                :            :     {</a>
<a name="1436"><span class="lineNum">    1436 </span>                :            :       // to much risks to do something, go away</a>
<a name="1437"><span class="lineNum">    1437 </span>                :<span class="lineNoCov">          0 :       return -100;</span></a>
<a name="1438"><span class="lineNum">    1438 </span>                :            :     }</a>
<a name="1439"><span class="lineNum">    1439 </span>                :            : </a>
<a name="1440"><span class="lineNum">    1440 </span>                :<span class="lineNoCov">          0 :     if ( MathUtils::lineIntersection( point1,</span></a>
<a name="1441"><span class="lineNum">    1441 </span>                :<span class="lineNoCov">          0 :                                       point2,</span></a>
<a name="1442"><span class="lineNum">    1442 </span>                :<span class="lineNoCov">          0 :                                       mPointVector[mHalfEdge[oppositeEdge]-&gt;getPoint()],</span></a>
<a name="1443"><span class="lineNum">    1443 </span>                :<span class="lineNoCov">          0 :                                       mPointVector[mHalfEdge[mHalfEdge[oppositeEdge]-&gt;getDual()]-&gt;getPoint()] ) )</span></a>
<a name="1444"><span class="lineNum">    1444 </span>                :            :     {</a>
<a name="1445"><span class="lineNum">    1445 </span>                :<span class="lineNoCov">          0 :       if ( mHalfEdge[mHalfEdge[actEdge]-&gt;getNext()]-&gt;getForced() &amp;&amp; mForcedCrossBehavior == QgsTriangulation::SnappingTypeVertex )//if the crossed edge is a forced edge, we have to snap the forced line to the next node</span></a>
<a name="1446"><span class="lineNum">    1446 </span>                :            :       {</a>
<a name="1447"><span class="lineNum">    1447 </span>                :<span class="lineNoCov">          0 :         QgsPoint crosspoint( 0, 0, 0 );</span></a>
<a name="1448"><span class="lineNum">    1448 </span>                :            :         int p3, p4;</a>
<a name="1449"><span class="lineNum">    1449 </span>                :<span class="lineNoCov">          0 :         p3 = mHalfEdge[mHalfEdge[actEdge]-&gt;getNext()]-&gt;getPoint();</span></a>
<a name="1450"><span class="lineNum">    1450 </span>                :<span class="lineNoCov">          0 :         p4 = mHalfEdge[mHalfEdge[mHalfEdge[actEdge]-&gt;getNext()]-&gt;getDual()]-&gt;getPoint();</span></a>
<a name="1451"><span class="lineNum">    1451 </span>                :<span class="lineNoCov">          0 :         MathUtils::lineIntersection( point1, point2, mPointVector[p3], mPointVector[p4], &amp;crosspoint );</span></a>
<a name="1452"><span class="lineNum">    1452 </span>                :<span class="lineNoCov">          0 :         double dista = std::sqrt( ( crosspoint.x() - mPointVector[p3]-&gt;x() ) * ( crosspoint.x() - mPointVector[p3]-&gt;x() ) + ( crosspoint.y() - mPointVector[p3]-&gt;y() ) * ( crosspoint.y() - mPointVector[p3]-&gt;y() ) );</span></a>
<a name="1453"><span class="lineNum">    1453 </span>                :<span class="lineNoCov">          0 :         double distb = std::sqrt( ( crosspoint.x() - mPointVector[p4]-&gt;x() ) * ( crosspoint.x() - mPointVector[p4]-&gt;x() ) + ( crosspoint.y() - mPointVector[p4]-&gt;y() ) * ( crosspoint.y() - mPointVector[p4]-&gt;y() ) );</span></a>
<a name="1454"><span class="lineNum">    1454 </span>                :<span class="lineNoCov">          0 :         if ( dista &lt;= distb )</span></a>
<a name="1455"><span class="lineNum">    1455 </span>                :            :         {</a>
<a name="1456"><span class="lineNum">    1456 </span>                :<span class="lineNoCov">          0 :           insertForcedSegment( p1, p3, segmentType );</span></a>
<a name="1457"><span class="lineNum">    1457 </span>                :<span class="lineNoCov">          0 :           int e = insertForcedSegment( p3, p2, segmentType );</span></a>
<a name="1458"><span class="lineNum">    1458 </span>                :<span class="lineNoCov">          0 :           return e;</span></a>
<a name="1459"><span class="lineNum">    1459 </span>                :            :         }</a>
<a name="1460"><span class="lineNum">    1460 </span>                :<span class="lineNoCov">          0 :         else if ( distb &lt;= dista )</span></a>
<a name="1461"><span class="lineNum">    1461 </span>                :            :         {</a>
<a name="1462"><span class="lineNum">    1462 </span>                :<span class="lineNoCov">          0 :           insertForcedSegment( p1, p4, segmentType );</span></a>
<a name="1463"><span class="lineNum">    1463 </span>                :<span class="lineNoCov">          0 :           int e = insertForcedSegment( p4, p2, segmentType );</span></a>
<a name="1464"><span class="lineNum">    1464 </span>                :<span class="lineNoCov">          0 :           return e;</span></a>
<a name="1465"><span class="lineNum">    1465 </span>                :            :         }</a>
<a name="1466"><span class="lineNum">    1466 </span>                :<span class="lineNoCov">          0 :       }</span></a>
<a name="1467"><span class="lineNum">    1467 </span>                :            : </a>
<a name="1468"><span class="lineNum">    1468 </span>                :<span class="lineNoCov">          0 :       if ( mHalfEdge[mHalfEdge[actEdge]-&gt;getNext()]-&gt;getForced() &amp;&amp; mForcedCrossBehavior == QgsTriangulation::InsertVertex )//if the crossed edge is a forced edge, we have to insert a new vertice on this edge</span></a>
<a name="1469"><span class="lineNum">    1469 </span>                :            :       {</a>
<a name="1470"><span class="lineNum">    1470 </span>                :<span class="lineNoCov">          0 :         QgsPoint crosspoint( 0, 0, 0 );</span></a>
<a name="1471"><span class="lineNum">    1471 </span>                :            :         int p3, p4;</a>
<a name="1472"><span class="lineNum">    1472 </span>                :<span class="lineNoCov">          0 :         p3 = mHalfEdge[mHalfEdge[actEdge]-&gt;getNext()]-&gt;getPoint();</span></a>
<a name="1473"><span class="lineNum">    1473 </span>                :<span class="lineNoCov">          0 :         p4 = mHalfEdge[mHalfEdge[mHalfEdge[actEdge]-&gt;getNext()]-&gt;getDual()]-&gt;getPoint();</span></a>
<a name="1474"><span class="lineNum">    1474 </span>                :<span class="lineNoCov">          0 :         MathUtils::lineIntersection( mPointVector[p1], mPointVector[p2], mPointVector[p3], mPointVector[p4], &amp;crosspoint );</span></a>
<a name="1475"><span class="lineNum">    1475 </span>                :<span class="lineNoCov">          0 :         double distpart = std::sqrt( ( crosspoint.x() - mPointVector[p4]-&gt;x() ) * ( crosspoint.x() - mPointVector[p4]-&gt;x() ) + ( crosspoint.y() - mPointVector[p4]-&gt;y() ) * ( crosspoint.y() - mPointVector[p4]-&gt;y() ) );</span></a>
<a name="1476"><span class="lineNum">    1476 </span>                :<span class="lineNoCov">          0 :         double disttot = std::sqrt( ( mPointVector[p3]-&gt;x() - mPointVector[p4]-&gt;x() ) * ( mPointVector[p3]-&gt;x() - mPointVector[p4]-&gt;x() ) + ( mPointVector[p3]-&gt;y() - mPointVector[p4]-&gt;y() ) * ( mPointVector[p3]-&gt;y() - mPointVector[p4]-&gt;y() ) );</span></a>
<a name="1477"><span class="lineNum">    1477 </span>                :<span class="lineNoCov">          0 :         float frac = distpart / disttot;</span></a>
<a name="1478"><span class="lineNum">    1478 </span>                :            : </a>
<a name="1479"><span class="lineNum">    1479 </span>                :<span class="lineNoCov">          0 :         if ( frac == 0 || frac == 1 )//just in case MathUtils::lineIntersection does not work as expected</span></a>
<a name="1480"><span class="lineNum">    1480 </span>                :            :         {</a>
<a name="1481"><span class="lineNum">    1481 </span>                :<span class="lineNoCov">          0 :           if ( frac == 0 )</span></a>
<a name="1482"><span class="lineNum">    1482 </span>                :            :           {</a>
<a name="1483"><span class="lineNum">    1483 </span>                :            :             //mark actEdge and Dual(actEdge) as forced, reset p1 and start the method from the beginning</a>
<a name="1484"><span class="lineNum">    1484 </span>                :<span class="lineNoCov">          0 :             mHalfEdge[actEdge]-&gt;setForced( true );</span></a>
<a name="1485"><span class="lineNum">    1485 </span>                :<span class="lineNoCov">          0 :             mHalfEdge[actEdge]-&gt;setBreak( segmentType == QgsInterpolator::SourceBreakLines );</span></a>
<a name="1486"><span class="lineNum">    1486 </span>                :<span class="lineNoCov">          0 :             mHalfEdge[mHalfEdge[actEdge]-&gt;getDual()]-&gt;setForced( true );</span></a>
<a name="1487"><span class="lineNum">    1487 </span>                :<span class="lineNoCov">          0 :             mHalfEdge[mHalfEdge[actEdge]-&gt;getDual()]-&gt;setBreak( segmentType == QgsInterpolator::SourceBreakLines );</span></a>
<a name="1488"><span class="lineNum">    1488 </span>                :<span class="lineNoCov">          0 :             int a = insertForcedSegment( p4, p2, segmentType );</span></a>
<a name="1489"><span class="lineNum">    1489 </span>                :<span class="lineNoCov">          0 :             return a;</span></a>
<a name="1490"><span class="lineNum">    1490 </span>                :            :           }</a>
<a name="1491"><span class="lineNum">    1491 </span>                :<span class="lineNoCov">          0 :           else if ( frac == 1 )</span></a>
<a name="1492"><span class="lineNum">    1492 </span>                :            :           {</a>
<a name="1493"><span class="lineNum">    1493 </span>                :            :             //mark actEdge and Dual(actEdge) as forced, reset p1 and start the method from the beginning</a>
<a name="1494"><span class="lineNum">    1494 </span>                :<span class="lineNoCov">          0 :             mHalfEdge[actEdge]-&gt;setForced( true );</span></a>
<a name="1495"><span class="lineNum">    1495 </span>                :<span class="lineNoCov">          0 :             mHalfEdge[actEdge]-&gt;setBreak( segmentType == QgsInterpolator::SourceBreakLines );</span></a>
<a name="1496"><span class="lineNum">    1496 </span>                :<span class="lineNoCov">          0 :             mHalfEdge[mHalfEdge[actEdge]-&gt;getDual()]-&gt;setForced( true );</span></a>
<a name="1497"><span class="lineNum">    1497 </span>                :<span class="lineNoCov">          0 :             mHalfEdge[mHalfEdge[actEdge]-&gt;getDual()]-&gt;setBreak( segmentType == QgsInterpolator::SourceBreakLines );</span></a>
<a name="1498"><span class="lineNum">    1498 </span>                :<span class="lineNoCov">          0 :             if ( p3 != p2 )</span></a>
<a name="1499"><span class="lineNum">    1499 </span>                :            :             {</a>
<a name="1500"><span class="lineNum">    1500 </span>                :<span class="lineNoCov">          0 :               int a = insertForcedSegment( p3, p2, segmentType );</span></a>
<a name="1501"><span class="lineNum">    1501 </span>                :<span class="lineNoCov">          0 :               return a;</span></a>
<a name="1502"><span class="lineNum">    1502 </span>                :            :             }</a>
<a name="1503"><span class="lineNum">    1503 </span>                :            :             else</a>
<a name="1504"><span class="lineNum">    1504 </span>                :            :             {</a>
<a name="1505"><span class="lineNum">    1505 </span>                :<span class="lineNoCov">          0 :               return actEdge;</span></a>
<a name="1506"><span class="lineNum">    1506 </span>                :            :             }</a>
<a name="1507"><span class="lineNum">    1507 </span>                :            :           }</a>
<a name="1508"><span class="lineNum">    1508 </span>                :            : </a>
<a name="1509"><span class="lineNum">    1509 </span>                :<span class="lineNoCov">          0 :         }</span></a>
<a name="1510"><span class="lineNum">    1510 </span>                :            :         else</a>
<a name="1511"><span class="lineNum">    1511 </span>                :            :         {</a>
<a name="1512"><span class="lineNum">    1512 </span>                :<span class="lineNoCov">          0 :           int newpoint = splitHalfEdge( mHalfEdge[actEdge]-&gt;getNext(), frac );</span></a>
<a name="1513"><span class="lineNum">    1513 </span>                :<span class="lineNoCov">          0 :           insertForcedSegment( p1, newpoint, segmentType );</span></a>
<a name="1514"><span class="lineNum">    1514 </span>                :<span class="lineNoCov">          0 :           int e = insertForcedSegment( newpoint, p2, segmentType );</span></a>
<a name="1515"><span class="lineNum">    1515 </span>                :<span class="lineNoCov">          0 :           return e;</span></a>
<a name="1516"><span class="lineNum">    1516 </span>                :            :         }</a>
<a name="1517"><span class="lineNum">    1517 </span>                :<span class="lineNoCov">          0 :       }</span></a>
<a name="1518"><span class="lineNum">    1518 </span>                :            : </a>
<a name="1519"><span class="lineNum">    1519 </span>                :            :       //add the first HalfEdge to the list of crossed edges</a>
<a name="1520"><span class="lineNum">    1520 </span>                :<span class="lineNoCov">          0 :       crossedEdges.append( oppositeEdge );</span></a>
<a name="1521"><span class="lineNum">    1521 </span>                :<span class="lineNoCov">          0 :       break;</span></a>
<a name="1522"><span class="lineNum">    1522 </span>                :            :     }</a>
<a name="1523"><span class="lineNum">    1523 </span>                :<span class="lineNoCov">          0 :     actEdge = mHalfEdge[mHalfEdge[oppositeEdge]-&gt;getNext()]-&gt;getDual(); //continue with the next edge around p1</span></a>
<a name="1524"><span class="lineNum">    1524 </span>                :<span class="lineNoCov">          0 :   }</span></a>
<a name="1525"><span class="lineNum">    1525 </span>                :<span class="lineNoCov">          0 :   while ( actEdge != firstActEdge );</span></a>
<a name="1526"><span class="lineNum">    1526 </span>                :            : </a>
<a name="1527"><span class="lineNum">    1527 </span>                :<span class="lineNoCov">          0 :   if ( crossedEdges.isEmpty() ) //nothing found due to rounding error, better to go away!</span></a>
<a name="1528"><span class="lineNum">    1528 </span>                :<span class="lineNoCov">          0 :     return -100;</span></a>
<a name="1529"><span class="lineNum">    1529 </span>                :<span class="lineNoCov">          0 :   int lastEdgeOppositePointIndex = mHalfEdge[mHalfEdge[mHalfEdge[crossedEdges.last()]-&gt;getDual()]-&gt;getNext()]-&gt;getPoint();</span></a>
<a name="1530"><span class="lineNum">    1530 </span>                :            : </a>
<a name="1531"><span class="lineNum">    1531 </span>                :            :   //we found the first edge, terminated the method or called the method with other points. Lets search for all the other crossed edges</a>
<a name="1532"><span class="lineNum">    1532 </span>                :<span class="lineNoCov">          0 :   while ( lastEdgeOppositePointIndex != p2 )</span></a>
<a name="1533"><span class="lineNum">    1533 </span>                :            :   {</a>
<a name="1534"><span class="lineNum">    1534 </span>                :<span class="lineNoCov">          0 :     QgsPoint *lastEdgePoint1 = mPointVector[mHalfEdge[mHalfEdge[crossedEdges.last()]-&gt;getDual()]-&gt;getPoint()];</span></a>
<a name="1535"><span class="lineNum">    1535 </span>                :<span class="lineNoCov">          0 :     QgsPoint *lastEdgePoint2 = mPointVector[mHalfEdge[mHalfEdge[mHalfEdge[mHalfEdge[crossedEdges.last()]-&gt;getDual()]-&gt;getNext()]-&gt;getNext()]-&gt;getPoint()];</span></a>
<a name="1536"><span class="lineNum">    1536 </span>                :<span class="lineNoCov">          0 :     QgsPoint *lastEdgeOppositePoint = mPointVector[lastEdgeOppositePointIndex];</span></a>
<a name="1537"><span class="lineNum">    1537 </span>                :            : </a>
<a name="1538"><span class="lineNum">    1538 </span>                :<span class="lineNoCov">          0 :     if ( MathUtils::lineIntersection( lastEdgePoint1, lastEdgeOppositePoint,</span></a>
<a name="1539"><span class="lineNum">    1539 </span>                :<span class="lineNoCov">          0 :                                       point1, point2 ) )</span></a>
<a name="1540"><span class="lineNum">    1540 </span>                :            :     {</a>
<a name="1541"><span class="lineNum">    1541 </span>                :<span class="lineNoCov">          0 :       if ( mHalfEdge[mHalfEdge[mHalfEdge[crossedEdges.last()]-&gt;getDual()]-&gt;getNext()]-&gt;getForced() &amp;&amp; mForcedCrossBehavior == QgsTriangulation::SnappingTypeVertex )//if the crossed edge is a forced edge and mForcedCrossBehavior is SnappingType_VERTICE, we have to snap the forced line to the next node</span></a>
<a name="1542"><span class="lineNum">    1542 </span>                :            :       {</a>
<a name="1543"><span class="lineNum">    1543 </span>                :<span class="lineNoCov">          0 :         QgsPoint crosspoint( 0, 0, 0 );</span></a>
<a name="1544"><span class="lineNum">    1544 </span>                :            :         int p3, p4;</a>
<a name="1545"><span class="lineNum">    1545 </span>                :<span class="lineNoCov">          0 :         p3 = mHalfEdge[mHalfEdge[crossedEdges.last()]-&gt;getDual()]-&gt;getPoint();</span></a>
<a name="1546"><span class="lineNum">    1546 </span>                :<span class="lineNoCov">          0 :         p4 = mHalfEdge[mHalfEdge[mHalfEdge[crossedEdges.last()]-&gt;getDual()]-&gt;getNext()]-&gt;getPoint();</span></a>
<a name="1547"><span class="lineNum">    1547 </span>                :<span class="lineNoCov">          0 :         MathUtils::lineIntersection( point1, point2, mPointVector[p3], mPointVector[p4], &amp;crosspoint );</span></a>
<a name="1548"><span class="lineNum">    1548 </span>                :<span class="lineNoCov">          0 :         double dista = std::sqrt( ( crosspoint.x() - mPointVector[p3]-&gt;x() ) * ( crosspoint.x() - mPointVector[p3]-&gt;x() ) + ( crosspoint.y() - mPointVector[p3]-&gt;y() ) * ( crosspoint.y() - mPointVector[p3]-&gt;y() ) );</span></a>
<a name="1549"><span class="lineNum">    1549 </span>                :<span class="lineNoCov">          0 :         double distb = std::sqrt( ( crosspoint.x() - mPointVector[p4]-&gt;x() ) * ( crosspoint.x() - mPointVector[p4]-&gt;x() ) + ( crosspoint.y() - mPointVector[p4]-&gt;y() ) * ( crosspoint.y() - mPointVector[p4]-&gt;y() ) );</span></a>
<a name="1550"><span class="lineNum">    1550 </span>                :<span class="lineNoCov">          0 :         if ( dista &lt;= distb )</span></a>
<a name="1551"><span class="lineNum">    1551 </span>                :            :         {</a>
<a name="1552"><span class="lineNum">    1552 </span>                :<span class="lineNoCov">          0 :           insertForcedSegment( p1, p3, segmentType );</span></a>
<a name="1553"><span class="lineNum">    1553 </span>                :<span class="lineNoCov">          0 :           int e = insertForcedSegment( p3, p2, segmentType );</span></a>
<a name="1554"><span class="lineNum">    1554 </span>                :<span class="lineNoCov">          0 :           return e;</span></a>
<a name="1555"><span class="lineNum">    1555 </span>                :            :         }</a>
<a name="1556"><span class="lineNum">    1556 </span>                :<span class="lineNoCov">          0 :         else if ( distb &lt;= dista )</span></a>
<a name="1557"><span class="lineNum">    1557 </span>                :            :         {</a>
<a name="1558"><span class="lineNum">    1558 </span>                :<span class="lineNoCov">          0 :           insertForcedSegment( p1, p4, segmentType );</span></a>
<a name="1559"><span class="lineNum">    1559 </span>                :<span class="lineNoCov">          0 :           int e = insertForcedSegment( p4, p2, segmentType );</span></a>
<a name="1560"><span class="lineNum">    1560 </span>                :<span class="lineNoCov">          0 :           return e;</span></a>
<a name="1561"><span class="lineNum">    1561 </span>                :            :         }</a>
<a name="1562"><span class="lineNum">    1562 </span>                :<span class="lineNoCov">          0 :       }</span></a>
<a name="1563"><span class="lineNum">    1563 </span>                :<span class="lineNoCov">          0 :       else if ( mHalfEdge[mHalfEdge[mHalfEdge[crossedEdges.last()]-&gt;getDual()]-&gt;getNext()]-&gt;getForced() &amp;&amp; mForcedCrossBehavior == QgsTriangulation::InsertVertex )//if the crossed edge is a forced edge, we have to insert a new vertice on this edge</span></a>
<a name="1564"><span class="lineNum">    1564 </span>                :            :       {</a>
<a name="1565"><span class="lineNum">    1565 </span>                :<span class="lineNoCov">          0 :         QgsPoint crosspoint( 0, 0, 0 );</span></a>
<a name="1566"><span class="lineNum">    1566 </span>                :            :         int p3, p4;</a>
<a name="1567"><span class="lineNum">    1567 </span>                :<span class="lineNoCov">          0 :         p3 = mHalfEdge[mHalfEdge[crossedEdges.last()]-&gt;getDual()]-&gt;getPoint();</span></a>
<a name="1568"><span class="lineNum">    1568 </span>                :<span class="lineNoCov">          0 :         p4 = mHalfEdge[mHalfEdge[mHalfEdge[crossedEdges.last()]-&gt;getDual()]-&gt;getNext()]-&gt;getPoint();</span></a>
<a name="1569"><span class="lineNum">    1569 </span>                :<span class="lineNoCov">          0 :         MathUtils::lineIntersection( point1, point2, mPointVector[p3], mPointVector[p4], &amp;crosspoint );</span></a>
<a name="1570"><span class="lineNum">    1570 </span>                :<span class="lineNoCov">          0 :         double distpart = std::sqrt( ( crosspoint.x() - mPointVector[p3]-&gt;x() ) * ( crosspoint.x() - mPointVector[p3]-&gt;x() ) + ( crosspoint.y() - mPointVector[p3]-&gt;y() ) * ( crosspoint.y() - mPointVector[p3]-&gt;y() ) );</span></a>
<a name="1571"><span class="lineNum">    1571 </span>                :<span class="lineNoCov">          0 :         double disttot = std::sqrt( ( mPointVector[p3]-&gt;x() - mPointVector[p4]-&gt;x() ) * ( mPointVector[p3]-&gt;x() - mPointVector[p4]-&gt;x() ) + ( mPointVector[p3]-&gt;y() - mPointVector[p4]-&gt;y() ) * ( mPointVector[p3]-&gt;y() - mPointVector[p4]-&gt;y() ) );</span></a>
<a name="1572"><span class="lineNum">    1572 </span>                :<span class="lineNoCov">          0 :         float frac = distpart / disttot;</span></a>
<a name="1573"><span class="lineNum">    1573 </span>                :<span class="lineNoCov">          0 :         if ( frac == 0 || frac == 1 )</span></a>
<a name="1574"><span class="lineNum">    1574 </span>                :            :         {</a>
<a name="1575"><span class="lineNum">    1575 </span>                :<span class="lineNoCov">          0 :           break;//seems that a roundoff error occurred. We found the endpoint</span></a>
<a name="1576"><span class="lineNum">    1576 </span>                :            :         }</a>
<a name="1577"><span class="lineNum">    1577 </span>                :<span class="lineNoCov">          0 :         int newpoint = splitHalfEdge( mHalfEdge[mHalfEdge[crossedEdges.last()]-&gt;getDual()]-&gt;getNext(), frac );</span></a>
<a name="1578"><span class="lineNum">    1578 </span>                :<span class="lineNoCov">          0 :         insertForcedSegment( p1, newpoint, segmentType );</span></a>
<a name="1579"><span class="lineNum">    1579 </span>                :<span class="lineNoCov">          0 :         int e = insertForcedSegment( newpoint, p2, segmentType );</span></a>
<a name="1580"><span class="lineNum">    1580 </span>                :<span class="lineNoCov">          0 :         return e;</span></a>
<a name="1581"><span class="lineNum">    1581 </span>                :<span class="lineNoCov">          0 :       }</span></a>
<a name="1582"><span class="lineNum">    1582 </span>                :            : </a>
<a name="1583"><span class="lineNum">    1583 </span>                :<span class="lineNoCov">          0 :       crossedEdges.append( mHalfEdge[mHalfEdge[crossedEdges.last()]-&gt;getDual()]-&gt;getNext() );</span></a>
<a name="1584"><span class="lineNum">    1584 </span>                :<span class="lineNoCov">          0 :     }</span></a>
<a name="1585"><span class="lineNum">    1585 </span>                :<span class="lineNoCov">          0 :     else if ( MathUtils::lineIntersection( lastEdgePoint2, lastEdgeOppositePoint,</span></a>
<a name="1586"><span class="lineNum">    1586 </span>                :<span class="lineNoCov">          0 :                                            point1, point2 ) )</span></a>
<a name="1587"><span class="lineNum">    1587 </span>                :            :     {</a>
<a name="1588"><span class="lineNum">    1588 </span>                :<span class="lineNoCov">          0 :       if ( mHalfEdge[mHalfEdge[mHalfEdge[mHalfEdge[crossedEdges.last()]-&gt;getDual()]-&gt;getNext()]-&gt;getNext()]-&gt;getForced() &amp;&amp; mForcedCrossBehavior == QgsTriangulation::SnappingTypeVertex )//if the crossed edge is a forced edge and mForcedCrossBehavior is SnappingType_VERTICE, we have to snap the forced line to the next node</span></a>
<a name="1589"><span class="lineNum">    1589 </span>                :            :       {</a>
<a name="1590"><span class="lineNum">    1590 </span>                :<span class="lineNoCov">          0 :         QgsPoint crosspoint( 0, 0, 0 );</span></a>
<a name="1591"><span class="lineNum">    1591 </span>                :            :         int p3, p4;</a>
<a name="1592"><span class="lineNum">    1592 </span>                :<span class="lineNoCov">          0 :         p3 = mHalfEdge[mHalfEdge[mHalfEdge[crossedEdges.last()]-&gt;getDual()]-&gt;getNext()]-&gt;getPoint();</span></a>
<a name="1593"><span class="lineNum">    1593 </span>                :<span class="lineNoCov">          0 :         p4 = mHalfEdge[mHalfEdge[mHalfEdge[mHalfEdge[crossedEdges.last()]-&gt;getDual()]-&gt;getNext()]-&gt;getNext()]-&gt;getPoint();</span></a>
<a name="1594"><span class="lineNum">    1594 </span>                :<span class="lineNoCov">          0 :         MathUtils::lineIntersection( mPointVector[p1], mPointVector[p2], mPointVector[p3], mPointVector[p4], &amp;crosspoint );</span></a>
<a name="1595"><span class="lineNum">    1595 </span>                :<span class="lineNoCov">          0 :         double dista = std::sqrt( ( crosspoint.x() - mPointVector[p3]-&gt;x() ) * ( crosspoint.x() - mPointVector[p3]-&gt;x() ) + ( crosspoint.y() - mPointVector[p3]-&gt;y() ) * ( crosspoint.y() - mPointVector[p3]-&gt;y() ) );</span></a>
<a name="1596"><span class="lineNum">    1596 </span>                :<span class="lineNoCov">          0 :         double distb = std::sqrt( ( crosspoint.x() - mPointVector[p4]-&gt;x() ) * ( crosspoint.x() - mPointVector[p4]-&gt;x() ) + ( crosspoint.y() - mPointVector[p4]-&gt;y() ) * ( crosspoint.y() - mPointVector[p4]-&gt;y() ) );</span></a>
<a name="1597"><span class="lineNum">    1597 </span>                :<span class="lineNoCov">          0 :         if ( dista &lt;= distb )</span></a>
<a name="1598"><span class="lineNum">    1598 </span>                :            :         {</a>
<a name="1599"><span class="lineNum">    1599 </span>                :<span class="lineNoCov">          0 :           insertForcedSegment( p1, p3, segmentType );</span></a>
<a name="1600"><span class="lineNum">    1600 </span>                :<span class="lineNoCov">          0 :           int e = insertForcedSegment( p3, p2, segmentType );</span></a>
<a name="1601"><span class="lineNum">    1601 </span>                :<span class="lineNoCov">          0 :           return e;</span></a>
<a name="1602"><span class="lineNum">    1602 </span>                :            :         }</a>
<a name="1603"><span class="lineNum">    1603 </span>                :<span class="lineNoCov">          0 :         else if ( distb &lt;= dista )</span></a>
<a name="1604"><span class="lineNum">    1604 </span>                :            :         {</a>
<a name="1605"><span class="lineNum">    1605 </span>                :<span class="lineNoCov">          0 :           insertForcedSegment( p1, p4, segmentType );</span></a>
<a name="1606"><span class="lineNum">    1606 </span>                :<span class="lineNoCov">          0 :           int e = insertForcedSegment( p4, p2, segmentType );</span></a>
<a name="1607"><span class="lineNum">    1607 </span>                :<span class="lineNoCov">          0 :           return e;</span></a>
<a name="1608"><span class="lineNum">    1608 </span>                :            :         }</a>
<a name="1609"><span class="lineNum">    1609 </span>                :<span class="lineNoCov">          0 :       }</span></a>
<a name="1610"><span class="lineNum">    1610 </span>                :<span class="lineNoCov">          0 :       else if ( mHalfEdge[mHalfEdge[mHalfEdge[mHalfEdge[crossedEdges.last()]-&gt;getDual()]-&gt;getNext()]-&gt;getNext()]-&gt;getForced() &amp;&amp; mForcedCrossBehavior == QgsTriangulation::InsertVertex )//if the crossed edge is a forced edge, we have to insert a new vertice on this edge</span></a>
<a name="1611"><span class="lineNum">    1611 </span>                :            :       {</a>
<a name="1612"><span class="lineNum">    1612 </span>                :<span class="lineNoCov">          0 :         QgsPoint crosspoint( 0, 0, 0 );</span></a>
<a name="1613"><span class="lineNum">    1613 </span>                :            :         int p3, p4;</a>
<a name="1614"><span class="lineNum">    1614 </span>                :<span class="lineNoCov">          0 :         p3 = mHalfEdge[mHalfEdge[mHalfEdge[crossedEdges.last()]-&gt;getDual()]-&gt;getNext()]-&gt;getPoint();</span></a>
<a name="1615"><span class="lineNum">    1615 </span>                :<span class="lineNoCov">          0 :         p4 = mHalfEdge[mHalfEdge[mHalfEdge[mHalfEdge[crossedEdges.last()]-&gt;getDual()]-&gt;getNext()]-&gt;getNext()]-&gt;getPoint();</span></a>
<a name="1616"><span class="lineNum">    1616 </span>                :<span class="lineNoCov">          0 :         MathUtils::lineIntersection( point1, point2, mPointVector[p3], mPointVector[p4], &amp;crosspoint );</span></a>
<a name="1617"><span class="lineNum">    1617 </span>                :<span class="lineNoCov">          0 :         double distpart = std::sqrt( ( crosspoint.x() - mPointVector[p3]-&gt;x() ) * ( crosspoint.x() - mPointVector[p3]-&gt;x() ) + ( crosspoint.y() - mPointVector[p3]-&gt;y() ) * ( crosspoint.y() - mPointVector[p3]-&gt;y() ) );</span></a>
<a name="1618"><span class="lineNum">    1618 </span>                :<span class="lineNoCov">          0 :         double disttot = std::sqrt( ( mPointVector[p3]-&gt;x() - mPointVector[p4]-&gt;x() ) * ( mPointVector[p3]-&gt;x() - mPointVector[p4]-&gt;x() ) + ( mPointVector[p3]-&gt;y() - mPointVector[p4]-&gt;y() ) * ( mPointVector[p3]-&gt;y() - mPointVector[p4]-&gt;y() ) );</span></a>
<a name="1619"><span class="lineNum">    1619 </span>                :<span class="lineNoCov">          0 :         float frac = distpart / disttot;</span></a>
<a name="1620"><span class="lineNum">    1620 </span>                :<span class="lineNoCov">          0 :         if ( frac == 0 || frac == 1 )</span></a>
<a name="1621"><span class="lineNum">    1621 </span>                :            :         {</a>
<a name="1622"><span class="lineNum">    1622 </span>                :<span class="lineNoCov">          0 :           break;//seems that a roundoff error occurred. We found the endpoint</span></a>
<a name="1623"><span class="lineNum">    1623 </span>                :            :         }</a>
<a name="1624"><span class="lineNum">    1624 </span>                :<span class="lineNoCov">          0 :         int newpoint = splitHalfEdge( mHalfEdge[mHalfEdge[mHalfEdge[crossedEdges.last()]-&gt;getDual()]-&gt;getNext()]-&gt;getNext(), frac );</span></a>
<a name="1625"><span class="lineNum">    1625 </span>                :<span class="lineNoCov">          0 :         insertForcedSegment( p1, newpoint, segmentType );</span></a>
<a name="1626"><span class="lineNum">    1626 </span>                :<span class="lineNoCov">          0 :         int e = insertForcedSegment( newpoint, p2, segmentType );</span></a>
<a name="1627"><span class="lineNum">    1627 </span>                :<span class="lineNoCov">          0 :         return e;</span></a>
<a name="1628"><span class="lineNum">    1628 </span>                :<span class="lineNoCov">          0 :       }</span></a>
<a name="1629"><span class="lineNum">    1629 </span>                :            : </a>
<a name="1630"><span class="lineNum">    1630 </span>                :<span class="lineNoCov">          0 :       crossedEdges.append( mHalfEdge[mHalfEdge[mHalfEdge[crossedEdges.last()]-&gt;getDual()]-&gt;getNext()]-&gt;getNext() );</span></a>
<a name="1631"><span class="lineNum">    1631 </span>                :<span class="lineNoCov">          0 :     }</span></a>
<a name="1632"><span class="lineNum">    1632 </span>                :            :     else</a>
<a name="1633"><span class="lineNum">    1633 </span>                :            :     {</a>
<a name="1634"><span class="lineNum">    1634 </span>                :            :       //no intersection found, surely due to rounding error or something else wrong, better to give up!</a>
<a name="1635"><span class="lineNum">    1635 </span>                :<span class="lineNoCov">          0 :       return -100;</span></a>
<a name="1636"><span class="lineNum">    1636 </span>                :            :     }</a>
<a name="1637"><span class="lineNum">    1637 </span>                :<span class="lineNoCov">          0 :     lastEdgeOppositePointIndex = mHalfEdge[mHalfEdge[mHalfEdge[crossedEdges.last()]-&gt;getDual()]-&gt;getNext()]-&gt;getPoint();</span></a>
<a name="1638"><span class="lineNum">    1638 </span>                :            :   }</a>
<a name="1639"><span class="lineNum">    1639 </span>                :            : </a>
<a name="1640"><span class="lineNum">    1640 </span>                :            :   // Last check before construct the breakline</a>
<a name="1641"><span class="lineNum">    1641 </span>                :<span class="lineNoCov">          0 :   QgsPoint *lastEdgePoint1 = mPointVector[mHalfEdge[mHalfEdge[crossedEdges.last()]-&gt;getDual()]-&gt;getPoint()];</span></a>
<a name="1642"><span class="lineNum">    1642 </span>                :<span class="lineNoCov">          0 :   QgsPoint *lastEdgePoint2 = mPointVector[mHalfEdge[mHalfEdge[mHalfEdge[mHalfEdge[crossedEdges.last()]-&gt;getDual()]-&gt;getNext()]-&gt;getNext()]-&gt;getPoint()];</span></a>
<a name="1643"><span class="lineNum">    1643 </span>                :<span class="lineNoCov">          0 :   QgsPoint *lastEdgeOppositePoint = mPointVector[lastEdgeOppositePointIndex];</span></a>
<a name="1644"><span class="lineNum">    1644 </span>                :<span class="lineNoCov">          0 :   if ( altitudeTriangleIsSmall( *lastEdgePoint1, *lastEdgePoint2, *lastEdgeOppositePoint, lastEdgePoint1-&gt;distance( *lastEdgePoint2 ) / 500 ) )</span></a>
<a name="1645"><span class="lineNum">    1645 </span>                :<span class="lineNoCov">          0 :     return -100;</span></a>
<a name="1646"><span class="lineNum">    1646 </span>                :            : </a>
<a name="1647"><span class="lineNum">    1647 </span>                :            :   //set the flags 'forced' and 'break' to false for every edge and dualedge of 'crossEdges'</a>
<a name="1648"><span class="lineNum">    1648 </span>                :<span class="lineNoCov">          0 :   QList&lt;int&gt;::const_iterator iter;</span></a>
<a name="1649"><span class="lineNum">    1649 </span>                :<span class="lineNoCov">          0 :   for ( iter = crossedEdges.constBegin(); iter != crossedEdges.constEnd(); ++iter )</span></a>
<a name="1650"><span class="lineNum">    1650 </span>                :            :   {</a>
<a name="1651"><span class="lineNum">    1651 </span>                :<span class="lineNoCov">          0 :     mHalfEdge[( *( iter ) )]-&gt;setForced( false );</span></a>
<a name="1652"><span class="lineNum">    1652 </span>                :<span class="lineNoCov">          0 :     mHalfEdge[( *( iter ) )]-&gt;setBreak( false );</span></a>
<a name="1653"><span class="lineNum">    1653 </span>                :<span class="lineNoCov">          0 :     mHalfEdge[mHalfEdge[( *( iter ) )]-&gt;getDual()]-&gt;setForced( false );</span></a>
<a name="1654"><span class="lineNum">    1654 </span>                :<span class="lineNoCov">          0 :     mHalfEdge[mHalfEdge[( *( iter ) )]-&gt;getDual()]-&gt;setBreak( false );</span></a>
<a name="1655"><span class="lineNum">    1655 </span>                :<span class="lineNoCov">          0 :   }</span></a>
<a name="1656"><span class="lineNum">    1656 </span>                :            : </a>
<a name="1657"><span class="lineNum">    1657 </span>                :            :   //crossed edges is filled, now the two polygons to be retriangulated can be build</a>
<a name="1658"><span class="lineNum">    1658 </span>                :            : </a>
<a name="1659"><span class="lineNum">    1659 </span>                :<span class="lineNoCov">          0 :   QList&lt;int&gt; freelist = crossedEdges;//copy the list with the crossed edges to remove the edges already reused</span></a>
<a name="1660"><span class="lineNum">    1660 </span>                :            : </a>
<a name="1661"><span class="lineNum">    1661 </span>                :            :   //create the left polygon as a list of the numbers of the halfedges</a>
<a name="1662"><span class="lineNum">    1662 </span>                :<span class="lineNoCov">          0 :   QList&lt;int&gt; leftPolygon;</span></a>
<a name="1663"><span class="lineNum">    1663 </span>                :<span class="lineNoCov">          0 :   QList&lt;int&gt; rightPolygon;</span></a>
<a name="1664"><span class="lineNum">    1664 </span>                :            : </a>
<a name="1665"><span class="lineNum">    1665 </span>                :            :   //insert the forced edge and enter the corresponding halfedges as the first edges in the left and right polygons. The nexts and points are set later because of the algorithm to build two polygons from 'crossedEdges'</a>
<a name="1666"><span class="lineNum">    1666 </span>                :<span class="lineNoCov">          0 :   int firstedge = freelist.first();//edge pointing from p1 to p2</span></a>
<a name="1667"><span class="lineNum">    1667 </span>                :<span class="lineNoCov">          0 :   mHalfEdge[firstedge]-&gt;setForced( true );</span></a>
<a name="1668"><span class="lineNum">    1668 </span>                :<span class="lineNoCov">          0 :   mHalfEdge[firstedge]-&gt;setBreak( segmentType == QgsInterpolator::SourceBreakLines );</span></a>
<a name="1669"><span class="lineNum">    1669 </span>                :<span class="lineNoCov">          0 :   leftPolygon.append( firstedge );</span></a>
<a name="1670"><span class="lineNum">    1670 </span>                :<span class="lineNoCov">          0 :   int dualfirstedge = mHalfEdge[freelist.first()]-&gt;getDual();//edge pointing from p2 to p1</span></a>
<a name="1671"><span class="lineNum">    1671 </span>                :<span class="lineNoCov">          0 :   mHalfEdge[dualfirstedge]-&gt;setForced( true );</span></a>
<a name="1672"><span class="lineNum">    1672 </span>                :<span class="lineNoCov">          0 :   mHalfEdge[dualfirstedge]-&gt;setBreak( segmentType == QgsInterpolator::SourceBreakLines );</span></a>
<a name="1673"><span class="lineNum">    1673 </span>                :<span class="lineNoCov">          0 :   rightPolygon.append( dualfirstedge );</span></a>
<a name="1674"><span class="lineNum">    1674 </span>                :<span class="lineNoCov">          0 :   freelist.pop_front();//delete the first entry from the freelist</span></a>
<a name="1675"><span class="lineNum">    1675 </span>                :            : </a>
<a name="1676"><span class="lineNum">    1676 </span>                :            :   //finish the polygon on the left side</a>
<a name="1677"><span class="lineNum">    1677 </span>                :<span class="lineNoCov">          0 :   int actpointl = p2;</span></a>
<a name="1678"><span class="lineNum">    1678 </span>                :<span class="lineNoCov">          0 :   QList&lt;int&gt;::const_iterator leftiter; //todo: is there a better way to set an iterator to the last list element?</span></a>
<a name="1679"><span class="lineNum">    1679 </span>                :<span class="lineNoCov">          0 :   leftiter = crossedEdges.constEnd();</span></a>
<a name="1680"><span class="lineNum">    1680 </span>                :<span class="lineNoCov">          0 :   --leftiter;</span></a>
<a name="1681"><span class="lineNum">    1681 </span>                :<span class="lineNoCov">          0 :   while ( true )</span></a>
<a name="1682"><span class="lineNum">    1682 </span>                :            :   {</a>
<a name="1683"><span class="lineNum">    1683 </span>                :<span class="lineNoCov">          0 :     int newpoint = mHalfEdge[mHalfEdge[mHalfEdge[mHalfEdge[( *leftiter )]-&gt;getDual()]-&gt;getNext()]-&gt;getNext()]-&gt;getPoint();</span></a>
<a name="1684"><span class="lineNum">    1684 </span>                :<span class="lineNoCov">          0 :     if ( newpoint != actpointl )</span></a>
<a name="1685"><span class="lineNum">    1685 </span>                :            :     {</a>
<a name="1686"><span class="lineNum">    1686 </span>                :            :       //insert the edge into the leftPolygon</a>
<a name="1687"><span class="lineNum">    1687 </span>                :<span class="lineNoCov">          0 :       actpointl = newpoint;</span></a>
<a name="1688"><span class="lineNum">    1688 </span>                :<span class="lineNoCov">          0 :       int theedge = mHalfEdge[mHalfEdge[mHalfEdge[( *leftiter )]-&gt;getDual()]-&gt;getNext()]-&gt;getNext();</span></a>
<a name="1689"><span class="lineNum">    1689 </span>                :<span class="lineNoCov">          0 :       leftPolygon.append( theedge );</span></a>
<a name="1690"><span class="lineNum">    1690 </span>                :<span class="lineNoCov">          0 :     }</span></a>
<a name="1691"><span class="lineNum">    1691 </span>                :<span class="lineNoCov">          0 :     if ( leftiter == crossedEdges.constBegin() )</span></a>
<a name="1692"><span class="lineNum">    1692 </span>                :<span class="lineNoCov">          0 :     {break;}</span></a>
<a name="1693"><span class="lineNum">    1693 </span>                :<span class="lineNoCov">          0 :     --leftiter;</span></a>
<a name="1694"><span class="lineNum">    1694 </span>                :            :   }</a>
<a name="1695"><span class="lineNum">    1695 </span>                :            : </a>
<a name="1696"><span class="lineNum">    1696 </span>                :            :   //insert the last element into leftPolygon</a>
<a name="1697"><span class="lineNum">    1697 </span>                :<span class="lineNoCov">          0 :   leftPolygon.append( mHalfEdge[crossedEdges.first()]-&gt;getNext() );</span></a>
<a name="1698"><span class="lineNum">    1698 </span>                :            : </a>
<a name="1699"><span class="lineNum">    1699 </span>                :            :   //finish the polygon on the right side</a>
<a name="1700"><span class="lineNum">    1700 </span>                :<span class="lineNoCov">          0 :   QList&lt;int&gt;::const_iterator rightiter;</span></a>
<a name="1701"><span class="lineNum">    1701 </span>                :<span class="lineNoCov">          0 :   int actpointr = p1;</span></a>
<a name="1702"><span class="lineNum">    1702 </span>                :<span class="lineNoCov">          0 :   for ( rightiter = crossedEdges.constBegin(); rightiter != crossedEdges.constEnd(); ++rightiter )</span></a>
<a name="1703"><span class="lineNum">    1703 </span>                :            :   {</a>
<a name="1704"><span class="lineNum">    1704 </span>                :<span class="lineNoCov">          0 :     int newpoint = mHalfEdge[mHalfEdge[mHalfEdge[( *rightiter )]-&gt;getNext()]-&gt;getNext()]-&gt;getPoint();</span></a>
<a name="1705"><span class="lineNum">    1705 </span>                :<span class="lineNoCov">          0 :     if ( newpoint != actpointr )</span></a>
<a name="1706"><span class="lineNum">    1706 </span>                :            :     {</a>
<a name="1707"><span class="lineNum">    1707 </span>                :            :       //insert the edge into the right polygon</a>
<a name="1708"><span class="lineNum">    1708 </span>                :<span class="lineNoCov">          0 :       actpointr = newpoint;</span></a>
<a name="1709"><span class="lineNum">    1709 </span>                :<span class="lineNoCov">          0 :       int theedge = mHalfEdge[mHalfEdge[( *rightiter )]-&gt;getNext()]-&gt;getNext();</span></a>
<a name="1710"><span class="lineNum">    1710 </span>                :<span class="lineNoCov">          0 :       rightPolygon.append( theedge );</span></a>
<a name="1711"><span class="lineNum">    1711 </span>                :<span class="lineNoCov">          0 :     }</span></a>
<a name="1712"><span class="lineNum">    1712 </span>                :<span class="lineNoCov">          0 :   }</span></a>
<a name="1713"><span class="lineNum">    1713 </span>                :            : </a>
<a name="1714"><span class="lineNum">    1714 </span>                :            : </a>
<a name="1715"><span class="lineNum">    1715 </span>                :            :   //insert the last element into rightPolygon</a>
<a name="1716"><span class="lineNum">    1716 </span>                :<span class="lineNoCov">          0 :   rightPolygon.append( mHalfEdge[mHalfEdge[crossedEdges.last()]-&gt;getDual()]-&gt;getNext() );</span></a>
<a name="1717"><span class="lineNum">    1717 </span>                :<span class="lineNoCov">          0 :   mHalfEdge[rightPolygon.last()]-&gt;setNext( dualfirstedge );//set 'Next' of the last edge to dualfirstedge</span></a>
<a name="1718"><span class="lineNum">    1718 </span>                :            : </a>
<a name="1719"><span class="lineNum">    1719 </span>                :            :   //set the necessary nexts of leftPolygon(except the first)</a>
<a name="1720"><span class="lineNum">    1720 </span>                :<span class="lineNoCov">          0 :   int actedgel = leftPolygon[1];</span></a>
<a name="1721"><span class="lineNum">    1721 </span>                :<span class="lineNoCov">          0 :   leftiter = leftPolygon.constBegin();</span></a>
<a name="1722"><span class="lineNum">    1722 </span>                :<span class="lineNoCov">          0 :   leftiter += 2;</span></a>
<a name="1723"><span class="lineNum">    1723 </span>                :<span class="lineNoCov">          0 :   for ( ; leftiter != leftPolygon.constEnd(); ++leftiter )</span></a>
<a name="1724"><span class="lineNum">    1724 </span>                :            :   {</a>
<a name="1725"><span class="lineNum">    1725 </span>                :<span class="lineNoCov">          0 :     mHalfEdge[actedgel]-&gt;setNext( ( *leftiter ) );</span></a>
<a name="1726"><span class="lineNum">    1726 </span>                :<span class="lineNoCov">          0 :     actedgel = ( *leftiter );</span></a>
<a name="1727"><span class="lineNum">    1727 </span>                :<span class="lineNoCov">          0 :   }</span></a>
<a name="1728"><span class="lineNum">    1728 </span>                :            : </a>
<a name="1729"><span class="lineNum">    1729 </span>                :            :   //set all the necessary nexts of rightPolygon</a>
<a name="1730"><span class="lineNum">    1730 </span>                :<span class="lineNoCov">          0 :   int actedger = rightPolygon[1];</span></a>
<a name="1731"><span class="lineNum">    1731 </span>                :<span class="lineNoCov">          0 :   rightiter = rightPolygon.constBegin();</span></a>
<a name="1732"><span class="lineNum">    1732 </span>                :<span class="lineNoCov">          0 :   rightiter += 2;</span></a>
<a name="1733"><span class="lineNum">    1733 </span>                :<span class="lineNoCov">          0 :   for ( ; rightiter != rightPolygon.constEnd(); ++rightiter )</span></a>
<a name="1734"><span class="lineNum">    1734 </span>                :            :   {</a>
<a name="1735"><span class="lineNum">    1735 </span>                :<span class="lineNoCov">          0 :     mHalfEdge[actedger]-&gt;setNext( ( *rightiter ) );</span></a>
<a name="1736"><span class="lineNum">    1736 </span>                :<span class="lineNoCov">          0 :     actedger = ( *( rightiter ) );</span></a>
<a name="1737"><span class="lineNum">    1737 </span>                :<span class="lineNoCov">          0 :   }</span></a>
<a name="1738"><span class="lineNum">    1738 </span>                :            : </a>
<a name="1739"><span class="lineNum">    1739 </span>                :            : </a>
<a name="1740"><span class="lineNum">    1740 </span>                :            :   //setNext and setPoint for the forced edge because this would disturb the building of 'leftpoly' and 'rightpoly' otherwise</a>
<a name="1741"><span class="lineNum">    1741 </span>                :<span class="lineNoCov">          0 :   mHalfEdge[leftPolygon.first()]-&gt;setNext( ( *( ++( leftiter = leftPolygon.constBegin() ) ) ) );</span></a>
<a name="1742"><span class="lineNum">    1742 </span>                :<span class="lineNoCov">          0 :   mHalfEdge[leftPolygon.first()]-&gt;setPoint( p2 );</span></a>
<a name="1743"><span class="lineNum">    1743 </span>                :<span class="lineNoCov">          0 :   mHalfEdge[leftPolygon.last()]-&gt;setNext( firstedge );</span></a>
<a name="1744"><span class="lineNum">    1744 </span>                :<span class="lineNoCov">          0 :   mHalfEdge[rightPolygon.first()]-&gt;setNext( ( *( ++( rightiter = rightPolygon.constBegin() ) ) ) );</span></a>
<a name="1745"><span class="lineNum">    1745 </span>                :<span class="lineNoCov">          0 :   mHalfEdge[rightPolygon.first()]-&gt;setPoint( p1 );</span></a>
<a name="1746"><span class="lineNum">    1746 </span>                :<span class="lineNoCov">          0 :   mHalfEdge[rightPolygon.last()]-&gt;setNext( dualfirstedge );</span></a>
<a name="1747"><span class="lineNum">    1747 </span>                :            : </a>
<a name="1748"><span class="lineNum">    1748 </span>                :<span class="lineNoCov">          0 :   triangulatePolygon( &amp;leftPolygon, &amp;freelist, firstedge );</span></a>
<a name="1749"><span class="lineNum">    1749 </span>                :<span class="lineNoCov">          0 :   triangulatePolygon( &amp;rightPolygon, &amp;freelist, dualfirstedge );</span></a>
<a name="1750"><span class="lineNum">    1750 </span>                :            : </a>
<a name="1751"><span class="lineNum">    1751 </span>                :            :   //optimisation of the new edges</a>
<a name="1752"><span class="lineNum">    1752 </span>                :<span class="lineNoCov">          0 :   for ( iter = crossedEdges.constBegin(); iter != crossedEdges.constEnd(); ++iter )</span></a>
<a name="1753"><span class="lineNum">    1753 </span>                :            :   {</a>
<a name="1754"><span class="lineNum">    1754 </span>                :<span class="lineNoCov">          0 :     checkSwapRecursively( ( *( iter ) ), 0 );</span></a>
<a name="1755"><span class="lineNum">    1755 </span>                :<span class="lineNoCov">          0 :   }</span></a>
<a name="1756"><span class="lineNum">    1756 </span>                :            : </a>
<a name="1757"><span class="lineNum">    1757 </span>                :<span class="lineNoCov">          0 :   return leftPolygon.first();</span></a>
<a name="1758"><span class="lineNum">    1758 </span>                :<span class="lineNoCov">          0 : }</span></a>
<a name="1759"><span class="lineNum">    1759 </span>                :            : </a>
<a name="1760"><span class="lineNum">    1760 </span>                :<span class="lineNoCov">          0 : void QgsDualEdgeTriangulation::setForcedCrossBehavior( QgsTriangulation::ForcedCrossBehavior b )</span></a>
<a name="1761"><span class="lineNum">    1761 </span>                :            : {</a>
<a name="1762"><span class="lineNum">    1762 </span>                :<span class="lineNoCov">          0 :   mForcedCrossBehavior = b;</span></a>
<a name="1763"><span class="lineNum">    1763 </span>                :<span class="lineNoCov">          0 : }</span></a>
<a name="1764"><span class="lineNum">    1764 </span>                :            : </a>
<a name="1765"><span class="lineNum">    1765 </span>                :<span class="lineNoCov">          0 : void QgsDualEdgeTriangulation::setTriangleInterpolator( TriangleInterpolator *interpolator )</span></a>
<a name="1766"><span class="lineNum">    1766 </span>                :            : {</a>
<a name="1767"><span class="lineNum">    1767 </span>                :<span class="lineNoCov">          0 :   mTriangleInterpolator = interpolator;</span></a>
<a name="1768"><span class="lineNum">    1768 </span>                :<span class="lineNoCov">          0 : }</span></a>
<a name="1769"><span class="lineNum">    1769 </span>                :            : </a>
<a name="1770"><span class="lineNum">    1770 </span>                :<span class="lineNoCov">          0 : void QgsDualEdgeTriangulation::eliminateHorizontalTriangles()</span></a>
<a name="1771"><span class="lineNum">    1771 </span>                :            : {</a>
<a name="1772"><span class="lineNum">    1772 </span>                :            :   //QgsDebugMsg( QStringLiteral( &quot;am in eliminateHorizontalTriangles&quot; ) );</a>
<a name="1773"><span class="lineNum">    1773 </span>                :<span class="lineNoCov">          0 :   double minangle = 0;//minimum angle for swapped triangles. If triangles generated by a swap would have a minimum angle (in degrees) below that value, the swap will not be done.</span></a>
<a name="1774"><span class="lineNum">    1774 </span>                :            : </a>
<a name="1775"><span class="lineNum">    1775 </span>                :<span class="lineNoCov">          0 :   while ( true )</span></a>
<a name="1776"><span class="lineNum">    1776 </span>                :            :   {</a>
<a name="1777"><span class="lineNum">    1777 </span>                :<span class="lineNoCov">          0 :     bool swapped = false;//flag which allows exiting the loop</span></a>
<a name="1778"><span class="lineNum">    1778 </span>                :<span class="lineNoCov">          0 :     bool *control = new bool[mHalfEdge.count()];//controlarray</span></a>
<a name="1779"><span class="lineNum">    1779 </span>                :            : </a>
<a name="1780"><span class="lineNum">    1780 </span>                :<span class="lineNoCov">          0 :     for ( int i = 0; i &lt;= mHalfEdge.count() - 1; i++ )</span></a>
<a name="1781"><span class="lineNum">    1781 </span>                :            :     {</a>
<a name="1782"><span class="lineNum">    1782 </span>                :<span class="lineNoCov">          0 :       control[i] = false;</span></a>
<a name="1783"><span class="lineNum">    1783 </span>                :<span class="lineNoCov">          0 :     }</span></a>
<a name="1784"><span class="lineNum">    1784 </span>                :            : </a>
<a name="1785"><span class="lineNum">    1785 </span>                :            : </a>
<a name="1786"><span class="lineNum">    1786 </span>                :<span class="lineNoCov">          0 :     for ( int i = 0; i &lt;= mHalfEdge.count() - 1; i++ )</span></a>
<a name="1787"><span class="lineNum">    1787 </span>                :            :     {</a>
<a name="1788"><span class="lineNum">    1788 </span>                :<span class="lineNoCov">          0 :       if ( control[i] )//edge has already been examined</span></a>
<a name="1789"><span class="lineNum">    1789 </span>                :            :       {</a>
<a name="1790"><span class="lineNum">    1790 </span>                :<span class="lineNoCov">          0 :         continue;</span></a>
<a name="1791"><span class="lineNum">    1791 </span>                :            :       }</a>
<a name="1792"><span class="lineNum">    1792 </span>                :            : </a>
<a name="1793"><span class="lineNum">    1793 </span>                :            :       int e1, e2, e3;//numbers of the three edges</a>
<a name="1794"><span class="lineNum">    1794 </span>                :<span class="lineNoCov">          0 :       e1 = i;</span></a>
<a name="1795"><span class="lineNum">    1795 </span>                :<span class="lineNoCov">          0 :       e2 = mHalfEdge[e1]-&gt;getNext();</span></a>
<a name="1796"><span class="lineNum">    1796 </span>                :<span class="lineNoCov">          0 :       e3 = mHalfEdge[e2]-&gt;getNext();</span></a>
<a name="1797"><span class="lineNum">    1797 </span>                :            : </a>
<a name="1798"><span class="lineNum">    1798 </span>                :            :       int p1, p2, p3;//numbers of the three points</a>
<a name="1799"><span class="lineNum">    1799 </span>                :<span class="lineNoCov">          0 :       p1 = mHalfEdge[e1]-&gt;getPoint();</span></a>
<a name="1800"><span class="lineNum">    1800 </span>                :<span class="lineNoCov">          0 :       p2 = mHalfEdge[e2]-&gt;getPoint();</span></a>
<a name="1801"><span class="lineNum">    1801 </span>                :<span class="lineNoCov">          0 :       p3 = mHalfEdge[e3]-&gt;getPoint();</span></a>
<a name="1802"><span class="lineNum">    1802 </span>                :            : </a>
<a name="1803"><span class="lineNum">    1803 </span>                :            :       //skip the iteration, if one point is the virtual point</a>
<a name="1804"><span class="lineNum">    1804 </span>                :<span class="lineNoCov">          0 :       if ( p1 == -1 || p2 == -1 || p3 == -1 )</span></a>
<a name="1805"><span class="lineNum">    1805 </span>                :            :       {</a>
<a name="1806"><span class="lineNum">    1806 </span>                :<span class="lineNoCov">          0 :         control[e1] = true;</span></a>
<a name="1807"><span class="lineNum">    1807 </span>                :<span class="lineNoCov">          0 :         control[e2] = true;</span></a>
<a name="1808"><span class="lineNum">    1808 </span>                :<span class="lineNoCov">          0 :         control[e3] = true;</span></a>
<a name="1809"><span class="lineNum">    1809 </span>                :<span class="lineNoCov">          0 :         continue;</span></a>
<a name="1810"><span class="lineNum">    1810 </span>                :            :       }</a>
<a name="1811"><span class="lineNum">    1811 </span>                :            : </a>
<a name="1812"><span class="lineNum">    1812 </span>                :            :       double el1, el2, el3;//elevations of the points</a>
<a name="1813"><span class="lineNum">    1813 </span>                :<span class="lineNoCov">          0 :       el1 = mPointVector[p1]-&gt;z();</span></a>
<a name="1814"><span class="lineNum">    1814 </span>                :<span class="lineNoCov">          0 :       el2 = mPointVector[p2]-&gt;z();</span></a>
<a name="1815"><span class="lineNum">    1815 </span>                :<span class="lineNoCov">          0 :       el3 = mPointVector[p3]-&gt;z();</span></a>
<a name="1816"><span class="lineNum">    1816 </span>                :            : </a>
<a name="1817"><span class="lineNum">    1817 </span>                :<span class="lineNoCov">          0 :       if ( el1 == el2 &amp;&amp; el2 == el3 )//we found a horizontal triangle</span></a>
<a name="1818"><span class="lineNum">    1818 </span>                :            :       {</a>
<a name="1819"><span class="lineNum">    1819 </span>                :            :         //swap edges if it is possible, if it would remove the horizontal triangle and if the minimum angle generated by the swap is high enough</a>
<a name="1820"><span class="lineNum">    1820 </span>                :<span class="lineNoCov">          0 :         if ( swapPossible( ( uint )e1 ) &amp;&amp; mPointVector[mHalfEdge[mHalfEdge[mHalfEdge[e1]-&gt;getDual()]-&gt;getNext()]-&gt;getPoint()]-&gt;z() != el1 &amp;&amp; swapMinAngle( e1 ) &gt; minangle )</span></a>
<a name="1821"><span class="lineNum">    1821 </span>                :            :         {</a>
<a name="1822"><span class="lineNum">    1822 </span>                :<span class="lineNoCov">          0 :           doOnlySwap( ( uint )e1 );</span></a>
<a name="1823"><span class="lineNum">    1823 </span>                :<span class="lineNoCov">          0 :           swapped = true;</span></a>
<a name="1824"><span class="lineNum">    1824 </span>                :<span class="lineNoCov">          0 :         }</span></a>
<a name="1825"><span class="lineNum">    1825 </span>                :<span class="lineNoCov">          0 :         else if ( swapPossible( ( uint )e2 ) &amp;&amp; mPointVector[mHalfEdge[mHalfEdge[mHalfEdge[e2]-&gt;getDual()]-&gt;getNext()]-&gt;getPoint()]-&gt;z() != el2 &amp;&amp; swapMinAngle( e2 ) &gt; minangle )</span></a>
<a name="1826"><span class="lineNum">    1826 </span>                :            :         {</a>
<a name="1827"><span class="lineNum">    1827 </span>                :<span class="lineNoCov">          0 :           doOnlySwap( ( uint )e2 );</span></a>
<a name="1828"><span class="lineNum">    1828 </span>                :<span class="lineNoCov">          0 :           swapped = true;</span></a>
<a name="1829"><span class="lineNum">    1829 </span>                :<span class="lineNoCov">          0 :         }</span></a>
<a name="1830"><span class="lineNum">    1830 </span>                :<span class="lineNoCov">          0 :         else if ( swapPossible( ( uint )e3 ) &amp;&amp; mPointVector[mHalfEdge[mHalfEdge[mHalfEdge[e3]-&gt;getDual()]-&gt;getNext()]-&gt;getPoint()]-&gt;z() != el3 &amp;&amp; swapMinAngle( e3 ) &gt; minangle )</span></a>
<a name="1831"><span class="lineNum">    1831 </span>                :            :         {</a>
<a name="1832"><span class="lineNum">    1832 </span>                :<span class="lineNoCov">          0 :           doOnlySwap( ( uint )e3 );</span></a>
<a name="1833"><span class="lineNum">    1833 </span>                :<span class="lineNoCov">          0 :           swapped = true;</span></a>
<a name="1834"><span class="lineNum">    1834 </span>                :<span class="lineNoCov">          0 :         }</span></a>
<a name="1835"><span class="lineNum">    1835 </span>                :<span class="lineNoCov">          0 :         control[e1] = true;</span></a>
<a name="1836"><span class="lineNum">    1836 </span>                :<span class="lineNoCov">          0 :         control[e2] = true;</span></a>
<a name="1837"><span class="lineNum">    1837 </span>                :<span class="lineNoCov">          0 :         control[e3] = true;</span></a>
<a name="1838"><span class="lineNum">    1838 </span>                :<span class="lineNoCov">          0 :         continue;</span></a>
<a name="1839"><span class="lineNum">    1839 </span>                :            :       }</a>
<a name="1840"><span class="lineNum">    1840 </span>                :            :       else//no horizontal triangle, go to the next one</a>
<a name="1841"><span class="lineNum">    1841 </span>                :            :       {</a>
<a name="1842"><span class="lineNum">    1842 </span>                :<span class="lineNoCov">          0 :         control[e1] = true;</span></a>
<a name="1843"><span class="lineNum">    1843 </span>                :<span class="lineNoCov">          0 :         control[e2] = true;</span></a>
<a name="1844"><span class="lineNum">    1844 </span>                :<span class="lineNoCov">          0 :         control[e3] = true;</span></a>
<a name="1845"><span class="lineNum">    1845 </span>                :<span class="lineNoCov">          0 :         continue;</span></a>
<a name="1846"><span class="lineNum">    1846 </span>                :            :       }</a>
<a name="1847"><span class="lineNum">    1847 </span>                :            :     }</a>
<a name="1848"><span class="lineNum">    1848 </span>                :<span class="lineNoCov">          0 :     if ( !swapped )</span></a>
<a name="1849"><span class="lineNum">    1849 </span>                :            :     {</a>
<a name="1850"><span class="lineNum">    1850 </span>                :<span class="lineNoCov">          0 :       delete[] control;</span></a>
<a name="1851"><span class="lineNum">    1851 </span>                :<span class="lineNoCov">          0 :       break;</span></a>
<a name="1852"><span class="lineNum">    1852 </span>                :            :     }</a>
<a name="1853"><span class="lineNum">    1853 </span>                :<span class="lineNoCov">          0 :     delete[] control;</span></a>
<a name="1854"><span class="lineNum">    1854 </span>                :            :   }</a>
<a name="1855"><span class="lineNum">    1855 </span>                :            : </a>
<a name="1856"><span class="lineNum">    1856 </span>                :            :   //QgsDebugMsg( QStringLiteral( &quot;end of method&quot; ) );</a>
<a name="1857"><span class="lineNum">    1857 </span>                :<span class="lineNoCov">          0 : }</span></a>
<a name="1858"><span class="lineNum">    1858 </span>                :            : </a>
<a name="1859"><span class="lineNum">    1859 </span>                :<span class="lineNoCov">          0 : void QgsDualEdgeTriangulation::ruppertRefinement()</span></a>
<a name="1860"><span class="lineNum">    1860 </span>                :            : {</a>
<a name="1861"><span class="lineNum">    1861 </span>                :            :   //minimum angle</a>
<a name="1862"><span class="lineNum">    1862 </span>                :<span class="lineNoCov">          0 :   double mintol = 17;//refinement stops after the minimum angle reached this tolerance</span></a>
<a name="1863"><span class="lineNum">    1863 </span>                :            : </a>
<a name="1864"><span class="lineNum">    1864 </span>                :            :   //data structures</a>
<a name="1865"><span class="lineNum">    1865 </span>                :<span class="lineNoCov">          0 :   std::map&lt;int, double&gt; edge_angle;//search tree with the edge number as key</span></a>
<a name="1866"><span class="lineNum">    1866 </span>                :<span class="lineNoCov">          0 :   std::multimap&lt;double, int&gt; angle_edge;//multimap (map with not unique keys) with angle as key</span></a>
<a name="1867"><span class="lineNum">    1867 </span>                :<span class="lineNoCov">          0 :   QSet&lt;int&gt; dontexamine;//search tree containing the edges which do not have to be examined (because of numerical problems)</span></a>
<a name="1868"><span class="lineNum">    1868 </span>                :            : </a>
<a name="1869"><span class="lineNum">    1869 </span>                :            : </a>
<a name="1870"><span class="lineNum">    1870 </span>                :            :   //first, go through all the forced edges and subdivide if they are encroached by a point</a>
<a name="1871"><span class="lineNum">    1871 </span>                :<span class="lineNoCov">          0 :   bool stop = false;//flag to ensure that the for-loop is repeated until no half edge is split any more</span></a>
<a name="1872"><span class="lineNum">    1872 </span>                :            : </a>
<a name="1873"><span class="lineNum">    1873 </span>                :<span class="lineNoCov">          0 :   while ( !stop )</span></a>
<a name="1874"><span class="lineNum">    1874 </span>                :            :   {</a>
<a name="1875"><span class="lineNum">    1875 </span>                :<span class="lineNoCov">          0 :     stop = true;</span></a>
<a name="1876"><span class="lineNum">    1876 </span>                :<span class="lineNoCov">          0 :     int nhalfedges = mHalfEdge.count();</span></a>
<a name="1877"><span class="lineNum">    1877 </span>                :            : </a>
<a name="1878"><span class="lineNum">    1878 </span>                :<span class="lineNoCov">          0 :     for ( int i = 0; i &lt; nhalfedges - 1; i++ )</span></a>
<a name="1879"><span class="lineNum">    1879 </span>                :            :     {</a>
<a name="1880"><span class="lineNum">    1880 </span>                :<span class="lineNoCov">          0 :       int next = mHalfEdge[i]-&gt;getNext();</span></a>
<a name="1881"><span class="lineNum">    1881 </span>                :<span class="lineNoCov">          0 :       int nextnext = mHalfEdge[next]-&gt;getNext();</span></a>
<a name="1882"><span class="lineNum">    1882 </span>                :            : </a>
<a name="1883"><span class="lineNum">    1883 </span>                :<span class="lineNoCov">          0 :       if ( mHalfEdge[next]-&gt;getPoint() != -1 &amp;&amp; ( mHalfEdge[i]-&gt;getForced() || mHalfEdge[mHalfEdge[mHalfEdge[i]-&gt;getDual()]-&gt;getNext()]-&gt;getPoint() == -1 ) )//check for encroached points on forced segments and segments on the inner side of the convex hull, but don't consider edges on the outer side of the convex hull</span></a>
<a name="1884"><span class="lineNum">    1884 </span>                :            :       {</a>
<a name="1885"><span class="lineNum">    1885 </span>                :<span class="lineNoCov">          0 :         if ( !( ( mHalfEdge[next]-&gt;getForced() || edgeOnConvexHull( next ) ) || ( mHalfEdge[nextnext]-&gt;getForced() || edgeOnConvexHull( nextnext ) ) ) ) //don't consider triangles where all three edges are forced edges or hull edges</span></a>
<a name="1886"><span class="lineNum">    1886 </span>                :            :         {</a>
<a name="1887"><span class="lineNum">    1887 </span>                :            :           //test for encroachment</a>
<a name="1888"><span class="lineNum">    1888 </span>                :<span class="lineNoCov">          0 :           while ( MathUtils::inDiametral( mPointVector[mHalfEdge[mHalfEdge[i]-&gt;getDual()]-&gt;getPoint()], mPointVector[mHalfEdge[i]-&gt;getPoint()], mPointVector[mHalfEdge[next]-&gt;getPoint()] ) )</span></a>
<a name="1889"><span class="lineNum">    1889 </span>                :            :           {</a>
<a name="1890"><span class="lineNum">    1890 </span>                :            :             //split segment</a>
<a name="1891"><span class="lineNum">    1891 </span>                :<span class="lineNoCov">          0 :             int pointno = splitHalfEdge( i, 0.5 );</span></a>
<a name="1892"><span class="lineNum">    1892 </span>                :            :             Q_UNUSED( pointno )</a>
<a name="1893"><span class="lineNum">    1893 </span>                :<span class="lineNoCov">          0 :             stop = false;</span></a>
<a name="1894"><span class="lineNum">    1894 </span>                :            :           }</a>
<a name="1895"><span class="lineNum">    1895 </span>                :<span class="lineNoCov">          0 :         }</span></a>
<a name="1896"><span class="lineNum">    1896 </span>                :<span class="lineNoCov">          0 :       }</span></a>
<a name="1897"><span class="lineNum">    1897 </span>                :<span class="lineNoCov">          0 :     }</span></a>
<a name="1898"><span class="lineNum">    1898 </span>                :            :   }</a>
<a name="1899"><span class="lineNum">    1899 </span>                :            : </a>
<a name="1900"><span class="lineNum">    1900 </span>                :            :   //examine the triangulation for angles below the minimum and insert the edges into angle_edge and edge_angle, except the small angle is between forced segments or convex hull edges</a>
<a name="1901"><span class="lineNum">    1901 </span>                :            :   double angle;//angle between edge i and the consecutive edge</a>
<a name="1902"><span class="lineNum">    1902 </span>                :            :   int p1, p2, p3;//numbers of the triangle points</a>
<a name="1903"><span class="lineNum">    1903 </span>                :<span class="lineNoCov">          0 :   for ( int i = 0; i &lt; mHalfEdge.count() - 1; i++ )</span></a>
<a name="1904"><span class="lineNum">    1904 </span>                :            :   {</a>
<a name="1905"><span class="lineNum">    1905 </span>                :<span class="lineNoCov">          0 :     p1 = mHalfEdge[mHalfEdge[i]-&gt;getDual()]-&gt;getPoint();</span></a>
<a name="1906"><span class="lineNum">    1906 </span>                :<span class="lineNoCov">          0 :     p2 = mHalfEdge[i]-&gt;getPoint();</span></a>
<a name="1907"><span class="lineNum">    1907 </span>                :<span class="lineNoCov">          0 :     p3 = mHalfEdge[mHalfEdge[i]-&gt;getNext()]-&gt;getPoint();</span></a>
<a name="1908"><span class="lineNum">    1908 </span>                :            : </a>
<a name="1909"><span class="lineNum">    1909 </span>                :<span class="lineNoCov">          0 :     if ( p1 == -1 || p2 == -1 || p3 == -1 )//don't consider triangles with the virtual point</span></a>
<a name="1910"><span class="lineNum">    1910 </span>                :            :     {</a>
<a name="1911"><span class="lineNum">    1911 </span>                :<span class="lineNoCov">          0 :       continue;</span></a>
<a name="1912"><span class="lineNum">    1912 </span>                :            :     }</a>
<a name="1913"><span class="lineNum">    1913 </span>                :<span class="lineNoCov">          0 :     angle = MathUtils::angle( mPointVector[p1], mPointVector[p2], mPointVector[p3], mPointVector[p2] );</span></a>
<a name="1914"><span class="lineNum">    1914 </span>                :            : </a>
<a name="1915"><span class="lineNum">    1915 </span>                :            :     bool twoforcededges;//flag to decide, if edges should be added to the maps. Do not add them if true</a>
<a name="1916"><span class="lineNum">    1916 </span>                :            : </a>
<a name="1917"><span class="lineNum">    1917 </span>                :            : </a>
<a name="1918"><span class="lineNum">    1918 </span>                :<span class="lineNoCov">          0 :     twoforcededges = ( mHalfEdge[i]-&gt;getForced() || edgeOnConvexHull( i ) ) &amp;&amp; ( mHalfEdge[mHalfEdge[i]-&gt;getNext()]-&gt;getForced() || edgeOnConvexHull( mHalfEdge[i]-&gt;getNext() ) );</span></a>
<a name="1919"><span class="lineNum">    1919 </span>                :            : </a>
<a name="1920"><span class="lineNum">    1920 </span>                :<span class="lineNoCov">          0 :     if ( angle &lt; mintol &amp;&amp; !twoforcededges )</span></a>
<a name="1921"><span class="lineNum">    1921 </span>                :            :     {</a>
<a name="1922"><span class="lineNum">    1922 </span>                :<span class="lineNoCov">          0 :       edge_angle.insert( std::make_pair( i, angle ) );</span></a>
<a name="1923"><span class="lineNum">    1923 </span>                :<span class="lineNoCov">          0 :       angle_edge.insert( std::make_pair( angle, i ) );</span></a>
<a name="1924"><span class="lineNum">    1924 </span>                :<span class="lineNoCov">          0 :     }</span></a>
<a name="1925"><span class="lineNum">    1925 </span>                :<span class="lineNoCov">          0 :   }</span></a>
<a name="1926"><span class="lineNum">    1926 </span>                :            : </a>
<a name="1927"><span class="lineNum">    1927 </span>                :            :   //debugging: print out all the angles below the minimum for a test</a>
<a name="1928"><span class="lineNum">    1928 </span>                :<span class="lineNoCov">          0 :   for ( std::multimap&lt;double, int&gt;::const_iterator it = angle_edge.begin(); it != angle_edge.end(); ++it )</span></a>
<a name="1929"><span class="lineNum">    1929 </span>                :            :   {</a>
<a name="1930"><span class="lineNum">    1930 </span>                :<span class="lineNoCov">          0 :     QgsDebugMsg( QStringLiteral( &quot;angle: %1&quot; ).arg( it-&gt;first ) );</span></a>
<a name="1931"><span class="lineNum">    1931 </span>                :<span class="lineNoCov">          0 :   }</span></a>
<a name="1932"><span class="lineNum">    1932 </span>                :            : </a>
<a name="1933"><span class="lineNum">    1933 </span>                :            : </a>
<a name="1934"><span class="lineNum">    1934 </span>                :<span class="lineNoCov">          0 :   double minangle = 0;//actual minimum angle</span></a>
<a name="1935"><span class="lineNum">    1935 </span>                :            :   int minedge;//first edge adjacent to the minimum angle</a>
<a name="1936"><span class="lineNum">    1936 </span>                :            :   int minedgenext;</a>
<a name="1937"><span class="lineNum">    1937 </span>                :            :   int minedgenextnext;</a>
<a name="1938"><span class="lineNum">    1938 </span>                :            : </a>
<a name="1939"><span class="lineNum">    1939 </span>                :<span class="lineNoCov">          0 :   QgsPoint circumcenter( 0, 0, 0 );</span></a>
<a name="1940"><span class="lineNum">    1940 </span>                :            : </a>
<a name="1941"><span class="lineNum">    1941 </span>                :<span class="lineNoCov">          0 :   while ( !edge_angle.empty() )</span></a>
<a name="1942"><span class="lineNum">    1942 </span>                :            :   {</a>
<a name="1943"><span class="lineNum">    1943 </span>                :<span class="lineNoCov">          0 :     minangle = angle_edge.begin()-&gt;first;</span></a>
<a name="1944"><span class="lineNum">    1944 </span>                :<span class="lineNoCov">          0 :     QgsDebugMsg( QStringLiteral( &quot;minangle: %1&quot; ).arg( minangle ) );</span></a>
<a name="1945"><span class="lineNum">    1945 </span>                :<span class="lineNoCov">          0 :     minedge = angle_edge.begin()-&gt;second;</span></a>
<a name="1946"><span class="lineNum">    1946 </span>                :<span class="lineNoCov">          0 :     minedgenext = mHalfEdge[minedge]-&gt;getNext();</span></a>
<a name="1947"><span class="lineNum">    1947 </span>                :<span class="lineNoCov">          0 :     minedgenextnext = mHalfEdge[minedgenext]-&gt;getNext();</span></a>
<a name="1948"><span class="lineNum">    1948 </span>                :            : </a>
<a name="1949"><span class="lineNum">    1949 </span>                :            :     //calculate the circumcenter</a>
<a name="1950"><span class="lineNum">    1950 </span>                :<span class="lineNoCov">          0 :     if ( !MathUtils::circumcenter( mPointVector[mHalfEdge[minedge]-&gt;getPoint()], mPointVector[mHalfEdge[minedgenext]-&gt;getPoint()], mPointVector[mHalfEdge[minedgenextnext]-&gt;getPoint()], &amp;circumcenter ) )</span></a>
<a name="1951"><span class="lineNum">    1951 </span>                :            :     {</a>
<a name="1952"><span class="lineNum">    1952 </span>                :<span class="lineNoCov">          0 :       QgsDebugMsg( QStringLiteral( &quot;warning, calculation of circumcenter failed&quot; ) );</span></a>
<a name="1953"><span class="lineNum">    1953 </span>                :            :       //put all three edges to dontexamine and remove them from the other maps</a>
<a name="1954"><span class="lineNum">    1954 </span>                :<span class="lineNoCov">          0 :       dontexamine.insert( minedge );</span></a>
<a name="1955"><span class="lineNum">    1955 </span>                :<span class="lineNoCov">          0 :       edge_angle.erase( minedge );</span></a>
<a name="1956"><span class="lineNum">    1956 </span>                :<span class="lineNoCov">          0 :       std::multimap&lt;double, int&gt;::iterator minedgeiter = angle_edge.find( minangle );</span></a>
<a name="1957"><span class="lineNum">    1957 </span>                :<span class="lineNoCov">          0 :       while ( minedgeiter-&gt;second != minedge )</span></a>
<a name="1958"><span class="lineNum">    1958 </span>                :            :       {</a>
<a name="1959"><span class="lineNum">    1959 </span>                :<span class="lineNoCov">          0 :         ++minedgeiter;</span></a>
<a name="1960"><span class="lineNum">    1960 </span>                :            :       }</a>
<a name="1961"><span class="lineNum">    1961 </span>                :<span class="lineNoCov">          0 :       angle_edge.erase( minedgeiter );</span></a>
<a name="1962"><span class="lineNum">    1962 </span>                :<span class="lineNoCov">          0 :       continue;</span></a>
<a name="1963"><span class="lineNum">    1963 </span>                :            :     }</a>
<a name="1964"><span class="lineNum">    1964 </span>                :            : </a>
<a name="1965"><span class="lineNum">    1965 </span>                :<span class="lineNoCov">          0 :     if ( !pointInside( circumcenter.x(), circumcenter.y() ) )</span></a>
<a name="1966"><span class="lineNum">    1966 </span>                :            :     {</a>
<a name="1967"><span class="lineNum">    1967 </span>                :            :       //put all three edges to dontexamine and remove them from the other maps</a>
<a name="1968"><span class="lineNum">    1968 </span>                :<span class="lineNoCov">          0 :       QgsDebugMsg( QStringLiteral( &quot;put circumcenter %1//%2 on dontexamine list because it is outside the convex hull&quot; )</span></a>
<a name="1969"><span class="lineNum">    1969 </span>                :            :                    .arg( circumcenter.x() ).arg( circumcenter.y() ) );</a>
<a name="1970"><span class="lineNum">    1970 </span>                :<span class="lineNoCov">          0 :       dontexamine.insert( minedge );</span></a>
<a name="1971"><span class="lineNum">    1971 </span>                :<span class="lineNoCov">          0 :       edge_angle.erase( minedge );</span></a>
<a name="1972"><span class="lineNum">    1972 </span>                :<span class="lineNoCov">          0 :       std::multimap&lt;double, int&gt;::iterator minedgeiter = angle_edge.find( minangle );</span></a>
<a name="1973"><span class="lineNum">    1973 </span>                :<span class="lineNoCov">          0 :       while ( minedgeiter-&gt;second != minedge )</span></a>
<a name="1974"><span class="lineNum">    1974 </span>                :            :       {</a>
<a name="1975"><span class="lineNum">    1975 </span>                :<span class="lineNoCov">          0 :         ++minedgeiter;</span></a>
<a name="1976"><span class="lineNum">    1976 </span>                :            :       }</a>
<a name="1977"><span class="lineNum">    1977 </span>                :<span class="lineNoCov">          0 :       angle_edge.erase( minedgeiter );</span></a>
<a name="1978"><span class="lineNum">    1978 </span>                :<span class="lineNoCov">          0 :       continue;</span></a>
<a name="1979"><span class="lineNum">    1979 </span>                :            :     }</a>
<a name="1980"><span class="lineNum">    1980 </span>                :            : </a>
<a name="1981"><span class="lineNum">    1981 </span>                :            :     /*******find out, if any forced segment or convex hull segment is in the influence region of the circumcenter. In this case, split the segment********************/</a>
<a name="1982"><span class="lineNum">    1982 </span>                :            : </a>
<a name="1983"><span class="lineNum">    1983 </span>                :<span class="lineNoCov">          0 :     bool encroached = false;</span></a>
<a name="1984"><span class="lineNum">    1984 </span>                :            : </a>
<a name="1985"><span class="lineNum">    1985 </span>                :            : #if 0 //slow version</a>
<a name="1986"><span class="lineNum">    1986 </span>                :            :     int numhalfedges = mHalfEdge.count();//begin slow version</a>
<a name="1987"><span class="lineNum">    1987 </span>                :            :     for ( int i = 0; i &lt; numhalfedges; i++ )</a>
<a name="1988"><span class="lineNum">    1988 </span>                :            :     {</a>
<a name="1989"><span class="lineNum">    1989 </span>                :            :       if ( mHalfEdge[i]-&gt;getForced() || edgeOnConvexHull( i ) )</a>
<a name="1990"><span class="lineNum">    1990 </span>                :            :       {</a>
<a name="1991"><span class="lineNum">    1991 </span>                :            :         if ( MathUtils::inDiametral( mPointVector[mHalfEdge[i]-&gt;getPoint()], mPointVector[mHalfEdge[mHalfEdge[i]-&gt;getDual()]-&gt;getPoint()], &amp;circumcenter ) )</a>
<a name="1992"><span class="lineNum">    1992 </span>                :            :         {</a>
<a name="1993"><span class="lineNum">    1993 </span>                :            :           encroached = true;</a>
<a name="1994"><span class="lineNum">    1994 </span>                :            :           //split segment</a>
<a name="1995"><span class="lineNum">    1995 </span>                :            :           QgsDebugMsg( QStringLiteral( &quot;segment split&quot; ) );</a>
<a name="1996"><span class="lineNum">    1996 </span>                :            :           int pointno = splitHalfEdge( i, 0.5 );</a>
<a name="1997"><span class="lineNum">    1997 </span>                :            : </a>
<a name="1998"><span class="lineNum">    1998 </span>                :            :           //update dontexmine, angle_edge, edge_angle</a>
<a name="1999"><span class="lineNum">    1999 </span>                :            :           int pointingedge = baseEdgeOfPoint( pointno );</a>
<a name="2000"><span class="lineNum">    2000 </span>                :            : </a>
<a name="2001"><span class="lineNum">    2001 </span>                :            :           int actedge = pointingedge;</a>
<a name="2002"><span class="lineNum">    2002 </span>                :            :           int ed1, ed2, ed3;//numbers of the three edges</a>
<a name="2003"><span class="lineNum">    2003 </span>                :            :           int pt1, pt2, pt3;//numbers of the three points</a>
<a name="2004"><span class="lineNum">    2004 </span>                :            :           double angle1, angle2, angle3;</a>
<a name="2005"><span class="lineNum">    2005 </span>                :            : </a>
<a name="2006"><span class="lineNum">    2006 </span>                :            :           do</a>
<a name="2007"><span class="lineNum">    2007 </span>                :            :           {</a>
<a name="2008"><span class="lineNum">    2008 </span>                :            :             ed1 = mHalfEdge[actedge]-&gt;getDual();</a>
<a name="2009"><span class="lineNum">    2009 </span>                :            :             pt1 = mHalfEdge[ed1]-&gt;getPoint();</a>
<a name="2010"><span class="lineNum">    2010 </span>                :            :             ed2 = mHalfEdge[ed1]-&gt;getNext();</a>
<a name="2011"><span class="lineNum">    2011 </span>                :            :             pt2 = mHalfEdge[ed2]-&gt;getPoint();</a>
<a name="2012"><span class="lineNum">    2012 </span>                :            :             ed3 = mHalfEdge[ed2]-&gt;getNext();</a>
<a name="2013"><span class="lineNum">    2013 </span>                :            :             pt3 = mHalfEdge[ed3]-&gt;getPoint();</a>
<a name="2014"><span class="lineNum">    2014 </span>                :            :             actedge = ed3;</a>
<a name="2015"><span class="lineNum">    2015 </span>                :            : </a>
<a name="2016"><span class="lineNum">    2016 </span>                :            :             if ( pt1 == -1 || pt2 == -1 || pt3 == -1 )//don't consider triangles with the virtual point</a>
<a name="2017"><span class="lineNum">    2017 </span>                :            :             {</a>
<a name="2018"><span class="lineNum">    2018 </span>                :            :               continue;</a>
<a name="2019"><span class="lineNum">    2019 </span>                :            :             }</a>
<a name="2020"><span class="lineNum">    2020 </span>                :            : </a>
<a name="2021"><span class="lineNum">    2021 </span>                :            :             angle1 = MathUtils::angle( mPointVector[pt3], mPointVector[pt1], mPointVector[pt2], mPointVector[pt1] );</a>
<a name="2022"><span class="lineNum">    2022 </span>                :            :             angle2 = MathUtils::angle( mPointVector[pt1], mPointVector[pt2], mPointVector[pt3], mPointVector[pt2] );</a>
<a name="2023"><span class="lineNum">    2023 </span>                :            :             angle3 = MathUtils::angle( mPointVector[pt2], mPointVector[pt3], mPointVector[pt1], mPointVector[pt3] );</a>
<a name="2024"><span class="lineNum">    2024 </span>                :            : </a>
<a name="2025"><span class="lineNum">    2025 </span>                :            :             //don't put the edges on the maps if two segments are forced or on a hull</a>
<a name="2026"><span class="lineNum">    2026 </span>                :            :             bool twoforcededges1, twoforcededges2, twoforcededges3;//flag to indicate, if angle1, angle2 and angle3 are between forced edges or hull edges</a>
<a name="2027"><span class="lineNum">    2027 </span>                :            : </a>
<a name="2028"><span class="lineNum">    2028 </span>                :            :             if ( ( mHalfEdge[ed1]-&gt;getForced() || edgeOnConvexHull( ed1 ) ) &amp;&amp; ( mHalfEdge[ed2]-&gt;getForced() || edgeOnConvexHull( ed2 ) ) )</a>
<a name="2029"><span class="lineNum">    2029 </span>                :            :             {</a>
<a name="2030"><span class="lineNum">    2030 </span>                :            :               twoforcededges1 = true;</a>
<a name="2031"><span class="lineNum">    2031 </span>                :            :             }</a>
<a name="2032"><span class="lineNum">    2032 </span>                :            :             else</a>
<a name="2033"><span class="lineNum">    2033 </span>                :            :             {</a>
<a name="2034"><span class="lineNum">    2034 </span>                :            :               twoforcededges1 = false;</a>
<a name="2035"><span class="lineNum">    2035 </span>                :            :             }</a>
<a name="2036"><span class="lineNum">    2036 </span>                :            : </a>
<a name="2037"><span class="lineNum">    2037 </span>                :            :             if ( ( mHalfEdge[ed2]-&gt;getForced() || edgeOnConvexHull( ed2 ) ) &amp;&amp; ( mHalfEdge[ed3]-&gt;getForced() || edgeOnConvexHull( ed3 ) ) )</a>
<a name="2038"><span class="lineNum">    2038 </span>                :            :             {</a>
<a name="2039"><span class="lineNum">    2039 </span>                :            :               twoforcededges2 = true;</a>
<a name="2040"><span class="lineNum">    2040 </span>                :            :             }</a>
<a name="2041"><span class="lineNum">    2041 </span>                :            :             else</a>
<a name="2042"><span class="lineNum">    2042 </span>                :            :             {</a>
<a name="2043"><span class="lineNum">    2043 </span>                :            :               twoforcededges2 = false;</a>
<a name="2044"><span class="lineNum">    2044 </span>                :            :             }</a>
<a name="2045"><span class="lineNum">    2045 </span>                :            : </a>
<a name="2046"><span class="lineNum">    2046 </span>                :            :             if ( ( mHalfEdge[ed3]-&gt;getForced() || edgeOnConvexHull( ed3 ) ) &amp;&amp; ( mHalfEdge[ed1]-&gt;getForced() || edgeOnConvexHull( ed1 ) ) )</a>
<a name="2047"><span class="lineNum">    2047 </span>                :            :             {</a>
<a name="2048"><span class="lineNum">    2048 </span>                :            :               twoforcededges3 = true;</a>
<a name="2049"><span class="lineNum">    2049 </span>                :            :             }</a>
<a name="2050"><span class="lineNum">    2050 </span>                :            :             else</a>
<a name="2051"><span class="lineNum">    2051 </span>                :            :             {</a>
<a name="2052"><span class="lineNum">    2052 </span>                :            :               twoforcededges3 = false;</a>
<a name="2053"><span class="lineNum">    2053 </span>                :            :             }</a>
<a name="2054"><span class="lineNum">    2054 </span>                :            : </a>
<a name="2055"><span class="lineNum">    2055 </span>                :            :             //update the settings related to ed1</a>
<a name="2056"><span class="lineNum">    2056 </span>                :            :             QSet&lt;int&gt;::iterator ed1iter = dontexamine.find( ed1 );</a>
<a name="2057"><span class="lineNum">    2057 </span>                :            :             if ( ed1iter != dontexamine.end() )</a>
<a name="2058"><span class="lineNum">    2058 </span>                :            :             {</a>
<a name="2059"><span class="lineNum">    2059 </span>                :            :               //edge number is on dontexamine list</a>
<a name="2060"><span class="lineNum">    2060 </span>                :            :               dontexamine.erase( ed1iter );</a>
<a name="2061"><span class="lineNum">    2061 </span>                :            :             }</a>
<a name="2062"><span class="lineNum">    2062 </span>                :            :             else</a>
<a name="2063"><span class="lineNum">    2063 </span>                :            :             {</a>
<a name="2064"><span class="lineNum">    2064 </span>                :            :               //test, if it is on edge_angle and angle_edge and erase them if yes</a>
<a name="2065"><span class="lineNum">    2065 </span>                :            :               std::map&lt;int, double&gt;::iterator tempit1;</a>
<a name="2066"><span class="lineNum">    2066 </span>                :            :               tempit1 = edge_angle.find( ed1 );</a>
<a name="2067"><span class="lineNum">    2067 </span>                :            :               if ( tempit1 != edge_angle.end() )</a>
<a name="2068"><span class="lineNum">    2068 </span>                :            :               {</a>
<a name="2069"><span class="lineNum">    2069 </span>                :            :                 //erase the entries</a>
<a name="2070"><span class="lineNum">    2070 </span>                :            :                 double angle = tempit1-&gt;second;</a>
<a name="2071"><span class="lineNum">    2071 </span>                :            :                 edge_angle.erase( ed1 );</a>
<a name="2072"><span class="lineNum">    2072 </span>                :            :                 std::multimap&lt;double, int&gt;::iterator tempit2 = angle_edge.lower_bound( angle );</a>
<a name="2073"><span class="lineNum">    2073 </span>                :            :                 while ( tempit2-&gt;second != ed1 )</a>
<a name="2074"><span class="lineNum">    2074 </span>                :            :                 {</a>
<a name="2075"><span class="lineNum">    2075 </span>                :            :                   ++tempit2;</a>
<a name="2076"><span class="lineNum">    2076 </span>                :            :                 }</a>
<a name="2077"><span class="lineNum">    2077 </span>                :            :                 angle_edge.erase( tempit2 );</a>
<a name="2078"><span class="lineNum">    2078 </span>                :            :               }</a>
<a name="2079"><span class="lineNum">    2079 </span>                :            :             }</a>
<a name="2080"><span class="lineNum">    2080 </span>                :            : </a>
<a name="2081"><span class="lineNum">    2081 </span>                :            :             if ( angle1 &lt; mintol &amp;&amp; !twoforcededges1 )</a>
<a name="2082"><span class="lineNum">    2082 </span>                :            :             {</a>
<a name="2083"><span class="lineNum">    2083 </span>                :            :               edge_angle.insert( std::make_pair( ed1, angle1 ) );</a>
<a name="2084"><span class="lineNum">    2084 </span>                :            :               angle_edge.insert( std::make_pair( angle1, ed1 ) );</a>
<a name="2085"><span class="lineNum">    2085 </span>                :            :             }</a>
<a name="2086"><span class="lineNum">    2086 </span>                :            : </a>
<a name="2087"><span class="lineNum">    2087 </span>                :            :             //update the settings related to ed2</a>
<a name="2088"><span class="lineNum">    2088 </span>                :            :             QSet&lt;int&gt;::iterator ed2iter = dontexamine.find( ed2 );</a>
<a name="2089"><span class="lineNum">    2089 </span>                :            :             if ( ed2iter != dontexamine.end() )</a>
<a name="2090"><span class="lineNum">    2090 </span>                :            :             {</a>
<a name="2091"><span class="lineNum">    2091 </span>                :            :               //edge number is on dontexamine list</a>
<a name="2092"><span class="lineNum">    2092 </span>                :            :               dontexamine.erase( ed2iter );</a>
<a name="2093"><span class="lineNum">    2093 </span>                :            :             }</a>
<a name="2094"><span class="lineNum">    2094 </span>                :            :             else</a>
<a name="2095"><span class="lineNum">    2095 </span>                :            :             {</a>
<a name="2096"><span class="lineNum">    2096 </span>                :            :               //test, if it is on edge_angle and angle_edge and erase them if yes</a>
<a name="2097"><span class="lineNum">    2097 </span>                :            :               std::map&lt;int, double&gt;::iterator tempit1;</a>
<a name="2098"><span class="lineNum">    2098 </span>                :            :               tempit1 = edge_angle.find( ed2 );</a>
<a name="2099"><span class="lineNum">    2099 </span>                :            :               if ( tempit1 != edge_angle.end() )</a>
<a name="2100"><span class="lineNum">    2100 </span>                :            :               {</a>
<a name="2101"><span class="lineNum">    2101 </span>                :            :                 //erase the entries</a>
<a name="2102"><span class="lineNum">    2102 </span>                :            :                 double angle = tempit1-&gt;second;</a>
<a name="2103"><span class="lineNum">    2103 </span>                :            :                 edge_angle.erase( ed2 );</a>
<a name="2104"><span class="lineNum">    2104 </span>                :            :                 std::multimap&lt;double, int&gt;::iterator tempit2 = angle_edge.lower_bound( angle );</a>
<a name="2105"><span class="lineNum">    2105 </span>                :            :                 while ( tempit2-&gt;second != ed2 )</a>
<a name="2106"><span class="lineNum">    2106 </span>                :            :                 {</a>
<a name="2107"><span class="lineNum">    2107 </span>                :            :                   ++tempit2;</a>
<a name="2108"><span class="lineNum">    2108 </span>                :            :                 }</a>
<a name="2109"><span class="lineNum">    2109 </span>                :            :                 angle_edge.erase( tempit2 );</a>
<a name="2110"><span class="lineNum">    2110 </span>                :            :               }</a>
<a name="2111"><span class="lineNum">    2111 </span>                :            :             }</a>
<a name="2112"><span class="lineNum">    2112 </span>                :            : </a>
<a name="2113"><span class="lineNum">    2113 </span>                :            :             if ( angle2 &lt; mintol &amp;&amp; !twoforcededges2 )</a>
<a name="2114"><span class="lineNum">    2114 </span>                :            :             {</a>
<a name="2115"><span class="lineNum">    2115 </span>                :            :               edge_angle.insert( std::make_pair( ed2, angle2 ) );</a>
<a name="2116"><span class="lineNum">    2116 </span>                :            :               angle_edge.insert( std::make_pair( angle2, ed2 ) );</a>
<a name="2117"><span class="lineNum">    2117 </span>                :            :             }</a>
<a name="2118"><span class="lineNum">    2118 </span>                :            : </a>
<a name="2119"><span class="lineNum">    2119 </span>                :            :             //update the settings related to ed3</a>
<a name="2120"><span class="lineNum">    2120 </span>                :            :             QSet&lt;int&gt;::iterator ed3iter = dontexamine.find( ed3 );</a>
<a name="2121"><span class="lineNum">    2121 </span>                :            :             if ( ed3iter != dontexamine.end() )</a>
<a name="2122"><span class="lineNum">    2122 </span>                :            :             {</a>
<a name="2123"><span class="lineNum">    2123 </span>                :            :               //edge number is on dontexamine list</a>
<a name="2124"><span class="lineNum">    2124 </span>                :            :               dontexamine.erase( ed3iter );</a>
<a name="2125"><span class="lineNum">    2125 </span>                :            :             }</a>
<a name="2126"><span class="lineNum">    2126 </span>                :            :             else</a>
<a name="2127"><span class="lineNum">    2127 </span>                :            :             {</a>
<a name="2128"><span class="lineNum">    2128 </span>                :            :               //test, if it is on edge_angle and angle_edge and erase them if yes</a>
<a name="2129"><span class="lineNum">    2129 </span>                :            :               std::map&lt;int, double&gt;::iterator tempit1;</a>
<a name="2130"><span class="lineNum">    2130 </span>                :            :               tempit1 = edge_angle.find( ed3 );</a>
<a name="2131"><span class="lineNum">    2131 </span>                :            :               if ( tempit1 != edge_angle.end() )</a>
<a name="2132"><span class="lineNum">    2132 </span>                :            :               {</a>
<a name="2133"><span class="lineNum">    2133 </span>                :            :                 //erase the entries</a>
<a name="2134"><span class="lineNum">    2134 </span>                :            :                 double angle = tempit1-&gt;second;</a>
<a name="2135"><span class="lineNum">    2135 </span>                :            :                 edge_angle.erase( ed3 );</a>
<a name="2136"><span class="lineNum">    2136 </span>                :            :                 std::multimap&lt;double, int&gt;::iterator tempit2 = angle_edge.lower_bound( angle );</a>
<a name="2137"><span class="lineNum">    2137 </span>                :            :                 while ( tempit2-&gt;second != ed3 )</a>
<a name="2138"><span class="lineNum">    2138 </span>                :            :                 {</a>
<a name="2139"><span class="lineNum">    2139 </span>                :            :                   ++tempit2;</a>
<a name="2140"><span class="lineNum">    2140 </span>                :            :                 }</a>
<a name="2141"><span class="lineNum">    2141 </span>                :            :                 angle_edge.erase( tempit2 );</a>
<a name="2142"><span class="lineNum">    2142 </span>                :            :               }</a>
<a name="2143"><span class="lineNum">    2143 </span>                :            :             }</a>
<a name="2144"><span class="lineNum">    2144 </span>                :            : </a>
<a name="2145"><span class="lineNum">    2145 </span>                :            :             if ( angle3 &lt; mintol &amp;&amp; !twoforcededges3 )</a>
<a name="2146"><span class="lineNum">    2146 </span>                :            :             {</a>
<a name="2147"><span class="lineNum">    2147 </span>                :            :               edge_angle.insert( std::make_pair( ed3, angle3 ) );</a>
<a name="2148"><span class="lineNum">    2148 </span>                :            :               angle_edge.insert( std::make_pair( angle3, ed3 ) );</a>
<a name="2149"><span class="lineNum">    2149 </span>                :            :             }</a>
<a name="2150"><span class="lineNum">    2150 </span>                :            : </a>
<a name="2151"><span class="lineNum">    2151 </span>                :            : </a>
<a name="2152"><span class="lineNum">    2152 </span>                :            :           }</a>
<a name="2153"><span class="lineNum">    2153 </span>                :            :           while ( actedge != pointingedge );</a>
<a name="2154"><span class="lineNum">    2154 </span>                :            :         }</a>
<a name="2155"><span class="lineNum">    2155 </span>                :            :       }</a>
<a name="2156"><span class="lineNum">    2156 </span>                :            :     }</a>
<a name="2157"><span class="lineNum">    2157 </span>                :            : #endif //end slow version</a>
<a name="2158"><span class="lineNum">    2158 </span>                :            : </a>
<a name="2159"><span class="lineNum">    2159 </span>                :            : </a>
<a name="2160"><span class="lineNum">    2160 </span>                :            :     //fast version. Maybe this does not work</a>
<a name="2161"><span class="lineNum">    2161 </span>                :<span class="lineNoCov">          0 :     QSet&lt;int&gt; influenceedges;//begin fast method</span></a>
<a name="2162"><span class="lineNum">    2162 </span>                :<span class="lineNoCov">          0 :     int baseedge = baseEdgeOfTriangle( circumcenter );</span></a>
<a name="2163"><span class="lineNum">    2163 </span>                :<span class="lineNoCov">          0 :     if ( baseedge == -5 )//a numerical instability occurred or the circumcenter already exists in the triangulation</span></a>
<a name="2164"><span class="lineNum">    2164 </span>                :            :     {</a>
<a name="2165"><span class="lineNum">    2165 </span>                :            :       //delete minedge from edge_angle and minangle from angle_edge</a>
<a name="2166"><span class="lineNum">    2166 </span>                :<span class="lineNoCov">          0 :       edge_angle.erase( minedge );</span></a>
<a name="2167"><span class="lineNum">    2167 </span>                :<span class="lineNoCov">          0 :       std::multimap&lt;double, int&gt;::iterator minedgeiter = angle_edge.find( minangle );</span></a>
<a name="2168"><span class="lineNum">    2168 </span>                :<span class="lineNoCov">          0 :       while ( minedgeiter-&gt;second != minedge )</span></a>
<a name="2169"><span class="lineNum">    2169 </span>                :            :       {</a>
<a name="2170"><span class="lineNum">    2170 </span>                :<span class="lineNoCov">          0 :         ++minedgeiter;</span></a>
<a name="2171"><span class="lineNum">    2171 </span>                :            :       }</a>
<a name="2172"><span class="lineNum">    2172 </span>                :<span class="lineNoCov">          0 :       angle_edge.erase( minedgeiter );</span></a>
<a name="2173"><span class="lineNum">    2173 </span>                :<span class="lineNoCov">          0 :       continue;</span></a>
<a name="2174"><span class="lineNum">    2174 </span>                :            :     }</a>
<a name="2175"><span class="lineNum">    2175 </span>                :<span class="lineNoCov">          0 :     else if ( baseedge == -25 )//circumcenter already exists in the triangulation</span></a>
<a name="2176"><span class="lineNum">    2176 </span>                :            :     {</a>
<a name="2177"><span class="lineNum">    2177 </span>                :            :       //delete minedge from edge_angle and minangle from angle_edge</a>
<a name="2178"><span class="lineNum">    2178 </span>                :<span class="lineNoCov">          0 :       edge_angle.erase( minedge );</span></a>
<a name="2179"><span class="lineNum">    2179 </span>                :<span class="lineNoCov">          0 :       std::multimap&lt;double, int&gt;::iterator minedgeiter = angle_edge.find( minangle );</span></a>
<a name="2180"><span class="lineNum">    2180 </span>                :<span class="lineNoCov">          0 :       while ( minedgeiter-&gt;second != minedge )</span></a>
<a name="2181"><span class="lineNum">    2181 </span>                :            :       {</a>
<a name="2182"><span class="lineNum">    2182 </span>                :<span class="lineNoCov">          0 :         ++minedgeiter;</span></a>
<a name="2183"><span class="lineNum">    2183 </span>                :            :       }</a>
<a name="2184"><span class="lineNum">    2184 </span>                :<span class="lineNoCov">          0 :       angle_edge.erase( minedgeiter );</span></a>
<a name="2185"><span class="lineNum">    2185 </span>                :<span class="lineNoCov">          0 :       continue;</span></a>
<a name="2186"><span class="lineNum">    2186 </span>                :            :     }</a>
<a name="2187"><span class="lineNum">    2187 </span>                :<span class="lineNoCov">          0 :     else if ( baseedge == -20 )</span></a>
<a name="2188"><span class="lineNum">    2188 </span>                :            :     {</a>
<a name="2189"><span class="lineNum">    2189 </span>                :<span class="lineNoCov">          0 :       baseedge = mEdgeWithPoint;</span></a>
<a name="2190"><span class="lineNum">    2190 </span>                :<span class="lineNoCov">          0 :     }</span></a>
<a name="2191"><span class="lineNum">    2191 </span>                :            : </a>
<a name="2192"><span class="lineNum">    2192 </span>                :<span class="lineNoCov">          0 :     evaluateInfluenceRegion( &amp;circumcenter, baseedge, influenceedges );</span></a>
<a name="2193"><span class="lineNum">    2193 </span>                :<span class="lineNoCov">          0 :     evaluateInfluenceRegion( &amp;circumcenter, mHalfEdge[baseedge]-&gt;getNext(), influenceedges );</span></a>
<a name="2194"><span class="lineNum">    2194 </span>                :<span class="lineNoCov">          0 :     evaluateInfluenceRegion( &amp;circumcenter, mHalfEdge[mHalfEdge[baseedge]-&gt;getNext()]-&gt;getNext(), influenceedges );</span></a>
<a name="2195"><span class="lineNum">    2195 </span>                :            : </a>
<a name="2196"><span class="lineNum">    2196 </span>                :<span class="lineNoCov">          0 :     for ( QSet&lt;int&gt;::iterator it = influenceedges.begin(); it != influenceedges.end(); ++it )</span></a>
<a name="2197"><span class="lineNum">    2197 </span>                :            :     {</a>
<a name="2198"><span class="lineNum">    2198 </span>                :<span class="lineNoCov">          0 :       if ( ( mHalfEdge[*it]-&gt;getForced() || edgeOnConvexHull( *it ) ) &amp;&amp; MathUtils::inDiametral( mPointVector[mHalfEdge[*it]-&gt;getPoint()], mPointVector[mHalfEdge[mHalfEdge[*it]-&gt;getDual()]-&gt;getPoint()], &amp;circumcenter ) )</span></a>
<a name="2199"><span class="lineNum">    2199 </span>                :            :       {</a>
<a name="2200"><span class="lineNum">    2200 </span>                :            :         //split segment</a>
<a name="2201"><span class="lineNum">    2201 </span>                :<span class="lineNoCov">          0 :         QgsDebugMsg( QStringLiteral( &quot;segment split&quot; ) );</span></a>
<a name="2202"><span class="lineNum">    2202 </span>                :<span class="lineNoCov">          0 :         int pointno = splitHalfEdge( *it, 0.5 );</span></a>
<a name="2203"><span class="lineNum">    2203 </span>                :<span class="lineNoCov">          0 :         encroached = true;</span></a>
<a name="2204"><span class="lineNum">    2204 </span>                :            : </a>
<a name="2205"><span class="lineNum">    2205 </span>                :            :         //update dontexmine, angle_edge, edge_angle</a>
<a name="2206"><span class="lineNum">    2206 </span>                :<span class="lineNoCov">          0 :         int pointingedge = baseEdgeOfPoint( pointno );</span></a>
<a name="2207"><span class="lineNum">    2207 </span>                :            : </a>
<a name="2208"><span class="lineNum">    2208 </span>                :<span class="lineNoCov">          0 :         int actedge = pointingedge;</span></a>
<a name="2209"><span class="lineNum">    2209 </span>                :            :         int ed1, ed2, ed3;//numbers of the three edges</a>
<a name="2210"><span class="lineNum">    2210 </span>                :            :         int pt1, pt2, pt3;//numbers of the three points</a>
<a name="2211"><span class="lineNum">    2211 </span>                :            :         double angle1, angle2, angle3;</a>
<a name="2212"><span class="lineNum">    2212 </span>                :            : </a>
<a name="2213"><span class="lineNum">    2213 </span>                :<span class="lineNoCov">          0 :         do</span></a>
<a name="2214"><span class="lineNum">    2214 </span>                :            :         {</a>
<a name="2215"><span class="lineNum">    2215 </span>                :<span class="lineNoCov">          0 :           ed1 = mHalfEdge[actedge]-&gt;getDual();</span></a>
<a name="2216"><span class="lineNum">    2216 </span>                :<span class="lineNoCov">          0 :           pt1 = mHalfEdge[ed1]-&gt;getPoint();</span></a>
<a name="2217"><span class="lineNum">    2217 </span>                :<span class="lineNoCov">          0 :           ed2 = mHalfEdge[ed1]-&gt;getNext();</span></a>
<a name="2218"><span class="lineNum">    2218 </span>                :<span class="lineNoCov">          0 :           pt2 = mHalfEdge[ed2]-&gt;getPoint();</span></a>
<a name="2219"><span class="lineNum">    2219 </span>                :<span class="lineNoCov">          0 :           ed3 = mHalfEdge[ed2]-&gt;getNext();</span></a>
<a name="2220"><span class="lineNum">    2220 </span>                :<span class="lineNoCov">          0 :           pt3 = mHalfEdge[ed3]-&gt;getPoint();</span></a>
<a name="2221"><span class="lineNum">    2221 </span>                :<span class="lineNoCov">          0 :           actedge = ed3;</span></a>
<a name="2222"><span class="lineNum">    2222 </span>                :            : </a>
<a name="2223"><span class="lineNum">    2223 </span>                :<span class="lineNoCov">          0 :           if ( pt1 == -1 || pt2 == -1 || pt3 == -1 )//don't consider triangles with the virtual point</span></a>
<a name="2224"><span class="lineNum">    2224 </span>                :            :           {</a>
<a name="2225"><span class="lineNum">    2225 </span>                :<span class="lineNoCov">          0 :             continue;</span></a>
<a name="2226"><span class="lineNum">    2226 </span>                :            :           }</a>
<a name="2227"><span class="lineNum">    2227 </span>                :            : </a>
<a name="2228"><span class="lineNum">    2228 </span>                :<span class="lineNoCov">          0 :           angle1 = MathUtils::angle( mPointVector[pt3], mPointVector[pt1], mPointVector[pt2], mPointVector[pt1] );</span></a>
<a name="2229"><span class="lineNum">    2229 </span>                :<span class="lineNoCov">          0 :           angle2 = MathUtils::angle( mPointVector[pt1], mPointVector[pt2], mPointVector[pt3], mPointVector[pt2] );</span></a>
<a name="2230"><span class="lineNum">    2230 </span>                :<span class="lineNoCov">          0 :           angle3 = MathUtils::angle( mPointVector[pt2], mPointVector[pt3], mPointVector[pt1], mPointVector[pt3] );</span></a>
<a name="2231"><span class="lineNum">    2231 </span>                :            : </a>
<a name="2232"><span class="lineNum">    2232 </span>                :            :           //don't put the edges on the maps if two segments are forced or on a hull</a>
<a name="2233"><span class="lineNum">    2233 </span>                :            :           bool twoforcededges1, twoforcededges2, twoforcededges3;//flag to decide, if edges should be added to the maps. Do not add them if true</a>
<a name="2234"><span class="lineNum">    2234 </span>                :            : </a>
<a name="2235"><span class="lineNum">    2235 </span>                :            : </a>
<a name="2236"><span class="lineNum">    2236 </span>                :            : </a>
<a name="2237"><span class="lineNum">    2237 </span>                :<span class="lineNoCov">          0 :           twoforcededges1 = ( mHalfEdge[ed1]-&gt;getForced() || edgeOnConvexHull( ed1 ) ) &amp;&amp; ( mHalfEdge[ed2]-&gt;getForced() || edgeOnConvexHull( ed2 ) );</span></a>
<a name="2238"><span class="lineNum">    2238 </span>                :            : </a>
<a name="2239"><span class="lineNum">    2239 </span>                :<span class="lineNoCov">          0 :           twoforcededges2 = ( mHalfEdge[ed2]-&gt;getForced() || edgeOnConvexHull( ed2 ) ) &amp;&amp; ( mHalfEdge[ed3]-&gt;getForced() || edgeOnConvexHull( ed3 ) );</span></a>
<a name="2240"><span class="lineNum">    2240 </span>                :            : </a>
<a name="2241"><span class="lineNum">    2241 </span>                :<span class="lineNoCov">          0 :           twoforcededges3 = ( mHalfEdge[ed3]-&gt;getForced() || edgeOnConvexHull( ed3 ) ) &amp;&amp; ( mHalfEdge[ed1]-&gt;getForced() || edgeOnConvexHull( ed1 ) );</span></a>
<a name="2242"><span class="lineNum">    2242 </span>                :            : </a>
<a name="2243"><span class="lineNum">    2243 </span>                :            : </a>
<a name="2244"><span class="lineNum">    2244 </span>                :            :           //update the settings related to ed1</a>
<a name="2245"><span class="lineNum">    2245 </span>                :<span class="lineNoCov">          0 :           QSet&lt;int&gt;::iterator ed1iter = dontexamine.find( ed1 );</span></a>
<a name="2246"><span class="lineNum">    2246 </span>                :<span class="lineNoCov">          0 :           if ( ed1iter != dontexamine.end() )</span></a>
<a name="2247"><span class="lineNum">    2247 </span>                :            :           {</a>
<a name="2248"><span class="lineNum">    2248 </span>                :            :             //edge number is on dontexamine list</a>
<a name="2249"><span class="lineNum">    2249 </span>                :<span class="lineNoCov">          0 :             dontexamine.erase( ed1iter );</span></a>
<a name="2250"><span class="lineNum">    2250 </span>                :<span class="lineNoCov">          0 :           }</span></a>
<a name="2251"><span class="lineNum">    2251 </span>                :            :           else</a>
<a name="2252"><span class="lineNum">    2252 </span>                :            :           {</a>
<a name="2253"><span class="lineNum">    2253 </span>                :            :             //test, if it is on edge_angle and angle_edge and erase them if yes</a>
<a name="2254"><span class="lineNum">    2254 </span>                :<span class="lineNoCov">          0 :             std::map&lt;int, double&gt;::iterator tempit1;</span></a>
<a name="2255"><span class="lineNum">    2255 </span>                :<span class="lineNoCov">          0 :             tempit1 = edge_angle.find( ed1 );</span></a>
<a name="2256"><span class="lineNum">    2256 </span>                :<span class="lineNoCov">          0 :             if ( tempit1 != edge_angle.end() )</span></a>
<a name="2257"><span class="lineNum">    2257 </span>                :            :             {</a>
<a name="2258"><span class="lineNum">    2258 </span>                :            :               //erase the entries</a>
<a name="2259"><span class="lineNum">    2259 </span>                :<span class="lineNoCov">          0 :               double angle = tempit1-&gt;second;</span></a>
<a name="2260"><span class="lineNum">    2260 </span>                :<span class="lineNoCov">          0 :               edge_angle.erase( ed1 );</span></a>
<a name="2261"><span class="lineNum">    2261 </span>                :<span class="lineNoCov">          0 :               std::multimap&lt;double, int&gt;::iterator tempit2 = angle_edge.lower_bound( angle );</span></a>
<a name="2262"><span class="lineNum">    2262 </span>                :<span class="lineNoCov">          0 :               while ( tempit2-&gt;second != ed1 )</span></a>
<a name="2263"><span class="lineNum">    2263 </span>                :            :               {</a>
<a name="2264"><span class="lineNum">    2264 </span>                :<span class="lineNoCov">          0 :                 ++tempit2;</span></a>
<a name="2265"><span class="lineNum">    2265 </span>                :            :               }</a>
<a name="2266"><span class="lineNum">    2266 </span>                :<span class="lineNoCov">          0 :               angle_edge.erase( tempit2 );</span></a>
<a name="2267"><span class="lineNum">    2267 </span>                :<span class="lineNoCov">          0 :             }</span></a>
<a name="2268"><span class="lineNum">    2268 </span>                :            :           }</a>
<a name="2269"><span class="lineNum">    2269 </span>                :            : </a>
<a name="2270"><span class="lineNum">    2270 </span>                :<span class="lineNoCov">          0 :           if ( angle1 &lt; mintol &amp;&amp; !twoforcededges1 )</span></a>
<a name="2271"><span class="lineNum">    2271 </span>                :            :           {</a>
<a name="2272"><span class="lineNum">    2272 </span>                :<span class="lineNoCov">          0 :             edge_angle.insert( std::make_pair( ed1, angle1 ) );</span></a>
<a name="2273"><span class="lineNum">    2273 </span>                :<span class="lineNoCov">          0 :             angle_edge.insert( std::make_pair( angle1, ed1 ) );</span></a>
<a name="2274"><span class="lineNum">    2274 </span>                :<span class="lineNoCov">          0 :           }</span></a>
<a name="2275"><span class="lineNum">    2275 </span>                :            : </a>
<a name="2276"><span class="lineNum">    2276 </span>                :            :           //update the settings related to ed2</a>
<a name="2277"><span class="lineNum">    2277 </span>                :<span class="lineNoCov">          0 :           QSet&lt;int&gt;::iterator ed2iter = dontexamine.find( ed2 );</span></a>
<a name="2278"><span class="lineNum">    2278 </span>                :<span class="lineNoCov">          0 :           if ( ed2iter != dontexamine.end() )</span></a>
<a name="2279"><span class="lineNum">    2279 </span>                :            :           {</a>
<a name="2280"><span class="lineNum">    2280 </span>                :            :             //edge number is on dontexamine list</a>
<a name="2281"><span class="lineNum">    2281 </span>                :<span class="lineNoCov">          0 :             dontexamine.erase( ed2iter );</span></a>
<a name="2282"><span class="lineNum">    2282 </span>                :<span class="lineNoCov">          0 :           }</span></a>
<a name="2283"><span class="lineNum">    2283 </span>                :            :           else</a>
<a name="2284"><span class="lineNum">    2284 </span>                :            :           {</a>
<a name="2285"><span class="lineNum">    2285 </span>                :            :             //test, if it is on edge_angle and angle_edge and erase them if yes</a>
<a name="2286"><span class="lineNum">    2286 </span>                :<span class="lineNoCov">          0 :             std::map&lt;int, double&gt;::iterator tempit1;</span></a>
<a name="2287"><span class="lineNum">    2287 </span>                :<span class="lineNoCov">          0 :             tempit1 = edge_angle.find( ed2 );</span></a>
<a name="2288"><span class="lineNum">    2288 </span>                :<span class="lineNoCov">          0 :             if ( tempit1 != edge_angle.end() )</span></a>
<a name="2289"><span class="lineNum">    2289 </span>                :            :             {</a>
<a name="2290"><span class="lineNum">    2290 </span>                :            :               //erase the entries</a>
<a name="2291"><span class="lineNum">    2291 </span>                :<span class="lineNoCov">          0 :               double angle = tempit1-&gt;second;</span></a>
<a name="2292"><span class="lineNum">    2292 </span>                :<span class="lineNoCov">          0 :               edge_angle.erase( ed2 );</span></a>
<a name="2293"><span class="lineNum">    2293 </span>                :<span class="lineNoCov">          0 :               std::multimap&lt;double, int&gt;::iterator tempit2 = angle_edge.lower_bound( angle );</span></a>
<a name="2294"><span class="lineNum">    2294 </span>                :<span class="lineNoCov">          0 :               while ( tempit2-&gt;second != ed2 )</span></a>
<a name="2295"><span class="lineNum">    2295 </span>                :            :               {</a>
<a name="2296"><span class="lineNum">    2296 </span>                :<span class="lineNoCov">          0 :                 ++tempit2;</span></a>
<a name="2297"><span class="lineNum">    2297 </span>                :            :               }</a>
<a name="2298"><span class="lineNum">    2298 </span>                :<span class="lineNoCov">          0 :               angle_edge.erase( tempit2 );</span></a>
<a name="2299"><span class="lineNum">    2299 </span>                :<span class="lineNoCov">          0 :             }</span></a>
<a name="2300"><span class="lineNum">    2300 </span>                :            :           }</a>
<a name="2301"><span class="lineNum">    2301 </span>                :            : </a>
<a name="2302"><span class="lineNum">    2302 </span>                :<span class="lineNoCov">          0 :           if ( angle2 &lt; mintol &amp;&amp; !twoforcededges2 )</span></a>
<a name="2303"><span class="lineNum">    2303 </span>                :            :           {</a>
<a name="2304"><span class="lineNum">    2304 </span>                :<span class="lineNoCov">          0 :             edge_angle.insert( std::make_pair( ed2, angle2 ) );</span></a>
<a name="2305"><span class="lineNum">    2305 </span>                :<span class="lineNoCov">          0 :             angle_edge.insert( std::make_pair( angle2, ed2 ) );</span></a>
<a name="2306"><span class="lineNum">    2306 </span>                :<span class="lineNoCov">          0 :           }</span></a>
<a name="2307"><span class="lineNum">    2307 </span>                :            : </a>
<a name="2308"><span class="lineNum">    2308 </span>                :            :           //update the settings related to ed3</a>
<a name="2309"><span class="lineNum">    2309 </span>                :<span class="lineNoCov">          0 :           QSet&lt;int&gt;::iterator ed3iter = dontexamine.find( ed3 );</span></a>
<a name="2310"><span class="lineNum">    2310 </span>                :<span class="lineNoCov">          0 :           if ( ed3iter != dontexamine.end() )</span></a>
<a name="2311"><span class="lineNum">    2311 </span>                :            :           {</a>
<a name="2312"><span class="lineNum">    2312 </span>                :            :             //edge number is on dontexamine list</a>
<a name="2313"><span class="lineNum">    2313 </span>                :<span class="lineNoCov">          0 :             dontexamine.erase( ed3iter );</span></a>
<a name="2314"><span class="lineNum">    2314 </span>                :<span class="lineNoCov">          0 :           }</span></a>
<a name="2315"><span class="lineNum">    2315 </span>                :            :           else</a>
<a name="2316"><span class="lineNum">    2316 </span>                :            :           {</a>
<a name="2317"><span class="lineNum">    2317 </span>                :            :             //test, if it is on edge_angle and angle_edge and erase them if yes</a>
<a name="2318"><span class="lineNum">    2318 </span>                :<span class="lineNoCov">          0 :             std::map&lt;int, double&gt;::iterator tempit1;</span></a>
<a name="2319"><span class="lineNum">    2319 </span>                :<span class="lineNoCov">          0 :             tempit1 = edge_angle.find( ed3 );</span></a>
<a name="2320"><span class="lineNum">    2320 </span>                :<span class="lineNoCov">          0 :             if ( tempit1 != edge_angle.end() )</span></a>
<a name="2321"><span class="lineNum">    2321 </span>                :            :             {</a>
<a name="2322"><span class="lineNum">    2322 </span>                :            :               //erase the entries</a>
<a name="2323"><span class="lineNum">    2323 </span>                :<span class="lineNoCov">          0 :               double angle = tempit1-&gt;second;</span></a>
<a name="2324"><span class="lineNum">    2324 </span>                :<span class="lineNoCov">          0 :               edge_angle.erase( ed3 );</span></a>
<a name="2325"><span class="lineNum">    2325 </span>                :<span class="lineNoCov">          0 :               std::multimap&lt;double, int&gt;::iterator tempit2 = angle_edge.lower_bound( angle );</span></a>
<a name="2326"><span class="lineNum">    2326 </span>                :<span class="lineNoCov">          0 :               while ( tempit2-&gt;second != ed3 )</span></a>
<a name="2327"><span class="lineNum">    2327 </span>                :            :               {</a>
<a name="2328"><span class="lineNum">    2328 </span>                :<span class="lineNoCov">          0 :                 ++tempit2;</span></a>
<a name="2329"><span class="lineNum">    2329 </span>                :            :               }</a>
<a name="2330"><span class="lineNum">    2330 </span>                :<span class="lineNoCov">          0 :               angle_edge.erase( tempit2 );</span></a>
<a name="2331"><span class="lineNum">    2331 </span>                :<span class="lineNoCov">          0 :             }</span></a>
<a name="2332"><span class="lineNum">    2332 </span>                :            :           }</a>
<a name="2333"><span class="lineNum">    2333 </span>                :            : </a>
<a name="2334"><span class="lineNum">    2334 </span>                :<span class="lineNoCov">          0 :           if ( angle3 &lt; mintol &amp;&amp; !twoforcededges3 )</span></a>
<a name="2335"><span class="lineNum">    2335 </span>                :            :           {</a>
<a name="2336"><span class="lineNum">    2336 </span>                :<span class="lineNoCov">          0 :             edge_angle.insert( std::make_pair( ed3, angle3 ) );</span></a>
<a name="2337"><span class="lineNum">    2337 </span>                :<span class="lineNoCov">          0 :             angle_edge.insert( std::make_pair( angle3, ed3 ) );</span></a>
<a name="2338"><span class="lineNum">    2338 </span>                :<span class="lineNoCov">          0 :           }</span></a>
<a name="2339"><span class="lineNum">    2339 </span>                :            : </a>
<a name="2340"><span class="lineNum">    2340 </span>                :            : </a>
<a name="2341"><span class="lineNum">    2341 </span>                :<span class="lineNoCov">          0 :         }</span></a>
<a name="2342"><span class="lineNum">    2342 </span>                :<span class="lineNoCov">          0 :         while ( actedge != pointingedge );</span></a>
<a name="2343"><span class="lineNum">    2343 </span>                :<span class="lineNoCov">          0 :       }</span></a>
<a name="2344"><span class="lineNum">    2344 </span>                :<span class="lineNoCov">          0 :     } //end fast method</span></a>
<a name="2345"><span class="lineNum">    2345 </span>                :            : </a>
<a name="2346"><span class="lineNum">    2346 </span>                :            : </a>
<a name="2347"><span class="lineNum">    2347 </span>                :<span class="lineNoCov">          0 :     if ( encroached )</span></a>
<a name="2348"><span class="lineNum">    2348 </span>                :            :     {</a>
<a name="2349"><span class="lineNum">    2349 </span>                :<span class="lineNoCov">          0 :       continue;</span></a>
<a name="2350"><span class="lineNum">    2350 </span>                :            :     }</a>
<a name="2351"><span class="lineNum">    2351 </span>                :            : </a>
<a name="2352"><span class="lineNum">    2352 </span>                :            :     /*******otherwise, try to add the circumcenter to the triangulation************************************************************************************************/</a>
<a name="2353"><span class="lineNum">    2353 </span>                :            : </a>
<a name="2354"><span class="lineNum">    2354 </span>                :<span class="lineNoCov">          0 :     QgsPoint p( 0, 0, 0 );</span></a>
<a name="2355"><span class="lineNum">    2355 </span>                :<span class="lineNoCov">          0 :     calcPoint( circumcenter.x(), circumcenter.y(), p );</span></a>
<a name="2356"><span class="lineNum">    2356 </span>                :<span class="lineNoCov">          0 :     int pointno = addPoint( p );</span></a>
<a name="2357"><span class="lineNum">    2357 </span>                :            : </a>
<a name="2358"><span class="lineNum">    2358 </span>                :<span class="lineNoCov">          0 :     if ( pointno == -100 || pointno == mTwiceInsPoint )</span></a>
<a name="2359"><span class="lineNum">    2359 </span>                :            :     {</a>
<a name="2360"><span class="lineNum">    2360 </span>                :<span class="lineNoCov">          0 :       if ( pointno == -100 )</span></a>
<a name="2361"><span class="lineNum">    2361 </span>                :            :       {</a>
<a name="2362"><span class="lineNum">    2362 </span>                :<span class="lineNoCov">          0 :         QgsDebugMsg( QStringLiteral( &quot;put circumcenter %1//%2 on dontexamine list because of numerical instabilities&quot; )</span></a>
<a name="2363"><span class="lineNum">    2363 </span>                :            :                      .arg( circumcenter.x() ).arg( circumcenter.y() ) );</a>
<a name="2364"><span class="lineNum">    2364 </span>                :<span class="lineNoCov">          0 :       }</span></a>
<a name="2365"><span class="lineNum">    2365 </span>                :<span class="lineNoCov">          0 :       else if ( pointno == mTwiceInsPoint )</span></a>
<a name="2366"><span class="lineNum">    2366 </span>                :            :       {</a>
<a name="2367"><span class="lineNum">    2367 </span>                :<span class="lineNoCov">          0 :         QgsDebugMsg( QStringLiteral( &quot;put circumcenter %1//%2 on dontexamine list because it is already inserted&quot; )</span></a>
<a name="2368"><span class="lineNum">    2368 </span>                :            :                      .arg( circumcenter.x() ).arg( circumcenter.y() ) );</a>
<a name="2369"><span class="lineNum">    2369 </span>                :            :         //test, if the point is present in the triangulation</a>
<a name="2370"><span class="lineNum">    2370 </span>                :<span class="lineNoCov">          0 :         bool flag = false;</span></a>
<a name="2371"><span class="lineNum">    2371 </span>                :<span class="lineNoCov">          0 :         for ( int i = 0; i &lt; mPointVector.count(); i++ )</span></a>
<a name="2372"><span class="lineNum">    2372 </span>                :            :         {</a>
<a name="2373"><span class="lineNum">    2373 </span>                :<span class="lineNoCov">          0 :           if ( mPointVector[i]-&gt;x() == circumcenter.x() &amp;&amp; mPointVector[i]-&gt;y() == circumcenter.y() )</span></a>
<a name="2374"><span class="lineNum">    2374 </span>                :            :           {</a>
<a name="2375"><span class="lineNum">    2375 </span>                :<span class="lineNoCov">          0 :             flag = true;</span></a>
<a name="2376"><span class="lineNum">    2376 </span>                :<span class="lineNoCov">          0 :           }</span></a>
<a name="2377"><span class="lineNum">    2377 </span>                :<span class="lineNoCov">          0 :         }</span></a>
<a name="2378"><span class="lineNum">    2378 </span>                :<span class="lineNoCov">          0 :         if ( !flag )</span></a>
<a name="2379"><span class="lineNum">    2379 </span>                :            :         {</a>
<a name="2380"><span class="lineNum">    2380 </span>                :<span class="lineNoCov">          0 :           QgsDebugMsg( QStringLiteral( &quot;point is not present in the triangulation&quot; ) );</span></a>
<a name="2381"><span class="lineNum">    2381 </span>                :<span class="lineNoCov">          0 :         }</span></a>
<a name="2382"><span class="lineNum">    2382 </span>                :<span class="lineNoCov">          0 :       }</span></a>
<a name="2383"><span class="lineNum">    2383 </span>                :            :       //put all three edges to dontexamine and remove them from the other maps</a>
<a name="2384"><span class="lineNum">    2384 </span>                :<span class="lineNoCov">          0 :       dontexamine.insert( minedge );</span></a>
<a name="2385"><span class="lineNum">    2385 </span>                :<span class="lineNoCov">          0 :       edge_angle.erase( minedge );</span></a>
<a name="2386"><span class="lineNum">    2386 </span>                :<span class="lineNoCov">          0 :       std::multimap&lt;double, int&gt;::iterator minedgeiter = angle_edge.lower_bound( minangle );</span></a>
<a name="2387"><span class="lineNum">    2387 </span>                :<span class="lineNoCov">          0 :       while ( minedgeiter-&gt;second != minedge )</span></a>
<a name="2388"><span class="lineNum">    2388 </span>                :            :       {</a>
<a name="2389"><span class="lineNum">    2389 </span>                :<span class="lineNoCov">          0 :         ++minedgeiter;</span></a>
<a name="2390"><span class="lineNum">    2390 </span>                :            :       }</a>
<a name="2391"><span class="lineNum">    2391 </span>                :<span class="lineNoCov">          0 :       angle_edge.erase( minedgeiter );</span></a>
<a name="2392"><span class="lineNum">    2392 </span>                :<span class="lineNoCov">          0 :       continue;</span></a>
<a name="2393"><span class="lineNum">    2393 </span>                :            :     }</a>
<a name="2394"><span class="lineNum">    2394 </span>                :            :     else//insertion successful</a>
<a name="2395"><span class="lineNum">    2395 </span>                :            :     {</a>
<a name="2396"><span class="lineNum">    2396 </span>                :<span class="lineNoCov">          0 :       QgsDebugMsg( QStringLiteral( &quot;circumcenter added&quot; ) );</span></a>
<a name="2397"><span class="lineNum">    2397 </span>                :            : </a>
<a name="2398"><span class="lineNum">    2398 </span>                :            :       //update the maps</a>
<a name="2399"><span class="lineNum">    2399 </span>                :            :       //go around the inserted point and make changes for every half edge</a>
<a name="2400"><span class="lineNum">    2400 </span>                :<span class="lineNoCov">          0 :       int pointingedge = baseEdgeOfPoint( pointno );</span></a>
<a name="2401"><span class="lineNum">    2401 </span>                :            : </a>
<a name="2402"><span class="lineNum">    2402 </span>                :<span class="lineNoCov">          0 :       int actedge = pointingedge;</span></a>
<a name="2403"><span class="lineNum">    2403 </span>                :            :       int ed1, ed2, ed3;//numbers of the three edges</a>
<a name="2404"><span class="lineNum">    2404 </span>                :            :       int pt1, pt2, pt3;//numbers of the three points</a>
<a name="2405"><span class="lineNum">    2405 </span>                :            :       double angle1, angle2, angle3;</a>
<a name="2406"><span class="lineNum">    2406 </span>                :            : </a>
<a name="2407"><span class="lineNum">    2407 </span>                :<span class="lineNoCov">          0 :       do</span></a>
<a name="2408"><span class="lineNum">    2408 </span>                :            :       {</a>
<a name="2409"><span class="lineNum">    2409 </span>                :<span class="lineNoCov">          0 :         ed1 = mHalfEdge[actedge]-&gt;getDual();</span></a>
<a name="2410"><span class="lineNum">    2410 </span>                :<span class="lineNoCov">          0 :         pt1 = mHalfEdge[ed1]-&gt;getPoint();</span></a>
<a name="2411"><span class="lineNum">    2411 </span>                :<span class="lineNoCov">          0 :         ed2 = mHalfEdge[ed1]-&gt;getNext();</span></a>
<a name="2412"><span class="lineNum">    2412 </span>                :<span class="lineNoCov">          0 :         pt2 = mHalfEdge[ed2]-&gt;getPoint();</span></a>
<a name="2413"><span class="lineNum">    2413 </span>                :<span class="lineNoCov">          0 :         ed3 = mHalfEdge[ed2]-&gt;getNext();</span></a>
<a name="2414"><span class="lineNum">    2414 </span>                :<span class="lineNoCov">          0 :         pt3 = mHalfEdge[ed3]-&gt;getPoint();</span></a>
<a name="2415"><span class="lineNum">    2415 </span>                :<span class="lineNoCov">          0 :         actedge = ed3;</span></a>
<a name="2416"><span class="lineNum">    2416 </span>                :            : </a>
<a name="2417"><span class="lineNum">    2417 </span>                :<span class="lineNoCov">          0 :         if ( pt1 == -1 || pt2 == -1 || pt3 == -1 )//don't consider triangles with the virtual point</span></a>
<a name="2418"><span class="lineNum">    2418 </span>                :            :         {</a>
<a name="2419"><span class="lineNum">    2419 </span>                :<span class="lineNoCov">          0 :           continue;</span></a>
<a name="2420"><span class="lineNum">    2420 </span>                :            :         }</a>
<a name="2421"><span class="lineNum">    2421 </span>                :            : </a>
<a name="2422"><span class="lineNum">    2422 </span>                :<span class="lineNoCov">          0 :         angle1 = MathUtils::angle( mPointVector[pt3], mPointVector[pt1], mPointVector[pt2], mPointVector[pt1] );</span></a>
<a name="2423"><span class="lineNum">    2423 </span>                :<span class="lineNoCov">          0 :         angle2 = MathUtils::angle( mPointVector[pt1], mPointVector[pt2], mPointVector[pt3], mPointVector[pt2] );</span></a>
<a name="2424"><span class="lineNum">    2424 </span>                :<span class="lineNoCov">          0 :         angle3 = MathUtils::angle( mPointVector[pt2], mPointVector[pt3], mPointVector[pt1], mPointVector[pt3] );</span></a>
<a name="2425"><span class="lineNum">    2425 </span>                :            : </a>
<a name="2426"><span class="lineNum">    2426 </span>                :            :         //todo: put all three edges on the dontexamine list if two edges are forced or convex hull edges</a>
<a name="2427"><span class="lineNum">    2427 </span>                :            :         bool twoforcededges1, twoforcededges2, twoforcededges3;</a>
<a name="2428"><span class="lineNum">    2428 </span>                :            : </a>
<a name="2429"><span class="lineNum">    2429 </span>                :<span class="lineNoCov">          0 :         twoforcededges1 = ( mHalfEdge[ed1]-&gt;getForced() || edgeOnConvexHull( ed1 ) ) &amp;&amp; ( mHalfEdge[ed2]-&gt;getForced() || edgeOnConvexHull( ed2 ) );</span></a>
<a name="2430"><span class="lineNum">    2430 </span>                :            : </a>
<a name="2431"><span class="lineNum">    2431 </span>                :<span class="lineNoCov">          0 :         twoforcededges2 = ( mHalfEdge[ed2]-&gt;getForced() || edgeOnConvexHull( ed2 ) ) &amp;&amp; ( mHalfEdge[ed3]-&gt;getForced() || edgeOnConvexHull( ed3 ) );</span></a>
<a name="2432"><span class="lineNum">    2432 </span>                :            : </a>
<a name="2433"><span class="lineNum">    2433 </span>                :<span class="lineNoCov">          0 :         twoforcededges3 = ( mHalfEdge[ed3]-&gt;getForced() || edgeOnConvexHull( ed3 ) ) &amp;&amp; ( mHalfEdge[ed1]-&gt;getForced() || edgeOnConvexHull( ed1 ) );</span></a>
<a name="2434"><span class="lineNum">    2434 </span>                :            : </a>
<a name="2435"><span class="lineNum">    2435 </span>                :            : </a>
<a name="2436"><span class="lineNum">    2436 </span>                :            :         //update the settings related to ed1</a>
<a name="2437"><span class="lineNum">    2437 </span>                :<span class="lineNoCov">          0 :         QSet&lt;int&gt;::iterator ed1iter = dontexamine.find( ed1 );</span></a>
<a name="2438"><span class="lineNum">    2438 </span>                :<span class="lineNoCov">          0 :         if ( ed1iter != dontexamine.end() )</span></a>
<a name="2439"><span class="lineNum">    2439 </span>                :            :         {</a>
<a name="2440"><span class="lineNum">    2440 </span>                :            :           //edge number is on dontexamine list</a>
<a name="2441"><span class="lineNum">    2441 </span>                :<span class="lineNoCov">          0 :           dontexamine.erase( ed1iter );</span></a>
<a name="2442"><span class="lineNum">    2442 </span>                :<span class="lineNoCov">          0 :         }</span></a>
<a name="2443"><span class="lineNum">    2443 </span>                :            :         else</a>
<a name="2444"><span class="lineNum">    2444 </span>                :            :         {</a>
<a name="2445"><span class="lineNum">    2445 </span>                :            :           //test, if it is on edge_angle and angle_edge and erase them if yes</a>
<a name="2446"><span class="lineNum">    2446 </span>                :<span class="lineNoCov">          0 :           std::map&lt;int, double&gt;::iterator tempit1;</span></a>
<a name="2447"><span class="lineNum">    2447 </span>                :<span class="lineNoCov">          0 :           tempit1 = edge_angle.find( ed1 );</span></a>
<a name="2448"><span class="lineNum">    2448 </span>                :<span class="lineNoCov">          0 :           if ( tempit1 != edge_angle.end() )</span></a>
<a name="2449"><span class="lineNum">    2449 </span>                :            :           {</a>
<a name="2450"><span class="lineNum">    2450 </span>                :            :             //erase the entries</a>
<a name="2451"><span class="lineNum">    2451 </span>                :<span class="lineNoCov">          0 :             double angle = tempit1-&gt;second;</span></a>
<a name="2452"><span class="lineNum">    2452 </span>                :<span class="lineNoCov">          0 :             edge_angle.erase( ed1 );</span></a>
<a name="2453"><span class="lineNum">    2453 </span>                :<span class="lineNoCov">          0 :             std::multimap&lt;double, int&gt;::iterator tempit2 = angle_edge.lower_bound( angle );</span></a>
<a name="2454"><span class="lineNum">    2454 </span>                :<span class="lineNoCov">          0 :             while ( tempit2-&gt;second != ed1 )</span></a>
<a name="2455"><span class="lineNum">    2455 </span>                :            :             {</a>
<a name="2456"><span class="lineNum">    2456 </span>                :<span class="lineNoCov">          0 :               ++tempit2;</span></a>
<a name="2457"><span class="lineNum">    2457 </span>                :            :             }</a>
<a name="2458"><span class="lineNum">    2458 </span>                :<span class="lineNoCov">          0 :             angle_edge.erase( tempit2 );</span></a>
<a name="2459"><span class="lineNum">    2459 </span>                :<span class="lineNoCov">          0 :           }</span></a>
<a name="2460"><span class="lineNum">    2460 </span>                :            :         }</a>
<a name="2461"><span class="lineNum">    2461 </span>                :            : </a>
<a name="2462"><span class="lineNum">    2462 </span>                :<span class="lineNoCov">          0 :         if ( angle1 &lt; mintol &amp;&amp; !twoforcededges1 )</span></a>
<a name="2463"><span class="lineNum">    2463 </span>                :            :         {</a>
<a name="2464"><span class="lineNum">    2464 </span>                :<span class="lineNoCov">          0 :           edge_angle.insert( std::make_pair( ed1, angle1 ) );</span></a>
<a name="2465"><span class="lineNum">    2465 </span>                :<span class="lineNoCov">          0 :           angle_edge.insert( std::make_pair( angle1, ed1 ) );</span></a>
<a name="2466"><span class="lineNum">    2466 </span>                :<span class="lineNoCov">          0 :         }</span></a>
<a name="2467"><span class="lineNum">    2467 </span>                :            : </a>
<a name="2468"><span class="lineNum">    2468 </span>                :            : </a>
<a name="2469"><span class="lineNum">    2469 </span>                :            :         //update the settings related to ed2</a>
<a name="2470"><span class="lineNum">    2470 </span>                :<span class="lineNoCov">          0 :         QSet&lt;int&gt;::iterator ed2iter = dontexamine.find( ed2 );</span></a>
<a name="2471"><span class="lineNum">    2471 </span>                :<span class="lineNoCov">          0 :         if ( ed2iter != dontexamine.end() )</span></a>
<a name="2472"><span class="lineNum">    2472 </span>                :            :         {</a>
<a name="2473"><span class="lineNum">    2473 </span>                :            :           //edge number is on dontexamine list</a>
<a name="2474"><span class="lineNum">    2474 </span>                :<span class="lineNoCov">          0 :           dontexamine.erase( ed2iter );</span></a>
<a name="2475"><span class="lineNum">    2475 </span>                :<span class="lineNoCov">          0 :         }</span></a>
<a name="2476"><span class="lineNum">    2476 </span>                :            :         else</a>
<a name="2477"><span class="lineNum">    2477 </span>                :            :         {</a>
<a name="2478"><span class="lineNum">    2478 </span>                :            :           //test, if it is on edge_angle and angle_edge and erase them if yes</a>
<a name="2479"><span class="lineNum">    2479 </span>                :<span class="lineNoCov">          0 :           std::map&lt;int, double&gt;::iterator tempit1;</span></a>
<a name="2480"><span class="lineNum">    2480 </span>                :<span class="lineNoCov">          0 :           tempit1 = edge_angle.find( ed2 );</span></a>
<a name="2481"><span class="lineNum">    2481 </span>                :<span class="lineNoCov">          0 :           if ( tempit1 != edge_angle.end() )</span></a>
<a name="2482"><span class="lineNum">    2482 </span>                :            :           {</a>
<a name="2483"><span class="lineNum">    2483 </span>                :            :             //erase the entries</a>
<a name="2484"><span class="lineNum">    2484 </span>                :<span class="lineNoCov">          0 :             double angle = tempit1-&gt;second;</span></a>
<a name="2485"><span class="lineNum">    2485 </span>                :<span class="lineNoCov">          0 :             edge_angle.erase( ed2 );</span></a>
<a name="2486"><span class="lineNum">    2486 </span>                :<span class="lineNoCov">          0 :             std::multimap&lt;double, int&gt;::iterator tempit2 = angle_edge.lower_bound( angle );</span></a>
<a name="2487"><span class="lineNum">    2487 </span>                :<span class="lineNoCov">          0 :             while ( tempit2-&gt;second != ed2 )</span></a>
<a name="2488"><span class="lineNum">    2488 </span>                :            :             {</a>
<a name="2489"><span class="lineNum">    2489 </span>                :<span class="lineNoCov">          0 :               ++tempit2;</span></a>
<a name="2490"><span class="lineNum">    2490 </span>                :            :             }</a>
<a name="2491"><span class="lineNum">    2491 </span>                :<span class="lineNoCov">          0 :             angle_edge.erase( tempit2 );</span></a>
<a name="2492"><span class="lineNum">    2492 </span>                :<span class="lineNoCov">          0 :           }</span></a>
<a name="2493"><span class="lineNum">    2493 </span>                :            :         }</a>
<a name="2494"><span class="lineNum">    2494 </span>                :            : </a>
<a name="2495"><span class="lineNum">    2495 </span>                :<span class="lineNoCov">          0 :         if ( angle2 &lt; mintol &amp;&amp; !twoforcededges2 )</span></a>
<a name="2496"><span class="lineNum">    2496 </span>                :            :         {</a>
<a name="2497"><span class="lineNum">    2497 </span>                :<span class="lineNoCov">          0 :           edge_angle.insert( std::make_pair( ed2, angle2 ) );</span></a>
<a name="2498"><span class="lineNum">    2498 </span>                :<span class="lineNoCov">          0 :           angle_edge.insert( std::make_pair( angle2, ed2 ) );</span></a>
<a name="2499"><span class="lineNum">    2499 </span>                :<span class="lineNoCov">          0 :         }</span></a>
<a name="2500"><span class="lineNum">    2500 </span>                :            : </a>
<a name="2501"><span class="lineNum">    2501 </span>                :            :         //update the settings related to ed3</a>
<a name="2502"><span class="lineNum">    2502 </span>                :<span class="lineNoCov">          0 :         QSet&lt;int&gt;::iterator ed3iter = dontexamine.find( ed3 );</span></a>
<a name="2503"><span class="lineNum">    2503 </span>                :<span class="lineNoCov">          0 :         if ( ed3iter != dontexamine.end() )</span></a>
<a name="2504"><span class="lineNum">    2504 </span>                :            :         {</a>
<a name="2505"><span class="lineNum">    2505 </span>                :            :           //edge number is on dontexamine list</a>
<a name="2506"><span class="lineNum">    2506 </span>                :<span class="lineNoCov">          0 :           dontexamine.erase( ed3iter );</span></a>
<a name="2507"><span class="lineNum">    2507 </span>                :<span class="lineNoCov">          0 :         }</span></a>
<a name="2508"><span class="lineNum">    2508 </span>                :            :         else</a>
<a name="2509"><span class="lineNum">    2509 </span>                :            :         {</a>
<a name="2510"><span class="lineNum">    2510 </span>                :            :           //test, if it is on edge_angle and angle_edge and erase them if yes</a>
<a name="2511"><span class="lineNum">    2511 </span>                :<span class="lineNoCov">          0 :           std::map&lt;int, double&gt;::iterator tempit1;</span></a>
<a name="2512"><span class="lineNum">    2512 </span>                :<span class="lineNoCov">          0 :           tempit1 = edge_angle.find( ed3 );</span></a>
<a name="2513"><span class="lineNum">    2513 </span>                :<span class="lineNoCov">          0 :           if ( tempit1 != edge_angle.end() )</span></a>
<a name="2514"><span class="lineNum">    2514 </span>                :            :           {</a>
<a name="2515"><span class="lineNum">    2515 </span>                :            :             //erase the entries</a>
<a name="2516"><span class="lineNum">    2516 </span>                :<span class="lineNoCov">          0 :             double angle = tempit1-&gt;second;</span></a>
<a name="2517"><span class="lineNum">    2517 </span>                :<span class="lineNoCov">          0 :             edge_angle.erase( ed3 );</span></a>
<a name="2518"><span class="lineNum">    2518 </span>                :<span class="lineNoCov">          0 :             std::multimap&lt;double, int&gt;::iterator tempit2 = angle_edge.lower_bound( angle );</span></a>
<a name="2519"><span class="lineNum">    2519 </span>                :<span class="lineNoCov">          0 :             while ( tempit2-&gt;second != ed3 )</span></a>
<a name="2520"><span class="lineNum">    2520 </span>                :            :             {</a>
<a name="2521"><span class="lineNum">    2521 </span>                :<span class="lineNoCov">          0 :               ++tempit2;</span></a>
<a name="2522"><span class="lineNum">    2522 </span>                :            :             }</a>
<a name="2523"><span class="lineNum">    2523 </span>                :<span class="lineNoCov">          0 :             angle_edge.erase( tempit2 );</span></a>
<a name="2524"><span class="lineNum">    2524 </span>                :<span class="lineNoCov">          0 :           }</span></a>
<a name="2525"><span class="lineNum">    2525 </span>                :            :         }</a>
<a name="2526"><span class="lineNum">    2526 </span>                :            : </a>
<a name="2527"><span class="lineNum">    2527 </span>                :<span class="lineNoCov">          0 :         if ( angle3 &lt; mintol &amp;&amp; !twoforcededges3 )</span></a>
<a name="2528"><span class="lineNum">    2528 </span>                :            :         {</a>
<a name="2529"><span class="lineNum">    2529 </span>                :<span class="lineNoCov">          0 :           edge_angle.insert( std::make_pair( ed3, angle3 ) );</span></a>
<a name="2530"><span class="lineNum">    2530 </span>                :<span class="lineNoCov">          0 :           angle_edge.insert( std::make_pair( angle3, ed3 ) );</span></a>
<a name="2531"><span class="lineNum">    2531 </span>                :<span class="lineNoCov">          0 :         }</span></a>
<a name="2532"><span class="lineNum">    2532 </span>                :            : </a>
<a name="2533"><span class="lineNum">    2533 </span>                :            : </a>
<a name="2534"><span class="lineNum">    2534 </span>                :<span class="lineNoCov">          0 :       }</span></a>
<a name="2535"><span class="lineNum">    2535 </span>                :<span class="lineNoCov">          0 :       while ( actedge != pointingedge );</span></a>
<a name="2536"><span class="lineNum">    2536 </span>                :            :     }</a>
<a name="2537"><span class="lineNum">    2537 </span>                :<span class="lineNoCov">          0 :   }</span></a>
<a name="2538"><span class="lineNum">    2538 </span>                :            : </a>
<a name="2539"><span class="lineNum">    2539 </span>                :            : #if 0</a>
<a name="2540"><span class="lineNum">    2540 </span>                :            :   //debugging: print out all edge of dontexamine</a>
<a name="2541"><span class="lineNum">    2541 </span>                :            :   for ( QSet&lt;int&gt;::iterator it = dontexamine.begin(); it != dontexamine.end(); ++it )</a>
<a name="2542"><span class="lineNum">    2542 </span>                :            :   {</a>
<a name="2543"><span class="lineNum">    2543 </span>                :            :     QgsDebugMsg( QStringLiteral( &quot;edge nr. %1 is in dontexamine&quot; ).arg( *it ) );</a>
<a name="2544"><span class="lineNum">    2544 </span>                :            :   }</a>
<a name="2545"><span class="lineNum">    2545 </span>                :            : #endif</a>
<a name="2546"><span class="lineNum">    2546 </span>                :<span class="lineNoCov">          0 : }</span></a>
<a name="2547"><span class="lineNum">    2547 </span>                :            : </a>
<a name="2548"><span class="lineNum">    2548 </span>                :            : </a>
<a name="2549"><span class="lineNum">    2549 </span>                :<span class="lineNoCov">          0 : bool QgsDualEdgeTriangulation::swapPossible( unsigned int edge ) const</span></a>
<a name="2550"><span class="lineNum">    2550 </span>                :            : {</a>
<a name="2551"><span class="lineNum">    2551 </span>                :            :   //test, if edge belongs to a forced edge</a>
<a name="2552"><span class="lineNum">    2552 </span>                :<span class="lineNoCov">          0 :   if ( mHalfEdge[edge]-&gt;getForced() )</span></a>
<a name="2553"><span class="lineNum">    2553 </span>                :            :   {</a>
<a name="2554"><span class="lineNum">    2554 </span>                :<span class="lineNoCov">          0 :     return false;</span></a>
<a name="2555"><span class="lineNum">    2555 </span>                :            :   }</a>
<a name="2556"><span class="lineNum">    2556 </span>                :            : </a>
<a name="2557"><span class="lineNum">    2557 </span>                :            :   //test, if the edge is on the convex hull or is connected to the virtual point</a>
<a name="2558"><span class="lineNum">    2558 </span>                :<span class="lineNoCov">          0 :   if ( mHalfEdge[edge]-&gt;getPoint() == -1 || mHalfEdge[mHalfEdge[edge]-&gt;getNext()]-&gt;getPoint() == -1 || mHalfEdge[mHalfEdge[mHalfEdge[edge]-&gt;getDual()]-&gt;getNext()]-&gt;getPoint() == -1 || mHalfEdge[mHalfEdge[edge]-&gt;getDual()]-&gt;getPoint() == -1 )</span></a>
<a name="2559"><span class="lineNum">    2559 </span>                :            :   {</a>
<a name="2560"><span class="lineNum">    2560 </span>                :<span class="lineNoCov">          0 :     return false;</span></a>
<a name="2561"><span class="lineNum">    2561 </span>                :            :   }</a>
<a name="2562"><span class="lineNum">    2562 </span>                :            :   //then, test, if the edge is in the middle of a not convex quad</a>
<a name="2563"><span class="lineNum">    2563 </span>                :<span class="lineNoCov">          0 :   QgsPoint *pta = mPointVector[mHalfEdge[edge]-&gt;getPoint()];</span></a>
<a name="2564"><span class="lineNum">    2564 </span>                :<span class="lineNoCov">          0 :   QgsPoint *ptb = mPointVector[mHalfEdge[mHalfEdge[edge]-&gt;getNext()]-&gt;getPoint()];</span></a>
<a name="2565"><span class="lineNum">    2565 </span>                :<span class="lineNoCov">          0 :   QgsPoint *ptc = mPointVector[mHalfEdge[mHalfEdge[mHalfEdge[edge]-&gt;getNext()]-&gt;getNext()]-&gt;getPoint()];</span></a>
<a name="2566"><span class="lineNum">    2566 </span>                :<span class="lineNoCov">          0 :   QgsPoint *ptd = mPointVector[mHalfEdge[mHalfEdge[mHalfEdge[edge]-&gt;getDual()]-&gt;getNext()]-&gt;getPoint()];</span></a>
<a name="2567"><span class="lineNum">    2567 </span>                :<span class="lineNoCov">          0 :   if ( MathUtils::leftOf( *ptc, pta, ptb ) &gt; leftOfTresh )</span></a>
<a name="2568"><span class="lineNum">    2568 </span>                :            :   {</a>
<a name="2569"><span class="lineNum">    2569 </span>                :<span class="lineNoCov">          0 :     return false;</span></a>
<a name="2570"><span class="lineNum">    2570 </span>                :            :   }</a>
<a name="2571"><span class="lineNum">    2571 </span>                :<span class="lineNoCov">          0 :   else if ( MathUtils::leftOf( *ptd, ptb, ptc ) &gt; leftOfTresh )</span></a>
<a name="2572"><span class="lineNum">    2572 </span>                :            :   {</a>
<a name="2573"><span class="lineNum">    2573 </span>                :<span class="lineNoCov">          0 :     return false;</span></a>
<a name="2574"><span class="lineNum">    2574 </span>                :            :   }</a>
<a name="2575"><span class="lineNum">    2575 </span>                :<span class="lineNoCov">          0 :   else if ( MathUtils::leftOf( *pta, ptc, ptd ) &gt; leftOfTresh )</span></a>
<a name="2576"><span class="lineNum">    2576 </span>                :            :   {</a>
<a name="2577"><span class="lineNum">    2577 </span>                :<span class="lineNoCov">          0 :     return false;</span></a>
<a name="2578"><span class="lineNum">    2578 </span>                :            :   }</a>
<a name="2579"><span class="lineNum">    2579 </span>                :<span class="lineNoCov">          0 :   else if ( MathUtils::leftOf( *ptb, ptd, pta ) &gt; leftOfTresh )</span></a>
<a name="2580"><span class="lineNum">    2580 </span>                :            :   {</a>
<a name="2581"><span class="lineNum">    2581 </span>                :<span class="lineNoCov">          0 :     return false;</span></a>
<a name="2582"><span class="lineNum">    2582 </span>                :            :   }</a>
<a name="2583"><span class="lineNum">    2583 </span>                :<span class="lineNoCov">          0 :   return true;</span></a>
<a name="2584"><span class="lineNum">    2584 </span>                :<span class="lineNoCov">          0 : }</span></a>
<a name="2585"><span class="lineNum">    2585 </span>                :            : </a>
<a name="2586"><span class="lineNum">    2586 </span>                :<span class="lineNoCov">          0 : void QgsDualEdgeTriangulation::triangulatePolygon( QList&lt;int&gt; *poly, QList&lt;int&gt; *free, int mainedge )</span></a>
<a name="2587"><span class="lineNum">    2587 </span>                :            : {</a>
<a name="2588"><span class="lineNum">    2588 </span>                :<span class="lineNoCov">          0 :   if ( poly &amp;&amp; free )</span></a>
<a name="2589"><span class="lineNum">    2589 </span>                :            :   {</a>
<a name="2590"><span class="lineNum">    2590 </span>                :<span class="lineNoCov">          0 :     if ( poly-&gt;count() == 3 )//polygon is already a triangle</span></a>
<a name="2591"><span class="lineNum">    2591 </span>                :            :     {</a>
<a name="2592"><span class="lineNum">    2592 </span>                :<span class="lineNoCov">          0 :       return;</span></a>
<a name="2593"><span class="lineNum">    2593 </span>                :            :     }</a>
<a name="2594"><span class="lineNum">    2594 </span>                :            : </a>
<a name="2595"><span class="lineNum">    2595 </span>                :            :     //search for the edge pointing on the closest point(distedge) and for the next(nextdistedge)</a>
<a name="2596"><span class="lineNum">    2596 </span>                :<span class="lineNoCov">          0 :     QList&lt;int&gt;::const_iterator iterator = ++( poly-&gt;constBegin() );//go to the second edge</span></a>
<a name="2597"><span class="lineNum">    2597 </span>                :<span class="lineNoCov">          0 :     double distance = MathUtils::distPointFromLine( mPointVector[mHalfEdge[( *iterator )]-&gt;getPoint()], mPointVector[mHalfEdge[mHalfEdge[mainedge]-&gt;getDual()]-&gt;getPoint()], mPointVector[mHalfEdge[mainedge]-&gt;getPoint()] );</span></a>
<a name="2598"><span class="lineNum">    2598 </span>                :<span class="lineNoCov">          0 :     int distedge = ( *iterator );</span></a>
<a name="2599"><span class="lineNum">    2599 </span>                :<span class="lineNoCov">          0 :     int nextdistedge = mHalfEdge[( *iterator )]-&gt;getNext();</span></a>
<a name="2600"><span class="lineNum">    2600 </span>                :<span class="lineNoCov">          0 :     ++iterator;</span></a>
<a name="2601"><span class="lineNum">    2601 </span>                :            : </a>
<a name="2602"><span class="lineNum">    2602 </span>                :<span class="lineNoCov">          0 :     while ( iterator != --( poly-&gt;constEnd() ) )</span></a>
<a name="2603"><span class="lineNum">    2603 </span>                :            :     {</a>
<a name="2604"><span class="lineNum">    2604 </span>                :<span class="lineNoCov">          0 :       if ( MathUtils::distPointFromLine( mPointVector[mHalfEdge[( *iterator )]-&gt;getPoint()], mPointVector[mHalfEdge[mHalfEdge[mainedge]-&gt;getDual()]-&gt;getPoint()], mPointVector[mHalfEdge[mainedge]-&gt;getPoint()] ) &lt; distance )</span></a>
<a name="2605"><span class="lineNum">    2605 </span>                :            :       {</a>
<a name="2606"><span class="lineNum">    2606 </span>                :<span class="lineNoCov">          0 :         distedge = ( *iterator );</span></a>
<a name="2607"><span class="lineNum">    2607 </span>                :<span class="lineNoCov">          0 :         nextdistedge = mHalfEdge[( *iterator )]-&gt;getNext();</span></a>
<a name="2608"><span class="lineNum">    2608 </span>                :<span class="lineNoCov">          0 :         distance = MathUtils::distPointFromLine( mPointVector[mHalfEdge[( *iterator )]-&gt;getPoint()], mPointVector[mHalfEdge[mHalfEdge[mainedge]-&gt;getDual()]-&gt;getPoint()], mPointVector[mHalfEdge[mainedge]-&gt;getPoint()] );</span></a>
<a name="2609"><span class="lineNum">    2609 </span>                :<span class="lineNoCov">          0 :       }</span></a>
<a name="2610"><span class="lineNum">    2610 </span>                :<span class="lineNoCov">          0 :       ++iterator;</span></a>
<a name="2611"><span class="lineNum">    2611 </span>                :            :     }</a>
<a name="2612"><span class="lineNum">    2612 </span>                :            : </a>
<a name="2613"><span class="lineNum">    2613 </span>                :<span class="lineNoCov">          0 :     if ( nextdistedge == ( *( --poly-&gt;end() ) ) )//the nearest point is connected to the endpoint of mainedge</span></a>
<a name="2614"><span class="lineNum">    2614 </span>                :            :     {</a>
<a name="2615"><span class="lineNum">    2615 </span>                :<span class="lineNoCov">          0 :       int inserta = free-&gt;first();//take an edge from the freelist</span></a>
<a name="2616"><span class="lineNum">    2616 </span>                :<span class="lineNoCov">          0 :       int insertb = mHalfEdge[inserta]-&gt;getDual();</span></a>
<a name="2617"><span class="lineNum">    2617 </span>                :<span class="lineNoCov">          0 :       free-&gt;pop_front();</span></a>
<a name="2618"><span class="lineNum">    2618 </span>                :            : </a>
<a name="2619"><span class="lineNum">    2619 </span>                :<span class="lineNoCov">          0 :       mHalfEdge[inserta]-&gt;setNext( ( poly-&gt;at( 1 ) ) );</span></a>
<a name="2620"><span class="lineNum">    2620 </span>                :<span class="lineNoCov">          0 :       mHalfEdge[inserta]-&gt;setPoint( mHalfEdge[mainedge]-&gt;getPoint() );</span></a>
<a name="2621"><span class="lineNum">    2621 </span>                :<span class="lineNoCov">          0 :       mHalfEdge[insertb]-&gt;setNext( nextdistedge );</span></a>
<a name="2622"><span class="lineNum">    2622 </span>                :<span class="lineNoCov">          0 :       mHalfEdge[insertb]-&gt;setPoint( mHalfEdge[distedge]-&gt;getPoint() );</span></a>
<a name="2623"><span class="lineNum">    2623 </span>                :<span class="lineNoCov">          0 :       mHalfEdge[distedge]-&gt;setNext( inserta );</span></a>
<a name="2624"><span class="lineNum">    2624 </span>                :<span class="lineNoCov">          0 :       mHalfEdge[mainedge]-&gt;setNext( insertb );</span></a>
<a name="2625"><span class="lineNum">    2625 </span>                :            : </a>
<a name="2626"><span class="lineNum">    2626 </span>                :<span class="lineNoCov">          0 :       QList&lt;int&gt; polya;</span></a>
<a name="2627"><span class="lineNum">    2627 </span>                :<span class="lineNoCov">          0 :       for ( iterator = ( ++( poly-&gt;constBegin() ) ); ( *iterator ) != nextdistedge; ++iterator )</span></a>
<a name="2628"><span class="lineNum">    2628 </span>                :            :       {</a>
<a name="2629"><span class="lineNum">    2629 </span>                :<span class="lineNoCov">          0 :         polya.append( ( *iterator ) );</span></a>
<a name="2630"><span class="lineNum">    2630 </span>                :<span class="lineNoCov">          0 :       }</span></a>
<a name="2631"><span class="lineNum">    2631 </span>                :<span class="lineNoCov">          0 :       polya.prepend( inserta );</span></a>
<a name="2632"><span class="lineNum">    2632 </span>                :            : </a>
<a name="2633"><span class="lineNum">    2633 </span>                :            : #if 0</a>
<a name="2634"><span class="lineNum">    2634 </span>                :            :       //print out all the elements of polya for a test</a>
<a name="2635"><span class="lineNum">    2635 </span>                :            :       for ( iterator = polya.begin(); iterator != polya.end(); ++iterator )</a>
<a name="2636"><span class="lineNum">    2636 </span>                :            :       {</a>
<a name="2637"><span class="lineNum">    2637 </span>                :            :         QgsDebugMsg( *iterator );</a>
<a name="2638"><span class="lineNum">    2638 </span>                :            :       }</a>
<a name="2639"><span class="lineNum">    2639 </span>                :            : #endif</a>
<a name="2640"><span class="lineNum">    2640 </span>                :            : </a>
<a name="2641"><span class="lineNum">    2641 </span>                :<span class="lineNoCov">          0 :       triangulatePolygon( &amp;polya, free, inserta );</span></a>
<a name="2642"><span class="lineNum">    2642 </span>                :<span class="lineNoCov">          0 :     }</span></a>
<a name="2643"><span class="lineNum">    2643 </span>                :            : </a>
<a name="2644"><span class="lineNum">    2644 </span>                :<span class="lineNoCov">          0 :     else if ( distedge == ( *( ++poly-&gt;begin() ) ) )//the nearest point is connected to the beginpoint of mainedge</span></a>
<a name="2645"><span class="lineNum">    2645 </span>                :            :     {</a>
<a name="2646"><span class="lineNum">    2646 </span>                :<span class="lineNoCov">          0 :       int inserta = free-&gt;first();//take an edge from the freelist</span></a>
<a name="2647"><span class="lineNum">    2647 </span>                :<span class="lineNoCov">          0 :       int insertb = mHalfEdge[inserta]-&gt;getDual();</span></a>
<a name="2648"><span class="lineNum">    2648 </span>                :<span class="lineNoCov">          0 :       free-&gt;pop_front();</span></a>
<a name="2649"><span class="lineNum">    2649 </span>                :            : </a>
<a name="2650"><span class="lineNum">    2650 </span>                :<span class="lineNoCov">          0 :       mHalfEdge[inserta]-&gt;setNext( ( poly-&gt;at( 2 ) ) );</span></a>
<a name="2651"><span class="lineNum">    2651 </span>                :<span class="lineNoCov">          0 :       mHalfEdge[inserta]-&gt;setPoint( mHalfEdge[distedge]-&gt;getPoint() );</span></a>
<a name="2652"><span class="lineNum">    2652 </span>                :<span class="lineNoCov">          0 :       mHalfEdge[insertb]-&gt;setNext( mainedge );</span></a>
<a name="2653"><span class="lineNum">    2653 </span>                :<span class="lineNoCov">          0 :       mHalfEdge[insertb]-&gt;setPoint( mHalfEdge[mHalfEdge[mainedge]-&gt;getDual()]-&gt;getPoint() );</span></a>
<a name="2654"><span class="lineNum">    2654 </span>                :<span class="lineNoCov">          0 :       mHalfEdge[distedge]-&gt;setNext( insertb );</span></a>
<a name="2655"><span class="lineNum">    2655 </span>                :<span class="lineNoCov">          0 :       mHalfEdge[( *( --poly-&gt;end() ) )]-&gt;setNext( inserta );</span></a>
<a name="2656"><span class="lineNum">    2656 </span>                :            : </a>
<a name="2657"><span class="lineNum">    2657 </span>                :<span class="lineNoCov">          0 :       QList&lt;int&gt; polya;</span></a>
<a name="2658"><span class="lineNum">    2658 </span>                :<span class="lineNoCov">          0 :       iterator = poly-&gt;constBegin();</span></a>
<a name="2659"><span class="lineNum">    2659 </span>                :<span class="lineNoCov">          0 :       iterator += 2;</span></a>
<a name="2660"><span class="lineNum">    2660 </span>                :<span class="lineNoCov">          0 :       while ( iterator != poly-&gt;constEnd() )</span></a>
<a name="2661"><span class="lineNum">    2661 </span>                :            :       {</a>
<a name="2662"><span class="lineNum">    2662 </span>                :<span class="lineNoCov">          0 :         polya.append( ( *iterator ) );</span></a>
<a name="2663"><span class="lineNum">    2663 </span>                :<span class="lineNoCov">          0 :         ++iterator;</span></a>
<a name="2664"><span class="lineNum">    2664 </span>                :            :       }</a>
<a name="2665"><span class="lineNum">    2665 </span>                :<span class="lineNoCov">          0 :       polya.prepend( inserta );</span></a>
<a name="2666"><span class="lineNum">    2666 </span>                :            : </a>
<a name="2667"><span class="lineNum">    2667 </span>                :<span class="lineNoCov">          0 :       triangulatePolygon( &amp;polya, free, inserta );</span></a>
<a name="2668"><span class="lineNum">    2668 </span>                :<span class="lineNoCov">          0 :     }</span></a>
<a name="2669"><span class="lineNum">    2669 </span>                :            : </a>
<a name="2670"><span class="lineNum">    2670 </span>                :            :     else//the nearest point is not connected to an endpoint of mainedge</a>
<a name="2671"><span class="lineNum">    2671 </span>                :            :     {</a>
<a name="2672"><span class="lineNum">    2672 </span>                :<span class="lineNoCov">          0 :       int inserta = free-&gt;first();//take an edge from the freelist</span></a>
<a name="2673"><span class="lineNum">    2673 </span>                :<span class="lineNoCov">          0 :       int insertb = mHalfEdge[inserta]-&gt;getDual();</span></a>
<a name="2674"><span class="lineNum">    2674 </span>                :<span class="lineNoCov">          0 :       free-&gt;pop_front();</span></a>
<a name="2675"><span class="lineNum">    2675 </span>                :            : </a>
<a name="2676"><span class="lineNum">    2676 </span>                :<span class="lineNoCov">          0 :       int insertc = free-&gt;first();</span></a>
<a name="2677"><span class="lineNum">    2677 </span>                :<span class="lineNoCov">          0 :       int insertd = mHalfEdge[insertc]-&gt;getDual();</span></a>
<a name="2678"><span class="lineNum">    2678 </span>                :<span class="lineNoCov">          0 :       free-&gt;pop_front();</span></a>
<a name="2679"><span class="lineNum">    2679 </span>                :            : </a>
<a name="2680"><span class="lineNum">    2680 </span>                :<span class="lineNoCov">          0 :       mHalfEdge[inserta]-&gt;setNext( ( poly-&gt;at( 1 ) ) );</span></a>
<a name="2681"><span class="lineNum">    2681 </span>                :<span class="lineNoCov">          0 :       mHalfEdge[inserta]-&gt;setPoint( mHalfEdge[mainedge]-&gt;getPoint() );</span></a>
<a name="2682"><span class="lineNum">    2682 </span>                :<span class="lineNoCov">          0 :       mHalfEdge[insertb]-&gt;setNext( insertd );</span></a>
<a name="2683"><span class="lineNum">    2683 </span>                :<span class="lineNoCov">          0 :       mHalfEdge[insertb]-&gt;setPoint( mHalfEdge[distedge]-&gt;getPoint() );</span></a>
<a name="2684"><span class="lineNum">    2684 </span>                :<span class="lineNoCov">          0 :       mHalfEdge[insertc]-&gt;setNext( nextdistedge );</span></a>
<a name="2685"><span class="lineNum">    2685 </span>                :<span class="lineNoCov">          0 :       mHalfEdge[insertc]-&gt;setPoint( mHalfEdge[distedge]-&gt;getPoint() );</span></a>
<a name="2686"><span class="lineNum">    2686 </span>                :<span class="lineNoCov">          0 :       mHalfEdge[insertd]-&gt;setNext( mainedge );</span></a>
<a name="2687"><span class="lineNum">    2687 </span>                :<span class="lineNoCov">          0 :       mHalfEdge[insertd]-&gt;setPoint( mHalfEdge[mHalfEdge[mainedge]-&gt;getDual()]-&gt;getPoint() );</span></a>
<a name="2688"><span class="lineNum">    2688 </span>                :            : </a>
<a name="2689"><span class="lineNum">    2689 </span>                :<span class="lineNoCov">          0 :       mHalfEdge[distedge]-&gt;setNext( inserta );</span></a>
<a name="2690"><span class="lineNum">    2690 </span>                :<span class="lineNoCov">          0 :       mHalfEdge[mainedge]-&gt;setNext( insertb );</span></a>
<a name="2691"><span class="lineNum">    2691 </span>                :<span class="lineNoCov">          0 :       mHalfEdge[( *( --poly-&gt;end() ) )]-&gt;setNext( insertc );</span></a>
<a name="2692"><span class="lineNum">    2692 </span>                :            : </a>
<a name="2693"><span class="lineNum">    2693 </span>                :            :       //build two new polygons for recursive triangulation</a>
<a name="2694"><span class="lineNum">    2694 </span>                :<span class="lineNoCov">          0 :       QList&lt;int&gt; polya;</span></a>
<a name="2695"><span class="lineNum">    2695 </span>                :<span class="lineNoCov">          0 :       QList&lt;int&gt; polyb;</span></a>
<a name="2696"><span class="lineNum">    2696 </span>                :            : </a>
<a name="2697"><span class="lineNum">    2697 </span>                :<span class="lineNoCov">          0 :       for ( iterator = ++( poly-&gt;constBegin() ); ( *iterator ) != nextdistedge; ++iterator )</span></a>
<a name="2698"><span class="lineNum">    2698 </span>                :            :       {</a>
<a name="2699"><span class="lineNum">    2699 </span>                :<span class="lineNoCov">          0 :         polya.append( ( *iterator ) );</span></a>
<a name="2700"><span class="lineNum">    2700 </span>                :<span class="lineNoCov">          0 :       }</span></a>
<a name="2701"><span class="lineNum">    2701 </span>                :<span class="lineNoCov">          0 :       polya.prepend( inserta );</span></a>
<a name="2702"><span class="lineNum">    2702 </span>                :            : </a>
<a name="2703"><span class="lineNum">    2703 </span>                :            : </a>
<a name="2704"><span class="lineNum">    2704 </span>                :<span class="lineNoCov">          0 :       while ( iterator != poly-&gt;constEnd() )</span></a>
<a name="2705"><span class="lineNum">    2705 </span>                :            :       {</a>
<a name="2706"><span class="lineNum">    2706 </span>                :<span class="lineNoCov">          0 :         polyb.append( ( *iterator ) );</span></a>
<a name="2707"><span class="lineNum">    2707 </span>                :<span class="lineNoCov">          0 :         ++iterator;</span></a>
<a name="2708"><span class="lineNum">    2708 </span>                :            :       }</a>
<a name="2709"><span class="lineNum">    2709 </span>                :<span class="lineNoCov">          0 :       polyb.prepend( insertc );</span></a>
<a name="2710"><span class="lineNum">    2710 </span>                :            : </a>
<a name="2711"><span class="lineNum">    2711 </span>                :<span class="lineNoCov">          0 :       triangulatePolygon( &amp;polya, free, inserta );</span></a>
<a name="2712"><span class="lineNum">    2712 </span>                :<span class="lineNoCov">          0 :       triangulatePolygon( &amp;polyb, free, insertc );</span></a>
<a name="2713"><span class="lineNum">    2713 </span>                :<span class="lineNoCov">          0 :     }</span></a>
<a name="2714"><span class="lineNum">    2714 </span>                :<span class="lineNoCov">          0 :   }</span></a>
<a name="2715"><span class="lineNum">    2715 </span>                :            : </a>
<a name="2716"><span class="lineNum">    2716 </span>                :            :   else</a>
<a name="2717"><span class="lineNum">    2717 </span>                :            :   {</a>
<a name="2718"><span class="lineNum">    2718 </span>                :<span class="lineNoCov">          0 :     QgsDebugMsg( QStringLiteral( &quot;warning, null pointer&quot; ) );</span></a>
<a name="2719"><span class="lineNum">    2719 </span>                :            :   }</a>
<a name="2720"><span class="lineNum">    2720 </span>                :            : </a>
<a name="2721"><span class="lineNum">    2721 </span>                :<span class="lineNoCov">          0 : }</span></a>
<a name="2722"><span class="lineNum">    2722 </span>                :            : </a>
<a name="2723"><span class="lineNum">    2723 </span>                :<span class="lineNoCov">          0 : bool QgsDualEdgeTriangulation::pointInside( double x, double y )</span></a>
<a name="2724"><span class="lineNum">    2724 </span>                :            : {</a>
<a name="2725"><span class="lineNum">    2725 </span>                :<span class="lineNoCov">          0 :   QgsPoint point( x, y, 0 );</span></a>
<a name="2726"><span class="lineNum">    2726 </span>                :<span class="lineNoCov">          0 :   unsigned int actedge = mEdgeInside;//start with an edge which does not point to the virtual point</span></a>
<a name="2727"><span class="lineNum">    2727 </span>                :<span class="lineNoCov">          0 :   int counter = 0;//number of consecutive successful left-of-tests</span></a>
<a name="2728"><span class="lineNum">    2728 </span>                :<span class="lineNoCov">          0 :   int nulls = 0;//number of left-of-tests, which returned 0. 1 means, that the point is on a line, 2 means that it is on an existing point</span></a>
<a name="2729"><span class="lineNum">    2729 </span>                :<span class="lineNoCov">          0 :   int numinstabs = 0;//number of suspect left-of-tests due to 'leftOfTresh'</span></a>
<a name="2730"><span class="lineNum">    2730 </span>                :<span class="lineNoCov">          0 :   int runs = 0;//counter for the number of iterations in the loop to prevent an endless loop</span></a>
<a name="2731"><span class="lineNum">    2731 </span>                :            : </a>
<a name="2732"><span class="lineNum">    2732 </span>                :<span class="lineNoCov">          0 :   while ( true )</span></a>
<a name="2733"><span class="lineNum">    2733 </span>                :            :   {</a>
<a name="2734"><span class="lineNum">    2734 </span>                :<span class="lineNoCov">          0 :     if ( runs &gt; MAX_BASE_ITERATIONS )//prevents endless loops</span></a>
<a name="2735"><span class="lineNum">    2735 </span>                :            :     {</a>
<a name="2736"><span class="lineNum">    2736 </span>                :<span class="lineNoCov">          0 :       QgsDebugMsg( QStringLiteral( &quot;warning, instability detected: Point coordinates: %1//%2&quot; ).arg( x ).arg( y ) );</span></a>
<a name="2737"><span class="lineNum">    2737 </span>                :<span class="lineNoCov">          0 :       return false;</span></a>
<a name="2738"><span class="lineNum">    2738 </span>                :            :     }</a>
<a name="2739"><span class="lineNum">    2739 </span>                :            : </a>
<a name="2740"><span class="lineNum">    2740 </span>                :<span class="lineNoCov">          0 :     if ( MathUtils::leftOf( point, mPointVector[mHalfEdge[mHalfEdge[actedge]-&gt;getDual()]-&gt;getPoint()], mPointVector[mHalfEdge[actedge]-&gt;getPoint()] ) &lt; ( -leftOfTresh ) )//point is on the left side</span></a>
<a name="2741"><span class="lineNum">    2741 </span>                :            :     {</a>
<a name="2742"><span class="lineNum">    2742 </span>                :<span class="lineNoCov">          0 :       counter += 1;</span></a>
<a name="2743"><span class="lineNum">    2743 </span>                :<span class="lineNoCov">          0 :       if ( counter == 3 )//three successful passes means that we have found the triangle</span></a>
<a name="2744"><span class="lineNum">    2744 </span>                :            :       {</a>
<a name="2745"><span class="lineNum">    2745 </span>                :<span class="lineNoCov">          0 :         break;</span></a>
<a name="2746"><span class="lineNum">    2746 </span>                :            :       }</a>
<a name="2747"><span class="lineNum">    2747 </span>                :<span class="lineNoCov">          0 :     }</span></a>
<a name="2748"><span class="lineNum">    2748 </span>                :            : </a>
<a name="2749"><span class="lineNum">    2749 </span>                :<span class="lineNoCov">          0 :     else if ( fabs( MathUtils::leftOf( point, mPointVector[mHalfEdge[mHalfEdge[actedge]-&gt;getDual()]-&gt;getPoint()], mPointVector[mHalfEdge[actedge]-&gt;getPoint()] ) ) &lt;= leftOfTresh ) //point is exactly in the line of the edge</span></a>
<a name="2750"><span class="lineNum">    2750 </span>                :            :     {</a>
<a name="2751"><span class="lineNum">    2751 </span>                :<span class="lineNoCov">          0 :       counter += 1;</span></a>
<a name="2752"><span class="lineNum">    2752 </span>                :<span class="lineNoCov">          0 :       mEdgeWithPoint = actedge;</span></a>
<a name="2753"><span class="lineNum">    2753 </span>                :<span class="lineNoCov">          0 :       nulls += 1;</span></a>
<a name="2754"><span class="lineNum">    2754 </span>                :<span class="lineNoCov">          0 :       if ( counter == 3 )//three successful passes means that we have found the triangle</span></a>
<a name="2755"><span class="lineNum">    2755 </span>                :            :       {</a>
<a name="2756"><span class="lineNum">    2756 </span>                :<span class="lineNoCov">          0 :         break;</span></a>
<a name="2757"><span class="lineNum">    2757 </span>                :            :       }</a>
<a name="2758"><span class="lineNum">    2758 </span>                :<span class="lineNoCov">          0 :     }</span></a>
<a name="2759"><span class="lineNum">    2759 </span>                :            : </a>
<a name="2760"><span class="lineNum">    2760 </span>                :            :     else//point is on the right side</a>
<a name="2761"><span class="lineNum">    2761 </span>                :            :     {</a>
<a name="2762"><span class="lineNum">    2762 </span>                :<span class="lineNoCov">          0 :       actedge = mHalfEdge[actedge]-&gt;getDual();</span></a>
<a name="2763"><span class="lineNum">    2763 </span>                :<span class="lineNoCov">          0 :       counter = 1;</span></a>
<a name="2764"><span class="lineNum">    2764 </span>                :<span class="lineNoCov">          0 :       nulls = 0;</span></a>
<a name="2765"><span class="lineNum">    2765 </span>                :<span class="lineNoCov">          0 :       numinstabs = 0;</span></a>
<a name="2766"><span class="lineNum">    2766 </span>                :            :     }</a>
<a name="2767"><span class="lineNum">    2767 </span>                :            : </a>
<a name="2768"><span class="lineNum">    2768 </span>                :<span class="lineNoCov">          0 :     actedge = mHalfEdge[actedge]-&gt;getNext();</span></a>
<a name="2769"><span class="lineNum">    2769 </span>                :<span class="lineNoCov">          0 :     if ( mHalfEdge[actedge]-&gt;getPoint() == -1 )//the half edge points to the virtual point</span></a>
<a name="2770"><span class="lineNum">    2770 </span>                :            :     {</a>
<a name="2771"><span class="lineNum">    2771 </span>                :<span class="lineNoCov">          0 :       if ( nulls == 1 )//point is exactly on the convex hull</span></a>
<a name="2772"><span class="lineNum">    2772 </span>                :            :       {</a>
<a name="2773"><span class="lineNum">    2773 </span>                :<span class="lineNoCov">          0 :         return true;</span></a>
<a name="2774"><span class="lineNum">    2774 </span>                :            :       }</a>
<a name="2775"><span class="lineNum">    2775 </span>                :<span class="lineNoCov">          0 :       mEdgeOutside = ( unsigned int )mHalfEdge[mHalfEdge[actedge]-&gt;getNext()]-&gt;getNext();</span></a>
<a name="2776"><span class="lineNum">    2776 </span>                :<span class="lineNoCov">          0 :       return false;//the point is outside the convex hull</span></a>
<a name="2777"><span class="lineNum">    2777 </span>                :            :     }</a>
<a name="2778"><span class="lineNum">    2778 </span>                :<span class="lineNoCov">          0 :     runs++;</span></a>
<a name="2779"><span class="lineNum">    2779 </span>                :            :   }</a>
<a name="2780"><span class="lineNum">    2780 </span>                :            : </a>
<a name="2781"><span class="lineNum">    2781 </span>                :<span class="lineNoCov">          0 :   if ( nulls == 2 )//we hit an existing point</span></a>
<a name="2782"><span class="lineNum">    2782 </span>                :            :   {</a>
<a name="2783"><span class="lineNum">    2783 </span>                :<span class="lineNoCov">          0 :     return true;</span></a>
<a name="2784"><span class="lineNum">    2784 </span>                :            :   }</a>
<a name="2785"><span class="lineNum">    2785 </span>                :<span class="lineNoCov">          0 :   if ( numinstabs &gt; 0 )//a numerical instability occurred</span></a>
<a name="2786"><span class="lineNum">    2786 </span>                :            :   {</a>
<a name="2787"><span class="lineNum">    2787 </span>                :<span class="lineNoCov">          0 :     QgsDebugMsg( QStringLiteral( &quot;numerical instabilities&quot; ) );</span></a>
<a name="2788"><span class="lineNum">    2788 </span>                :<span class="lineNoCov">          0 :     return true;</span></a>
<a name="2789"><span class="lineNum">    2789 </span>                :            :   }</a>
<a name="2790"><span class="lineNum">    2790 </span>                :            : </a>
<a name="2791"><span class="lineNum">    2791 </span>                :<span class="lineNoCov">          0 :   if ( nulls == 1 )//point is on an existing edge</span></a>
<a name="2792"><span class="lineNum">    2792 </span>                :            :   {</a>
<a name="2793"><span class="lineNum">    2793 </span>                :<span class="lineNoCov">          0 :     return true;</span></a>
<a name="2794"><span class="lineNum">    2794 </span>                :            :   }</a>
<a name="2795"><span class="lineNum">    2795 </span>                :<span class="lineNoCov">          0 :   mEdgeInside = actedge;</span></a>
<a name="2796"><span class="lineNum">    2796 </span>                :<span class="lineNoCov">          0 :   return true;</span></a>
<a name="2797"><span class="lineNum">    2797 </span>                :<span class="lineNoCov">          0 : }</span></a>
<a name="2798"><span class="lineNum">    2798 </span>                :            : </a>
<a name="2799"><span class="lineNum">    2799 </span>                :            : #if 0</a>
<a name="2800"><span class="lineNum">    2800 </span>                :            : bool DualEdgeTriangulation::readFromTAFF( QString filename )</a>
<a name="2801"><span class="lineNum">    2801 </span>                :            : {</a>
<a name="2802"><span class="lineNum">    2802 </span>                :            :   QApplication::setOverrideCursor( QCursor( Qt::WaitCursor ) );//change the cursor</a>
<a name="2803"><span class="lineNum">    2803 </span>                :            : </a>
<a name="2804"><span class="lineNum">    2804 </span>                :            :   QFile file( filename );//the file to be read</a>
<a name="2805"><span class="lineNum">    2805 </span>                :            :   file.open( IO_Raw | IO_ReadOnly );</a>
<a name="2806"><span class="lineNum">    2806 </span>                :            :   QBuffer buffer( file.readAll() );//the buffer to copy the file to</a>
<a name="2807"><span class="lineNum">    2807 </span>                :            :   file.close();</a>
<a name="2808"><span class="lineNum">    2808 </span>                :            : </a>
<a name="2809"><span class="lineNum">    2809 </span>                :            :   QTextStream textstream( &amp;buffer );</a>
<a name="2810"><span class="lineNum">    2810 </span>                :            :   buffer.open( IO_ReadOnly );</a>
<a name="2811"><span class="lineNum">    2811 </span>                :            : </a>
<a name="2812"><span class="lineNum">    2812 </span>                :            :   QString buff;</a>
<a name="2813"><span class="lineNum">    2813 </span>                :            :   int numberofhalfedges;</a>
<a name="2814"><span class="lineNum">    2814 </span>                :            :   int numberofpoints;</a>
<a name="2815"><span class="lineNum">    2815 </span>                :            : </a>
<a name="2816"><span class="lineNum">    2816 </span>                :            :   //edge section</a>
<a name="2817"><span class="lineNum">    2817 </span>                :            :   while ( buff.mid( 0, 4 ) != &quot;TRIA&quot; )//search for the TRIA-section</a>
<a name="2818"><span class="lineNum">    2818 </span>                :            :   {</a>
<a name="2819"><span class="lineNum">    2819 </span>                :            :     buff = textstream.readLine();</a>
<a name="2820"><span class="lineNum">    2820 </span>                :            :   }</a>
<a name="2821"><span class="lineNum">    2821 </span>                :            :   while ( buff.mid( 0, 4 ) != &quot;NEDG&quot; )</a>
<a name="2822"><span class="lineNum">    2822 </span>                :            :   {</a>
<a name="2823"><span class="lineNum">    2823 </span>                :            :     buff = textstream.readLine();</a>
<a name="2824"><span class="lineNum">    2824 </span>                :            :   }</a>
<a name="2825"><span class="lineNum">    2825 </span>                :            :   numberofhalfedges = buff.section( ' ', 1, 1 ).toInt();</a>
<a name="2826"><span class="lineNum">    2826 </span>                :            :   mHalfEdge.resize( numberofhalfedges );</a>
<a name="2827"><span class="lineNum">    2827 </span>                :            : </a>
<a name="2828"><span class="lineNum">    2828 </span>                :            : </a>
<a name="2829"><span class="lineNum">    2829 </span>                :            :   while ( buff.mid( 0, 4 ) != &quot;DATA&quot; )//search for the data section</a>
<a name="2830"><span class="lineNum">    2830 </span>                :            :   {</a>
<a name="2831"><span class="lineNum">    2831 </span>                :            :     textstream &gt;&gt; buff;</a>
<a name="2832"><span class="lineNum">    2832 </span>                :            :   }</a>
<a name="2833"><span class="lineNum">    2833 </span>                :            : </a>
<a name="2834"><span class="lineNum">    2834 </span>                :            :   int nr1, nr2, dual1, dual2, point1, point2, next1, next2, fo1, fo2, b1, b2;</a>
<a name="2835"><span class="lineNum">    2835 </span>                :            :   bool forced1, forced2, break1, break2;</a>
<a name="2836"><span class="lineNum">    2836 </span>                :            : </a>
<a name="2837"><span class="lineNum">    2837 </span>                :            : </a>
<a name="2838"><span class="lineNum">    2838 </span>                :            :   //import all the DualEdges</a>
<a name="2839"><span class="lineNum">    2839 </span>                :            :   QProgressBar *edgebar = new QProgressBar();//use a progress dialog so that it is not boring for the user</a>
<a name="2840"><span class="lineNum">    2840 </span>                :            :   edgebar-&gt;setCaption( tr( &quot;Reading edges&quot; ) );</a>
<a name="2841"><span class="lineNum">    2841 </span>                :            :   edgebar-&gt;setTotalSteps( numberofhalfedges / 2 );</a>
<a name="2842"><span class="lineNum">    2842 </span>                :            :   edgebar-&gt;setMinimumWidth( 400 );</a>
<a name="2843"><span class="lineNum">    2843 </span>                :            :   edgebar-&gt;move( 500, 500 );</a>
<a name="2844"><span class="lineNum">    2844 </span>                :            :   edgebar-&gt;show();</a>
<a name="2845"><span class="lineNum">    2845 </span>                :            : </a>
<a name="2846"><span class="lineNum">    2846 </span>                :            :   for ( int i = 0; i &lt; numberofhalfedges / 2; i++ )</a>
<a name="2847"><span class="lineNum">    2847 </span>                :            :   {</a>
<a name="2848"><span class="lineNum">    2848 </span>                :            :     if ( i % 1000 == 0 )</a>
<a name="2849"><span class="lineNum">    2849 </span>                :            :     {</a>
<a name="2850"><span class="lineNum">    2850 </span>                :            :       edgebar-&gt;setProgress( i );</a>
<a name="2851"><span class="lineNum">    2851 </span>                :            :     }</a>
<a name="2852"><span class="lineNum">    2852 </span>                :            : </a>
<a name="2853"><span class="lineNum">    2853 </span>                :            :     textstream &gt;&gt; nr1;</a>
<a name="2854"><span class="lineNum">    2854 </span>                :            :     textstream &gt;&gt; point1;</a>
<a name="2855"><span class="lineNum">    2855 </span>                :            :     textstream &gt;&gt; next1;</a>
<a name="2856"><span class="lineNum">    2856 </span>                :            :     textstream &gt;&gt; fo1;</a>
<a name="2857"><span class="lineNum">    2857 </span>                :            : </a>
<a name="2858"><span class="lineNum">    2858 </span>                :            :     if ( fo1 == 0 )</a>
<a name="2859"><span class="lineNum">    2859 </span>                :            :     {</a>
<a name="2860"><span class="lineNum">    2860 </span>                :            :       forced1 = false;</a>
<a name="2861"><span class="lineNum">    2861 </span>                :            :     }</a>
<a name="2862"><span class="lineNum">    2862 </span>                :            :     else</a>
<a name="2863"><span class="lineNum">    2863 </span>                :            :     {</a>
<a name="2864"><span class="lineNum">    2864 </span>                :            :       forced1 = true;</a>
<a name="2865"><span class="lineNum">    2865 </span>                :            :     }</a>
<a name="2866"><span class="lineNum">    2866 </span>                :            : </a>
<a name="2867"><span class="lineNum">    2867 </span>                :            :     textstream &gt;&gt; b1;</a>
<a name="2868"><span class="lineNum">    2868 </span>                :            : </a>
<a name="2869"><span class="lineNum">    2869 </span>                :            :     if ( b1 == 0 )</a>
<a name="2870"><span class="lineNum">    2870 </span>                :            :     {</a>
<a name="2871"><span class="lineNum">    2871 </span>                :            :       break1 = false;</a>
<a name="2872"><span class="lineNum">    2872 </span>                :            :     }</a>
<a name="2873"><span class="lineNum">    2873 </span>                :            :     else</a>
<a name="2874"><span class="lineNum">    2874 </span>                :            :     {</a>
<a name="2875"><span class="lineNum">    2875 </span>                :            :       break1 = true;</a>
<a name="2876"><span class="lineNum">    2876 </span>                :            :     }</a>
<a name="2877"><span class="lineNum">    2877 </span>                :            : </a>
<a name="2878"><span class="lineNum">    2878 </span>                :            :     textstream &gt;&gt; nr2;</a>
<a name="2879"><span class="lineNum">    2879 </span>                :            :     textstream &gt;&gt; point2;</a>
<a name="2880"><span class="lineNum">    2880 </span>                :            :     textstream &gt;&gt; next2;</a>
<a name="2881"><span class="lineNum">    2881 </span>                :            :     textstream &gt;&gt; fo2;</a>
<a name="2882"><span class="lineNum">    2882 </span>                :            : </a>
<a name="2883"><span class="lineNum">    2883 </span>                :            :     if ( fo2 == 0 )</a>
<a name="2884"><span class="lineNum">    2884 </span>                :            :     {</a>
<a name="2885"><span class="lineNum">    2885 </span>                :            :       forced2 = false;</a>
<a name="2886"><span class="lineNum">    2886 </span>                :            :     }</a>
<a name="2887"><span class="lineNum">    2887 </span>                :            :     else</a>
<a name="2888"><span class="lineNum">    2888 </span>                :            :     {</a>
<a name="2889"><span class="lineNum">    2889 </span>                :            :       forced2 = true;</a>
<a name="2890"><span class="lineNum">    2890 </span>                :            :     }</a>
<a name="2891"><span class="lineNum">    2891 </span>                :            : </a>
<a name="2892"><span class="lineNum">    2892 </span>                :            :     textstream &gt;&gt; b2;</a>
<a name="2893"><span class="lineNum">    2893 </span>                :            : </a>
<a name="2894"><span class="lineNum">    2894 </span>                :            :     if ( b2 == 0 )</a>
<a name="2895"><span class="lineNum">    2895 </span>                :            :     {</a>
<a name="2896"><span class="lineNum">    2896 </span>                :            :       break2 = false;</a>
<a name="2897"><span class="lineNum">    2897 </span>                :            :     }</a>
<a name="2898"><span class="lineNum">    2898 </span>                :            :     else</a>
<a name="2899"><span class="lineNum">    2899 </span>                :            :     {</a>
<a name="2900"><span class="lineNum">    2900 </span>                :            :       break2 = true;</a>
<a name="2901"><span class="lineNum">    2901 </span>                :            :     }</a>
<a name="2902"><span class="lineNum">    2902 </span>                :            : </a>
<a name="2903"><span class="lineNum">    2903 </span>                :            :     HalfEdge *hf1 = new HalfEdge();</a>
<a name="2904"><span class="lineNum">    2904 </span>                :            :     hf1-&gt;setDual( nr2 );</a>
<a name="2905"><span class="lineNum">    2905 </span>                :            :     hf1-&gt;setNext( next1 );</a>
<a name="2906"><span class="lineNum">    2906 </span>                :            :     hf1-&gt;setPoint( point1 );</a>
<a name="2907"><span class="lineNum">    2907 </span>                :            :     hf1-&gt;setBreak( break1 );</a>
<a name="2908"><span class="lineNum">    2908 </span>                :            :     hf1-&gt;setForced( forced1 );</a>
<a name="2909"><span class="lineNum">    2909 </span>                :            : </a>
<a name="2910"><span class="lineNum">    2910 </span>                :            :     HalfEdge *hf2 = new HalfEdge();</a>
<a name="2911"><span class="lineNum">    2911 </span>                :            :     hf2-&gt;setDual( nr1 );</a>
<a name="2912"><span class="lineNum">    2912 </span>                :            :     hf2-&gt;setNext( next2 );</a>
<a name="2913"><span class="lineNum">    2913 </span>                :            :     hf2-&gt;setPoint( point2 );</a>
<a name="2914"><span class="lineNum">    2914 </span>                :            :     hf2-&gt;setBreak( break2 );</a>
<a name="2915"><span class="lineNum">    2915 </span>                :            :     hf2-&gt;setForced( forced2 );</a>
<a name="2916"><span class="lineNum">    2916 </span>                :            : </a>
<a name="2917"><span class="lineNum">    2917 </span>                :            :     // QgsDebugMsg( QStringLiteral( &quot;inserting half edge pair %1&quot; ).arg( i ) );</a>
<a name="2918"><span class="lineNum">    2918 </span>                :            :     mHalfEdge.insert( nr1, hf1 );</a>
<a name="2919"><span class="lineNum">    2919 </span>                :            :     mHalfEdge.insert( nr2, hf2 );</a>
<a name="2920"><span class="lineNum">    2920 </span>                :            : </a>
<a name="2921"><span class="lineNum">    2921 </span>                :            :   }</a>
<a name="2922"><span class="lineNum">    2922 </span>                :            : </a>
<a name="2923"><span class="lineNum">    2923 </span>                :            :   edgebar-&gt;setProgress( numberofhalfedges / 2 );</a>
<a name="2924"><span class="lineNum">    2924 </span>                :            :   delete edgebar;</a>
<a name="2925"><span class="lineNum">    2925 </span>                :            : </a>
<a name="2926"><span class="lineNum">    2926 </span>                :            :   //set mEdgeInside to a reasonable value</a>
<a name="2927"><span class="lineNum">    2927 </span>                :            :   for ( int i = 0; i &lt; numberofhalfedges; i++ )</a>
<a name="2928"><span class="lineNum">    2928 </span>                :            :   {</a>
<a name="2929"><span class="lineNum">    2929 </span>                :            :     int a, b, c, d;</a>
<a name="2930"><span class="lineNum">    2930 </span>                :            :     a = mHalfEdge[i]-&gt;getPoint();</a>
<a name="2931"><span class="lineNum">    2931 </span>                :            :     b = mHalfEdge[mHalfEdge[i]-&gt;getDual()]-&gt;getPoint();</a>
<a name="2932"><span class="lineNum">    2932 </span>                :            :     c = mHalfEdge[mHalfEdge[i]-&gt;getNext()]-&gt;getPoint();</a>
<a name="2933"><span class="lineNum">    2933 </span>                :            :     d = mHalfEdge[mHalfEdge[mHalfEdge[i]-&gt;getDual()]-&gt;getNext()]-&gt;getPoint();</a>
<a name="2934"><span class="lineNum">    2934 </span>                :            :     if ( a != -1 &amp;&amp; b != -1 &amp;&amp; c != -1 &amp;&amp; d != -1 )</a>
<a name="2935"><span class="lineNum">    2935 </span>                :            :     {</a>
<a name="2936"><span class="lineNum">    2936 </span>                :            :       mEdgeInside = i;</a>
<a name="2937"><span class="lineNum">    2937 </span>                :            :       break;</a>
<a name="2938"><span class="lineNum">    2938 </span>                :            :     }</a>
<a name="2939"><span class="lineNum">    2939 </span>                :            :   }</a>
<a name="2940"><span class="lineNum">    2940 </span>                :            : </a>
<a name="2941"><span class="lineNum">    2941 </span>                :            :   //point section</a>
<a name="2942"><span class="lineNum">    2942 </span>                :            :   while ( buff.mid( 0, 4 ) != &quot;POIN&quot; )</a>
<a name="2943"><span class="lineNum">    2943 </span>                :            :   {</a>
<a name="2944"><span class="lineNum">    2944 </span>                :            :     buff = textstream.readLine();</a>
<a name="2945"><span class="lineNum">    2945 </span>                :            :     QgsDebugMsg( buff );</a>
<a name="2946"><span class="lineNum">    2946 </span>                :            :   }</a>
<a name="2947"><span class="lineNum">    2947 </span>                :            :   while ( buff.mid( 0, 4 ) != &quot;NPTS&quot; )</a>
<a name="2948"><span class="lineNum">    2948 </span>                :            :   {</a>
<a name="2949"><span class="lineNum">    2949 </span>                :            :     buff = textstream.readLine();</a>
<a name="2950"><span class="lineNum">    2950 </span>                :            :     QgsDebugMsg( buff );</a>
<a name="2951"><span class="lineNum">    2951 </span>                :            :   }</a>
<a name="2952"><span class="lineNum">    2952 </span>                :            :   numberofpoints = buff.section( ' ', 1, 1 ).toInt();</a>
<a name="2953"><span class="lineNum">    2953 </span>                :            :   mPointVector.resize( numberofpoints );</a>
<a name="2954"><span class="lineNum">    2954 </span>                :            : </a>
<a name="2955"><span class="lineNum">    2955 </span>                :            :   while ( buff.mid( 0, 4 ) != &quot;DATA&quot; )</a>
<a name="2956"><span class="lineNum">    2956 </span>                :            :   {</a>
<a name="2957"><span class="lineNum">    2957 </span>                :            :     textstream &gt;&gt; buff;</a>
<a name="2958"><span class="lineNum">    2958 </span>                :            :   }</a>
<a name="2959"><span class="lineNum">    2959 </span>                :            : </a>
<a name="2960"><span class="lineNum">    2960 </span>                :            :   QProgressBar *pointbar = new QProgressBar();</a>
<a name="2961"><span class="lineNum">    2961 </span>                :            :   pointbar-&gt;setCaption( tr( &quot;Reading points&quot; ) );</a>
<a name="2962"><span class="lineNum">    2962 </span>                :            :   pointbar-&gt;setTotalSteps( numberofpoints );</a>
<a name="2963"><span class="lineNum">    2963 </span>                :            :   pointbar-&gt;setMinimumWidth( 400 );</a>
<a name="2964"><span class="lineNum">    2964 </span>                :            :   pointbar-&gt;move( 500, 500 );</a>
<a name="2965"><span class="lineNum">    2965 </span>                :            :   pointbar-&gt;show();</a>
<a name="2966"><span class="lineNum">    2966 </span>                :            : </a>
<a name="2967"><span class="lineNum">    2967 </span>                :            : </a>
<a name="2968"><span class="lineNum">    2968 </span>                :            :   double x, y, z;</a>
<a name="2969"><span class="lineNum">    2969 </span>                :            :   for ( int i = 0; i &lt; numberofpoints; i++ )</a>
<a name="2970"><span class="lineNum">    2970 </span>                :            :   {</a>
<a name="2971"><span class="lineNum">    2971 </span>                :            :     if ( i % 1000 == 0 )</a>
<a name="2972"><span class="lineNum">    2972 </span>                :            :     {</a>
<a name="2973"><span class="lineNum">    2973 </span>                :            :       pointbar-&gt;setProgress( i );</a>
<a name="2974"><span class="lineNum">    2974 </span>                :            :     }</a>
<a name="2975"><span class="lineNum">    2975 </span>                :            : </a>
<a name="2976"><span class="lineNum">    2976 </span>                :            :     textstream &gt;&gt; x;</a>
<a name="2977"><span class="lineNum">    2977 </span>                :            :     textstream &gt;&gt; y;</a>
<a name="2978"><span class="lineNum">    2978 </span>                :            :     textstream &gt;&gt; z;</a>
<a name="2979"><span class="lineNum">    2979 </span>                :            : </a>
<a name="2980"><span class="lineNum">    2980 </span>                :            :     QgsPoint *p = new QgsPoint( x, y, z );</a>
<a name="2981"><span class="lineNum">    2981 </span>                :            : </a>
<a name="2982"><span class="lineNum">    2982 </span>                :            :     // QgsDebugMsg( QStringLiteral( &quot;inserting point %1&quot; ).arg( i ) );</a>
<a name="2983"><span class="lineNum">    2983 </span>                :            :     mPointVector.insert( i, p );</a>
<a name="2984"><span class="lineNum">    2984 </span>                :            : </a>
<a name="2985"><span class="lineNum">    2985 </span>                :            :     if ( i == 0 )</a>
<a name="2986"><span class="lineNum">    2986 </span>                :            :     {</a>
<a name="2987"><span class="lineNum">    2987 </span>                :            :       xMin = x;</a>
<a name="2988"><span class="lineNum">    2988 </span>                :            :       xMax = x;</a>
<a name="2989"><span class="lineNum">    2989 </span>                :            :       yMin = y;</a>
<a name="2990"><span class="lineNum">    2990 </span>                :            :       yMax = y;</a>
<a name="2991"><span class="lineNum">    2991 </span>                :            :     }</a>
<a name="2992"><span class="lineNum">    2992 </span>                :            :     else</a>
<a name="2993"><span class="lineNum">    2993 </span>                :            :     {</a>
<a name="2994"><span class="lineNum">    2994 </span>                :            :       //update the bounding box</a>
<a name="2995"><span class="lineNum">    2995 </span>                :            :       if ( x &lt; xMin )</a>
<a name="2996"><span class="lineNum">    2996 </span>                :            :       {</a>
<a name="2997"><span class="lineNum">    2997 </span>                :            :         xMin = x;</a>
<a name="2998"><span class="lineNum">    2998 </span>                :            :       }</a>
<a name="2999"><span class="lineNum">    2999 </span>                :            :       else if ( x &gt; xMax )</a>
<a name="3000"><span class="lineNum">    3000 </span>                :            :       {</a>
<a name="3001"><span class="lineNum">    3001 </span>                :            :         xMax = x;</a>
<a name="3002"><span class="lineNum">    3002 </span>                :            :       }</a>
<a name="3003"><span class="lineNum">    3003 </span>                :            : </a>
<a name="3004"><span class="lineNum">    3004 </span>                :            :       if ( y &lt; yMin )</a>
<a name="3005"><span class="lineNum">    3005 </span>                :            :       {</a>
<a name="3006"><span class="lineNum">    3006 </span>                :            :         yMin = y;</a>
<a name="3007"><span class="lineNum">    3007 </span>                :            :       }</a>
<a name="3008"><span class="lineNum">    3008 </span>                :            :       else if ( y &gt; yMax )</a>
<a name="3009"><span class="lineNum">    3009 </span>                :            :       {</a>
<a name="3010"><span class="lineNum">    3010 </span>                :            :         yMax = y;</a>
<a name="3011"><span class="lineNum">    3011 </span>                :            :       }</a>
<a name="3012"><span class="lineNum">    3012 </span>                :            :     }</a>
<a name="3013"><span class="lineNum">    3013 </span>                :            :   }</a>
<a name="3014"><span class="lineNum">    3014 </span>                :            : </a>
<a name="3015"><span class="lineNum">    3015 </span>                :            :   pointbar-&gt;setProgress( numberofpoints );</a>
<a name="3016"><span class="lineNum">    3016 </span>                :            :   delete pointbar;</a>
<a name="3017"><span class="lineNum">    3017 </span>                :            :   QApplication::restoreOverrideCursor();</a>
<a name="3018"><span class="lineNum">    3018 </span>                :            : </a>
<a name="3019"><span class="lineNum">    3019 </span>                :            : }</a>
<a name="3020"><span class="lineNum">    3020 </span>                :            : </a>
<a name="3021"><span class="lineNum">    3021 </span>                :            : bool DualEdgeTriangulation::saveToTAFF( QString filename ) const</a>
<a name="3022"><span class="lineNum">    3022 </span>                :            : {</a>
<a name="3023"><span class="lineNum">    3023 </span>                :            :   QFile outputfile( filename );</a>
<a name="3024"><span class="lineNum">    3024 </span>                :            :   if ( !outputfile.open( IO_WriteOnly ) )</a>
<a name="3025"><span class="lineNum">    3025 </span>                :            :   {</a>
<a name="3026"><span class="lineNum">    3026 </span>                :            :     QMessageBox::warning( 0, tr( &quot;Warning&quot; ), tr( &quot;File could not be written.&quot; ), QMessageBox::Ok, QMessageBox::NoButton, QMessageBox::NoButton );</a>
<a name="3027"><span class="lineNum">    3027 </span>                :            :     return false;</a>
<a name="3028"><span class="lineNum">    3028 </span>                :            :   }</a>
<a name="3029"><span class="lineNum">    3029 </span>                :            : </a>
<a name="3030"><span class="lineNum">    3030 </span>                :            :   QTextStream outstream( &amp;outputfile );</a>
<a name="3031"><span class="lineNum">    3031 </span>                :            :   outstream.precision( 9 );</a>
<a name="3032"><span class="lineNum">    3032 </span>                :            : </a>
<a name="3033"><span class="lineNum">    3033 </span>                :            :   //export the edges. Attention, dual edges must be adjacent in the TAFF-file</a>
<a name="3034"><span class="lineNum">    3034 </span>                :            :   outstream &lt;&lt; &quot;TRIA&quot; &lt;&lt; std::endl &lt;&lt; std::flush;</a>
<a name="3035"><span class="lineNum">    3035 </span>                :            :   outstream &lt;&lt; &quot;NEDG &quot; &lt;&lt; mHalfEdge.count() &lt;&lt; std::endl &lt;&lt; std::flush;</a>
<a name="3036"><span class="lineNum">    3036 </span>                :            :   outstream &lt;&lt; &quot;PANO 1&quot; &lt;&lt; std::endl &lt;&lt; std::flush;</a>
<a name="3037"><span class="lineNum">    3037 </span>                :            :   outstream &lt;&lt; &quot;DATA &quot;;</a>
<a name="3038"><span class="lineNum">    3038 </span>                :            : </a>
<a name="3039"><span class="lineNum">    3039 </span>                :            :   bool *cont = new bool[mHalfEdge.count()];</a>
<a name="3040"><span class="lineNum">    3040 </span>                :            :   for ( unsigned int i = 0; i &lt;= mHalfEdge.count() - 1; i++ )</a>
<a name="3041"><span class="lineNum">    3041 </span>                :            :   {</a>
<a name="3042"><span class="lineNum">    3042 </span>                :            :     cont[i] = false;</a>
<a name="3043"><span class="lineNum">    3043 </span>                :            :   }</a>
<a name="3044"><span class="lineNum">    3044 </span>                :            : </a>
<a name="3045"><span class="lineNum">    3045 </span>                :            :   for ( unsigned int i = 0; i &lt; mHalfEdge.count(); i++ )</a>
<a name="3046"><span class="lineNum">    3046 </span>                :            :   {</a>
<a name="3047"><span class="lineNum">    3047 </span>                :            :     if ( cont[i] )</a>
<a name="3048"><span class="lineNum">    3048 </span>                :            :     {</a>
<a name="3049"><span class="lineNum">    3049 </span>                :            :       continue;</a>
<a name="3050"><span class="lineNum">    3050 </span>                :            :     }</a>
<a name="3051"><span class="lineNum">    3051 </span>                :            : </a>
<a name="3052"><span class="lineNum">    3052 </span>                :            :     int dual = mHalfEdge[i]-&gt;getDual();</a>
<a name="3053"><span class="lineNum">    3053 </span>                :            :     outstream &lt;&lt; i &lt;&lt; &quot; &quot; &lt;&lt; mHalfEdge[i]-&gt;getPoint() &lt;&lt; &quot; &quot; &lt;&lt; mHalfEdge[i]-&gt;getNext() &lt;&lt; &quot; &quot; &lt;&lt; mHalfEdge[i]-&gt;getForced() &lt;&lt; &quot; &quot; &lt;&lt; mHalfEdge[i]-&gt;getBreak() &lt;&lt; &quot; &quot;;</a>
<a name="3054"><span class="lineNum">    3054 </span>                :            :     outstream &lt;&lt; dual &lt;&lt; &quot; &quot; &lt;&lt; mHalfEdge[dual]-&gt;getPoint() &lt;&lt; &quot; &quot; &lt;&lt; mHalfEdge[dual]-&gt;getNext() &lt;&lt; &quot; &quot; &lt;&lt; mHalfEdge[dual]-&gt;getForced() &lt;&lt; &quot; &quot; &lt;&lt; mHalfEdge[dual]-&gt;getBreak() &lt;&lt; &quot; &quot;;</a>
<a name="3055"><span class="lineNum">    3055 </span>                :            :     cont[i] = true;</a>
<a name="3056"><span class="lineNum">    3056 </span>                :            :     cont[dual] = true;</a>
<a name="3057"><span class="lineNum">    3057 </span>                :            :   }</a>
<a name="3058"><span class="lineNum">    3058 </span>                :            :   outstream &lt;&lt; std::endl &lt;&lt; std::flush;</a>
<a name="3059"><span class="lineNum">    3059 </span>                :            :   outstream &lt;&lt; std::endl &lt;&lt; std::flush;</a>
<a name="3060"><span class="lineNum">    3060 </span>                :            : </a>
<a name="3061"><span class="lineNum">    3061 </span>                :            :   delete[] cont;</a>
<a name="3062"><span class="lineNum">    3062 </span>                :            : </a>
<a name="3063"><span class="lineNum">    3063 </span>                :            :   //export the points to the file</a>
<a name="3064"><span class="lineNum">    3064 </span>                :            :   outstream &lt;&lt; &quot;POIN&quot; &lt;&lt; std::endl &lt;&lt; std::flush;</a>
<a name="3065"><span class="lineNum">    3065 </span>                :            :   outstream &lt;&lt; &quot;NPTS &quot; &lt;&lt; getNumberOfPoints() &lt;&lt; std::endl &lt;&lt; std::flush;</a>
<a name="3066"><span class="lineNum">    3066 </span>                :            :   outstream &lt;&lt; &quot;PATT 3&quot; &lt;&lt; std::endl &lt;&lt; std::flush;</a>
<a name="3067"><span class="lineNum">    3067 </span>                :            :   outstream &lt;&lt; &quot;DATA &quot;;</a>
<a name="3068"><span class="lineNum">    3068 </span>                :            : </a>
<a name="3069"><span class="lineNum">    3069 </span>                :            :   for ( int i = 0; i &lt; getNumberOfPoints(); i++ )</a>
<a name="3070"><span class="lineNum">    3070 </span>                :            :   {</a>
<a name="3071"><span class="lineNum">    3071 </span>                :            :     QgsPoint *p = mPointVector[i];</a>
<a name="3072"><span class="lineNum">    3072 </span>                :            :     outstream &lt;&lt; p-&gt;getX() &lt;&lt; &quot; &quot; &lt;&lt; p-&gt;getY() &lt;&lt; &quot; &quot; &lt;&lt; p-&gt;getZ() &lt;&lt; &quot; &quot;;</a>
<a name="3073"><span class="lineNum">    3073 </span>                :            :   }</a>
<a name="3074"><span class="lineNum">    3074 </span>                :            :   outstream &lt;&lt; std::endl &lt;&lt; std::flush;</a>
<a name="3075"><span class="lineNum">    3075 </span>                :            :   outstream &lt;&lt; std::endl &lt;&lt; std::flush;</a>
<a name="3076"><span class="lineNum">    3076 </span>                :            : </a>
<a name="3077"><span class="lineNum">    3077 </span>                :            :   return true;</a>
<a name="3078"><span class="lineNum">    3078 </span>                :            : }</a>
<a name="3079"><span class="lineNum">    3079 </span>                :            : #endif //0</a>
<a name="3080"><span class="lineNum">    3080 </span>                :            : </a>
<a name="3081"><span class="lineNum">    3081 </span>                :<span class="lineNoCov">          0 : bool QgsDualEdgeTriangulation::swapEdge( double x, double y )</span></a>
<a name="3082"><span class="lineNum">    3082 </span>                :            : {</a>
<a name="3083"><span class="lineNum">    3083 </span>                :<span class="lineNoCov">          0 :   QgsPoint p( x, y, 0 );</span></a>
<a name="3084"><span class="lineNum">    3084 </span>                :<span class="lineNoCov">          0 :   int edge1 = baseEdgeOfTriangle( p );</span></a>
<a name="3085"><span class="lineNum">    3085 </span>                :<span class="lineNoCov">          0 :   if ( edge1 &gt;= 0 )</span></a>
<a name="3086"><span class="lineNum">    3086 </span>                :            :   {</a>
<a name="3087"><span class="lineNum">    3087 </span>                :            :     int edge2, edge3;</a>
<a name="3088"><span class="lineNum">    3088 </span>                :<span class="lineNoCov">          0 :     QgsPoint *point1 = nullptr;</span></a>
<a name="3089"><span class="lineNum">    3089 </span>                :<span class="lineNoCov">          0 :     QgsPoint *point2 = nullptr;</span></a>
<a name="3090"><span class="lineNum">    3090 </span>                :<span class="lineNoCov">          0 :     QgsPoint *point3 = nullptr;</span></a>
<a name="3091"><span class="lineNum">    3091 </span>                :<span class="lineNoCov">          0 :     edge2 = mHalfEdge[edge1]-&gt;getNext();</span></a>
<a name="3092"><span class="lineNum">    3092 </span>                :<span class="lineNoCov">          0 :     edge3 = mHalfEdge[edge2]-&gt;getNext();</span></a>
<a name="3093"><span class="lineNum">    3093 </span>                :<span class="lineNoCov">          0 :     point1 = point( mHalfEdge[edge1]-&gt;getPoint() );</span></a>
<a name="3094"><span class="lineNum">    3094 </span>                :<span class="lineNoCov">          0 :     point2 = point( mHalfEdge[edge2]-&gt;getPoint() );</span></a>
<a name="3095"><span class="lineNum">    3095 </span>                :<span class="lineNoCov">          0 :     point3 = point( mHalfEdge[edge3]-&gt;getPoint() );</span></a>
<a name="3096"><span class="lineNum">    3096 </span>                :<span class="lineNoCov">          0 :     if ( point1 &amp;&amp; point2 &amp;&amp; point3 )</span></a>
<a name="3097"><span class="lineNum">    3097 </span>                :            :     {</a>
<a name="3098"><span class="lineNum">    3098 </span>                :            :       //find out the closest edge to the point and swap this edge</a>
<a name="3099"><span class="lineNum">    3099 </span>                :            :       double dist1, dist2, dist3;</a>
<a name="3100"><span class="lineNum">    3100 </span>                :<span class="lineNoCov">          0 :       dist1 = MathUtils::distPointFromLine( &amp;p, point3, point1 );</span></a>
<a name="3101"><span class="lineNum">    3101 </span>                :<span class="lineNoCov">          0 :       dist2 = MathUtils::distPointFromLine( &amp;p, point1, point2 );</span></a>
<a name="3102"><span class="lineNum">    3102 </span>                :<span class="lineNoCov">          0 :       dist3 = MathUtils::distPointFromLine( &amp;p, point2, point3 );</span></a>
<a name="3103"><span class="lineNum">    3103 </span>                :<span class="lineNoCov">          0 :       if ( dist1 &lt;= dist2 &amp;&amp; dist1 &lt;= dist3 )</span></a>
<a name="3104"><span class="lineNum">    3104 </span>                :            :       {</a>
<a name="3105"><span class="lineNum">    3105 </span>                :            :         //qWarning(&quot;edge &quot;+QString::number(edge1)+&quot; is closest&quot;);</a>
<a name="3106"><span class="lineNum">    3106 </span>                :<span class="lineNoCov">          0 :         if ( swapPossible( edge1 ) )</span></a>
<a name="3107"><span class="lineNum">    3107 </span>                :            :         {</a>
<a name="3108"><span class="lineNum">    3108 </span>                :<span class="lineNoCov">          0 :           doOnlySwap( edge1 );</span></a>
<a name="3109"><span class="lineNum">    3109 </span>                :<span class="lineNoCov">          0 :         }</span></a>
<a name="3110"><span class="lineNum">    3110 </span>                :<span class="lineNoCov">          0 :       }</span></a>
<a name="3111"><span class="lineNum">    3111 </span>                :<span class="lineNoCov">          0 :       else if ( dist2 &lt;= dist1 &amp;&amp; dist2 &lt;= dist3 )</span></a>
<a name="3112"><span class="lineNum">    3112 </span>                :            :       {</a>
<a name="3113"><span class="lineNum">    3113 </span>                :            :         //qWarning(&quot;edge &quot;+QString::number(edge2)+&quot; is closest&quot;);</a>
<a name="3114"><span class="lineNum">    3114 </span>                :<span class="lineNoCov">          0 :         if ( swapPossible( edge2 ) )</span></a>
<a name="3115"><span class="lineNum">    3115 </span>                :            :         {</a>
<a name="3116"><span class="lineNum">    3116 </span>                :<span class="lineNoCov">          0 :           doOnlySwap( edge2 );</span></a>
<a name="3117"><span class="lineNum">    3117 </span>                :<span class="lineNoCov">          0 :         }</span></a>
<a name="3118"><span class="lineNum">    3118 </span>                :<span class="lineNoCov">          0 :       }</span></a>
<a name="3119"><span class="lineNum">    3119 </span>                :<span class="lineNoCov">          0 :       else if ( dist3 &lt;= dist1 &amp;&amp; dist3 &lt;= dist2 )</span></a>
<a name="3120"><span class="lineNum">    3120 </span>                :            :       {</a>
<a name="3121"><span class="lineNum">    3121 </span>                :            :         //qWarning(&quot;edge &quot;+QString::number(edge3)+&quot; is closest&quot;);</a>
<a name="3122"><span class="lineNum">    3122 </span>                :<span class="lineNoCov">          0 :         if ( swapPossible( edge3 ) )</span></a>
<a name="3123"><span class="lineNum">    3123 </span>                :            :         {</a>
<a name="3124"><span class="lineNum">    3124 </span>                :<span class="lineNoCov">          0 :           doOnlySwap( edge3 );</span></a>
<a name="3125"><span class="lineNum">    3125 </span>                :<span class="lineNoCov">          0 :         }</span></a>
<a name="3126"><span class="lineNum">    3126 </span>                :<span class="lineNoCov">          0 :       }</span></a>
<a name="3127"><span class="lineNum">    3127 </span>                :<span class="lineNoCov">          0 :       return true;</span></a>
<a name="3128"><span class="lineNum">    3128 </span>                :            :     }</a>
<a name="3129"><span class="lineNum">    3129 </span>                :            :     else</a>
<a name="3130"><span class="lineNum">    3130 </span>                :            :     {</a>
<a name="3131"><span class="lineNum">    3131 </span>                :            :       // QgsDebugMsg(&quot;warning: null pointer&quot;);</a>
<a name="3132"><span class="lineNum">    3132 </span>                :<span class="lineNoCov">          0 :       return false;</span></a>
<a name="3133"><span class="lineNum">    3133 </span>                :            :     }</a>
<a name="3134"><span class="lineNum">    3134 </span>                :            :   }</a>
<a name="3135"><span class="lineNum">    3135 </span>                :            :   else</a>
<a name="3136"><span class="lineNum">    3136 </span>                :            :   {</a>
<a name="3137"><span class="lineNum">    3137 </span>                :            :     // QgsDebugMsg(&quot;Edge number negative&quot;);</a>
<a name="3138"><span class="lineNum">    3138 </span>                :<span class="lineNoCov">          0 :     return false;</span></a>
<a name="3139"><span class="lineNum">    3139 </span>                :            :   }</a>
<a name="3140"><span class="lineNum">    3140 </span>                :<span class="lineNoCov">          0 : }</span></a>
<a name="3141"><span class="lineNum">    3141 </span>                :            : </a>
<a name="3142"><span class="lineNum">    3142 </span>                :<span class="lineNoCov">          0 : QList&lt;int&gt; QgsDualEdgeTriangulation::pointsAroundEdge( double x, double y )</span></a>
<a name="3143"><span class="lineNum">    3143 </span>                :            : {</a>
<a name="3144"><span class="lineNum">    3144 </span>                :<span class="lineNoCov">          0 :   QgsPoint p( x, y, 0 );</span></a>
<a name="3145"><span class="lineNum">    3145 </span>                :<span class="lineNoCov">          0 :   QList&lt;int&gt; list;</span></a>
<a name="3146"><span class="lineNum">    3146 </span>                :<span class="lineNoCov">          0 :   const int edge1 = baseEdgeOfTriangle( p );</span></a>
<a name="3147"><span class="lineNum">    3147 </span>                :<span class="lineNoCov">          0 :   if ( edge1 &gt;= 0 )</span></a>
<a name="3148"><span class="lineNum">    3148 </span>                :            :   {</a>
<a name="3149"><span class="lineNum">    3149 </span>                :<span class="lineNoCov">          0 :     const int edge2 = mHalfEdge[edge1]-&gt;getNext();</span></a>
<a name="3150"><span class="lineNum">    3150 </span>                :<span class="lineNoCov">          0 :     const int edge3 = mHalfEdge[edge2]-&gt;getNext();</span></a>
<a name="3151"><span class="lineNum">    3151 </span>                :<span class="lineNoCov">          0 :     QgsPoint *point1 = point( mHalfEdge[edge1]-&gt;getPoint() );</span></a>
<a name="3152"><span class="lineNum">    3152 </span>                :<span class="lineNoCov">          0 :     QgsPoint *point2 = point( mHalfEdge[edge2]-&gt;getPoint() );</span></a>
<a name="3153"><span class="lineNum">    3153 </span>                :<span class="lineNoCov">          0 :     QgsPoint *point3 = point( mHalfEdge[edge3]-&gt;getPoint() );</span></a>
<a name="3154"><span class="lineNum">    3154 </span>                :<span class="lineNoCov">          0 :     if ( point1 &amp;&amp; point2 &amp;&amp; point3 )</span></a>
<a name="3155"><span class="lineNum">    3155 </span>                :            :     {</a>
<a name="3156"><span class="lineNum">    3156 </span>                :            :       int p1, p2, p3, p4;</a>
<a name="3157"><span class="lineNum">    3157 </span>                :<span class="lineNoCov">          0 :       const double dist1 = MathUtils::distPointFromLine( &amp;p, point3, point1 );</span></a>
<a name="3158"><span class="lineNum">    3158 </span>                :<span class="lineNoCov">          0 :       const double dist2 = MathUtils::distPointFromLine( &amp;p, point1, point2 );</span></a>
<a name="3159"><span class="lineNum">    3159 </span>                :<span class="lineNoCov">          0 :       const double dist3 = MathUtils::distPointFromLine( &amp;p, point2, point3 );</span></a>
<a name="3160"><span class="lineNum">    3160 </span>                :<span class="lineNoCov">          0 :       if ( dist1 &lt;= dist2 &amp;&amp; dist1 &lt;= dist3 )</span></a>
<a name="3161"><span class="lineNum">    3161 </span>                :            :       {</a>
<a name="3162"><span class="lineNum">    3162 </span>                :<span class="lineNoCov">          0 :         p1 = mHalfEdge[edge1]-&gt;getPoint();</span></a>
<a name="3163"><span class="lineNum">    3163 </span>                :<span class="lineNoCov">          0 :         p2 = mHalfEdge[mHalfEdge[edge1]-&gt;getNext()]-&gt;getPoint();</span></a>
<a name="3164"><span class="lineNum">    3164 </span>                :<span class="lineNoCov">          0 :         p3 = mHalfEdge[mHalfEdge[edge1]-&gt;getDual()]-&gt;getPoint();</span></a>
<a name="3165"><span class="lineNum">    3165 </span>                :<span class="lineNoCov">          0 :         p4 = mHalfEdge[mHalfEdge[mHalfEdge[edge1]-&gt;getDual()]-&gt;getNext()]-&gt;getPoint();</span></a>
<a name="3166"><span class="lineNum">    3166 </span>                :<span class="lineNoCov">          0 :       }</span></a>
<a name="3167"><span class="lineNum">    3167 </span>                :<span class="lineNoCov">          0 :       else if ( dist2 &lt;= dist1 &amp;&amp; dist2 &lt;= dist3 )</span></a>
<a name="3168"><span class="lineNum">    3168 </span>                :            :       {</a>
<a name="3169"><span class="lineNum">    3169 </span>                :<span class="lineNoCov">          0 :         p1 = mHalfEdge[edge2]-&gt;getPoint();</span></a>
<a name="3170"><span class="lineNum">    3170 </span>                :<span class="lineNoCov">          0 :         p2 = mHalfEdge[mHalfEdge[edge2]-&gt;getNext()]-&gt;getPoint();</span></a>
<a name="3171"><span class="lineNum">    3171 </span>                :<span class="lineNoCov">          0 :         p3 = mHalfEdge[mHalfEdge[edge2]-&gt;getDual()]-&gt;getPoint();</span></a>
<a name="3172"><span class="lineNum">    3172 </span>                :<span class="lineNoCov">          0 :         p4 = mHalfEdge[mHalfEdge[mHalfEdge[edge2]-&gt;getDual()]-&gt;getNext()]-&gt;getPoint();</span></a>
<a name="3173"><span class="lineNum">    3173 </span>                :<span class="lineNoCov">          0 :       }</span></a>
<a name="3174"><span class="lineNum">    3174 </span>                :            :       else /* if ( dist3 &lt;= dist1 &amp;&amp; dist3 &lt;= dist2 ) */</a>
<a name="3175"><span class="lineNum">    3175 </span>                :            :       {</a>
<a name="3176"><span class="lineNum">    3176 </span>                :<span class="lineNoCov">          0 :         p1 = mHalfEdge[edge3]-&gt;getPoint();</span></a>
<a name="3177"><span class="lineNum">    3177 </span>                :<span class="lineNoCov">          0 :         p2 = mHalfEdge[mHalfEdge[edge3]-&gt;getNext()]-&gt;getPoint();</span></a>
<a name="3178"><span class="lineNum">    3178 </span>                :<span class="lineNoCov">          0 :         p3 = mHalfEdge[mHalfEdge[edge3]-&gt;getDual()]-&gt;getPoint();</span></a>
<a name="3179"><span class="lineNum">    3179 </span>                :<span class="lineNoCov">          0 :         p4 = mHalfEdge[mHalfEdge[mHalfEdge[edge3]-&gt;getDual()]-&gt;getNext()]-&gt;getPoint();</span></a>
<a name="3180"><span class="lineNum">    3180 </span>                :            :       }</a>
<a name="3181"><span class="lineNum">    3181 </span>                :            : </a>
<a name="3182"><span class="lineNum">    3182 </span>                :            : </a>
<a name="3183"><span class="lineNum">    3183 </span>                :<span class="lineNoCov">          0 :       list.append( p1 );</span></a>
<a name="3184"><span class="lineNum">    3184 </span>                :<span class="lineNoCov">          0 :       list.append( p2 );</span></a>
<a name="3185"><span class="lineNum">    3185 </span>                :<span class="lineNoCov">          0 :       list.append( p3 );</span></a>
<a name="3186"><span class="lineNum">    3186 </span>                :<span class="lineNoCov">          0 :       list.append( p4 );</span></a>
<a name="3187"><span class="lineNum">    3187 </span>                :<span class="lineNoCov">          0 :     }</span></a>
<a name="3188"><span class="lineNum">    3188 </span>                :            :     else</a>
<a name="3189"><span class="lineNum">    3189 </span>                :            :     {</a>
<a name="3190"><span class="lineNum">    3190 </span>                :<span class="lineNoCov">          0 :       QgsDebugMsg( QStringLiteral( &quot;warning: null pointer&quot; ) );</span></a>
<a name="3191"><span class="lineNum">    3191 </span>                :            :     }</a>
<a name="3192"><span class="lineNum">    3192 </span>                :<span class="lineNoCov">          0 :   }</span></a>
<a name="3193"><span class="lineNum">    3193 </span>                :            :   else</a>
<a name="3194"><span class="lineNum">    3194 </span>                :            :   {</a>
<a name="3195"><span class="lineNum">    3195 </span>                :<span class="lineNoCov">          0 :     QgsDebugMsg( QStringLiteral( &quot;Edge number negative&quot; ) );</span></a>
<a name="3196"><span class="lineNum">    3196 </span>                :            :   }</a>
<a name="3197"><span class="lineNum">    3197 </span>                :<span class="lineNoCov">          0 :   return list;</span></a>
<a name="3198"><span class="lineNum">    3198 </span>                :<span class="lineNoCov">          0 : }</span></a>
<a name="3199"><span class="lineNum">    3199 </span>                :            : </a>
<a name="3200"><span class="lineNum">    3200 </span>                :<span class="lineNoCov">          0 : bool QgsDualEdgeTriangulation::saveTriangulation( QgsFeatureSink *sink, QgsFeedback *feedback ) const</span></a>
<a name="3201"><span class="lineNum">    3201 </span>                :            : {</a>
<a name="3202"><span class="lineNum">    3202 </span>                :<span class="lineNoCov">          0 :   if ( !sink )</span></a>
<a name="3203"><span class="lineNum">    3203 </span>                :            :   {</a>
<a name="3204"><span class="lineNum">    3204 </span>                :<span class="lineNoCov">          0 :     return false;</span></a>
<a name="3205"><span class="lineNum">    3205 </span>                :            :   }</a>
<a name="3206"><span class="lineNum">    3206 </span>                :            : </a>
<a name="3207"><span class="lineNum">    3207 </span>                :<span class="lineNoCov">          0 :   bool *alreadyVisitedEdges = new bool[mHalfEdge.size()];</span></a>
<a name="3208"><span class="lineNum">    3208 </span>                :<span class="lineNoCov">          0 :   if ( !alreadyVisitedEdges )</span></a>
<a name="3209"><span class="lineNum">    3209 </span>                :            :   {</a>
<a name="3210"><span class="lineNum">    3210 </span>                :<span class="lineNoCov">          0 :     QgsDebugMsg( QStringLiteral( &quot;out of memory&quot; ) );</span></a>
<a name="3211"><span class="lineNum">    3211 </span>                :<span class="lineNoCov">          0 :     return false;</span></a>
<a name="3212"><span class="lineNum">    3212 </span>                :            :   }</a>
<a name="3213"><span class="lineNum">    3213 </span>                :            : </a>
<a name="3214"><span class="lineNum">    3214 </span>                :<span class="lineNoCov">          0 :   for ( int i = 0; i &lt; mHalfEdge.size(); ++i )</span></a>
<a name="3215"><span class="lineNum">    3215 </span>                :            :   {</a>
<a name="3216"><span class="lineNum">    3216 </span>                :<span class="lineNoCov">          0 :     alreadyVisitedEdges[i] = false;</span></a>
<a name="3217"><span class="lineNum">    3217 </span>                :<span class="lineNoCov">          0 :   }</span></a>
<a name="3218"><span class="lineNum">    3218 </span>                :            : </a>
<a name="3219"><span class="lineNum">    3219 </span>                :<span class="lineNoCov">          0 :   for ( int i = 0; i &lt; mHalfEdge.size(); ++i )</span></a>
<a name="3220"><span class="lineNum">    3220 </span>                :            :   {</a>
<a name="3221"><span class="lineNum">    3221 </span>                :<span class="lineNoCov">          0 :     if ( feedback &amp;&amp; feedback-&gt;isCanceled() )</span></a>
<a name="3222"><span class="lineNum">    3222 </span>                :<span class="lineNoCov">          0 :       break;</span></a>
<a name="3223"><span class="lineNum">    3223 </span>                :            : </a>
<a name="3224"><span class="lineNum">    3224 </span>                :<span class="lineNoCov">          0 :     HalfEdge *currentEdge = mHalfEdge[i];</span></a>
<a name="3225"><span class="lineNum">    3225 </span>                :<span class="lineNoCov">          0 :     if ( currentEdge-&gt;getPoint() != -1 &amp;&amp; mHalfEdge[currentEdge-&gt;getDual()]-&gt;getPoint() != -1 &amp;&amp; !alreadyVisitedEdges[currentEdge-&gt;getDual()] )</span></a>
<a name="3226"><span class="lineNum">    3226 </span>                :            :     {</a>
<a name="3227"><span class="lineNum">    3227 </span>                :<span class="lineNoCov">          0 :       QgsFeature edgeLineFeature;</span></a>
<a name="3228"><span class="lineNum">    3228 </span>                :            : </a>
<a name="3229"><span class="lineNum">    3229 </span>                :            :       //geometry</a>
<a name="3230"><span class="lineNum">    3230 </span>                :<span class="lineNoCov">          0 :       QgsPoint *p1 = mPointVector[currentEdge-&gt;getPoint()];</span></a>
<a name="3231"><span class="lineNum">    3231 </span>                :<span class="lineNoCov">          0 :       QgsPoint *p2 = mPointVector[mHalfEdge[currentEdge-&gt;getDual()]-&gt;getPoint()];</span></a>
<a name="3232"><span class="lineNum">    3232 </span>                :<span class="lineNoCov">          0 :       QgsPolylineXY lineGeom;</span></a>
<a name="3233"><span class="lineNum">    3233 </span>                :<span class="lineNoCov">          0 :       lineGeom.push_back( QgsPointXY( p1-&gt;x(), p1-&gt;y() ) );</span></a>
<a name="3234"><span class="lineNum">    3234 </span>                :<span class="lineNoCov">          0 :       lineGeom.push_back( QgsPointXY( p2-&gt;x(), p2-&gt;y() ) );</span></a>
<a name="3235"><span class="lineNum">    3235 </span>                :<span class="lineNoCov">          0 :       edgeLineFeature.setGeometry( QgsGeometry::fromPolylineXY( lineGeom ) );</span></a>
<a name="3236"><span class="lineNum">    3236 </span>                :<span class="lineNoCov">          0 :       edgeLineFeature.initAttributes( 1 );</span></a>
<a name="3237"><span class="lineNum">    3237 </span>                :            : </a>
<a name="3238"><span class="lineNum">    3238 </span>                :            :       //attributes</a>
<a name="3239"><span class="lineNum">    3239 </span>                :<span class="lineNoCov">          0 :       QString attributeString;</span></a>
<a name="3240"><span class="lineNum">    3240 </span>                :<span class="lineNoCov">          0 :       if ( currentEdge-&gt;getForced() )</span></a>
<a name="3241"><span class="lineNum">    3241 </span>                :            :       {</a>
<a name="3242"><span class="lineNum">    3242 </span>                :<span class="lineNoCov">          0 :         if ( currentEdge-&gt;getBreak() )</span></a>
<a name="3243"><span class="lineNum">    3243 </span>                :            :         {</a>
<a name="3244"><span class="lineNum">    3244 </span>                :<span class="lineNoCov">          0 :           attributeString = QStringLiteral( &quot;break line&quot; );</span></a>
<a name="3245"><span class="lineNum">    3245 </span>                :<span class="lineNoCov">          0 :         }</span></a>
<a name="3246"><span class="lineNum">    3246 </span>                :            :         else</a>
<a name="3247"><span class="lineNum">    3247 </span>                :            :         {</a>
<a name="3248"><span class="lineNum">    3248 </span>                :<span class="lineNoCov">          0 :           attributeString = QStringLiteral( &quot;structure line&quot; );</span></a>
<a name="3249"><span class="lineNum">    3249 </span>                :            :         }</a>
<a name="3250"><span class="lineNum">    3250 </span>                :<span class="lineNoCov">          0 :       }</span></a>
<a name="3251"><span class="lineNum">    3251 </span>                :<span class="lineNoCov">          0 :       edgeLineFeature.setAttribute( 0, attributeString );</span></a>
<a name="3252"><span class="lineNum">    3252 </span>                :            : </a>
<a name="3253"><span class="lineNum">    3253 </span>                :<span class="lineNoCov">          0 :       sink-&gt;addFeature( edgeLineFeature, QgsFeatureSink::FastInsert );</span></a>
<a name="3254"><span class="lineNum">    3254 </span>                :<span class="lineNoCov">          0 :     }</span></a>
<a name="3255"><span class="lineNum">    3255 </span>                :<span class="lineNoCov">          0 :     alreadyVisitedEdges[i] = true;</span></a>
<a name="3256"><span class="lineNum">    3256 </span>                :<span class="lineNoCov">          0 :   }</span></a>
<a name="3257"><span class="lineNum">    3257 </span>                :            : </a>
<a name="3258"><span class="lineNum">    3258 </span>                :<span class="lineNoCov">          0 :   delete [] alreadyVisitedEdges;</span></a>
<a name="3259"><span class="lineNum">    3259 </span>                :            : </a>
<a name="3260"><span class="lineNum">    3260 </span>                :<span class="lineNoCov">          0 :   return !feedback || !feedback-&gt;isCanceled();</span></a>
<a name="3261"><span class="lineNum">    3261 </span>                :<span class="lineNoCov">          0 : }</span></a>
<a name="3262"><span class="lineNum">    3262 </span>                :            : </a>
<a name="3263"><span class="lineNum">    3263 </span>                :<span class="lineNoCov">          0 : QgsMesh QgsDualEdgeTriangulation::triangulationToMesh( QgsFeedback *feedback ) const</span></a>
<a name="3264"><span class="lineNum">    3264 </span>                :            : {</a>
<a name="3265"><span class="lineNum">    3265 </span>                :<span class="lineNoCov">          0 :   QVector&lt;bool&gt; alreadyVisitedEdges( mHalfEdge.count(), false );</span></a>
<a name="3266"><span class="lineNum">    3266 </span>                :            : </a>
<a name="3267"><span class="lineNum">    3267 </span>                :<span class="lineNoCov">          0 :   if ( feedback )</span></a>
<a name="3268"><span class="lineNum">    3268 </span>                :<span class="lineNoCov">          0 :     feedback-&gt;setProgress( 0 );</span></a>
<a name="3269"><span class="lineNum">    3269 </span>                :            : </a>
<a name="3270"><span class="lineNum">    3270 </span>                :<span class="lineNoCov">          0 :   QVector&lt; bool&gt; edgeToTreat( mHalfEdge.count(), true );</span></a>
<a name="3271"><span class="lineNum">    3271 </span>                :<span class="lineNoCov">          0 :   QHash&lt;HalfEdge *, int &gt; edgesHash;</span></a>
<a name="3272"><span class="lineNum">    3272 </span>                :<span class="lineNoCov">          0 :   for ( int i = 0; i &lt; mHalfEdge.count(); ++i )</span></a>
<a name="3273"><span class="lineNum">    3273 </span>                :            :   {</a>
<a name="3274"><span class="lineNum">    3274 </span>                :<span class="lineNoCov">          0 :     edgesHash.insert( mHalfEdge[i], i );</span></a>
<a name="3275"><span class="lineNum">    3275 </span>                :<span class="lineNoCov">          0 :   }</span></a>
<a name="3276"><span class="lineNum">    3276 </span>                :            : </a>
<a name="3277"><span class="lineNum">    3277 </span>                :<span class="lineNoCov">          0 :   QgsMesh mesh;</span></a>
<a name="3278"><span class="lineNum">    3278 </span>                :<span class="lineNoCov">          0 :   for ( const QgsPoint *point : mPointVector )</span></a>
<a name="3279"><span class="lineNum">    3279 </span>                :            :   {</a>
<a name="3280"><span class="lineNum">    3280 </span>                :<span class="lineNoCov">          0 :     mesh.vertices.append( *point );</span></a>
<a name="3281"><span class="lineNum">    3281 </span>                :            :   }</a>
<a name="3282"><span class="lineNum">    3282 </span>                :            : </a>
<a name="3283"><span class="lineNum">    3283 </span>                :<span class="lineNoCov">          0 :   int edgeCount = edgeToTreat.count();</span></a>
<a name="3284"><span class="lineNum">    3284 </span>                :<span class="lineNoCov">          0 :   for ( int i = 0 ; i &lt; edgeCount; ++i )</span></a>
<a name="3285"><span class="lineNum">    3285 </span>                :            :   {</a>
<a name="3286"><span class="lineNum">    3286 </span>                :<span class="lineNoCov">          0 :     bool containVirtualPoint = false;</span></a>
<a name="3287"><span class="lineNum">    3287 </span>                :<span class="lineNoCov">          0 :     if ( edgeToTreat[i] )</span></a>
<a name="3288"><span class="lineNum">    3288 </span>                :            :     {</a>
<a name="3289"><span class="lineNum">    3289 </span>                :<span class="lineNoCov">          0 :       HalfEdge *currentEdge = mHalfEdge[i];</span></a>
<a name="3290"><span class="lineNum">    3290 </span>                :<span class="lineNoCov">          0 :       HalfEdge *firstEdge = currentEdge;</span></a>
<a name="3291"><span class="lineNum">    3291 </span>                :<span class="lineNoCov">          0 :       QgsMeshFace face;</span></a>
<a name="3292"><span class="lineNum">    3292 </span>                :<span class="lineNoCov">          0 :       do</span></a>
<a name="3293"><span class="lineNum">    3293 </span>                :            :       {</a>
<a name="3294"><span class="lineNum">    3294 </span>                :<span class="lineNoCov">          0 :         edgeToTreat[edgesHash.value( currentEdge )] = false;</span></a>
<a name="3295"><span class="lineNum">    3295 </span>                :<span class="lineNoCov">          0 :         face.append( currentEdge-&gt;getPoint() );</span></a>
<a name="3296"><span class="lineNum">    3296 </span>                :<span class="lineNoCov">          0 :         containVirtualPoint |= currentEdge-&gt;getPoint() == -1;</span></a>
<a name="3297"><span class="lineNum">    3297 </span>                :<span class="lineNoCov">          0 :         currentEdge = mHalfEdge.at( currentEdge-&gt;getNext() );</span></a>
<a name="3298"><span class="lineNum">    3298 </span>                :<span class="lineNoCov">          0 :       }</span></a>
<a name="3299"><span class="lineNum">    3299 </span>                :<span class="lineNoCov">          0 :       while ( currentEdge != firstEdge &amp;&amp; !containVirtualPoint &amp;&amp; ( !feedback || !feedback-&gt;isCanceled() ) );</span></a>
<a name="3300"><span class="lineNum">    3300 </span>                :<span class="lineNoCov">          0 :       if ( !containVirtualPoint )</span></a>
<a name="3301"><span class="lineNum">    3301 </span>                :<span class="lineNoCov">          0 :         mesh.faces.append( face );</span></a>
<a name="3302"><span class="lineNum">    3302 </span>                :<span class="lineNoCov">          0 :     }</span></a>
<a name="3303"><span class="lineNum">    3303 </span>                :<span class="lineNoCov">          0 :     if ( feedback )</span></a>
<a name="3304"><span class="lineNum">    3304 </span>                :            :     {</a>
<a name="3305"><span class="lineNum">    3305 </span>                :<span class="lineNoCov">          0 :       feedback-&gt;setProgress( ( 100 *  i ) / edgeCount ) ;</span></a>
<a name="3306"><span class="lineNum">    3306 </span>                :<span class="lineNoCov">          0 :     }</span></a>
<a name="3307"><span class="lineNum">    3307 </span>                :<span class="lineNoCov">          0 :   }</span></a>
<a name="3308"><span class="lineNum">    3308 </span>                :            : </a>
<a name="3309"><span class="lineNum">    3309 </span>                :<span class="lineNoCov">          0 :   return mesh;</span></a>
<a name="3310"><span class="lineNum">    3310 </span>                :<span class="lineNoCov">          0 : }</span></a>
<a name="3311"><span class="lineNum">    3311 </span>                :            : </a>
<a name="3312"><span class="lineNum">    3312 </span>                :<span class="lineNoCov">          0 : double QgsDualEdgeTriangulation::swapMinAngle( int edge ) const</span></a>
<a name="3313"><span class="lineNum">    3313 </span>                :            : {</a>
<a name="3314"><span class="lineNum">    3314 </span>                :<span class="lineNoCov">          0 :   QgsPoint *p1 = point( mHalfEdge[edge]-&gt;getPoint() );</span></a>
<a name="3315"><span class="lineNum">    3315 </span>                :<span class="lineNoCov">          0 :   QgsPoint *p2 = point( mHalfEdge[mHalfEdge[edge]-&gt;getNext()]-&gt;getPoint() );</span></a>
<a name="3316"><span class="lineNum">    3316 </span>                :<span class="lineNoCov">          0 :   QgsPoint *p3 = point( mHalfEdge[mHalfEdge[edge]-&gt;getDual()]-&gt;getPoint() );</span></a>
<a name="3317"><span class="lineNum">    3317 </span>                :<span class="lineNoCov">          0 :   QgsPoint *p4 = point( mHalfEdge[mHalfEdge[mHalfEdge[edge]-&gt;getDual()]-&gt;getNext()]-&gt;getPoint() );</span></a>
<a name="3318"><span class="lineNum">    3318 </span>                :            : </a>
<a name="3319"><span class="lineNum">    3319 </span>                :            :   //search for the minimum angle (it is important, which directions the lines have!)</a>
<a name="3320"><span class="lineNum">    3320 </span>                :            :   double minangle;</a>
<a name="3321"><span class="lineNum">    3321 </span>                :<span class="lineNoCov">          0 :   double angle1 = MathUtils::angle( p1, p2, p4, p2 );</span></a>
<a name="3322"><span class="lineNum">    3322 </span>                :<span class="lineNoCov">          0 :   minangle = angle1;</span></a>
<a name="3323"><span class="lineNum">    3323 </span>                :<span class="lineNoCov">          0 :   double angle2 = MathUtils::angle( p3, p2, p4, p2 );</span></a>
<a name="3324"><span class="lineNum">    3324 </span>                :<span class="lineNoCov">          0 :   if ( angle2 &lt; minangle )</span></a>
<a name="3325"><span class="lineNum">    3325 </span>                :            :   {</a>
<a name="3326"><span class="lineNum">    3326 </span>                :<span class="lineNoCov">          0 :     minangle = angle2;</span></a>
<a name="3327"><span class="lineNum">    3327 </span>                :<span class="lineNoCov">          0 :   }</span></a>
<a name="3328"><span class="lineNum">    3328 </span>                :<span class="lineNoCov">          0 :   double angle3 = MathUtils::angle( p2, p3, p4, p3 );</span></a>
<a name="3329"><span class="lineNum">    3329 </span>                :<span class="lineNoCov">          0 :   if ( angle3 &lt; minangle )</span></a>
<a name="3330"><span class="lineNum">    3330 </span>                :            :   {</a>
<a name="3331"><span class="lineNum">    3331 </span>                :<span class="lineNoCov">          0 :     minangle = angle3;</span></a>
<a name="3332"><span class="lineNum">    3332 </span>                :<span class="lineNoCov">          0 :   }</span></a>
<a name="3333"><span class="lineNum">    3333 </span>                :<span class="lineNoCov">          0 :   double angle4 = MathUtils::angle( p3, p4, p2, p4 );</span></a>
<a name="3334"><span class="lineNum">    3334 </span>                :<span class="lineNoCov">          0 :   if ( angle4 &lt; minangle )</span></a>
<a name="3335"><span class="lineNum">    3335 </span>                :            :   {</a>
<a name="3336"><span class="lineNum">    3336 </span>                :<span class="lineNoCov">          0 :     minangle = angle4;</span></a>
<a name="3337"><span class="lineNum">    3337 </span>                :<span class="lineNoCov">          0 :   }</span></a>
<a name="3338"><span class="lineNum">    3338 </span>                :<span class="lineNoCov">          0 :   double angle5 = MathUtils::angle( p2, p4, p1, p4 );</span></a>
<a name="3339"><span class="lineNum">    3339 </span>                :<span class="lineNoCov">          0 :   if ( angle5 &lt; minangle )</span></a>
<a name="3340"><span class="lineNum">    3340 </span>                :            :   {</a>
<a name="3341"><span class="lineNum">    3341 </span>                :<span class="lineNoCov">          0 :     minangle = angle5;</span></a>
<a name="3342"><span class="lineNum">    3342 </span>                :<span class="lineNoCov">          0 :   }</span></a>
<a name="3343"><span class="lineNum">    3343 </span>                :<span class="lineNoCov">          0 :   double angle6 = MathUtils::angle( p4, p1, p2, p1 );</span></a>
<a name="3344"><span class="lineNum">    3344 </span>                :<span class="lineNoCov">          0 :   if ( angle6 &lt; minangle )</span></a>
<a name="3345"><span class="lineNum">    3345 </span>                :            :   {</a>
<a name="3346"><span class="lineNum">    3346 </span>                :<span class="lineNoCov">          0 :     minangle = angle6;</span></a>
<a name="3347"><span class="lineNum">    3347 </span>                :<span class="lineNoCov">          0 :   }</span></a>
<a name="3348"><span class="lineNum">    3348 </span>                :            : </a>
<a name="3349"><span class="lineNum">    3349 </span>                :<span class="lineNoCov">          0 :   return minangle;</span></a>
<a name="3350"><span class="lineNum">    3350 </span>                :            : }</a>
<a name="3351"><span class="lineNum">    3351 </span>                :            : </a>
<a name="3352"><span class="lineNum">    3352 </span>                :<span class="lineNoCov">          0 : int QgsDualEdgeTriangulation::splitHalfEdge( int edge, float position )</span></a>
<a name="3353"><span class="lineNum">    3353 </span>                :            : {</a>
<a name="3354"><span class="lineNum">    3354 </span>                :            :   //just a short test if position is between 0 and 1</a>
<a name="3355"><span class="lineNum">    3355 </span>                :<span class="lineNoCov">          0 :   if ( position &lt; 0 || position &gt; 1 )</span></a>
<a name="3356"><span class="lineNum">    3356 </span>                :            :   {</a>
<a name="3357"><span class="lineNum">    3357 </span>                :<span class="lineNoCov">          0 :     QgsDebugMsg( QStringLiteral( &quot;warning, position is not between 0 and 1&quot; ) );</span></a>
<a name="3358"><span class="lineNum">    3358 </span>                :<span class="lineNoCov">          0 :   }</span></a>
<a name="3359"><span class="lineNum">    3359 </span>                :            : </a>
<a name="3360"><span class="lineNum">    3360 </span>                :            :   //create the new point on the heap</a>
<a name="3361"><span class="lineNum">    3361 </span>                :<span class="lineNoCov">          0 :   QgsPoint *p = new QgsPoint( mPointVector[mHalfEdge[edge]-&gt;getPoint()]-&gt;x()*position + mPointVector[mHalfEdge[mHalfEdge[edge]-&gt;getDual()]-&gt;getPoint()]-&gt;x() * ( 1 - position ), mPointVector[mHalfEdge[edge]-&gt;getPoint()]-&gt;y()*position + mPointVector[mHalfEdge[mHalfEdge[edge]-&gt;getDual()]-&gt;getPoint()]-&gt;y() * ( 1 - position ), 0 );</span></a>
<a name="3362"><span class="lineNum">    3362 </span>                :            : </a>
<a name="3363"><span class="lineNum">    3363 </span>                :            :   //calculate the z-value of the point to insert</a>
<a name="3364"><span class="lineNum">    3364 </span>                :<span class="lineNoCov">          0 :   QgsPoint zvaluepoint( 0, 0, 0 );</span></a>
<a name="3365"><span class="lineNum">    3365 </span>                :<span class="lineNoCov">          0 :   calcPoint( p-&gt;x(), p-&gt;y(), zvaluepoint );</span></a>
<a name="3366"><span class="lineNum">    3366 </span>                :<span class="lineNoCov">          0 :   p-&gt;setZ( zvaluepoint.z() );</span></a>
<a name="3367"><span class="lineNum">    3367 </span>                :            : </a>
<a name="3368"><span class="lineNum">    3368 </span>                :            :   //insert p into mPointVector</a>
<a name="3369"><span class="lineNum">    3369 </span>                :<span class="lineNoCov">          0 :   if ( mPointVector.count() &gt;= mPointVector.size() )</span></a>
<a name="3370"><span class="lineNum">    3370 </span>                :            :   {</a>
<a name="3371"><span class="lineNum">    3371 </span>                :<span class="lineNoCov">          0 :     mPointVector.resize( mPointVector.count() + 1 );</span></a>
<a name="3372"><span class="lineNum">    3372 </span>                :<span class="lineNoCov">          0 :   }</span></a>
<a name="3373"><span class="lineNum">    3373 </span>                :<span class="lineNoCov">          0 :   QgsDebugMsg( QStringLiteral( &quot;inserting point nr. %1, %2//%3//%4&quot; ).arg( mPointVector.count() ).arg( p-&gt;x() ).arg( p-&gt;y() ).arg( p-&gt;z() ) );</span></a>
<a name="3374"><span class="lineNum">    3374 </span>                :<span class="lineNoCov">          0 :   mPointVector.insert( mPointVector.count(), p );</span></a>
<a name="3375"><span class="lineNum">    3375 </span>                :            : </a>
<a name="3376"><span class="lineNum">    3376 </span>                :            :   //insert the six new halfedges</a>
<a name="3377"><span class="lineNum">    3377 </span>                :<span class="lineNoCov">          0 :   int dualedge = mHalfEdge[edge]-&gt;getDual();</span></a>
<a name="3378"><span class="lineNum">    3378 </span>                :<span class="lineNoCov">          0 :   int edge1 = insertEdge( -10, -10, mPointVector.count() - 1, false, false );</span></a>
<a name="3379"><span class="lineNum">    3379 </span>                :<span class="lineNoCov">          0 :   int edge2 = insertEdge( edge1, mHalfEdge[mHalfEdge[edge]-&gt;getNext()]-&gt;getNext(), mHalfEdge[mHalfEdge[edge]-&gt;getNext()]-&gt;getPoint(), false, false );</span></a>
<a name="3380"><span class="lineNum">    3380 </span>                :<span class="lineNoCov">          0 :   int edge3 = insertEdge( -10, mHalfEdge[mHalfEdge[dualedge]-&gt;getNext()]-&gt;getNext(), mHalfEdge[mHalfEdge[dualedge]-&gt;getNext()]-&gt;getPoint(), false, false );</span></a>
<a name="3381"><span class="lineNum">    3381 </span>                :<span class="lineNoCov">          0 :   int edge4 = insertEdge( edge3, dualedge, mPointVector.count() - 1, false, false );</span></a>
<a name="3382"><span class="lineNum">    3382 </span>                :<span class="lineNoCov">          0 :   int edge5 = insertEdge( -10, mHalfEdge[edge]-&gt;getNext(), mHalfEdge[edge]-&gt;getPoint(), mHalfEdge[edge]-&gt;getBreak(), mHalfEdge[edge]-&gt;getForced() );</span></a>
<a name="3383"><span class="lineNum">    3383 </span>                :<span class="lineNoCov">          0 :   int edge6 = insertEdge( edge5, edge3, mPointVector.count() - 1, mHalfEdge[dualedge]-&gt;getBreak(), mHalfEdge[dualedge]-&gt;getForced() );</span></a>
<a name="3384"><span class="lineNum">    3384 </span>                :<span class="lineNoCov">          0 :   mHalfEdge[edge1]-&gt;setDual( edge2 );</span></a>
<a name="3385"><span class="lineNum">    3385 </span>                :<span class="lineNoCov">          0 :   mHalfEdge[edge1]-&gt;setNext( edge5 );</span></a>
<a name="3386"><span class="lineNum">    3386 </span>                :<span class="lineNoCov">          0 :   mHalfEdge[edge3]-&gt;setDual( edge4 );</span></a>
<a name="3387"><span class="lineNum">    3387 </span>                :<span class="lineNoCov">          0 :   mHalfEdge[edge5]-&gt;setDual( edge6 );</span></a>
<a name="3388"><span class="lineNum">    3388 </span>                :            : </a>
<a name="3389"><span class="lineNum">    3389 </span>                :            :   //adjust the already existing halfedges</a>
<a name="3390"><span class="lineNum">    3390 </span>                :<span class="lineNoCov">          0 :   mHalfEdge[mHalfEdge[edge]-&gt;getNext()]-&gt;setNext( edge1 );</span></a>
<a name="3391"><span class="lineNum">    3391 </span>                :<span class="lineNoCov">          0 :   mHalfEdge[mHalfEdge[dualedge]-&gt;getNext()]-&gt;setNext( edge4 );</span></a>
<a name="3392"><span class="lineNum">    3392 </span>                :<span class="lineNoCov">          0 :   mHalfEdge[edge]-&gt;setNext( edge2 );</span></a>
<a name="3393"><span class="lineNum">    3393 </span>                :<span class="lineNoCov">          0 :   mHalfEdge[edge]-&gt;setPoint( mPointVector.count() - 1 );</span></a>
<a name="3394"><span class="lineNum">    3394 </span>                :<span class="lineNoCov">          0 :   mHalfEdge[mHalfEdge[edge3]-&gt;getNext()]-&gt;setNext( edge6 );</span></a>
<a name="3395"><span class="lineNum">    3395 </span>                :            : </a>
<a name="3396"><span class="lineNum">    3396 </span>                :            :   //test four times recursively for swapping</a>
<a name="3397"><span class="lineNum">    3397 </span>                :<span class="lineNoCov">          0 :   checkSwapRecursively( mHalfEdge[edge5]-&gt;getNext(), 0 );</span></a>
<a name="3398"><span class="lineNum">    3398 </span>                :<span class="lineNoCov">          0 :   checkSwapRecursively( mHalfEdge[edge2]-&gt;getNext(), 0 );</span></a>
<a name="3399"><span class="lineNum">    3399 </span>                :<span class="lineNoCov">          0 :   checkSwapRecursively( mHalfEdge[dualedge]-&gt;getNext(), 0 );</span></a>
<a name="3400"><span class="lineNum">    3400 </span>                :<span class="lineNoCov">          0 :   checkSwapRecursively( mHalfEdge[edge3]-&gt;getNext(), 0 );</span></a>
<a name="3401"><span class="lineNum">    3401 </span>                :            : </a>
<a name="3402"><span class="lineNum">    3402 </span>                :<span class="lineNoCov">          0 :   addPoint( QgsPoint( p-&gt;x(), p-&gt;y(), 0 ) );//dirty hack to enforce update of decorators</span></a>
<a name="3403"><span class="lineNum">    3403 </span>                :            : </a>
<a name="3404"><span class="lineNum">    3404 </span>                :<span class="lineNoCov">          0 :   return mPointVector.count() - 1;</span></a>
<a name="3405"><span class="lineNum">    3405 </span>                :<span class="lineNoCov">          0 : }</span></a>
<a name="3406"><span class="lineNum">    3406 </span>                :            : </a>
<a name="3407"><span class="lineNum">    3407 </span>                :<span class="lineNoCov">          0 : bool QgsDualEdgeTriangulation::edgeOnConvexHull( int edge )</span></a>
<a name="3408"><span class="lineNum">    3408 </span>                :            : {</a>
<a name="3409"><span class="lineNum">    3409 </span>                :<span class="lineNoCov">          0 :   return ( mHalfEdge[mHalfEdge[edge]-&gt;getNext()]-&gt;getPoint() == -1 || mHalfEdge[mHalfEdge[mHalfEdge[edge]-&gt;getDual()]-&gt;getNext()]-&gt;getPoint() == -1 );</span></a>
<a name="3410"><span class="lineNum">    3410 </span>                :            : }</a>
<a name="3411"><span class="lineNum">    3411 </span>                :            : </a>
<a name="3412"><span class="lineNum">    3412 </span>                :<span class="lineNoCov">          0 : void QgsDualEdgeTriangulation::evaluateInfluenceRegion( QgsPoint *point, int edge, QSet&lt;int&gt; &amp;set )</span></a>
<a name="3413"><span class="lineNum">    3413 </span>                :            : {</a>
<a name="3414"><span class="lineNum">    3414 </span>                :<span class="lineNoCov">          0 :   if ( set.find( edge ) == set.end() )</span></a>
<a name="3415"><span class="lineNum">    3415 </span>                :            :   {</a>
<a name="3416"><span class="lineNum">    3416 </span>                :<span class="lineNoCov">          0 :     set.insert( edge );</span></a>
<a name="3417"><span class="lineNum">    3417 </span>                :<span class="lineNoCov">          0 :   }</span></a>
<a name="3418"><span class="lineNum">    3418 </span>                :            :   else//prevent endless loops</a>
<a name="3419"><span class="lineNum">    3419 </span>                :            :   {</a>
<a name="3420"><span class="lineNum">    3420 </span>                :<span class="lineNoCov">          0 :     return;</span></a>
<a name="3421"><span class="lineNum">    3421 </span>                :            :   }</a>
<a name="3422"><span class="lineNum">    3422 </span>                :            : </a>
<a name="3423"><span class="lineNum">    3423 </span>                :<span class="lineNoCov">          0 :   if ( !mHalfEdge[edge]-&gt;getForced() &amp;&amp; !edgeOnConvexHull( edge ) )</span></a>
<a name="3424"><span class="lineNum">    3424 </span>                :            :   {</a>
<a name="3425"><span class="lineNum">    3425 </span>                :            :     //test, if point is in the circle through both endpoints of edge and the endpoint of edge-&gt;dual-&gt;next-&gt;point</a>
<a name="3426"><span class="lineNum">    3426 </span>                :<span class="lineNoCov">          0 :     if ( inCircle( *point, *mPointVector[mHalfEdge[mHalfEdge[edge]-&gt;getDual()]-&gt;getPoint()], *mPointVector[mHalfEdge[edge]-&gt;getPoint()], *mPointVector[mHalfEdge[mHalfEdge[edge]-&gt;getNext()]-&gt;getPoint()] ) )</span></a>
<a name="3427"><span class="lineNum">    3427 </span>                :            :     {</a>
<a name="3428"><span class="lineNum">    3428 </span>                :<span class="lineNoCov">          0 :       evaluateInfluenceRegion( point, mHalfEdge[mHalfEdge[edge]-&gt;getDual()]-&gt;getNext(), set );</span></a>
<a name="3429"><span class="lineNum">    3429 </span>                :<span class="lineNoCov">          0 :       evaluateInfluenceRegion( point, mHalfEdge[mHalfEdge[mHalfEdge[edge]-&gt;getDual()]-&gt;getNext()]-&gt;getNext(), set );</span></a>
<a name="3430"><span class="lineNum">    3430 </span>                :<span class="lineNoCov">          0 :     }</span></a>
<a name="3431"><span class="lineNum">    3431 </span>                :<span class="lineNoCov">          0 :   }</span></a>
<a name="3432"><span class="lineNum">    3432 </span>                :<span class="lineNoCov">          0 : }</span></a>
<a name="3433"><span class="lineNum">    3433 </span>                :            : </a>
<a name="3434"><span class="lineNum">    3434 </span>                :<span class="lineNoCov">          0 : int QgsDualEdgeTriangulation::firstEdgeOutSide()</span></a>
<a name="3435"><span class="lineNum">    3435 </span>                :            : {</a>
<a name="3436"><span class="lineNum">    3436 </span>                :<span class="lineNoCov">          0 :   int edge = 0;</span></a>
<a name="3437"><span class="lineNum">    3437 </span>                :<span class="lineNoCov">          0 :   while ( ( mHalfEdge[mHalfEdge[edge]-&gt;getNext()]-&gt;getPoint() != -1 ||</span></a>
<a name="3438"><span class="lineNum">    3438 </span>                :<span class="lineNoCov">          0 :             mHalfEdge[edge]-&gt;getPoint() == -1 || mHalfEdge[mHalfEdge[edge]-&gt;getDual()]-&gt;getPoint() == -1 ) &amp;&amp;</span></a>
<a name="3439"><span class="lineNum">    3439 </span>                :<span class="lineNoCov">          0 :           edge &lt; mHalfEdge.count() )</span></a>
<a name="3440"><span class="lineNum">    3440 </span>                :            :   {</a>
<a name="3441"><span class="lineNum">    3441 </span>                :<span class="lineNoCov">          0 :     edge++;</span></a>
<a name="3442"><span class="lineNum">    3442 </span>                :            :   }</a>
<a name="3443"><span class="lineNum">    3443 </span>                :            : </a>
<a name="3444"><span class="lineNum">    3444 </span>                :<span class="lineNoCov">          0 :   if ( edge &gt;= mHalfEdge.count() )</span></a>
<a name="3445"><span class="lineNum">    3445 </span>                :<span class="lineNoCov">          0 :     return -1;</span></a>
<a name="3446"><span class="lineNum">    3446 </span>                :            :   else</a>
<a name="3447"><span class="lineNum">    3447 </span>                :<span class="lineNoCov">          0 :     return edge;</span></a>
<a name="3448"><span class="lineNum">    3448 </span>                :<span class="lineNoCov">          0 : }</span></a>
<a name="3449"><span class="lineNum">    3449 </span>                :            : </a>
<a name="3450"><span class="lineNum">    3450 </span>                :<span class="lineNoCov">          0 : void QgsDualEdgeTriangulation::removeLastPoint()</span></a>
<a name="3451"><span class="lineNum">    3451 </span>                :            : {</a>
<a name="3452"><span class="lineNum">    3452 </span>                :<span class="lineNoCov">          0 :   if ( mPointVector.isEmpty() )</span></a>
<a name="3453"><span class="lineNum">    3453 </span>                :<span class="lineNoCov">          0 :     return;</span></a>
<a name="3454"><span class="lineNum">    3454 </span>                :<span class="lineNoCov">          0 :   QgsPoint *p = mPointVector.takeLast();</span></a>
<a name="3455"><span class="lineNum">    3455 </span>                :<span class="lineNoCov">          0 :   delete p;</span></a>
<a name="3456"><span class="lineNum">    3456 </span>                :<span class="lineNoCov">          0 : }</span></a>
</pre>
      </td>
    </tr>
  </table>
  <br>

  <table width="100%" border=0 cellspacing=0 cellpadding=0>
    <tr><td class="ruler"><img src="../../glass.png" width=3 height=3 alt=""></td></tr>
    <tr><td class="versionInfo">Generated by: <a href="http://ltp.sourceforge.net/coverage/lcov.php" target="_parent">LCOV version 1.14</a></td></tr>
  </table>
  <br>

</body>
</html>
