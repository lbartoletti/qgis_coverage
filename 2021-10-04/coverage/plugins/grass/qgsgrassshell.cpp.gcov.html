<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">

<html lang="en">

<head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <title>LCOV - coverage.info.cleaned - plugins/grass/qgsgrassshell.cpp</title>
  <link rel="stylesheet" type="text/css" href="../../gcov.css">
</head>

<body>

  <table width="100%" border=0 cellspacing=0 cellpadding=0>
    <tr><td class="title">LCOV - code coverage report</td></tr>
    <tr><td class="ruler"><img src="../../glass.png" width=3 height=3 alt=""></td></tr>

    <tr>
      <td width="100%">
        <table cellpadding=1 border=0 width="100%">
          <tr>
            <td width="10%" class="headerItem">Current view:</td>
            <td width="35%" class="headerValue"><a href="../../index.html">top level</a> - <a href="index.html">plugins/grass</a> - qgsgrassshell.cpp<span style="font-size: 80%;"> (source / <a href="qgsgrassshell.cpp.func-sort-c.html">functions</a>)</span></td>
            <td width="5%"></td>
            <td width="15%"></td>
            <td width="10%" class="headerCovTableHead">Hit</td>
            <td width="10%" class="headerCovTableHead">Total</td>
            <td width="15%" class="headerCovTableHead">Coverage</td>
          </tr>
          <tr>
            <td class="headerItem">Test:</td>
            <td class="headerValue">coverage.info.cleaned</td>
            <td></td>
            <td class="headerItem">Lines:</td>
            <td class="headerCovTableEntry">0</td>
            <td class="headerCovTableEntry">55</td>
            <td class="headerCovTableEntryLo">0.0 %</td>
          </tr>
          <tr>
            <td class="headerItem">Date:</td>
            <td class="headerValue">2021-10-04 07:08:52</td>
            <td></td>
            <td class="headerItem">Functions:</td>
            <td class="headerCovTableEntry">0</td>
            <td class="headerCovTableEntry">0</td>
            <td class="headerCovTableEntryHi">-</td>
          </tr>
          <tr>
            <td></td>
            <td></td>
            <td></td>
            <td class="headerItem">Branches:</td>
            <td class="headerCovTableEntry">0</td>
            <td class="headerCovTableEntry">0</td>
            <td class="headerCovTableEntryHi">-</td>
          </tr>
          <tr><td><img src="../../glass.png" width=3 height=3 alt=""></td></tr>
        </table>
      </td>
    </tr>

    <tr><td class="ruler"><img src="../../glass.png" width=3 height=3 alt=""></td></tr>
  </table>

  <table cellpadding=0 cellspacing=0 border=0>
    <tr>
      <td><br></td>
    </tr>
    <tr>
      <td>
<pre class="sourceHeading">           Branch data     Line data    Source code</pre>
<pre class="source">
<a name="1"><span class="lineNum">       1 </span>                :            : /***************************************************************************</a>
<a name="2"><span class="lineNum">       2 </span>                :            :      qgsgrassshell.cpp</a>
<a name="3"><span class="lineNum">       3 </span>                :            :      --------------------------------------</a>
<a name="4"><span class="lineNum">       4 </span>                :            :     Date                 : Thu Apr 23 08:35:43 CEST 2009</a>
<a name="5"><span class="lineNum">       5 </span>                :            :     Copyright            : (C) 2009 by Lorenzo &quot;Il Rugginoso&quot; Masini</a>
<a name="6"><span class="lineNum">       6 </span>                :            :     Email                : lorenxo86@gmail.com</a>
<a name="7"><span class="lineNum">       7 </span>                :            :  ***************************************************************************</a>
<a name="8"><span class="lineNum">       8 </span>                :            :  *                                                                         *</a>
<a name="9"><span class="lineNum">       9 </span>                :            :  *   This program is free software; you can redistribute it and/or modify  *</a>
<a name="10"><span class="lineNum">      10 </span>                :            :  *   it under the terms of the GNU General Public License as published by  *</a>
<a name="11"><span class="lineNum">      11 </span>                :            :  *   the Free Software Foundation; either version 2 of the License, or     *</a>
<a name="12"><span class="lineNum">      12 </span>                :            :  *   (at your option) any later version.                                   *</a>
<a name="13"><span class="lineNum">      13 </span>                :            :  *                                                                         *</a>
<a name="14"><span class="lineNum">      14 </span>                :            :  ***************************************************************************/</a>
<a name="15"><span class="lineNum">      15 </span>                :            : #include &lt;QEvent&gt;</a>
<a name="16"><span class="lineNum">      16 </span>                :            : #include &lt;QTabWidget&gt;</a>
<a name="17"><span class="lineNum">      17 </span>                :            : #include &lt;QVBoxLayout&gt;</a>
<a name="18"><span class="lineNum">      18 </span>                :            : #include &lt;QShortcut&gt;</a>
<a name="19"><span class="lineNum">      19 </span>                :            : #include &lt;QKeyEvent&gt;</a>
<a name="20"><span class="lineNum">      20 </span>                :            : #include &lt;QKeySequence&gt;</a>
<a name="21"><span class="lineNum">      21 </span>                :            : </a>
<a name="22"><span class="lineNum">      22 </span>                :            : #include &quot;qgslogger.h&quot;</a>
<a name="23"><span class="lineNum">      23 </span>                :            : #include &quot;qgsapplication.h&quot;</a>
<a name="24"><span class="lineNum">      24 </span>                :            : #include &quot;qtermwidget/qtermwidget.h&quot;</a>
<a name="25"><span class="lineNum">      25 </span>                :            : #include &quot;qgsgrass.h&quot;</a>
<a name="26"><span class="lineNum">      26 </span>                :            : #include &quot;qgsconfig.h&quot;</a>
<a name="27"><span class="lineNum">      27 </span>                :            : </a>
<a name="28"><span class="lineNum">      28 </span>                :            : #include &quot;qgsgrassutils.h&quot;</a>
<a name="29"><span class="lineNum">      29 </span>                :            : #include &quot;qgsgrassshell.h&quot;</a>
<a name="30"><span class="lineNum">      30 </span>                :            : </a>
<a name="31"><span class="lineNum">      31 </span>                :            : extern &quot;C&quot;</a>
<a name="32"><span class="lineNum">      32 </span>                :            : {</a>
<a name="33"><span class="lineNum">      33 </span>                :            : #include &lt;stdlib.h&gt;</a>
<a name="34"><span class="lineNum">      34 </span>                :            : }</a>
<a name="35"><span class="lineNum">      35 </span>                :            : </a>
<a name="36"><span class="lineNum">      36 </span>                :<span class="lineNoCov">          0 : QgsGrassShell::QgsGrassShell( QgsGrassTools *tools, QTabWidget *parent, const char *name )</span></a>
<a name="37"><span class="lineNum">      37 </span>                :<span class="lineNoCov">          0 :   : QFrame( parent )</span></a>
<a name="38"><span class="lineNum">      38 </span>                :<span class="lineNoCov">          0 :   , mTools( tools )</span></a>
<a name="39"><span class="lineNum">      39 </span>                :<span class="lineNoCov">          0 :   , mTabWidget( parent )</span></a>
<a name="40"><span class="lineNum">      40 </span>                :<span class="lineNoCov">          0 : {</span></a>
<a name="41"><span class="lineNum">      41 </span>                :            :   Q_UNUSED( name )</a>
<a name="42"><span class="lineNum">      42 </span>                :<span class="lineNoCov">          0 :   QVBoxLayout *mainLayout = new QVBoxLayout( this );</span></a>
<a name="43"><span class="lineNum">      43 </span>                :<span class="lineNoCov">          0 :   mTerminal = new QTermWidget( 0, this );</span></a>
<a name="44"><span class="lineNum">      44 </span>                :<span class="lineNoCov">          0 :   initTerminal( mTerminal );</span></a>
<a name="45"><span class="lineNum">      45 </span>                :<span class="lineNoCov">          0 :   QShortcut *pasteShortcut = new QShortcut( QKeySequence( tr( &quot;Ctrl+Shift+V&quot; ) ), mTerminal );</span></a>
<a name="46"><span class="lineNum">      46 </span>                :<span class="lineNoCov">          0 :   QShortcut *copyShortcut = new QShortcut( QKeySequence( tr( &quot;Ctrl+Shift+C&quot; ) ), mTerminal );</span></a>
<a name="47"><span class="lineNum">      47 </span>                :            : </a>
<a name="48"><span class="lineNum">      48 </span>                :<span class="lineNoCov">          0 :   mainLayout-&gt;addWidget( mTerminal );</span></a>
<a name="49"><span class="lineNum">      49 </span>                :<span class="lineNoCov">          0 :   setLayout( mainLayout );</span></a>
<a name="50"><span class="lineNum">      50 </span>                :            : </a>
<a name="51"><span class="lineNum">      51 </span>                :<span class="lineNoCov">          0 :   connect( mTerminal, &amp;QTermWidget::finished, this, &amp;QgsGrassShell::closeShell );</span></a>
<a name="52"><span class="lineNum">      52 </span>                :<span class="lineNoCov">          0 :   connect( pasteShortcut, &amp;QShortcut::activated, mTerminal, &amp;QTermWidget::pasteClipboard );</span></a>
<a name="53"><span class="lineNum">      53 </span>                :<span class="lineNoCov">          0 :   connect( copyShortcut, &amp;QShortcut::activated, mTerminal, &amp;QTermWidget::copyClipboard );</span></a>
<a name="54"><span class="lineNum">      54 </span>                :            : </a>
<a name="55"><span class="lineNum">      55 </span>                :            : #if 0</a>
<a name="56"><span class="lineNum">      56 </span>                :            :   // TODO: find a better way to manage the lockfile.</a>
<a name="57"><span class="lineNum">      57 </span>                :            :   // Locking should not be done here, a mapset is either locked by GRASS if QGIS is started from GRASS or it is created by QgsGrass::openMapset</a>
<a name="58"><span class="lineNum">      58 </span>                :            :   mLockFilename = QgsGrass::lockFilePath();</a>
<a name="59"><span class="lineNum">      59 </span>                :            :   QFile::remove( mLockFilename + &quot;.qgis&quot; );</a>
<a name="60"><span class="lineNum">      60 </span>                :            :   if ( !QFile::rename( mLockFilename, mLockFilename + &quot;.qgis&quot; ) )</a>
<a name="61"><span class="lineNum">      61 </span>                :            :   {</a>
<a name="62"><span class="lineNum">      62 </span>                :            :     QMessageBox::warning( this, tr( &quot;Warning&quot; ), tr( &quot;Cannot rename the lock file %1&quot; ).arg( mLockFilename ) );</a>
<a name="63"><span class="lineNum">      63 </span>                :            :   }</a>
<a name="64"><span class="lineNum">      64 </span>                :            : #endif</a>
<a name="65"><span class="lineNum">      65 </span>                :            : </a>
<a name="66"><span class="lineNum">      66 </span>                :<span class="lineNoCov">          0 :   mTerminal-&gt;setSize( 80, 25 );</span></a>
<a name="67"><span class="lineNum">      67 </span>                :            :   //mTerminal-&gt;setColorScheme( COLOR_SCHEME_BLACK_ON_WHITE );</a>
<a name="68"><span class="lineNum">      68 </span>                :<span class="lineNoCov">          0 :   mTerminal-&gt;setColorScheme( QgsApplication::pkgDataPath() + &quot;/grass/qtermwidget/color-schemes/BlackOnWhite.schema&quot; );</span></a>
<a name="69"><span class="lineNum">      69 </span>                :<span class="lineNoCov">          0 :   mTerminal-&gt;startShellProgram();</span></a>
<a name="70"><span class="lineNum">      70 </span>                :<span class="lineNoCov">          0 :   mTerminal-&gt;setFocus( Qt::MouseFocusReason );</span></a>
<a name="71"><span class="lineNum">      71 </span>                :            : </a>
<a name="72"><span class="lineNum">      72 </span>                :            :   // QTermWidget does set default font family Monospace, size 10 via QWidget::setFont()</a>
<a name="73"><span class="lineNum">      73 </span>                :            :   // but QWidget::setFont() does not guarantee to really change the font (see doc)</a>
<a name="74"><span class="lineNum">      74 </span>                :            :   // setStyleSheet() works (it is applied to QTermWidget children TerminalDisplay)</a>
<a name="75"><span class="lineNum">      75 </span>                :<span class="lineNoCov">          0 :   mTerminal-&gt;setStyleSheet( QStringLiteral( &quot;font-family: Monospace; font-size: 10pt;&quot; ) );</span></a>
<a name="76"><span class="lineNum">      76 </span>                :<span class="lineNoCov">          0 : }</span></a>
<a name="77"><span class="lineNum">      77 </span>                :            : </a>
<a name="78"><span class="lineNum">      78 </span>                :<span class="lineNoCov">          0 : bool QgsGrassShell::event( QEvent *e )</span></a>
<a name="79"><span class="lineNum">      79 </span>                :            : {</a>
<a name="80"><span class="lineNum">      80 </span>                :            :   // We have to accept simple shortcuts, QGIS defines shortcuts without Ctrl/Shift for map tools,</a>
<a name="81"><span class="lineNum">      81 </span>                :            :   // for example S for Enable Snapping. See #18262.</a>
<a name="82"><span class="lineNum">      82 </span>                :            :   // See also QWidgetLineControl::processShortcutOverrideEvent and TerminalDisplay::handleShortcutOverrideEvent</a>
<a name="83"><span class="lineNum">      83 </span>                :<span class="lineNoCov">          0 :   if ( e-&gt;type() == QEvent::ShortcutOverride )</span></a>
<a name="84"><span class="lineNum">      84 </span>                :            :   {</a>
<a name="85"><span class="lineNum">      85 </span>                :<span class="lineNoCov">          0 :     QKeyEvent *ke = static_cast&lt;QKeyEvent *&gt;( e );</span></a>
<a name="86"><span class="lineNum">      86 </span>                :<span class="lineNoCov">          0 :     if ( ke-&gt;modifiers() == Qt::NoModifier || ke-&gt;modifiers() == Qt::ShiftModifier</span></a>
<a name="87"><span class="lineNum">      87 </span>                :<span class="lineNoCov">          0 :          || ke-&gt;modifiers() == Qt::KeypadModifier )</span></a>
<a name="88"><span class="lineNum">      88 </span>                :            :     {</a>
<a name="89"><span class="lineNum">      89 </span>                :<span class="lineNoCov">          0 :       if ( ke-&gt;key() &lt; Qt::Key_Escape )</span></a>
<a name="90"><span class="lineNum">      90 </span>                :            :       {</a>
<a name="91"><span class="lineNum">      91 </span>                :<span class="lineNoCov">          0 :         ke-&gt;accept();</span></a>
<a name="92"><span class="lineNum">      92 </span>                :<span class="lineNoCov">          0 :         return true;</span></a>
<a name="93"><span class="lineNum">      93 </span>                :            :       }</a>
<a name="94"><span class="lineNum">      94 </span>                :<span class="lineNoCov">          0 :     }</span></a>
<a name="95"><span class="lineNum">      95 </span>                :<span class="lineNoCov">          0 :   }</span></a>
<a name="96"><span class="lineNum">      96 </span>                :<span class="lineNoCov">          0 :   return QFrame::event( e );</span></a>
<a name="97"><span class="lineNum">      97 </span>                :<span class="lineNoCov">          0 : }</span></a>
<a name="98"><span class="lineNum">      98 </span>                :            : </a>
<a name="99"><span class="lineNum">      99 </span>                :<span class="lineNoCov">          0 : void QgsGrassShell::closeShell()</span></a>
<a name="100"><span class="lineNum">     100 </span>                :            : {</a>
<a name="101"><span class="lineNum">     101 </span>                :<span class="lineNoCov">          0 :   int index = mTabWidget-&gt;indexOf( this );</span></a>
<a name="102"><span class="lineNum">     102 </span>                :<span class="lineNoCov">          0 :   mTabWidget-&gt;removeTab( index );</span></a>
<a name="103"><span class="lineNum">     103 </span>                :            : </a>
<a name="104"><span class="lineNum">     104 </span>                :            : #if 0</a>
<a name="105"><span class="lineNum">     105 </span>                :            :   // TODO: find a better way to manage the lockfile.</a>
<a name="106"><span class="lineNum">     106 </span>                :            :   // No locking should be done here, see above</a>
<a name="107"><span class="lineNum">     107 </span>                :            : </a>
<a name="108"><span class="lineNum">     108 </span>                :            :   if ( !QFile::rename( mLockFilename + &quot;.qgis&quot;, mLockFilename ) )</a>
<a name="109"><span class="lineNum">     109 </span>                :            :   {</a>
<a name="110"><span class="lineNum">     110 </span>                :            :     QMessageBox::warning( this, tr( &quot;Warning&quot; ), tr( &quot;Cannot rename the lock file %1&quot; ).arg( mLockFilename ) );</a>
<a name="111"><span class="lineNum">     111 </span>                :            :   }</a>
<a name="112"><span class="lineNum">     112 </span>                :            : #endif</a>
<a name="113"><span class="lineNum">     113 </span>                :<span class="lineNoCov">          0 :   deleteLater();</span></a>
<a name="114"><span class="lineNum">     114 </span>                :<span class="lineNoCov">          0 : }</span></a>
<a name="115"><span class="lineNum">     115 </span>                :            : </a>
<a name="116"><span class="lineNum">     116 </span>                :<span class="lineNoCov">          0 : void QgsGrassShell::initTerminal( QTermWidget *terminal )</span></a>
<a name="117"><span class="lineNum">     117 </span>                :            : {</a>
<a name="118"><span class="lineNum">     118 </span>                :<span class="lineNoCov">          0 :   QStringList env( ( QString() ) );</span></a>
<a name="119"><span class="lineNum">     119 </span>                :<span class="lineNoCov">          0 :   QStringList args( ( QString() ) );</span></a>
<a name="120"><span class="lineNum">     120 </span>                :            : </a>
<a name="121"><span class="lineNum">     121 </span>                :            :   // GRASS Init.sh should not be started here, it is either run when GRASS is started if QGIS is run from GRASS shell or everything (set environment variables and lock mapset) is done in QgsGrass::openMapset</a>
<a name="122"><span class="lineNum">     122 </span>                :            :   //QString shellProgram = QString( &quot;%1/etc/Init.sh&quot; ).arg( ::getenv( &quot;GISBASE&quot; ) );</a>
<a name="123"><span class="lineNum">     123 </span>                :            : </a>
<a name="124"><span class="lineNum">     124 </span>                :            :   //terminal-&gt;setShellProgram( shellProgram );</a>
<a name="125"><span class="lineNum">     125 </span>                :            : </a>
<a name="126"><span class="lineNum">     126 </span>                :<span class="lineNoCov">          0 :   QString path = getenv( &quot;PATH&quot; );</span></a>
<a name="127"><span class="lineNum">     127 </span>                :<span class="lineNoCov">          0 :   path += QgsGrass::pathSeparator() + QgsGrass::grassModulesPaths().join( QgsGrass::pathSeparator() );</span></a>
<a name="128"><span class="lineNum">     128 </span>                :<span class="lineNoCov">          0 :   QgsDebugMsg( &quot;path = &quot; + path );</span></a>
<a name="129"><span class="lineNum">     129 </span>                :            : </a>
<a name="130"><span class="lineNum">     130 </span>                :<span class="lineNoCov">          0 :   env &lt;&lt; &quot;PATH=&quot; + path;</span></a>
<a name="131"><span class="lineNum">     131 </span>                :<span class="lineNoCov">          0 :   env &lt;&lt; &quot;PYTHONPATH=&quot; + QgsGrass::getPythonPath();</span></a>
<a name="132"><span class="lineNum">     132 </span>                :<span class="lineNoCov">          0 :   env &lt;&lt; QStringLiteral( &quot;TERM=vt100&quot; );</span></a>
<a name="133"><span class="lineNum">     133 </span>                :<span class="lineNoCov">          0 :   env &lt;&lt; QStringLiteral( &quot;GISRC_MODE_MEMORY&quot; );</span></a>
<a name="134"><span class="lineNum">     134 </span>                :            :   // TODO: we should check if these environment variable were set by user before QGIS was started</a>
<a name="135"><span class="lineNum">     135 </span>                :<span class="lineNoCov">          0 :   env &lt;&lt; &quot;GRASS_HTML_BROWSER=&quot; + QgsGrassUtils::htmlBrowserPath();</span></a>
<a name="136"><span class="lineNum">     136 </span>                :<span class="lineNoCov">          0 :   env &lt;&lt; QStringLiteral( &quot;GRASS_WISH=wish&quot; );</span></a>
<a name="137"><span class="lineNum">     137 </span>                :<span class="lineNoCov">          0 :   env &lt;&lt; QStringLiteral( &quot;GRASS_TCLSH=tclsh&quot; );</span></a>
<a name="138"><span class="lineNum">     138 </span>                :<span class="lineNoCov">          0 :   env &lt;&lt; QStringLiteral( &quot;GRASS_PYTHON=python&quot; );</span></a>
<a name="139"><span class="lineNum">     139 </span>                :            : </a>
<a name="140"><span class="lineNum">     140 </span>                :            :   //args &lt;&lt; &quot;-text&quot;;</a>
<a name="141"><span class="lineNum">     141 </span>                :            :   //args &lt;&lt; QString( &quot;%1/%2/%3&quot; ).arg( QgsGrass::getDefaultGisdbase() ).arg( QgsGrass::getDefaultLocation() ).arg( QgsGrass::getDefaultMapset() );</a>
<a name="142"><span class="lineNum">     142 </span>                :            : </a>
<a name="143"><span class="lineNum">     143 </span>                :            :   //terminal-&gt;setArgs( args );</a>
<a name="144"><span class="lineNum">     144 </span>                :<span class="lineNoCov">          0 :   terminal-&gt;setEnvironment( env );</span></a>
<a name="145"><span class="lineNum">     145 </span>                :            : </a>
<a name="146"><span class="lineNum">     146 </span>                :            :   // Look &amp; Feel</a>
<a name="147"><span class="lineNum">     147 </span>                :<span class="lineNoCov">          0 :   terminal-&gt;setScrollBarPosition( QTermWidget::ScrollBarRight );</span></a>
<a name="148"><span class="lineNum">     148 </span>                :<span class="lineNoCov">          0 : }</span></a>
</pre>
      </td>
    </tr>
  </table>
  <br>

  <table width="100%" border=0 cellspacing=0 cellpadding=0>
    <tr><td class="ruler"><img src="../../glass.png" width=3 height=3 alt=""></td></tr>
    <tr><td class="versionInfo">Generated by: <a href="http://ltp.sourceforge.net/coverage/lcov.php" target="_parent">LCOV version 1.15</a></td></tr>
  </table>
  <br>

</body>
</html>
